webpackJsonp(["main"],{

/***/ "./node_modules/moment/locale recursive ^\\.\\/.*$":
/***/ (function(module, exports, __webpack_require__) {

var map = {
	"./af": "./node_modules/moment/locale/af.js",
	"./af.js": "./node_modules/moment/locale/af.js",
	"./ar": "./node_modules/moment/locale/ar.js",
	"./ar-dz": "./node_modules/moment/locale/ar-dz.js",
	"./ar-dz.js": "./node_modules/moment/locale/ar-dz.js",
	"./ar-kw": "./node_modules/moment/locale/ar-kw.js",
	"./ar-kw.js": "./node_modules/moment/locale/ar-kw.js",
	"./ar-ly": "./node_modules/moment/locale/ar-ly.js",
	"./ar-ly.js": "./node_modules/moment/locale/ar-ly.js",
	"./ar-ma": "./node_modules/moment/locale/ar-ma.js",
	"./ar-ma.js": "./node_modules/moment/locale/ar-ma.js",
	"./ar-sa": "./node_modules/moment/locale/ar-sa.js",
	"./ar-sa.js": "./node_modules/moment/locale/ar-sa.js",
	"./ar-tn": "./node_modules/moment/locale/ar-tn.js",
	"./ar-tn.js": "./node_modules/moment/locale/ar-tn.js",
	"./ar.js": "./node_modules/moment/locale/ar.js",
	"./az": "./node_modules/moment/locale/az.js",
	"./az.js": "./node_modules/moment/locale/az.js",
	"./be": "./node_modules/moment/locale/be.js",
	"./be.js": "./node_modules/moment/locale/be.js",
	"./bg": "./node_modules/moment/locale/bg.js",
	"./bg.js": "./node_modules/moment/locale/bg.js",
	"./bm": "./node_modules/moment/locale/bm.js",
	"./bm.js": "./node_modules/moment/locale/bm.js",
	"./bn": "./node_modules/moment/locale/bn.js",
	"./bn-bd": "./node_modules/moment/locale/bn-bd.js",
	"./bn-bd.js": "./node_modules/moment/locale/bn-bd.js",
	"./bn.js": "./node_modules/moment/locale/bn.js",
	"./bo": "./node_modules/moment/locale/bo.js",
	"./bo.js": "./node_modules/moment/locale/bo.js",
	"./br": "./node_modules/moment/locale/br.js",
	"./br.js": "./node_modules/moment/locale/br.js",
	"./bs": "./node_modules/moment/locale/bs.js",
	"./bs.js": "./node_modules/moment/locale/bs.js",
	"./ca": "./node_modules/moment/locale/ca.js",
	"./ca.js": "./node_modules/moment/locale/ca.js",
	"./cs": "./node_modules/moment/locale/cs.js",
	"./cs.js": "./node_modules/moment/locale/cs.js",
	"./cv": "./node_modules/moment/locale/cv.js",
	"./cv.js": "./node_modules/moment/locale/cv.js",
	"./cy": "./node_modules/moment/locale/cy.js",
	"./cy.js": "./node_modules/moment/locale/cy.js",
	"./da": "./node_modules/moment/locale/da.js",
	"./da.js": "./node_modules/moment/locale/da.js",
	"./de": "./node_modules/moment/locale/de.js",
	"./de-at": "./node_modules/moment/locale/de-at.js",
	"./de-at.js": "./node_modules/moment/locale/de-at.js",
	"./de-ch": "./node_modules/moment/locale/de-ch.js",
	"./de-ch.js": "./node_modules/moment/locale/de-ch.js",
	"./de.js": "./node_modules/moment/locale/de.js",
	"./dv": "./node_modules/moment/locale/dv.js",
	"./dv.js": "./node_modules/moment/locale/dv.js",
	"./el": "./node_modules/moment/locale/el.js",
	"./el.js": "./node_modules/moment/locale/el.js",
	"./en-au": "./node_modules/moment/locale/en-au.js",
	"./en-au.js": "./node_modules/moment/locale/en-au.js",
	"./en-ca": "./node_modules/moment/locale/en-ca.js",
	"./en-ca.js": "./node_modules/moment/locale/en-ca.js",
	"./en-gb": "./node_modules/moment/locale/en-gb.js",
	"./en-gb.js": "./node_modules/moment/locale/en-gb.js",
	"./en-ie": "./node_modules/moment/locale/en-ie.js",
	"./en-ie.js": "./node_modules/moment/locale/en-ie.js",
	"./en-il": "./node_modules/moment/locale/en-il.js",
	"./en-il.js": "./node_modules/moment/locale/en-il.js",
	"./en-in": "./node_modules/moment/locale/en-in.js",
	"./en-in.js": "./node_modules/moment/locale/en-in.js",
	"./en-nz": "./node_modules/moment/locale/en-nz.js",
	"./en-nz.js": "./node_modules/moment/locale/en-nz.js",
	"./en-sg": "./node_modules/moment/locale/en-sg.js",
	"./en-sg.js": "./node_modules/moment/locale/en-sg.js",
	"./eo": "./node_modules/moment/locale/eo.js",
	"./eo.js": "./node_modules/moment/locale/eo.js",
	"./es": "./node_modules/moment/locale/es.js",
	"./es-do": "./node_modules/moment/locale/es-do.js",
	"./es-do.js": "./node_modules/moment/locale/es-do.js",
	"./es-mx": "./node_modules/moment/locale/es-mx.js",
	"./es-mx.js": "./node_modules/moment/locale/es-mx.js",
	"./es-us": "./node_modules/moment/locale/es-us.js",
	"./es-us.js": "./node_modules/moment/locale/es-us.js",
	"./es.js": "./node_modules/moment/locale/es.js",
	"./et": "./node_modules/moment/locale/et.js",
	"./et.js": "./node_modules/moment/locale/et.js",
	"./eu": "./node_modules/moment/locale/eu.js",
	"./eu.js": "./node_modules/moment/locale/eu.js",
	"./fa": "./node_modules/moment/locale/fa.js",
	"./fa.js": "./node_modules/moment/locale/fa.js",
	"./fi": "./node_modules/moment/locale/fi.js",
	"./fi.js": "./node_modules/moment/locale/fi.js",
	"./fil": "./node_modules/moment/locale/fil.js",
	"./fil.js": "./node_modules/moment/locale/fil.js",
	"./fo": "./node_modules/moment/locale/fo.js",
	"./fo.js": "./node_modules/moment/locale/fo.js",
	"./fr": "./node_modules/moment/locale/fr.js",
	"./fr-ca": "./node_modules/moment/locale/fr-ca.js",
	"./fr-ca.js": "./node_modules/moment/locale/fr-ca.js",
	"./fr-ch": "./node_modules/moment/locale/fr-ch.js",
	"./fr-ch.js": "./node_modules/moment/locale/fr-ch.js",
	"./fr.js": "./node_modules/moment/locale/fr.js",
	"./fy": "./node_modules/moment/locale/fy.js",
	"./fy.js": "./node_modules/moment/locale/fy.js",
	"./ga": "./node_modules/moment/locale/ga.js",
	"./ga.js": "./node_modules/moment/locale/ga.js",
	"./gd": "./node_modules/moment/locale/gd.js",
	"./gd.js": "./node_modules/moment/locale/gd.js",
	"./gl": "./node_modules/moment/locale/gl.js",
	"./gl.js": "./node_modules/moment/locale/gl.js",
	"./gom-deva": "./node_modules/moment/locale/gom-deva.js",
	"./gom-deva.js": "./node_modules/moment/locale/gom-deva.js",
	"./gom-latn": "./node_modules/moment/locale/gom-latn.js",
	"./gom-latn.js": "./node_modules/moment/locale/gom-latn.js",
	"./gu": "./node_modules/moment/locale/gu.js",
	"./gu.js": "./node_modules/moment/locale/gu.js",
	"./he": "./node_modules/moment/locale/he.js",
	"./he.js": "./node_modules/moment/locale/he.js",
	"./hi": "./node_modules/moment/locale/hi.js",
	"./hi.js": "./node_modules/moment/locale/hi.js",
	"./hr": "./node_modules/moment/locale/hr.js",
	"./hr.js": "./node_modules/moment/locale/hr.js",
	"./hu": "./node_modules/moment/locale/hu.js",
	"./hu.js": "./node_modules/moment/locale/hu.js",
	"./hy-am": "./node_modules/moment/locale/hy-am.js",
	"./hy-am.js": "./node_modules/moment/locale/hy-am.js",
	"./id": "./node_modules/moment/locale/id.js",
	"./id.js": "./node_modules/moment/locale/id.js",
	"./is": "./node_modules/moment/locale/is.js",
	"./is.js": "./node_modules/moment/locale/is.js",
	"./it": "./node_modules/moment/locale/it.js",
	"./it-ch": "./node_modules/moment/locale/it-ch.js",
	"./it-ch.js": "./node_modules/moment/locale/it-ch.js",
	"./it.js": "./node_modules/moment/locale/it.js",
	"./ja": "./node_modules/moment/locale/ja.js",
	"./ja.js": "./node_modules/moment/locale/ja.js",
	"./jv": "./node_modules/moment/locale/jv.js",
	"./jv.js": "./node_modules/moment/locale/jv.js",
	"./ka": "./node_modules/moment/locale/ka.js",
	"./ka.js": "./node_modules/moment/locale/ka.js",
	"./kk": "./node_modules/moment/locale/kk.js",
	"./kk.js": "./node_modules/moment/locale/kk.js",
	"./km": "./node_modules/moment/locale/km.js",
	"./km.js": "./node_modules/moment/locale/km.js",
	"./kn": "./node_modules/moment/locale/kn.js",
	"./kn.js": "./node_modules/moment/locale/kn.js",
	"./ko": "./node_modules/moment/locale/ko.js",
	"./ko.js": "./node_modules/moment/locale/ko.js",
	"./ku": "./node_modules/moment/locale/ku.js",
	"./ku.js": "./node_modules/moment/locale/ku.js",
	"./ky": "./node_modules/moment/locale/ky.js",
	"./ky.js": "./node_modules/moment/locale/ky.js",
	"./lb": "./node_modules/moment/locale/lb.js",
	"./lb.js": "./node_modules/moment/locale/lb.js",
	"./lo": "./node_modules/moment/locale/lo.js",
	"./lo.js": "./node_modules/moment/locale/lo.js",
	"./lt": "./node_modules/moment/locale/lt.js",
	"./lt.js": "./node_modules/moment/locale/lt.js",
	"./lv": "./node_modules/moment/locale/lv.js",
	"./lv.js": "./node_modules/moment/locale/lv.js",
	"./me": "./node_modules/moment/locale/me.js",
	"./me.js": "./node_modules/moment/locale/me.js",
	"./mi": "./node_modules/moment/locale/mi.js",
	"./mi.js": "./node_modules/moment/locale/mi.js",
	"./mk": "./node_modules/moment/locale/mk.js",
	"./mk.js": "./node_modules/moment/locale/mk.js",
	"./ml": "./node_modules/moment/locale/ml.js",
	"./ml.js": "./node_modules/moment/locale/ml.js",
	"./mn": "./node_modules/moment/locale/mn.js",
	"./mn.js": "./node_modules/moment/locale/mn.js",
	"./mr": "./node_modules/moment/locale/mr.js",
	"./mr.js": "./node_modules/moment/locale/mr.js",
	"./ms": "./node_modules/moment/locale/ms.js",
	"./ms-my": "./node_modules/moment/locale/ms-my.js",
	"./ms-my.js": "./node_modules/moment/locale/ms-my.js",
	"./ms.js": "./node_modules/moment/locale/ms.js",
	"./mt": "./node_modules/moment/locale/mt.js",
	"./mt.js": "./node_modules/moment/locale/mt.js",
	"./my": "./node_modules/moment/locale/my.js",
	"./my.js": "./node_modules/moment/locale/my.js",
	"./nb": "./node_modules/moment/locale/nb.js",
	"./nb.js": "./node_modules/moment/locale/nb.js",
	"./ne": "./node_modules/moment/locale/ne.js",
	"./ne.js": "./node_modules/moment/locale/ne.js",
	"./nl": "./node_modules/moment/locale/nl.js",
	"./nl-be": "./node_modules/moment/locale/nl-be.js",
	"./nl-be.js": "./node_modules/moment/locale/nl-be.js",
	"./nl.js": "./node_modules/moment/locale/nl.js",
	"./nn": "./node_modules/moment/locale/nn.js",
	"./nn.js": "./node_modules/moment/locale/nn.js",
	"./oc-lnc": "./node_modules/moment/locale/oc-lnc.js",
	"./oc-lnc.js": "./node_modules/moment/locale/oc-lnc.js",
	"./pa-in": "./node_modules/moment/locale/pa-in.js",
	"./pa-in.js": "./node_modules/moment/locale/pa-in.js",
	"./pl": "./node_modules/moment/locale/pl.js",
	"./pl.js": "./node_modules/moment/locale/pl.js",
	"./pt": "./node_modules/moment/locale/pt.js",
	"./pt-br": "./node_modules/moment/locale/pt-br.js",
	"./pt-br.js": "./node_modules/moment/locale/pt-br.js",
	"./pt.js": "./node_modules/moment/locale/pt.js",
	"./ro": "./node_modules/moment/locale/ro.js",
	"./ro.js": "./node_modules/moment/locale/ro.js",
	"./ru": "./node_modules/moment/locale/ru.js",
	"./ru.js": "./node_modules/moment/locale/ru.js",
	"./sd": "./node_modules/moment/locale/sd.js",
	"./sd.js": "./node_modules/moment/locale/sd.js",
	"./se": "./node_modules/moment/locale/se.js",
	"./se.js": "./node_modules/moment/locale/se.js",
	"./si": "./node_modules/moment/locale/si.js",
	"./si.js": "./node_modules/moment/locale/si.js",
	"./sk": "./node_modules/moment/locale/sk.js",
	"./sk.js": "./node_modules/moment/locale/sk.js",
	"./sl": "./node_modules/moment/locale/sl.js",
	"./sl.js": "./node_modules/moment/locale/sl.js",
	"./sq": "./node_modules/moment/locale/sq.js",
	"./sq.js": "./node_modules/moment/locale/sq.js",
	"./sr": "./node_modules/moment/locale/sr.js",
	"./sr-cyrl": "./node_modules/moment/locale/sr-cyrl.js",
	"./sr-cyrl.js": "./node_modules/moment/locale/sr-cyrl.js",
	"./sr.js": "./node_modules/moment/locale/sr.js",
	"./ss": "./node_modules/moment/locale/ss.js",
	"./ss.js": "./node_modules/moment/locale/ss.js",
	"./sv": "./node_modules/moment/locale/sv.js",
	"./sv.js": "./node_modules/moment/locale/sv.js",
	"./sw": "./node_modules/moment/locale/sw.js",
	"./sw.js": "./node_modules/moment/locale/sw.js",
	"./ta": "./node_modules/moment/locale/ta.js",
	"./ta.js": "./node_modules/moment/locale/ta.js",
	"./te": "./node_modules/moment/locale/te.js",
	"./te.js": "./node_modules/moment/locale/te.js",
	"./tet": "./node_modules/moment/locale/tet.js",
	"./tet.js": "./node_modules/moment/locale/tet.js",
	"./tg": "./node_modules/moment/locale/tg.js",
	"./tg.js": "./node_modules/moment/locale/tg.js",
	"./th": "./node_modules/moment/locale/th.js",
	"./th.js": "./node_modules/moment/locale/th.js",
	"./tk": "./node_modules/moment/locale/tk.js",
	"./tk.js": "./node_modules/moment/locale/tk.js",
	"./tl-ph": "./node_modules/moment/locale/tl-ph.js",
	"./tl-ph.js": "./node_modules/moment/locale/tl-ph.js",
	"./tlh": "./node_modules/moment/locale/tlh.js",
	"./tlh.js": "./node_modules/moment/locale/tlh.js",
	"./tr": "./node_modules/moment/locale/tr.js",
	"./tr.js": "./node_modules/moment/locale/tr.js",
	"./tzl": "./node_modules/moment/locale/tzl.js",
	"./tzl.js": "./node_modules/moment/locale/tzl.js",
	"./tzm": "./node_modules/moment/locale/tzm.js",
	"./tzm-latn": "./node_modules/moment/locale/tzm-latn.js",
	"./tzm-latn.js": "./node_modules/moment/locale/tzm-latn.js",
	"./tzm.js": "./node_modules/moment/locale/tzm.js",
	"./ug-cn": "./node_modules/moment/locale/ug-cn.js",
	"./ug-cn.js": "./node_modules/moment/locale/ug-cn.js",
	"./uk": "./node_modules/moment/locale/uk.js",
	"./uk.js": "./node_modules/moment/locale/uk.js",
	"./ur": "./node_modules/moment/locale/ur.js",
	"./ur.js": "./node_modules/moment/locale/ur.js",
	"./uz": "./node_modules/moment/locale/uz.js",
	"./uz-latn": "./node_modules/moment/locale/uz-latn.js",
	"./uz-latn.js": "./node_modules/moment/locale/uz-latn.js",
	"./uz.js": "./node_modules/moment/locale/uz.js",
	"./vi": "./node_modules/moment/locale/vi.js",
	"./vi.js": "./node_modules/moment/locale/vi.js",
	"./x-pseudo": "./node_modules/moment/locale/x-pseudo.js",
	"./x-pseudo.js": "./node_modules/moment/locale/x-pseudo.js",
	"./yo": "./node_modules/moment/locale/yo.js",
	"./yo.js": "./node_modules/moment/locale/yo.js",
	"./zh-cn": "./node_modules/moment/locale/zh-cn.js",
	"./zh-cn.js": "./node_modules/moment/locale/zh-cn.js",
	"./zh-hk": "./node_modules/moment/locale/zh-hk.js",
	"./zh-hk.js": "./node_modules/moment/locale/zh-hk.js",
	"./zh-mo": "./node_modules/moment/locale/zh-mo.js",
	"./zh-mo.js": "./node_modules/moment/locale/zh-mo.js",
	"./zh-tw": "./node_modules/moment/locale/zh-tw.js",
	"./zh-tw.js": "./node_modules/moment/locale/zh-tw.js"
};
function webpackContext(req) {
	return __webpack_require__(webpackContextResolve(req));
};
function webpackContextResolve(req) {
	var id = map[req];
	if(!(id + 1)) // check for number or string
		throw new Error("Cannot find module '" + req + "'.");
	return id;
};
webpackContext.keys = function webpackContextKeys() {
	return Object.keys(map);
};
webpackContext.resolve = webpackContextResolve;
module.exports = webpackContext;
webpackContext.id = "./node_modules/moment/locale recursive ^\\.\\/.*$";

/***/ }),

/***/ "./redbox-portal/angular/shared/StringTemplatePipe.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var StringTemplatePipe = /** @class */ (function () {
    function StringTemplatePipe() {
        this.generateTemplateString = (function () {
            var cache = {};
            function generateTemplate(template) {
                var fn = cache[template];
                if (!fn) {
                    // Replace ${expressions} (etc) with ${map.expressions}.
                    var sanitized = template
                        .replace(/\$\{([\s]*[^;\s\{]+[\s]*)\}/g, function (_, match) {
                        return "${map." + match.trim() + "}";
                    })
                        .replace(/(\$\{(?!map\.)[^}]+\})/g, '');
                    fn = Function('map', "return `" + sanitized + "`");
                }
                return fn;
            }
            ;
            return generateTemplate;
        })();
    }
    StringTemplatePipe.prototype.transform = function (templateString, args) {
        if (args != null) {
            var template = this.generateTemplateString(templateString);
            return template(args);
        }
        return templateString;
    };
    StringTemplatePipe = __decorate([
        core_1.Pipe({
            name: 'stringTemplate'
        })
    ], StringTemplatePipe);
    return StringTemplatePipe;
}());
exports.StringTemplatePipe = StringTemplatePipe;


/***/ }),

/***/ "./redbox-portal/angular/shared/ands-service.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var http_1 = __webpack_require__("./node_modules/@angular/http/esm5/http.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/map.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/toPromise.js");
var base_service_1 = __webpack_require__("./redbox-portal/angular/shared/base-service.ts");
var config_service_1 = __webpack_require__("./redbox-portal/angular/shared/config-service.ts");
var translation_service_1 = __webpack_require__("./redbox-portal/angular/shared/translation-service.ts");
var ANDSService = /** @class */ (function (_super) {
    __extends(ANDSService, _super);
    function ANDSService(http, configService, translator) {
        var _this = _super.call(this, http, configService) || this;
        _this.configService = configService;
        _this.translator = translator;
        return _this;
    }
    ANDSService.prototype.getResourceDetails = function (uri, vocab) {
        var _this = this;
        return this.http.get(this.brandingAndPortalUrl + "/ands/vocab/resourceDetails?uri=" + uri + "&vocab=" + vocab, this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    ANDSService = __decorate([
        core_1.Injectable(),
        __param(0, core_1.Inject(http_1.Http)),
        __param(1, core_1.Inject(config_service_1.ConfigService)),
        __param(2, core_1.Inject(translation_service_1.TranslationService)),
        __metadata("design:paramtypes", [http_1.Http,
            config_service_1.ConfigService,
            translation_service_1.TranslationService])
    ], ANDSService);
    return ANDSService;
}(base_service_1.BaseService));
exports.ANDSService = ANDSService;


/***/ }),

/***/ "./redbox-portal/angular/shared/base-service.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
Object.defineProperty(exports, "__esModule", { value: true });
var http_1 = __webpack_require__("./node_modules/@angular/http/esm5/http.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/observable/interval.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/observable/of.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/mergeMap.js");
var Subject_1 = __webpack_require__("./node_modules/rxjs/_esm5/Subject.js");
/**
 * Base class for all client-side services...
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 *
 */
var BaseService = /** @class */ (function () {
    function BaseService(http, configService) {
        var _this = this;
        this.http = http;
        this.configService = configService;
        this.initSubject = new Subject_1.Subject();
        this.configService.getConfig(function (config) {
            _this.config = config;
            _this.baseUrl = _this.config.baseUrl;
            _this.brandingAndPortalUrl = _this.baseUrl + "/" + _this.config.branding + "/" + _this.config.portal;
            _this.options = _this.getOptionsClient();
            _this.emitInit();
        });
    }
    Object.defineProperty(BaseService.prototype, "getBrandingAndPortalUrl", {
        get: function () {
            return this.brandingAndPortalUrl;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BaseService.prototype, "getBaseUrl", {
        get: function () {
            return this.baseUrl;
        },
        enumerable: true,
        configurable: true
    });
    BaseService.prototype.waitForInit = function (handler) {
        var subs = this.initSubject.subscribe(handler);
        this.emitInit();
        return subs;
    };
    BaseService.prototype.getInitSubject = function () {
        return this.initSubject;
    };
    BaseService.prototype.emitInit = function () {
        if (this.config) {
            this.initSubject.next(this);
        }
    };
    BaseService.prototype.getConfig = function () {
        return this.config;
    };
    BaseService.prototype.extractData = function (res, parentField) {
        if (parentField === void 0) { parentField = null; }
        var body = res.json();
        if (parentField) {
            return body[parentField] || {};
        }
        else {
            return body || {};
        }
    };
    BaseService.prototype.getOptions = function (headersObj) {
        var headers = new http_1.Headers(headersObj);
        return new http_1.RequestOptions({ headers: headers });
    };
    BaseService.prototype.getOptionsClient = function (headersObj) {
        if (headersObj === void 0) { headersObj = {}; }
        headersObj['X-Source'] = 'jsclient';
        headersObj['Content-Type'] = 'application/json;charset=utf-8';
        headersObj['X-CSRF-Token'] = this.config.csrfToken;
        return this.getOptions(headersObj);
    };
    return BaseService;
}());
exports.BaseService = BaseService;


/***/ }),

/***/ "./redbox-portal/angular/shared/config-service.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var http_1 = __webpack_require__("./node_modules/@angular/http/esm5/http.js");
var Subject_1 = __webpack_require__("./node_modules/rxjs/_esm5/Subject.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/observable/interval.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/observable/of.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/mergeMap.js");
/**
 * Handles client-side global configuration
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 *
 */
var ConfigService = /** @class */ (function () {
    function ConfigService(http) {
        this.http = http;
        this.subjects = {};
        this.subjects['get'] = new Subject_1.Subject();
        this.initConfig();
    }
    ConfigService.prototype.getConfig = function (handler) {
        var subs = this.subjects['get'].subscribe(handler);
        this.emitConfig();
        return subs;
    };
    ConfigService.prototype.emitConfig = function () {
        if (this.config) {
            this.subjects['get'].next(this.config);
        }
    };
    ConfigService.prototype.initConfig = function () {
        var _this = this;
        this.http.get("/csrfToken").mergeMap(function (csrfRes) {
            _this.csrfToken = csrfRes.json()['_csrf'];
            return _this.http.get("/dynamic/apiClientConfig?v=" + new Date().getTime());
        })
            .subscribe(function (res) {
            _this.config = _this.extractData(res);
            _this.config['csrfToken'] = _this.csrfToken;
            console.log("ConfigService, initialized. ");
            _this.emitConfig();
        });
    };
    ConfigService.prototype.extractData = function (res, parentField) {
        if (parentField === void 0) { parentField = null; }
        var body = res.json();
        if (parentField) {
            return body[parentField] || {};
        }
        else {
            return body || {};
        }
    };
    ConfigService = __decorate([
        core_1.Injectable(),
        __param(0, core_1.Inject(http_1.Http)),
        __metadata("design:paramtypes", [Object])
    ], ConfigService);
    return ConfigService;
}());
exports.ConfigService = ConfigService;


/***/ }),

/***/ "./redbox-portal/angular/shared/dashboard-service.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var http_1 = __webpack_require__("./node_modules/@angular/http/esm5/http.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/map.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/toPromise.js");
var moment = __webpack_require__("./node_modules/moment/moment.js");
var base_service_1 = __webpack_require__("./redbox-portal/angular/shared/base-service.ts");
var config_service_1 = __webpack_require__("./redbox-portal/angular/shared/config-service.ts");
var translation_service_1 = __webpack_require__("./redbox-portal/angular/shared/translation-service.ts");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var DashboardService = /** @class */ (function (_super) {
    __extends(DashboardService, _super);
    function DashboardService(http, configService, translator) {
        var _this = _super.call(this, http, configService) || this;
        _this.configService = configService;
        _this.translator = translator;
        return _this;
    }
    DashboardService.prototype.getAllDraftPlansCanEdit = function () {
        var _this = this;
        var rows = this.config.maxTransferRowsPerPage;
        var start = 0;
        return this.http.get(this.brandingAndPortalUrl + "/listRecords?recordType=rdmp&state=draft&editOnly=true&start=" + start + "&rows=" + rows + "&ts=" + moment().unix(), this.options)
            .toPromise()
            .then(function (res) { return _this.formatDates(_this.extractData(res)); });
    };
    DashboardService.prototype.getAllRecordsCanEdit = function (recordType, state) {
        var _this = this;
        var rows = this.config.maxTransferRowsPerPage;
        var start = 0;
        var url = this.brandingAndPortalUrl + "/listRecords?recordType=" + recordType + "&editOnly=true&start=" + start + "&rows=" + rows + "&ts=" + moment().unix();
        if (state != '') {
            url += "&state=" + state;
        }
        return this.http.get(url, this.options)
            .toPromise()
            .then(function (res) { return _this.formatDates(_this.extractData(res)); });
    };
    DashboardService.prototype.getActivePlans = function (pageNumber) {
        var _this = this;
        var rows = 10;
        var start = (pageNumber - 1) * rows;
        return this.http.get(this.brandingAndPortalUrl + "/listRecords?state=active&start=" + start + "&rows=" + rows + "&ts=" + moment().unix(), this.options)
            .toPromise()
            .then(function (res) { return _this.formatDates(_this.extractData(res)); });
    };
    DashboardService.prototype.getDraftPlans = function (pageNumber) {
        var _this = this;
        var rows = 10;
        var start = (pageNumber - 1) * rows;
        return this.http.get(this.brandingAndPortalUrl + "/listRecords?recordType=rdmp&state=draft&start=" + start + "&rows=" + rows + "&ts=" + moment().unix(), this.options)
            .toPromise()
            .then(function (res) { return _this.formatDates(_this.extractData(res)); });
    };
    DashboardService.prototype.getRecords = function (recordType, state, pageNumber, packageType, sort) {
        var _this = this;
        if (packageType === void 0) { packageType = undefined; }
        if (sort === void 0) { sort = undefined; }
        var rows = 10;
        var start = (pageNumber - 1) * rows;
        recordType = (!_.isEmpty(recordType) && !_.isUndefined(recordType)) ? "recordType=" + recordType : '';
        packageType = (!_.isEmpty(packageType) && !_.isUndefined(packageType)) ? "packageType=" + packageType : '';
        sort = (!_.isEmpty(sort) && !_.isUndefined(sort)) ? "&sort=" + sort : '';
        state = (!_.isEmpty(state) && !_.isUndefined(state)) ? "&state=" + state : '';
        return this.http.get(this.brandingAndPortalUrl + "/listRecords?" + recordType + packageType + state + sort + "&start=" + start + "&rows=" + rows + "&ts=" + moment().unix(), this.options)
            .toPromise()
            .then(function (res) { return _this.formatDates(_this.extractData(res)); });
    };
    DashboardService.prototype.formatDates = function (response) {
        var items = response["items"];
        for (var i = 0; i < items.length; i++) {
            items[i]["dateCreated"] = moment(items[i]["dateCreated"]).local().format('LLL');
            items[i]["dateModified"] = moment(items[i]["dateModified"]).local().format('LLL');
        }
        return response;
    };
    DashboardService.prototype.setDashboardTitle = function (planTable, plans) {
        var _this = this;
        if (plans === void 0) { plans = null; }
        _.forEach(planTable ? planTable.items : plans, function (plan) {
            plan.dashboardTitle = (_.isUndefined(plan.title) || _.isEmpty(plan.title) || _.isEmpty(plan.title[0])) ? _this.translator.t('plan-with-no-title') : plan.title;
        });
    };
    DashboardService.prototype.searchRecords = function (pageNumber, basicSearch, facets) {
        var _this = this;
        if (facets === void 0) { facets = null; }
        var rows = this.config.maxSearchRowsPerPage;
        var start = (pageNumber - 1) * rows;
        return this.http.get(this.brandingAndPortalUrl + "/searchPlans?start=" + start + "&rows=" + rows + "&query=" + basicSearch + "&facets=" + facets + "&ts=" + moment().unix(), this.options)
            .toPromise()
            .then(function (res) { return _this.formatDates(_this.extractData(res)); });
    };
    DashboardService = __decorate([
        core_1.Injectable(),
        __param(0, core_1.Inject(http_1.Http)),
        __param(1, core_1.Inject(config_service_1.ConfigService)),
        __param(2, core_1.Inject(translation_service_1.TranslationService)),
        __metadata("design:paramtypes", [http_1.Http,
            config_service_1.ConfigService,
            translation_service_1.TranslationService])
    ], DashboardService);
    return DashboardService;
}(base_service_1.BaseService));
exports.DashboardService = DashboardService;


/***/ }),

/***/ "./redbox-portal/angular/shared/email-service.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var http_1 = __webpack_require__("./node_modules/@angular/http/esm5/http.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/map.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/toPromise.js");
var base_service_1 = __webpack_require__("./redbox-portal/angular/shared/base-service.ts");
var config_service_1 = __webpack_require__("./redbox-portal/angular/shared/config-service.ts");
/**
 * User related service...
 *
 * @author <a target='_' href='https://github.com/thomcuddihy'>Thom Cuddihy</a>
 *
 */
var EmailNotificationService = /** @class */ (function (_super) {
    __extends(EmailNotificationService, _super);
    function EmailNotificationService(http, configService) {
        var _this = _super.call(this, http, configService) || this;
        _this.configService = configService;
        return _this;
    }
    EmailNotificationService.prototype.sendNotification = function (to, template, data, subject, from) {
        if (data === void 0) { data = {}; }
        if (subject === void 0) { subject = null; }
        if (from === void 0) { from = null; }
        var payload = { to: to, template: template, data: data };
        if (subject) {
            payload['subject'] = subject;
        }
        if (from) {
            payload['from'] = from;
        }
        return this.http.post(this.brandingAndPortalUrl + "/api/sendNotification", payload, this.getOptionsClient())
            .toPromise()
            .then(this.extractData);
    };
    EmailNotificationService = __decorate([
        core_1.Injectable(),
        __param(0, core_1.Inject(http_1.Http)), __param(1, core_1.Inject(config_service_1.ConfigService)),
        __metadata("design:paramtypes", [http_1.Http, config_service_1.ConfigService])
    ], EmailNotificationService);
    return EmailNotificationService;
}(base_service_1.BaseService));
exports.EmailNotificationService = EmailNotificationService;


/***/ }),

/***/ "./redbox-portal/angular/shared/fieldClasses.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var field_simple_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.ts");
var field_textfield_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-textfield.component.ts");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var record_meta_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/record-meta.component.ts");
var field_vocab_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-vocab.component.ts");
var field_repeatable_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-repeatable.component.ts");
var field_contributor_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-contributor.component.ts");
var workflow_button_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/workflow-button.component.ts");
var action_button_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/action-button.component.ts");
var field_relatedobjectdata_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-relatedobjectdata.component.ts");
var field_recordpermissions_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-recordpermissions.component.ts");
var field_datalocation_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-datalocation.component.ts");
var field_relatedobjectselector_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-relatedobjectselector.component.ts");
var field_relatedfileupload_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-relatedfileupload.component.ts");
var field_publishdatalocationselector_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-publishdatalocationselector.component.ts");
var field_map_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-map.component.ts");
var field_group_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-group.component.ts");
var workspace_field_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/workspace-field.component.ts");
var workspace_selector_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/workspace-selector.component.ts");
var workspace_select_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/workspace-select.component.ts");
var workspace_register_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/workspace-register.component.ts");
var field_andsvocab_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-andsvocab.component.ts");
var field_pdflist_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-pdflist.component.ts");
var field_asynch_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-asynch.component.ts");
var field_publish_data_location_refresh_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-publish-data-location-refresh.component.ts");
var html_event_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/html-event.component.ts");
exports.fieldClasses = {
    'TextField': { 'meta': field_textfield_component_1.TextField, 'comp': field_textfield_component_1.TextFieldComponent },
    'TextArea': { 'meta': field_textfield_component_1.TextArea, 'comp': field_textfield_component_1.TextAreaComponent },
    'MarkdownTextArea': { 'meta': field_textfield_component_1.MarkdownTextArea, 'comp': field_textfield_component_1.MarkdownTextAreaComponent },
    'DateTime': { 'meta': field_simple_1.DateTime, 'comp': field_simple_component_1.DateTimeComponent },
    'Container': { 'meta': field_simple_1.Container, 'comp': [field_simple_component_1.TextBlockComponent, field_group_component_1.GenericGroupComponent] },
    'TabOrAccordionContainer': { 'meta': field_simple_1.TabOrAccordionContainer, 'comp': field_simple_component_1.TabOrAccordionContainerComponent },
    'ButtonBarContainer': { 'meta': field_simple_1.ButtonBarContainer, 'comp': field_simple_component_1.ButtonBarContainerComponent },
    'AnchorOrButton': { 'meta': field_simple_1.AnchorOrButton, 'comp': field_simple_component_1.AnchorOrButtonComponent },
    'SaveButton': { 'meta': field_simple_1.SaveButton, 'comp': field_simple_component_1.SaveButtonComponent },
    'CancelButton': { 'meta': field_simple_1.CancelButton, 'comp': field_simple_component_1.CancelButtonComponent },
    'VocabField': { 'meta': field_vocab_component_1.VocabField, 'comp': field_vocab_component_1.VocabFieldComponent, 'lookupService': 'vocabFieldLookupService' },
    'RepeatableContainer': { 'meta': field_repeatable_component_1.RepeatableContainer, 'comp': [field_repeatable_component_1.RepeatableVocabComponent, field_textfield_component_1.RepeatableTextfieldComponent, field_group_component_1.RepeatableGroupComponent] },
    'RepeatableContributor': { 'meta': field_repeatable_component_1.RepeatableContributor, 'comp': field_repeatable_component_1.RepeatableContributorComponent },
    'RepeatableVocab': { 'meta': field_repeatable_component_1.RepeatableVocab, 'comp': field_repeatable_component_1.RepeatableVocabComponent },
    'ContributorField': { 'meta': field_contributor_component_1.ContributorField, 'comp': field_contributor_component_1.ContributorComponent, 'lookupService': 'vocabFieldLookupService' },
    'HiddenValue': { 'meta': field_simple_1.HiddenValue, 'comp': field_simple_component_1.HiddenValueComponent },
    'WorkflowStepButton': { 'meta': workflow_button_component_1.WorkflowStepButton, 'comp': workflow_button_component_1.WorkflowStepButtonComponent },
    'ActionButton': { 'meta': action_button_component_1.ActionButton, 'comp': action_button_component_1.ActionButtonComponent },
    'LinkValueComponent': { 'meta': field_simple_1.LinkValue, 'comp': field_simple_component_1.LinkValueComponent },
    'SelectionField': { 'meta': field_simple_1.SelectionField, 'comp': [field_simple_component_1.SelectionFieldComponent, field_simple_component_1.DropdownFieldComponent] },
    'RelatedObjectDataField': { 'meta': field_relatedobjectdata_component_1.RelatedObjectDataField, 'comp': field_relatedobjectdata_component_1.RelatedObjectDataComponent, 'lookupService': 'vocabFieldLookupService' },
    'RecordPermissionsField': { 'meta': field_recordpermissions_component_1.RecordPermissionsField, 'comp': field_recordpermissions_component_1.RecordPermissionsComponent, 'lookupService': 'vocabFieldLookupService' },
    'MapField': { 'meta': field_map_component_1.MapField, 'comp': field_map_component_1.MapComponent, 'lookupService': 'vocabFieldLookupService' },
    'ParameterRetriever': { 'meta': field_simple_1.ParameterRetrieverField, 'comp': field_simple_component_1.ParameterRetrieverComponent },
    'RecordMetadataRetriever': { 'meta': record_meta_component_1.RecordMetadataRetrieverField, 'comp': record_meta_component_1.RecordMetadataRetrieverComponent },
    'RelatedObjectSelector': { 'meta': field_relatedobjectselector_component_1.RelatedObjectSelectorField, 'comp': field_relatedobjectselector_component_1.RelatedObjectSelectorComponent },
    'RelatedFileUpload': { 'meta': field_relatedfileupload_component_1.RelatedFileUploadField, 'comp': field_relatedfileupload_component_1.RelatedFileUploadComponent },
    'DataLocation': { 'meta': field_datalocation_component_1.DataLocationField, 'comp': field_datalocation_component_1.DataLocationComponent },
    'WorkspaceSelectorField': { 'meta': workspace_field_component_1.WorkspaceSelectorField, 'comp': [workspace_selector_component_1.WorkspaceSelectorComponent, workspace_selector_component_1.WorkspaceSelectorFieldComponent, workspace_select_component_1.WorkspaceSelectComponent, workspace_select_component_1.WorkspaceSelectFieldComponent] },
    'WorkspaceRegisterField': { 'meta': workspace_field_component_1.WorkspaceRegisterField, 'comp': [workspace_register_component_1.WorkspaceRegisterComponent, workspace_register_component_1.WorkspaceRegisterFieldComponent] },
    'PublishDataLocationSelector': { 'meta': field_publishdatalocationselector_component_1.PublishDataLocationSelectorField, 'comp': field_publishdatalocationselector_component_1.PublishDataLocationSelectorComponent },
    'TabNavButton': { 'meta': field_simple_1.TabNavButton, 'comp': field_simple_component_1.TabNavButtonComponent },
    'Spacer': { 'meta': field_simple_1.Spacer, 'comp': field_simple_component_1.SpacerComponent },
    'ANDSVocab': { 'meta': field_andsvocab_component_1.ANDSVocabField, 'comp': field_andsvocab_component_1.ANDSVocabComponent },
    'PDFList': { 'meta': field_pdflist_component_1.PDFListField, 'comp': field_pdflist_component_1.PDFListComponent },
    'AsynchField': { 'meta': field_asynch_component_1.AsynchField, 'comp': field_asynch_component_1.AsynchComponent },
    'Toggle': { 'meta': field_simple_1.Toggle, 'comp': field_simple_component_1.ToggleComponent },
    'HtmlRaw': { 'meta': field_simple_1.HtmlRaw, 'comp': field_simple_component_1.HtmlRawComponent },
    'PublishDataLocationRefresh': { 'meta': field_publish_data_location_refresh_component_1.PublishDataLocationRefreshField, 'comp': field_publish_data_location_refresh_component_1.PublishDataLocationRefreshComponent },
    'EventHandler': { 'meta': html_event_component_1.EventHandler, 'comp': html_event_component_1.EventHandlerComponent }
};


/***/ }),

/***/ "./redbox-portal/angular/shared/form/action-button.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var records_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/records.service.ts");
var ActionButton = /** @class */ (function (_super) {
    __extends(ActionButton, _super);
    function ActionButton(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.submitting = false;
        _this.targetAction = options['targetAction'] || null;
        _this.recordService = _this.getFromInjector(records_service_1.RecordsService);
        _this.value = options['value'] || null;
        // read from the form config if this action button should be part of the form (i.e. hold values)
        _this.hasControl = _.isUndefined(options['hasControl']) ? _this.hasControl : options['hasControl'];
        // controls if the action button will be disabled
        _this.isDisabledTemplate = options['isDisabledTemplate'];
        _this.valueLabelPrefix = _.isUndefined(options['valueLabelPrefix']) ? _this.getTranslated(options['valueLabelPrefix'], '') : '';
        _this.valueLabelSufffix = _.isUndefined(options['valueLabelSufffix']) ? _this.getTranslated(options['valueLabelSufffix'], '') : '';
        _this.submittingLabel = _.isUndefined(options['submittingLabel']) ? _this.getTranslated(options['submittingLabel'], '') : '';
        _this.unsubmittedLabel = _.isUndefined(options['unsubmittedLabel']) ? _this.getTranslated(options['unsubmittedLabel'], '') : '';
        _this.valueIsUrl = _.isUndefined(options['valueIsUrl']) ? true : options['valueIsUrl'];
        _this.isDisabledTemplate = options['isDisabledTemplate'];
        _this.isRecordAction = _.isUndefined(options['isRecordAction']) ? false : options['isRecordAction'];
        return _this;
    }
    ActionButton.prototype.setValue = function (value) {
        this.value = value;
        this.formModel.patchValue(value, { emitEvent: true, emitModelToViewChange: true });
        this.formModel.markAsTouched();
    };
    // override the default behavior to prevent form control creation
    ActionButton.prototype.getGroup = function (group, fieldMap) {
        this.fieldMap = fieldMap;
        var retval = null;
        if (this.hasControl) {
            return _super.prototype.getGroup.call(this, group, fieldMap);
        }
        return retval;
    };
    return ActionButton;
}(field_base_1.FieldBase));
exports.ActionButton = ActionButton;
// For action buttons
var ActionButtonComponent = /** @class */ (function (_super) {
    __extends(ActionButtonComponent, _super);
    function ActionButtonComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ActionButtonComponent.prototype.executeAction = function (event) {
        this.field.submitting = true;
        var that = this;
        this.field.recordService.executeAction(this.field.targetAction, { oid: this.field.fieldMap._rootComp.oid })
            .then(function (response) {
            that.field.submitting = false;
            if (that.field.isRecordAction) {
                response = response;
                if (response.success == true) {
                    // execute success action
                }
                else {
                    // show the failure message
                }
            }
            else {
                // parsing of the response will be delegated to form configuration
            }
            // decide later what to do with CKAN-specific behavior
            // that.field.setValue("http://203.101.227.135:5000/dataset/"+that.field.fieldMap._rootComp.oid);
            // that.fieldMap._rootComp.onSubmit().subscribe();
        });
    };
    ActionButtonComponent.prototype.isDisabled = function () {
        if (_.isEmpty(this.field.isDisabledTemplate)) {
            return false;
        }
        var imports = _.extend({}, this);
        var templateData = { imports: imports };
        var template = _.template(this.field.isDisabledTemplate, templateData);
        var templateRes = template();
        return templateRes;
    };
    ActionButtonComponent = __decorate([
        core_1.Component({
            selector: 'action-button',
            template: "\n  <ng-container *ngIf=\"field.editMode && field.visible\">\n    <div *ngIf=\"field.value\">\n      {{ field.valueLabelPrefix }}<a *ngIf=\"field.valueIsUrl\" target=\"_blank\" [attr.href]=\"field.value\">{{ field.value }}</a>{{ field.valueLabelSuffix }}\n    </div>\n    <div *ngIf=\"!field.value\">\n      <button *ngIf=\"!field.submitting\" type=\"{{field.type}}\" [ngClass]=\"field.cssClasses\" (click)=\"executeAction($event)\" [disabled]=\"isDisabled()\">\n        {{field.label}}\n      </button>\n      <span *ngIf=\"field.submitting && field.submittingLabel\">{{ field.submittingLabel }}</span>\n    </div>\n    <div *ngIf=\"field.hasControl\" [formGroup]='form'>\n      <input [formControl]=\"getFormControl()\"  [id]=\"field.name\" name=\"{{field.name}}\" type=\"hidden\" />\n    </div>\n  </ng-container>\n  <div *ngIf=\"!field.editMode && field.visible\">\n    <div *ngIf=\"field.value\">\n    {{ field.valueLabelPrefix }}<a *ngIf=\"field.valueIsUrl\" target=\"_blank\" [attr.href]=\"field.value\">{{ field.value }}</a>{{ field.valueLabelSuffix }}\n    </div>\n    <div *ngIf=\"!field.value && field.unsubmittedLabel\">{{ field.unsubmittedLabel }}</div>\n  </div>\n  ",
        })
    ], ActionButtonComponent);
    return ActionButtonComponent;
}(field_simple_component_1.SimpleComponent));
exports.ActionButtonComponent = ActionButtonComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/dmp-field.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var moment = __webpack_require__("./node_modules/moment/moment.js");
/**
 * Base component for a DMP field.
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 *
 */
var DmpFieldComponent = /** @class */ (function () {
    /**
     * For DI'ing...
     */
    function DmpFieldComponent(componentFactoryResolver, app) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.app = app;
        this.isEmbedded = false;
        this.disabled = false;
        this.disabledElements = [];
    }
    Object.defineProperty(DmpFieldComponent.prototype, "isValid", {
        /**
         * If the form is valid.
         */
        get: function () {
            if (this.form && this.form.controls) {
                return this.form.controls[this.field.name].valid;
            }
            return false;
        },
        enumerable: true,
        configurable: true
    });
    /**
     *
     */
    DmpFieldComponent.prototype.isDisabled = function () {
        var disabledExpression = this.field.options['disabledExpression'];
        if (disabledExpression != null) {
            var imports = this.fieldAnchor;
            var variables = { imports: {} };
            _.forOwn(this.fieldMap._rootComp, function (val, key) {
                variables.imports[key] = val;
            });
            variables.imports['moment'] = moment;
            var compiled = _.template(disabledExpression, variables);
            var parentElement = jQuery(this.fieldElement.nativeElement.parentElement);
            if (compiled() == "true") {
                if (!this.disabled) {
                    //take note of which elements where already disabled as we dont want to enable them if whole component becomes enabled again
                    this.disabledElements = parentElement.find('*:disabled');
                    parentElement.find('input').prop("disabled", true);
                    parentElement.find('button').filter(function (index, buttonElem) {
                        var isHelp = jQuery(buttonElem).find("span[class='glyphicon glyphicon-question-sign']");
                        return isHelp.length <= 0;
                    }).prop("disabled", true);
                    parentElement.find('textarea').prop("disabled", true);
                    parentElement.find('select').prop("disabled", true);
                    this.disabled = true;
                }
                return 'disabled';
            }
            else {
                if (this.disabled) {
                    //previously disabled so lets re-enable
                    parentElement.find('input').prop("disabled", false);
                    parentElement.find('button').prop("disabled", false);
                    parentElement.find('textarea').prop("disabled", false);
                    parentElement.find('select').prop("disabled", false);
                    _.each(this.disabledElements, function (disabledElement) {
                        if (_.isFunction(disabledElement.prop)) {
                            disabledElement.prop("disabled", true);
                        }
                    });
                    this.disabledElements = [];
                    this.disabled = false;
                }
                return null;
            }
        }
        return null;
    };
    /**
     * Change handler, instantiates the field component.
     */
    DmpFieldComponent.prototype.ngOnChanges = function () {
        if (!this.field || !this.componentFactoryResolver) {
            return;
        }
        this.fieldAnchor.clear();
        var compFactory = this.componentFactoryResolver.resolveComponentFactory(this.field.compClass);
        var fieldCompRef = this.fieldAnchor.createComponent(compFactory, undefined, this.app['_injector']);
        fieldCompRef.instance.injector = this.app['_injector'];
        fieldCompRef.instance.field = this.field;
        fieldCompRef.instance.form = this.form;
        fieldCompRef.instance.fieldMap = this.fieldMap;
        fieldCompRef.instance.parentId = this.parentId;
        fieldCompRef.instance.isEmbedded = this.isEmbedded;
        fieldCompRef.instance.name = this.name;
        fieldCompRef.instance.index = this.index;
        // flip thi: make the fields responsible for setting the right fieldMap member
        this.field.setFieldMapEntry(this.fieldMap, fieldCompRef);
        //this.fieldMap[this.field.name].instance = fieldCompRef.instance;
    };
    __decorate([
        core_1.Input(),
        __metadata("design:type", field_base_1.FieldBase)
    ], DmpFieldComponent.prototype, "field", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", forms_1.FormGroup)
    ], DmpFieldComponent.prototype, "form", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Object)
    ], DmpFieldComponent.prototype, "value", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Object)
    ], DmpFieldComponent.prototype, "fieldMap", void 0);
    __decorate([
        core_1.ViewChild('field', { read: core_1.ViewContainerRef }),
        __metadata("design:type", core_1.ViewContainerRef)
    ], DmpFieldComponent.prototype, "fieldAnchor", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", String)
    ], DmpFieldComponent.prototype, "parentId", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Boolean)
    ], DmpFieldComponent.prototype, "isEmbedded", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Object)
    ], DmpFieldComponent.prototype, "name", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Number)
    ], DmpFieldComponent.prototype, "index", void 0);
    __decorate([
        core_1.ViewChild('field'),
        __metadata("design:type", Object)
    ], DmpFieldComponent.prototype, "fieldElement", void 0);
    DmpFieldComponent = __decorate([
        core_1.Component({
            selector: 'dmp-field',
            template: '<span [attr.disabled]="isDisabled()" #field></span>'
        }),
        __param(0, core_1.Inject(core_1.ComponentFactoryResolver)),
        __metadata("design:paramtypes", [core_1.ComponentFactoryResolver, core_1.ApplicationRef])
    ], DmpFieldComponent);
    return DmpFieldComponent;
}());
exports.DmpFieldComponent = DmpFieldComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-andsvocab.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || Object.assign || function(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
    }
    return t;
};
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var ands_service_1 = __webpack_require__("./redbox-portal/angular/shared/ands-service.ts");
var angular_tree_component_1 = __webpack_require__("./node_modules/angular-tree-component/dist/angular-tree-component.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var Observable_1 = __webpack_require__("./node_modules/rxjs/_esm5/Observable.js");
var Subject_1 = __webpack_require__("./node_modules/rxjs/_esm5/Subject.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/bufferTime.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/filter.js");
/**
 *  Vocab Model
 *
 *
 * @author <a target='_' href='https://github.com/shilob'>Shilo Banihit</a>
 *
 */
var ANDSVocabField = /** @class */ (function (_super) {
    __extends(ANDSVocabField, _super);
    function ANDSVocabField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.value = options['value'] || _this.setEmptyValue();
        _this.vocabId = options['vocabId'] || 'anzsrc-for';
        _this.andsService = _this.getFromInjector(ands_service_1.ANDSService);
        return _this;
    }
    ANDSVocabField.prototype.setValue = function (value, emitEvent) {
        if (emitEvent === void 0) { emitEvent = true; }
        this.formModel.setValue(value, { emitEvent: emitEvent, emitModelToViewChange: true });
        this.formModel.markAsTouched();
        this.formModel.markAsDirty();
    };
    ANDSVocabField.prototype.setEmptyValue = function () {
        this.value = [];
        return this.value;
    };
    ANDSVocabField.prototype.setSelected = function (item, flag) {
        var curVal = this.formModel.value;
        if (flag) {
            curVal.push(item);
        }
        else {
            _.remove(curVal, function (entry) {
                return entry.notation == item.notation;
            });
        }
        this.setValue(curVal);
    };
    return ANDSVocabField;
}(field_base_1.FieldBase));
exports.ANDSVocabField = ANDSVocabField;
/**
* Component utilising the ANDS Vocabb selector widget
*
*
*
*
*/
var ANDSVocabComponent = /** @class */ (function (_super) {
    __extends(ANDSVocabComponent, _super);
    function ANDSVocabComponent(elementRef) {
        var _this = _super.call(this) || this;
        _this.treeData = [];
        _this.expandNodeIds = [];
        _this.STATUS_INIT = 0;
        _this.STATUS_LOADING = 1;
        _this.STATUS_LOADED = 2;
        _this.STATUS_EXPANDING = 3;
        _this.STATUS_EXPANDED = 4;
        _this.elementRef = elementRef;
        _this.treeData = [];
        _this.options = {
            useCheckbox: true,
            useTriState: false,
            getChildren: _this.getChildren.bind(_this),
            scrollContainer: document.body.parentElement
        };
        _this.nodeEventSubject = new Subject_1.Subject();
        _this.loadState = _this.STATUS_INIT;
        return _this;
    }
    ANDSVocabComponent.prototype.ngOnInit = function () {
        if (this.field.editMode) {
            jQuery(this.elementRef.nativeElement)['vocab_widget']({
                repository: this.field.vocabId,
                endpoint: 'https://vocabs.ardc.edu.au/apps/vocab_widget/proxy/',
                fields: ["label", "notation", "about"],
                cache: false
            });
            this.field.componentReactors.push(this);
        }
    };
    ANDSVocabComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        if (this.field.editMode) {
            var that_1 = this;
            if (this.loadState == this.STATUS_INIT) {
                this.loadState = this.STATUS_LOADING;
                jQuery(this.elementRef.nativeElement).on('top.vocab.ands', function (event, data) {
                    if (_.isEmpty(that_1.treeData)) {
                        that_1.treeData = that_1.mapItemsToChildren(data.items);
                        that_1.loadState = that_1.STATUS_LOADED;
                    }
                });
                jQuery(this.elementRef.nativeElement)['vocab_widget']('top');
                this.nodeEventSubject.bufferTime(1000)
                    .filter(function (eventArr) {
                    return eventArr.length > 0;
                })
                    .subscribe(function (eventArr) {
                    _this.handleNodeEvent(eventArr);
                });
                this.startTreeInit();
            }
        }
    };
    ANDSVocabComponent.prototype.startTreeInit = function () {
        var _this = this;
        this.treeInitListener = Observable_1.Observable.interval(1000).subscribe(function () {
            if (!_.isEmpty(_this.expandNodeIds)) {
                _this.expandNodes();
            }
            else if (!_.isEmpty(_this.andsTree.treeModel.getVisibleRoots()) && _this.loadState == _this.STATUS_LOADED) {
                _this.loadState = _this.STATUS_EXPANDING;
                _this.updateTreeView(_this);
                _this.expandNodes();
            }
            else if (_this.loadState == _this.STATUS_EXPANDING) {
                _this.treeInitListener.unsubscribe();
                _this.loadState = _this.STATUS_EXPANDED;
            }
        });
    };
    ANDSVocabComponent.prototype.onEvent = function (event) {
        switch (event.eventName) {
            case "select":
                this.field.setSelected(this.getValueFromChildData(event.node), true);
                break;
            case "deselect":
                this.field.setSelected(this.getValueFromChildData(event.node), false);
                break;
        }
    };
    ANDSVocabComponent.prototype.handleNodeEvent = function (eventArr) {
        var event = eventArr[0];
        if (eventArr.length >= 2) {
            event = eventArr[1];
        }
        var currentState = this.getNodeSelected(event.node.id);
        switch (event.eventName) {
            case "nodeActivate":
                if (currentState == undefined) {
                    currentState = true;
                }
                else {
                    currentState = false;
                }
                this.updateSingleNodeSelectedState(event.node, currentState);
                break;
            case "nodeDeactivate":
                this.updateSingleNodeSelectedState(event.node, false);
                break;
        }
    };
    ANDSVocabComponent.prototype.updateSingleNodeSelectedState = function (node, state) {
        var nodeId = node.id;
        var curState = this.andsTree.treeModel.getState();
        this.setNodeSelected(curState, nodeId, state);
        this.andsTree.treeModel.setState(curState);
        this.andsTree.treeModel.update();
        this.field.setSelected(this.getValueFromChildData(node), state);
    };
    ANDSVocabComponent.prototype.onNodeActivate = function (event) {
        this.nodeEventSubject.next(event);
    };
    ANDSVocabComponent.prototype.onNodeDeactivate = function (event) {
        this.nodeEventSubject.next(event);
    };
    ANDSVocabComponent.prototype.updateTreeView = function (that) {
        var _this = this;
        var state = that.andsTree.treeModel.getState();
        that.expandNodeIds = [];
        _.each(that.field.value, function (val) {
            _this.setNodeSelected(state, val.notation, true);
            _.each(val.geneaology, function (parentId) {
                if (!_.includes(that.expandNodeIds, parentId)) {
                    that.expandNodeIds.push(parentId);
                }
            });
        });
        that.andsTree.treeModel.setState(state);
        that.andsTree.treeModel.update();
        that.expandNodeIds = _.sortBy(that.expandNodeIds, function (o) { return _.isString(o) ? o.length : 0; });
    };
    ANDSVocabComponent.prototype.expandNodes = function () {
        if (!_.isEmpty(this.expandNodeIds)) {
            var parentId_1 = this.expandNodeIds[0];
            var node = this.andsTree.treeModel.getNodeById(parentId_1);
            if (node) {
                node.expand();
                _.remove(this.expandNodeIds, function (id) { return id == parentId_1; });
            }
        }
    };
    ANDSVocabComponent.prototype.collapseNodes = function () {
        this.andsTree.treeModel.collapseAll();
    };
    ANDSVocabComponent.prototype.setNodeSelected = function (state, nodeId, flag) {
        if (flag) {
            state.selectedLeafNodeIds[nodeId] = flag;
        }
        else {
            _.unset(state.selectedLeafNodeIds, nodeId);
        }
    };
    ANDSVocabComponent.prototype.getNodeSelected = function (nodeId) {
        return this.andsTree.treeModel.getState().selectedLeafNodeIds[nodeId];
    };
    ANDSVocabComponent.prototype.clearSelectedNodes = function () {
        var state = this.andsTree.treeModel.getState();
        state.selectedLeafNodeIds = {};
        this.andsTree.treeModel.setState(state);
    };
    ANDSVocabComponent.prototype.getChildren = function (node) {
        var _this = this;
        var that = this;
        var promise = new Promise(function (resolve, reject) {
            jQuery(_this.elementRef.nativeElement).on('narrow.vocab.ands', function (event, data) {
                return resolve(that.mapItemsToChildren(data.items));
            });
        });
        jQuery(this.elementRef.nativeElement)['vocab_widget']('narrow', { uri: node.data.about });
        return promise;
    };
    ANDSVocabComponent.prototype.mapItemsToChildren = function (items) {
        return _.map(items, function (item) {
            return __assign({ id: item.notation, name: item.notation + " - " + item.label, hasChildren: item.narrower && item.narrower.length > 0 }, item);
        });
    };
    ANDSVocabComponent.prototype.getValueFromChildData = function (childNode) {
        var data = childNode.data;
        var val = { name: data.notation + " - " + data.label, label: data.label, notation: data.notation };
        this.setParentTree(val, childNode);
        return val;
    };
    ANDSVocabComponent.prototype.setParentTree = function (val, childNode) {
        var parentNotation = _.get(childNode, 'parent.data.notation');
        if (!_.isUndefined(parentNotation)) {
            if (_.isUndefined(val['geneaology'])) {
                val['geneaology'] = [];
            }
            val['geneaology'].push(parentNotation);
            if (childNode.parent.parent) {
                this.setParentTree(val, childNode.parent);
            }
        }
        else if (!_.isUndefined(val['geneaology'])) {
            val['geneaology'] = _.sortBy(val['geneaology']);
        }
    };
    ANDSVocabComponent.prototype.reactEvent = function (eventName, eventData, origData, elem) {
        this.collapseNodes();
        this.clearSelectedNodes();
        this.loadState = this.STATUS_LOADED;
        this.startTreeInit();
    };
    __decorate([
        core_1.ViewChild('andsTree'),
        __metadata("design:type", angular_tree_component_1.TreeComponent)
    ], ANDSVocabComponent.prototype, "andsTree", void 0);
    ANDSVocabComponent = __decorate([
        core_1.Component({
            selector: 'ands-vocab-selector',
            template: __webpack_require__("./redbox-portal/angular/shared/form/field-andsvocab.html"),
            styles: ['span.node-name { font-size: 300%; }']
        }),
        __param(0, core_1.Inject(core_1.ElementRef)),
        __metadata("design:paramtypes", [core_1.ElementRef])
    ], ANDSVocabComponent);
    return ANDSVocabComponent;
}(field_simple_component_1.SimpleComponent));
exports.ANDSVocabComponent = ANDSVocabComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-andsvocab.html":
/***/ (function(module, exports) {

module.exports = "<div *ngIf=\"!field.editMode\" class=\"key-value-pair\">\n  <span *ngIf=\"field.label\" class=\"key\">{{field.label}}</span>\n  <ul>\n    <li *ngFor=\"let value of field.value\">{{ value.notation }} - {{ value.label }}</li>\n  </ul>\n</div>\n<div *ngIf=\"field.editMode\" [formGroup]='form' [ngClass]=\"getGroupClass()\">\n  <span class=\"label-font\">\n    {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n    <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n  </span>\n  <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\">{{field.help}}</span>\n  <tree-root *ngIf=\"field.editMode\"\n      #andsTree\n      class=\"reverse\"\n      id=\"andsTree\"\n      [nodes]=\"treeData\"\n      [options]=\"options\"\n      (nodeActivate)=\"onNodeActivate($event)\"\n      (nodeDeactivate)=\"onNodeDeactivate($event)\"\n      (event)=\"onEvent($event)\"\n      >\n      <ng-template #treeNodeWrapperTemplate let-node let-index=\"index\">\n        <div class=\"node-wrapper\" [style.padding-left]=\"node.getNodePadding()\">\n          <tree-node-expander [node]=\"node\"></tree-node-expander>\n          <rb-tree-node-checkbox *ngIf=\"node.options.useCheckbox\" [node]=\"node\" [ariaLabel]=\"node.data.name\"></rb-tree-node-checkbox>\n          <div class=\"node-content-wrapper\"\n            [class.node-content-wrapper-active]=\"node.isActive\"\n            [class.node-content-wrapper-focused]=\"node.isFocused\"\n            (click)=\"node.mouseAction('click', $event)\"\n            (dblclick)=\"node.mouseAction('dblClick', $event)\"\n            (contextmenu)=\"node.mouseAction('contextMenu', $event)\"\n            (treeDrop)=\"node.onDrop($event)\"\n            [treeAllowDrop]=\"node.allowDrop\"\n            [treeDrag]=\"node\"\n            [treeDragEnabled]=\"node.allowDrag()\">\n\n            <tree-node-content [node]=\"node\" [index]=\"index\"></tree-node-content>\n          </div>\n        </div>\n      </ng-template>\n  </tree-root>\n  <div class=\"text-danger\" *ngIf=\"hasRequiredError()\">{{field.validationMessages.required}}</div>\n</div>\n"

/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-asynch.component.html":
/***/ (function(module, exports) {

module.exports = "<div *ngIf=\"isListening\">\n  <div>&nbsp;</div>\n  <h4> {{ field.label }} </h4>\n  <table class='table table-striped'>\n    <thead>\n      <tr>\n        <th>{{ field.nameLabel }} </th>\n        <th>{{ field.statusLabel }} </th>\n        <th>{{ field.completionLabel }} </th>\n        <th>{{ field.messageLabel }} </th>\n        <th>{{ field.dateStartedLabel }} </th>\n        <th>{{ field.startedByLabel }} </th>\n        <th>{{ field.lastUpdateLabel }} </th>\n        <th>{{ field.dateCompletedLabel }} </th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr *ngFor=\"let progress of field.progressArr\">\n        <td>{{ progress.name }}</td>\n        <td>{{ field.getStatusLabel(progress.status) }}</td>\n        <td *ngIf=\"field.completionRateType == 'percentage'\">{{ progress.completionRate | percent:'1.0-0':locale }}</td>\n        <td>{{ progress.message }}</td>\n        <td>{{ formatDateForDisplay(progress.date_started) }}</td>\n        <td>{{ progress.started_by }}</td>\n        <td>{{ formatDateForDisplay(progress.updatedAt) }}</td>\n        <td>{{ formatDateForDisplay(progress.date_completed) }}</td>\n      </tr>\n    </tbody>\n  </table>\n</div>\n"

/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-asynch.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_simple_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.ts");
var records_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/records.service.ts");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/bufferTime.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/filter.js");
var moment = __webpack_require__("./node_modules/moment/moment.js");
/**
 * Async / background tasks field
 *
 * @author <a target='_' href='https://github.com/shilob'>Shilo Banihit</a>
 *
 */
var AsynchField = /** @class */ (function (_super) {
    __extends(AsynchField, _super);
    function AsynchField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.relatedRecordId = options['relatedRecordId'] || undefined;
        _this.completionRateType = options['completionRateType'] || 'percentage';
        _this.nameLabel = options['nameLabel'] ? _this.getTranslated(options['nameLabel'], options['nameLabel']) : 'Name';
        _this.statusLabel = options['statusLabel'] ? _this.getTranslated(options['statusLabel'], options['statusLabel']) : 'Status';
        _this.dateStartedLabel = options['dateStartedLabel'] ? _this.getTranslated(options['dateStartedLabel'], options['dateStartedLabel']) : 'Date Started';
        _this.dateCompletedLabel = options['dateCompletedLabel'] ? _this.getTranslated(options['dateCompletedLabel'], options['dateCompletedLabel']) : 'Date Completed';
        _this.startedByLabel = options['startedByLabel'] ? _this.getTranslated(options['startedByLabel'], options['startedByLabel']) : 'Started By';
        _this.messageLabel = options['messageLabel'] ? _this.getTranslated(options['messageLabel'], options['messageLabel']) : 'Message';
        _this.completionLabel = options['completionLabel'] ? _this.getTranslated(options['completionLabel'], options['completionLabel']) : 'Completion';
        _this.lastUpdateLabel = options['lastUpdateLabel'] ? _this.getTranslated(options['lastUpdateLabel'], options['lastUpdateLabel']) : 'Last Updated';
        _this.dateFormat = options['dateFormat'] || 'L LT';
        _this.listenType = options['listenType'] || "record"; // listens to record wide
        _this.taskType = options['taskType'] || '';
        _this.criteria = options['criteria'] || { where: { relatedRecordId: '@oid' } }; // defaults to all happenings for this oid
        _this.RecordsService = _this.getFromInjector(records_service_1.RecordsService);
        return _this;
    }
    AsynchField.prototype.getStatusLabel = function (status) {
        return this.getTranslated(this.options.statusLabel + "-" + status, status);
    };
    return AsynchField;
}(field_simple_1.NotInFormField));
exports.AsynchField = AsynchField;
/**
*
* Component to display asynchronous processes
*
*
*/
var AsynchComponent = /** @class */ (function (_super) {
    __extends(AsynchComponent, _super);
    function AsynchComponent(changeRef) {
        var _this = _super.call(this) || this;
        _this.changeRef = changeRef;
        _this.locale = window.navigator.language;
        return _this;
    }
    AsynchComponent.prototype.ngOnInit = function () {
        var oid = this.field.relatedRecordId || this.field.fieldMap._rootComp.oid;
        var that = this;
        if (_.isNull(oid) || _.isUndefined(oid) || _.isEmpty(oid)) {
            // wait for the OID to be set when record is created
            if (!this.field.fieldMap._rootComp.getSubscription('recordCreated')) {
                console.log("Subscribing to record creation..... " + this.field.name);
                this.field.fieldMap._rootComp.subscribe('recordCreated', this.field.name, function (createdInfo) {
                    that.field.relatedRecordId = createdInfo.oid;
                    that.startListen();
                });
            }
        }
        if (oid) {
            this.field.relatedRecordId = this.field.fieldMap._rootComp.oid;
            this.startListen();
        }
    };
    AsynchComponent.prototype.startListen = function () {
        var _this = this;
        if (!this.isListening && (!_.isUndefined(this.field.relatedRecordId) && !_.isEmpty(this.field.relatedRecordId))) {
            var fq = JSON.stringify(this.field.criteria).replace(/@oid/g, this.field.relatedRecordId);
            this.field.RecordsService.getAsyncProgress(fq).then(function (progressArr) {
                _.each(progressArr, function (progress) {
                    progress.completionRate = progress.currentIdx / progress.targetIdx;
                    if (_this.field.listenType == "progress") {
                        _this.field.RecordsService.subscribeToAsyncProgress(progress.id, function (data, socketRes) {
                            console.log("Subscribed to async tasks: " + progress.id);
                            console.log(data);
                            console.log(socketRes);
                        });
                    }
                });
                if (_this.field.listenType == "record") {
                    _this.field.RecordsService.subscribeToAsyncProgress(_this.field.relatedRecordId, function (data, socketRes) {
                        console.log("Subscribed to async tasks for record: " + _this.field.relatedRecordId);
                        console.log(data);
                        console.log(socketRes);
                    });
                }
                else if (_this.field.listenType == "taskType") {
                    _this.field.RecordsService.subscribeToAsyncProgress(_this.field.relatedRecordId + "-" + _this.field.taskType, function (data, socketRes) {
                        console.log("Subscribed to async tasks for record with taskType: " + _this.field.relatedRecordId + "-" + _this.field.taskType);
                        console.log(data);
                        console.log(socketRes);
                    });
                }
                io.socket.on('start', _this.onStart.bind(_this));
                io.socket.on('stop', _this.onStop.bind(_this));
                io.socket.on('update', _this.onUpdate.bind(_this));
                _this.field.progressArr = progressArr;
                _this.isListening = true;
            });
        }
    };
    AsynchComponent.prototype.onStart = function (progress) {
        console.log("Got start event:");
        console.log(progress);
        this.field.progressArr ? this.field.progressArr.push(progress) : this.field.progressArr = [progress];
        this.changeRef.detectChanges();
    };
    AsynchComponent.prototype.onStop = function (progress) {
        console.log("Got stop event:");
        console.log(progress);
        this.updateProgress(progress);
    };
    AsynchComponent.prototype.onUpdate = function (progress) {
        console.log("Got update event:");
        console.log(progress);
        this.updateProgress(progress);
    };
    AsynchComponent.prototype.updateProgress = function (progress) {
        var targetProgress = _.find(this.field.progressArr, function (prog) { return prog.id == progress.id; });
        _.assign(targetProgress, progress);
        this.changeRef.detectChanges();
    };
    AsynchComponent.prototype.formatDateForDisplay = function (value) {
        return value ? moment(value).locale(this.locale).format(this.field.dateFormat) : '';
    };
    AsynchComponent = __decorate([
        core_1.Component({
            selector: 'asynch-component',
            template: __webpack_require__("./redbox-portal/angular/shared/form/field-asynch.component.html")
        }),
        __metadata("design:paramtypes", [core_1.ChangeDetectorRef])
    ], AsynchComponent);
    return AsynchComponent;
}(field_simple_component_1.SimpleComponent));
exports.AsynchComponent = AsynchComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-base.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var translation_service_1 = __webpack_require__("./redbox-portal/angular/shared/translation-service.ts");
var Observable_1 = __webpack_require__("./node_modules/rxjs/_esm5/Observable.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
/**
 * Base class for dynamic form models...
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 *
 */
var FieldBase = /** @class */ (function () {
    function FieldBase(options, injector) {
        if (options === void 0) { options = {}; }
        this.componentReactors = [];
        this.onValueUpdate = new core_1.EventEmitter();
        this.onValueLoaded = new core_1.EventEmitter();
        this.injector = injector;
        this.translationService = this.getFromInjector(translation_service_1.TranslationService);
        this.setOptions(options);
        this.validators = null;
    }
    FieldBase.prototype.getFromInjector = function (token) {
        return this.injector.get(token);
    };
    FieldBase.prototype.setOptions = function (options) {
        var _this = this;
        if (options === void 0) { options = {}; }
        this.value = this.getTranslated(options.value, undefined);
        this.name = options.name || '';
        this.id = options.id || '';
        this.label = this.getTranslated(options.label, '');
        if (options.selectFor && options.defaultSelect) {
            if (_.isArray(options.help)) {
                var newHelp = _.defaultTo(_.find(options.help, function (f) { return f.key === options.selectFor; }), _.find(options.help, function (f) { return f.key === options.defaultSelect; }));
                options.help = newHelp.value;
            }
        }
        this.help = this.getTranslated(options.help, undefined);
        this.required = !!options.required;
        this.controlType = options.controlType || '';
        this.cssClasses = options.cssClasses || {}; // array of
        this.groupClasses = options['groupClasses'] || '';
        this.groupName = options.groupName || null;
        this.editMode = _.isUndefined(options.editMode) ? false : options.editMode;
        this.readOnly = _.isUndefined(options.readOnly) ? false : options.readOnly;
        this.onChange = options['onChange'] || null;
        this.publish = options['publish'] || null;
        this.subscribe = options['subscribe'] || null;
        this.visible = _.isUndefined(options['visible']) ? true : options['visible'];
        this.visibilityCriteria = options['visibilityCriteria'];
        this.requiredIfHasValue = options['requiredIfHasValue'] || [];
        this.hasValueLabel = this.getTranslated(options['hasValueLabel'], 'Multiple Values');
        this.confirmChangesLabel = this.getTranslated(options['confirmChangesLabel'], 'Confirm Changes');
        this.confirmChangesParagraphLabel = this.getTranslated(options['confirmChangesParagraphLabel'], 'The following values will be cleared');
        if (this.groupName) {
            this.hasGroup = true;
        }
        this.options = options;
        this.hasControl = true;
        this.validationMessages = {};
        _.forOwn(options['validationMessages'] || {}, function (messageKey, messageName) {
            _this.validationMessages[messageName] = _this.getTranslated(messageKey, messageKey);
        });
        this.defaultValue = this.getTranslated(options.defaultValue, undefined);
        if ((_.isUndefined(this.value) || _.isEmpty(this.value)) && !_.isUndefined(this.defaultValue)) {
            this.value = this.defaultValue;
        }
    };
    FieldBase.prototype.getTranslated = function (key, defValue) {
        if (!_.isEmpty(key) && !_.isUndefined(key)) {
            if (_.isFunction(key.startsWith) && key.startsWith('@') && this.translationService) {
                return this.translationService.t(key);
            }
            else {
                return key;
            }
        }
        else {
            return defValue;
        }
    };
    Object.defineProperty(FieldBase.prototype, "isValid", {
        get: function () {
            if (this.form && this.form.controls) {
                return this.form.controls[this.name].valid;
            }
            return false;
        },
        enumerable: true,
        configurable: true
    });
    FieldBase.prototype.createFormModel = function (valueElem) {
        if (valueElem === void 0) { valueElem = null; }
        if (valueElem) {
            this.value = valueElem;
        }
        if (this.required) {
            this.validators = forms_1.Validators.required;
        }
        this.formModel = new forms_1.FormControl(this.value || '', this.validators);
        return this.formModel;
    };
    /**
     * Creates a control group and populates field map with:
     *
     * fieldMap[name].control = the NG2 FormControl
     * fieldMap[name].field = the Field model (this)
     *
     * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
     * @param  {any} group
     * @param  {any} fieldMap
     * @return {any}
     */
    FieldBase.prototype.getGroup = function (group, fieldMap) {
        this.fieldMap = fieldMap;
        var retval = null;
        _.set(fieldMap, this.getFullFieldName() + ".field", this);
        var control = this.createFormModel();
        _.set(fieldMap, this.getFullFieldName() + ".control", control);
        if (this.hasGroup && this.groupName) {
            if (group[this.groupName]) {
                group[this.groupName].addControl(this.name, control);
            }
            else {
                var fg = {};
                fg[this.name] = control;
                group[this.groupName] = new forms_1.FormGroup(fg);
            }
            retval = group[this.groupName];
        }
        else {
            if (this.hasControl) {
                group[this.name] = control;
                retval = group[this.name];
            }
        }
        return retval;
    };
    FieldBase.prototype.triggerValidation = function () {
        if (this.formModel) {
            this.formModel.markAsTouched();
            this.formModel.updateValueAndValidity({ onlySelf: false, emitEvent: false });
        }
    };
    FieldBase.prototype.valueNotNull = function (data) {
        return !_.isNull(data) && (_.isArray(data) ? (!_.isNull(data[0])) : true);
    };
    FieldBase.prototype.setupEventHandlers = function () {
        var _this = this;
        var publishConfig = this.publish;
        var subscribeConfig = this.subscribe;
        if (!_.isEmpty(this.formModel)) {
            if (!_.isEmpty(publishConfig)) {
                _.forOwn(publishConfig, function (eventConfig, eventName) {
                    var eventSourceName = eventConfig.modelEventSource;
                    var eventSource = eventSourceName ? _this.formModel[eventSourceName] : null;
                    if (!eventSource) {
                        eventSource = _this.getEventEmitter(eventSourceName, 'this');
                        if (!eventSource) {
                            // you only need a 'publish' config block doesn't have an eventEmitter...if you do, as in the case
                            // of the TabOrAccordionContainer, a simple 'subscribe' block will do
                            // create the event emitter so components and other things can hook and publish stuff
                            // Note: you will need publishers and subcribers to be named, otherwise they'd get lost in the map
                            _this[eventSource] = new core_1.EventEmitter();
                        }
                    }
                    eventSource.subscribe(function (value) {
                        if (_this.valueNotNull(value)) {
                            var emitData_1 = value;
                            if (!_.isEmpty(eventConfig.fields)) {
                                if (_.isArray(value)) {
                                    emitData_1 = [];
                                    _.each(value, function (v) {
                                        if (!_.isEmpty(v)) {
                                            var item_1 = {};
                                            _.each(eventConfig.fields, function (f) {
                                                _.forOwn(f, function (src, tgt) {
                                                    item_1[tgt] = _.get(v, src);
                                                });
                                            });
                                            emitData_1.push(item_1);
                                        }
                                    });
                                }
                                else {
                                    emitData_1 = {};
                                    if (!_.isEmpty(value)) {
                                        _.each(eventConfig.fields, function (f) {
                                            _.forOwn(f, function (src, tgt) {
                                                emitData_1[tgt] = _.get(value, src);
                                            });
                                        });
                                    }
                                }
                            }
                            //console.log(`Emitting data:`);
                            //console.log(`eventName: ${eventName} emitData: ${emitData} value: ${value}`);
                            _this.emitEvent(eventName, emitData_1, value);
                        }
                    });
                });
            }
        }
        if (!_.isEmpty(subscribeConfig)) {
            _.forOwn(subscribeConfig, function (subConfig, srcName) {
                _.forOwn(subConfig, function (eventConfArr, eventName) {
                    var eventEmitter = _this.getEventEmitter(eventName, srcName);
                    eventEmitter.subscribe(function (value) {
                        var curValue = value;
                        if (_.isArray(value)) {
                            curValue = [];
                            _.each(value, function (v) {
                                var entryVal = v;
                                _.each(eventConfArr, function (eventConf) {
                                    var fn = _.get(_this, eventConf.action);
                                    if (fn) {
                                        var boundFunction = fn;
                                        if (eventConf.action.indexOf(".") == -1) {
                                            boundFunction = fn.bind(_this);
                                        }
                                        else {
                                            var objectName = eventConf.action.substring(0, eventConf.action.indexOf("."));
                                            boundFunction = fn.bind(_this[objectName]);
                                        }
                                        entryVal = boundFunction(entryVal, eventConf);
                                    }
                                });
                                if (!_.isEmpty(entryVal)) {
                                    curValue.push(entryVal);
                                }
                            });
                        }
                        else {
                            _.each(eventConfArr, function (eventConf) {
                                // adding source of the event
                                eventConf.srcName = srcName;
                                var fn = _.get(_this, eventConf.action);
                                if (fn) {
                                    var boundFunction = fn;
                                    if (eventConf.action.indexOf(".") == -1) {
                                        boundFunction = fn.bind(_this);
                                    }
                                    else {
                                        var objectName = eventConf.action.substring(0, eventConf.action.indexOf("."));
                                        boundFunction = fn.bind(_this[objectName]);
                                    }
                                    curValue = boundFunction(curValue, eventConf);
                                }
                            });
                        }
                        if (!_.isUndefined(curValue)) {
                            // cascade the event instance wide if only there's a valid value
                            _this.reactEvent(eventName, curValue, value);
                        }
                    });
                });
            });
        }
    };
    FieldBase.prototype.getEventEmitter = function (eventName, srcName) {
        if (srcName == "this") {
            return _.get(this, eventName);
        }
        if (srcName == "form") {
            return _.get(this.fieldMap['_rootComp'], eventName);
        }
        return _.get(this.fieldMap[srcName].field, eventName);
    };
    FieldBase.prototype.emitEvent = function (eventName, eventData, origData) {
        this[eventName].emit(eventData);
    };
    FieldBase.prototype.reactEvent = function (eventName, eventData, origData) {
        var _this = this;
        this.value = eventData;
        if (this.formModel) {
            this.formModel.setValue(eventData, { onlySelf: true, emitEvent: false });
        }
        _.each(this.componentReactors, function (compReact) {
            compReact.reactEvent(eventName, eventData, origData, _this);
        });
    };
    FieldBase.prototype.setFieldMapEntry = function (fieldMap, fieldCompRef) {
        if (!_.isUndefined(this.name) && !_.isEmpty(this.name) && !_.isNull(this.name)) {
            _.set(fieldMap, this.getFullFieldName() + ".instance", fieldCompRef.instance);
        }
    };
    FieldBase.prototype.getFullFieldName = function (name) {
        if (name === void 0) { name = null; }
        var fldName = "" + (name ? name : this.name);
        // console.log(`Using fldName: ${fldName}`);
        // console.log(this.fieldMap);
        return fldName;
    };
    FieldBase.prototype.getControl = function (name, fieldMap) {
        if (name === void 0) { name = null; }
        if (fieldMap === void 0) { fieldMap = null; }
        return _.get(fieldMap ? fieldMap : this.fieldMap, this.getFullFieldName(name) + ".control");
    };
    FieldBase.prototype.setValue = function (value, emitEvent) {
        if (emitEvent === void 0) { emitEvent = true; }
        this.value = value;
        this.formModel.setValue(value, { onlySelf: true, emitEvent: emitEvent });
    };
    FieldBase.prototype.toggleVisibility = function () {
        this.visible = !this.visible;
    };
    FieldBase.prototype.setVisibility = function (data) {
        var newVisible = this.visible;
        if (_.isObject(this.visibilityCriteria) && this.visibilityCriteria['type'] == 'function') {
            var fn = _.get(this, this.visibilityCriteria['action']);
            if (this.visibilityCriteria['debug']) {
                console.log("visibilityCriteria: " + this.visibilityCriteria['debug']);
            }
            if (fn) {
                var boundFunction = fn;
                if (this.visibilityCriteria['action'].indexOf(".") == -1) {
                    boundFunction = fn.bind(this);
                }
                else {
                    var objectName = this.visibilityCriteria['action'].substring(0, this.visibilityCriteria['action'].indexOf("."));
                    boundFunction = fn.bind(this[objectName]);
                }
                //console.log(`visibilityCriteria: ${this.visibilityCriteria.name}`);
                newVisible = boundFunction(data, this.visibilityCriteria);
            }
        }
        else {
            newVisible = _.isEqual(data, this.visibilityCriteria);
        }
        this.updateVisible(newVisible);
    };
    FieldBase.prototype.updateVisible = function (newVisible) {
        var that = this;
        setTimeout(function () {
            if (!newVisible) {
                if (that.visible) {
                    // remove validators
                    if (that.formModel) {
                        that.formModel.clearValidators();
                        that.formModel.updateValueAndValidity();
                    }
                }
            }
            else {
                if (!that.visible) {
                    // restore validators
                    if (that.formModel) {
                        that.formModel.setValidators(that.validators);
                        that.formModel.updateValueAndValidity();
                    }
                }
            }
            that.visible = newVisible;
        });
    };
    FieldBase.prototype.checkIfVisible = function () {
        if (_.isObject(this.visibilityCriteria) && this.visibilityCriteria['type'] == 'function') {
            this.setVisibility(this.visibilityCriteria);
        }
    };
    FieldBase.prototype.replaceValWithConfig = function (val) {
        _.forOwn(this.appConfig, function (configVal, configKey) {
            val = val.replace(new RegExp("@" + configKey, 'g'), configVal);
        });
        return val;
    };
    FieldBase.prototype.getConfigEntry = function (name, defValue) {
        return _.isUndefined(_.get(this.appConfig, name)) ? defValue : _.get(this.appConfig, name);
    };
    FieldBase.prototype.publishValueLoaded = function () {
        this.onValueLoaded.emit(this.value);
    };
    FieldBase.prototype.setRequiredAndClearValueOnFalse = function (flag) {
        this.required = flag;
        if (flag) {
            this.validators = forms_1.Validators.required;
            this.formModel.setValidators(this.validators);
        }
        else {
            if (_.isFunction(this.validators) && _.isEqual(this.validators, forms_1.Validators.required)) {
                this.validators = null;
            }
            this.formModel.clearValidators();
            this.formModel.setValue(null);
            this.value = null;
        }
    };
    FieldBase.prototype.setRequired = function (flag) {
        this.required = flag;
        if (flag) {
            this.validators = forms_1.Validators.required;
        }
        else {
            if (_.isFunction(this.validators) && _.isEqual(this.validators, forms_1.Validators.required)) {
                this.validators = null;
            }
            else {
                _.remove(this.validators, function (v) {
                    return _.isEqual(v, forms_1.Validators.required);
                });
            }
        }
        if (this.validators) {
            this.formModel.setValidators(this.validators);
        }
        else {
            this.formModel.clearValidators();
        }
    };
    FieldBase.prototype.setRequiredIfDependenciesHaveValue = function (data) {
        var _this = this;
        var retVal = false;
        _.each(this.requiredIfHasValue, function (name) {
            var depVal = _this.fieldMap._rootComp.getFieldValue(name);
            var hasVal = false;
            if (_.isArrayLike(depVal)) {
                hasVal = !_.isEmpty(depVal);
            }
            else {
                hasVal = !_.isUndefined(depVal) && !_.isNull(depVal);
            }
            retVal = retVal || hasVal;
        });
        this.setRequired(retVal);
    };
    //Default asyncLoadData function. No async load required so return empty Observable.
    FieldBase.prototype.asyncLoadData = function () {
        return Observable_1.Observable.of(null);
    };
    FieldBase.prototype.setProp = function (change, config) {
        var _this = this;
        if (config['debug']) {
            console.log('setProp: ' + config['debug']);
        }
        var defered = false;
        var value;
        var checked;
        if (_.isObject(change)) {
            value = change['value'];
            defered = _.isUndefined(change['defered']) ? false : change['defered'];
            checked = _.isUndefined(change['checked']) ? false : change['checked'];
        }
        else {
            value = change;
            checked = true;
        }
        if (config['defer'] && !defered) {
            return;
        }
        if (config['valueCase']) {
            var caseSet_1;
            _.each(config['valueCase'], function (cases) {
                if (cases['val'] === value) {
                    value = cases['set'];
                    caseSet_1 = checked;
                    return false;
                }
            });
            if (caseSet_1) {
                this.setValue(this.getTranslated(value, undefined));
            }
        }
        else if (config['valueSet']) {
            if (this.formModel) {
                this.setValue(this.getTranslated(value, undefined));
            }
            else {
                this.value = this.getTranslated(value, undefined);
            }
        }
        else if (config['valueTest']) {
            if (_.includes(config['valueTest'], value)) {
                _.each(config['props'], function (prop) {
                    _this.setPropValue(prop, checked, config['debug']);
                });
            }
            else if (_.includes(config['valueFalse'], value)) {
                _.each(config['props'], function (prop) {
                    _this.setPropValue(prop, false, config['debug']);
                });
            }
        }
    };
    FieldBase.prototype.setPropValue = function (prop, checked, debug) {
        if (debug) {
            console.log('setPropValue: ' + debug);
        }
        if (prop.key === 'required') {
            if (checked) {
                this.setRequired(prop.val);
            }
            else {
                this.setRequired(!prop.val);
            }
        }
        else if (prop.key === 'value') {
            if (prop.clear && !checked) {
                if (this.formModel) {
                    this.setValue('');
                }
                else {
                    if (Array.isArray(this.value)) {
                        // Since there is no formArray.clear(); in this version of angular:
                        this.getControl().controls = [];
                        this.getControl().setValue([]);
                    }
                    else {
                        this.value = null;
                    }
                }
            }
            else if (checked) {
                if (this.formModel) {
                    this.setValue(this.getTranslated(prop.val, undefined));
                }
                else {
                    this.value = this.getTranslated(prop.val, undefined);
                }
            }
        }
        else if (prop.key === 'visible') {
            if (checked) {
                //this.setVisibility(prop.val);
                this.updateVisible(prop.val);
            }
            else if (!checked) {
                this.updateVisible(!prop.val);
                //this.setVisibility(!prop.val);
            }
        }
    };
    FieldBase.prototype.updateVisibility = function (visible, config) {
        if (config['debug']) {
            console.log(config['debug']);
        }
        var fieldName = config['field'];
        var fieldValue = config['fieldValue'];
        var field;
        if (this.fieldMap && this.fieldMap[fieldName]) {
            field = this.fieldMap[fieldName]['field'];
            if (field && _.includes(field['value'], fieldValue)) {
                console.log("updateVisibility to true: " + config['debug']);
                return true;
            }
            else {
                return false;
            }
        }
        else {
            return false;
        }
    };
    FieldBase.prototype.getFieldDisplay = function (f) {
        var valueLabel = f.control.value;
        var options = f.field.options.options;
        if (options) {
            if (Array.isArray(valueLabel)) {
                valueLabel = this.hasValueLabel;
            }
            else {
                valueLabel = options.find(function (o) { return f.control.value === o.value; }).label;
            }
        }
        return {
            valueLabel: valueLabel === true ? '' : valueLabel,
            label: f.field.label
        };
    };
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], FieldBase.prototype, "onValueUpdate", void 0);
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], FieldBase.prototype, "onValueLoaded", void 0);
    return FieldBase;
}());
exports.FieldBase = FieldBase;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-contributor.component.html":
/***/ (function(module, exports) {

module.exports = "<div *ngIf=\"field.editMode\" class='padding-bottom-10'>\n  <div class=\"row\" *ngIf=\"field.label && field.showHeader\">\n    <div class=\"col-xs-12\">\n      <span class=\"label-font\">\n        {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n        <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n      </span>\n    </div>\n  </div>\n  <div class=\"row\" *ngIf=\"field.showHeader\">\n    <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"col-xs-12 help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\"></span>\n  </div>\n  <div class=\"row\">\n    <ng-container *ngIf=\"field.freeText\" [formGroup]='field.formModel'>\n      <!-- Free Text version -->\n      <!--\n      <ng-container >\n        <div [ngClass]=\"getGroupClass('name')\">\n          <input formControlName=\"name\" type=\"text\" class=\"form-control\"/>\n          <div class=\"text-danger\" *ngIf=\"field.formModel.controls['name'].touched && field.formModel.controls['name'].hasError('required')\">{{field.validationMessages.required.name}}</div>\n        </div>\n        <div [ngClass]=\"getGroupClass('email')\">\n          <input formControlName=\"email\" type=\"text\" class=\"form-control\" />\n          <div class=\"text-danger\" *ngIf=\"field.formModel.controls['email'].touched && field.formModel.controls['email'].hasError('email')\">{{field.validationMessages.invalid.email}}</div>\n          <div class=\"text-danger\" *ngIf=\"field.formModel.controls['email'].touched && field.formModel.controls['email'].hasError('required')\">{{field.validationMessages.required.email}}</div>\n        </div>\n        <div >\n          <input formControlName=\"orcid\" type=\"text\" class=\"form-control\"/>\n        </div>\n      </ng-container>  -->\n\n      <div *ngIf=\"!isEmbedded\">\n        <div class=\"row\">\n          <span class='col-xs-10' >\n            <!-- Free text not embedded version -->\n            <!-- Name not split -->\n            <ng-container *ngIf=\"!field.splitNames\">\n              <!-- If we show the title -->\n              <ng-container *ngIf=\"field.showTitle\">\n                <div class='col-xs-1'>\n                  <input formControlName=\"honorific\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.titleColHdr\" [attr.placeholder]=\"field.titleColHdr\"/>\n                </div>\n              </ng-container>\n              <!-- Name  -->\n              <div class='col-xs-1'>\n                <span class='text-right'>{{ field.nameColHdr }}</span>\n              </div>\n              <div [ngClass]=\"getGroupClass('text_full_name', true)\" >\n                <input formControlName=\"text_full_name\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.nameColHdr\"/>\n                <div class=\"text-danger\" *ngIf=\"field.formModel.controls['text_full_name'].touched && field.formModel.controls['text_full_name'].hasError('required')\">{{field.validationMessages.required.text_full_name}}</div>\n              </div>\n            </ng-container>\n            <!-- Name split to family name, give name -->\n            <ng-container *ngIf=\"field.splitNames\">\n              <div class='col-xs-1' >\n                <span class='text-right'>{{ field.familyNameHdr }}</span>\n              </div>\n              <div [ngClass]=\"getGroupClass('family_name')\" >\n                <input formControlName=\"family_name\" type=\"text\" class=\"form-control\"/>\n                <div class=\"text-danger\" *ngIf=\"field.formModel.controls['family_name'].touched && field.formModel.controls['family_name'].hasError('required')\" [attr.aria-label]=\"field.familyNameHdr\">{{field.validationMessages.required.family_name}}</div>\n              </div>\n              <div class='col-xs-1' >\n                <span class='text-right'>{{ field.givenNameHdr }}</span>\n              </div>\n              <div [ngClass]=\"getGroupClass('given_name')\" >\n                <input formControlName=\"given_name\" type=\"text\" class=\"form-control\"/>\n                <div class=\"text-danger\" *ngIf=\"field.formModel.controls['given_name'].touched && field.formModel.controls['given_name'].hasError('required')\" [attr.aria-label]=\"field.givenNameHdr\">{{field.validationMessages.required.given_name}}</div>\n              </div>\n            </ng-container>\n            <!-- Email field -->\n            <div class='col-xs-1'>\n              <span class='text-right'>{{ field.emailColHdr }}</span>\n            </div>\n            <div [ngClass]=\"getGroupClass('email', !field.splitNames)\">\n              <input formControlName=\"email\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.emailColHdr\"/>\n              <div class=\"text-danger\" *ngIf=\"field.formModel.controls['email'].touched && field.formModel.controls['email'].hasError('email')\">{{field.validationMessages.invalid.email}}</div>\n              <div class=\"text-danger\" *ngIf=\"field.formModel.controls['email'].touched && field.formModel.controls['email'].hasError('required')\">{{field.validationMessages.required.email}}</div>\n            </div>\n            <div class='col-xs-1'>\n              <span class='text-right'>{{ field.orcidColHdr }}</span>\n            </div>\n            <div [ngClass]=\"getGroupClass('orcid', !field.splitNames && !field.showTitle)\">\n              <input formControlName=\"orcid\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.orcidColHdr\"/>\n            </div>\n          </span>\n        </div>\n      </div>\n      <!-- Embedded free text version -->\n      <ng-container *ngIf=\"isEmbedded\">\n        <div class=\"row\">\n          <span class='col-xs-12' >\n            <ng-container *ngIf=\"field.showTitle\">\n              <div class='col-xs-1'>\n                <input formControlName=\"honorific\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.titleColHdr\" [attr.placeholder]=\"field.titleColHdr\"/>\n              </div>\n            </ng-container>\n            <!-- Names unsplit -->\n            <div class='col-xs-1' *ngIf=\"!field.splitNames\">\n              <span class='text-right'>{{ field.nameColHdr }}</span>\n            </div>\n            <div [ngClass]=\"getGroupClass('text_full_name', true)\" *ngIf=\"!field.splitNames\">\n              <input formControlName=\"text_full_name\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.nameColHdr\"/>\n              <div class=\"text-danger\" *ngIf=\"field.formModel.controls['text_full_name'].touched && field.formModel.controls['text_full_name'].hasError('required')\">{{field.validationMessages.required.text_full_name}}</div>\n            </div>\n            <!-- Names are split -->\n            <div class='col-xs-1' *ngIf=\"field.splitNames\">\n              <span class='text-right'>{{ field.familyNameHdr }}</span>\n            </div>\n            <div [ngClass]=\"getGroupClass('family_name')\" *ngIf=\"field.splitNames\">\n              <input formControlName=\"family_name\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.familyNameHdr\"/>\n              <div class=\"text-danger\" *ngIf=\"field.formModel.controls['family_name'].touched && field.formModel.controls['family_name'].hasError('required')\">{{field.validationMessages.required.family_name}}</div>\n            </div>\n            <div class='col-xs-1' *ngIf=\"field.splitNames\">\n              <span class='text-right'>{{ field.givenNameHdr }}</span>\n            </div>\n            <div [ngClass]=\"getGroupClass('given_name')\" *ngIf=\"field.splitNames\">\n              <input formControlName=\"given_name\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.givenNameHdr\"/>\n              <div class=\"text-danger\" *ngIf=\"field.formModel.controls['given_name'].touched && field.formModel.controls['given_name'].hasError('required')\">{{field.validationMessages.required.given_name}}</div>\n            </div>\n            <div class='col-xs-1'>\n              <span class='text-right'>{{ field.emailColHdr }}</span>\n            </div>\n            <div [ngClass]=\"getGroupClass('email', !field.splitNames)\">\n              <input formControlName=\"email\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.emailColHdr\"/>\n              <div class=\"text-danger\" *ngIf=\"field.formModel.controls['email'].touched && field.formModel.controls['email'].hasError('email')\">{{field.validationMessages.invalid.email}}</div>\n              <div class=\"text-danger\" *ngIf=\"field.formModel.controls['email'].touched && field.formModel.controls['email'].hasError('required')\">{{field.validationMessages.required.email}}</div>\n            </div>\n            <div class='col-xs-1'>\n              <span class='text-right'>{{ field.orcidColHdr }}</span>\n            </div>\n            <div [ngClass]=\"getGroupClass('orcid', !field.splitNames && !field.showTitle)\">\n              <input formControlName=\"orcid\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.orcidColHdr\"/>\n            </div>\n          </span>\n        </div>\n      </ng-container>\n\n    </ng-container>\n    <!-- Lookup version -->\n    <ng-container *ngIf=\"!field.freeText\" [formGroup]=\"field.formModel\">\n      <!-- Not embedded version -->\n      <div *ngIf=\"!isEmbedded\">\n        <div class=\"row\">\n          <span class='col-xs-10' >\n            <!-- Lookup Not Embedded version -->\n            <!-- If we show the title -->\n            <ng-container *ngIf=\"field.showTitle\">\n              <div class=\"col-xs-1\" >\n                <input formControlName=\"honorific\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.titleColHdr\" [attr.placeholder]=\"field.titleColHdr\"/>\n              </div>\n            </ng-container>\n            <div class='col-xs-1'>\n              <span class='text-right'>{{ field.nameColHdr }}</span>\n            </div>\n            <div [ngClass]=\"getGroupClass('text_full_name', true)\">\n              <ng2-completer #ngCompleter (opened)=\"onOpen($event)\" (blur)=\"onBlur()\" (keyup)=\"onKeyUp($event)\" (keydown)=\"onKeydown($event)\" [overrideSuggested]=\"!field.forceLookupOnly\" [inputClass]=\"'form-control'\" [placeholder]=\"field.vocabField.placeHolder\" [clearUnselected]=\"shouldClearUnselected()\" (selected)=\"onSelect($event)\" [datasource]=\"field.vocabField.dataService\" [minSearchLength]=\"0\" [initialValue]=\"field.vocabField.initialValue\"></ng2-completer>\n              <div class=\"text-danger\" *ngIf=\"field.formModel.controls['text_full_name'].hasError('required')\">{{field.validationMessages.required.text_full_name}}</div>\n            </div>\n            <div class='col-xs-1'>\n              <span class='text-right'>{{ field.emailColHdr }}</span>\n            </div>\n            <div [ngClass]=\"getGroupClass('email', true)\">\n              <input formControlName=\"email\" type=\"text\" class=\"form-control\" [readOnly]=\"field.forceLookupOnly\" [attr.aria-label]=\"field.emailColHdr\"/>\n              <div class=\"text-danger\" *ngIf=\"field.formModel.controls['email'].touched && field.formModel.controls['email'].hasError('email')\">{{field.validationMessages.invalid.email}}</div>\n              <div class=\"text-danger\" *ngIf=\"field.formModel.controls['email'].touched && field.formModel.controls['email'].hasError('required')\">{{field.validationMessages.required.email}}</div>\n            </div>\n            <div class='col-xs-1'>\n              <span class='text-right'>{{ field.orcidColHdr }}</span>\n            </div>\n            <div [ngClass]=\"getGroupClass('orcid', !field.showTitle)\">\n              <input formControlName=\"orcid\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.orcidColHdr\"/>\n            </div>\n          </span>\n        </div>\n      </div>\n      <ng-container *ngIf=\"isEmbedded\">\n        <div class=\"row\">\n          <span class='col-xs-12' >\n            <!-- Lookup Embedded version -->\n            <!-- If we show the title -->\n            <ng-container *ngIf=\"field.showTitle\">\n              <div class=\"col-xs-1\" >\n                <input formControlName=\"honorific\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.titleColHdr\" [attr.placeholder]=\"field.titleColHdr\"/>\n              </div>\n            </ng-container>\n            <div class='col-xs-1'>\n              <span class='text-right'>{{ field.nameColHdr }}</span>\n            </div>\n            <div [ngClass]=\"getGroupClass('text_full_name', true)\">\n              <ng2-completer #ngCompleter (opened)=\"onOpen($event)\" (blur)=\"onBlur()\" (keyup)=\"onKeyUp($event)\" (keydown)=\"onKeydown($event)\" [overrideSuggested]=\"!field.forceLookupOnly\" [inputClass]=\"'form-control'\" [placeholder]=\"field.vocabField.placeHolder\" [clearUnselected]=\"shouldClearUnselected()\" (selected)=\"onSelect($event)\" [datasource]=\"field.vocabField.dataService\" [minSearchLength]=\"0\" [initialValue]=\"field.vocabField.initialValue\"></ng2-completer>\n              <div class=\"text-danger\" *ngIf=\"field.formModel.controls['text_full_name'].hasError('required')\">{{field.validationMessages.required.text_full_name}}</div>\n            </div>\n            <div class='col-xs-1'>\n              <span class='text-right'>{{ field.emailColHdr }}</span>\n            </div>\n            <div [ngClass]=\"getGroupClass('email', true)\">\n              <input formControlName=\"email\" type=\"text\" class=\"form-control\" [readOnly]=\"field.forceLookupOnly\" [attr.aria-label]=\"field.emailColHdr\"/>\n              <div class=\"text-danger\" *ngIf=\"field.formModel.controls['email'].touched && field.formModel.controls['email'].hasError('email')\">{{field.validationMessages.invalid.email}}</div>\n              <div class=\"text-danger\" *ngIf=\"field.formModel.controls['email'].touched && field.formModel.controls['email'].hasError('required')\">{{field.validationMessages.required.email}}</div>\n            </div>\n            <div class='col-xs-1'>\n              <span class='text-right'>{{ field.orcidColHdr }}</span>\n            </div>\n            <div [ngClass]=\"getGroupClass('orcid', !field.showTitle)\">\n              <input formControlName=\"orcid\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.orcidColHdr\" />\n            </div>\n          </span>\n        </div>\n      </ng-container>\n    </ng-container>\n  </div>\n</div>\n<div class=\"view-contributor\" *ngIf=\"!field.editMode\">\n  <div class=\"row\">\n    <div class=\"col-xs-12 key-value-pair\" *ngIf=\"field.label\">\n      <span class=\"key\">\n      {{ field.label }}\n      </span>\n    </div>\n  </div>\n  <div class=\"row view-contributor\" *ngIf=\"field.showHeader\">\n    <div *ngIf=\"field.showTitle\" class=\"col-xs-1 label-font\">{{field.titleColHdr}}</div>\n    <div class=\"col-xs-3 label-font\">{{field.nameColHdr}}</div>\n    <div [attr.class]=\"field.showRole? 'col-xs-3':'col-xs-4'\"><span class='label-font'>{{field.emailColHdr}}</span></div>\n    <div [attr.class]=\"field.showRole? 'col-xs-3':'hidden'\"><span class='label-font'>{{field.roleColHdr}}</span></div>\n    <div [attr.class]=\"field.showRole? (field.showTitle ? 'col-xs-2' : 'col-xs-3') :'col-xs-4'\"><span class='label-font'>{{field.orcidColHdr}}</span></div>\n  </div>\n  <div class=\"row view-contributor\">\n    <div *ngIf=\"field.showTitle\" class=\"col-xs-1\">{{field.value.honorific}}</div>\n    <div class=\"col-xs-3\">{{field.value.text_full_name}}</div>\n    <div [attr.class]=\"field.showRole? 'col-xs-3':'col-xs-4'\">{{field.value.email}}</div>\n    <div [attr.class]=\"field.showRole? 'col-xs-3':'hidden'\">{{field.value.role}}</div>\n    <div [attr.class]=\"field.showRole? (field.showTitle ? 'col-xs-2' : 'col-xs-3') :'col-xs-4'\">{{field.value.orcid}}</div>\n  </div>\n</div>\n"

/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-contributor.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var field_vocab_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-vocab.component.ts");
var Rx_1 = __webpack_require__("./node_modules/rxjs/_esm5/Rx.js");
/**
 * Contributor Model
 *
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 *
 */
var KEY_TAB = 9;
var KEY_EN = 13;
var ContributorField = /** @class */ (function (_super) {
    __extends(ContributorField, _super);
    function ContributorField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.fullNameResponseField = "text_full_name";
        _this.clName = 'ContributorField';
        _this.controlType = 'textbox';
        _this.splitNames = options['splitNames'] || false;
        _this.familyNameHdr = options['familyNameHdr'] ? _this.getTranslated(options['familyNameHdr'], options['familyNameHdr']) : 'Family';
        _this.givenNameHdr = options['givenNameHdr'] ? _this.getTranslated(options['givenNameHdr'], options['givenNameHdr']) : 'Given';
        _this.nameColHdr = options['nameColHdr'] ? _this.getTranslated(options['nameColHdr'], options['nameColHdr']) : 'Researcher Name';
        _this.emailColHdr = options['emailColHdr'] ? _this.getTranslated(options['emailColHdr'], options['emailColHdr']) : 'Email Address';
        _this.roleColHdr = options['roleColHdr'] ? _this.getTranslated(options['roleColHdr'], options['roleColHdr']) : 'Project Role';
        _this.orcidColHdr = options['orcidColHdr'] ? _this.getTranslated(options['orcidColHdr'], options['orcidColHdr']) : 'ORCID';
        _this.titleColHdr = options['titleColHdr'] ? _this.getTranslated(options['titleColHdr'], options['titleColHdr']) : 'Title';
        _this.showTitle = options['showTitle'] == undefined ? true : options['showTitle'];
        _this.showHeader = options['showHeader'] == undefined ? true : options['showHeader'];
        _this.showRole = options['showRole'] == undefined ? true : options['showRole'];
        _this.baseMarginTop = options['baseMarginTop'] || '';
        _this.forceLookup_clearOnTabThrough = _.isUndefined(options['forceLookup_clearOnTabThrough']) ? true : options['forceLookup_clearOnTabThrough'];
        _this.roles = options['roles'] || [];
        _this.value = options['value'] || _this.setEmptyValue();
        _this.activeValidators = options['activeValidators'];
        _this.fieldNames = options['fieldNames'] || [];
        var textFullNameFieldName = _.find(_this.fieldNames, function (fieldNameObject) {
            return fieldNameObject['text_full_name'] != undefined;
        });
        if (textFullNameFieldName != null) {
            _this.fullNameResponseField = textFullNameFieldName['text_full_name'];
        }
        _this.validationMessages = options['validationMessages'] || { required: {
                email: _this.getTranslated(options['validation_required_email'], 'Email required'),
                text_full_name: _this.getTranslated(options['validation_required_name'], 'Name is required'),
                role: _this.getTranslated(options['validation_required_role'], 'Select a role'),
                family_name: _this.getTranslated(options['validation_required_family_name'], 'Family name is required'),
                given_name: _this.getTranslated(options['validation_required_given_name'], 'Given name is required'),
            },
            invalid: { email: _this.getTranslated(options['validation_invalid_email'], 'Email format is incorrect') } };
        _this.groupFieldNames = ['text_full_name', 'email'];
        _this.freeText = options['freeText'] || false;
        _this.forceLookupOnly = options['forceLookupOnly'] || false;
        if (_this.forceLookupOnly) {
            // override free text as it doesn't make sense
            _this.freeText = false;
        }
        // do not show contributor role if required details are blank
        var showFieldRoleValue = _.get(_this.value, 'text_full_name') || _.get(_this.value, 'email');
        _this.role = showFieldRoleValue && options['role'] ? _this.getTranslated(options['role'], options['role']) : null;
        _this.username = options['username'] || '';
        _this.previousEmail = _this.value ? _this.value.email : '';
        _this.validators = {
            text_full_name: [forms_1.Validators.required],
            email: [forms_1.Validators.required, forms_1.Validators.email]
        };
        if (!_this.freeText) {
            _this.vocabField = new field_vocab_component_1.VocabField(_this.options, _this.injector);
            _this.hasLookup = true;
        }
        if (_this.splitNames) {
            _this.groupFieldNames.push('family_name');
            _this.groupFieldNames.push('given_name');
            _this.validators['family_name'] = [forms_1.Validators.required];
            _this.validators['given_name'] = [forms_1.Validators.required];
        }
        // Resolves: #605
        // now that we've set the default validators... we read the config to override
        if (!_.isEmpty(_this.activeValidators)) {
            _.forOwn(_this.activeValidators, function (vConfig, fName) {
                // expects to be an array of Validator method names
                if (_.isArray(vConfig)) {
                    _this.validators[fName] = _.map(vConfig, function (vConfigEntry) {
                        return _.get(forms_1.Validators, vConfigEntry);
                    });
                }
                else if (vConfig == null) {
                    // remove the default...
                    _.unset(_this.validators, fName);
                }
            });
        }
        _this.findRelationshipFor = options['findRelationshipFor'] || '';
        _this.findRelationship = options['findRelationship'] || null;
        _this.relationshipFor = options['relationshipFor'] || '';
        return _this;
    }
    ContributorField.prototype.setLookupServices = function (completerService, lookupService) {
        if (!this.freeText) {
            this.vocabField.setLookupServices(completerService, lookupService);
        }
    };
    ContributorField.prototype.createFormModel = function (valueElem) {
        var _this = this;
        if (valueElem === void 0) { valueElem = undefined; }
        if (valueElem) {
            this.value = valueElem;
        }
        if (_.isEmpty(this.value.role)) {
            this.value.role = this.role;
        }
        if (!this.freeText) {
            // this.vocabField.setEmptyValue();
            this.formModel = this.vocabField.createFormModel(this.value, true);
            this.formModel.addControl('username', new forms_1.FormControl(this.value.username));
            this.formModel.addControl('role', new forms_1.FormControl(this.value.role));
            this.formModel.addControl('orcid', new forms_1.FormControl(this.value.orcid));
            this.formModel.addControl('honorific', new forms_1.FormControl(this.value.honorific));
            if (this.value) {
                this.setValue(this.value);
            }
        }
        else {
            this.formModel = new forms_1.FormGroup({ text_full_name: new forms_1.FormControl(this.value.text_full_name || null),
                email: new forms_1.FormControl(this.value.email || null),
                role: new forms_1.FormControl(this.value.role || null),
                username: new forms_1.FormControl(this.value.username || ''),
                orcid: new forms_1.FormControl(this.value.orcid || ''),
                honorific: new forms_1.FormControl(this.value.honorific || '')
            });
            if (this.splitNames) {
                this.formModel.addControl('family_name', new forms_1.FormControl(this.value.family_name));
                this.formModel.addControl('given_name', new forms_1.FormControl(this.value.given_name));
            }
        }
        if (this.required) {
            this.enableValidators();
        }
        else {
            // if splitting names, attach handler to individual input form control
            if (this.splitNames) {
                var reqFields = ['family_name', 'given_name'];
                var handler_1 = this.getToggleConditionalValidationHandler(reqFields, true);
                _.each(reqFields, function (reqField) {
                    _this.formModel.controls[reqField].valueChanges.subscribe(handler_1);
                });
                // install the validators if needed
                var hasValue = !_.isEmpty(this.value.family_name) || !_.isEmpty(this.value.given_name);
                this.toggleConditionalValidation(hasValue);
            }
            else {
                // install the validators if needed
                this.toggleConditionalValidation(!_.isEmpty(this.value.text_full_name));
            }
        }
        return this.formModel;
    };
    ContributorField.prototype.getToggleConditionalValidationHandler = function (requiredFields, useFormControl) {
        var _this = this;
        return (function (value) {
            var hasValue = true;
            if (useFormControl) {
                _.each(requiredFields, function (reqField) {
                    hasValue = hasValue || !_.isEmpty(_this.formModel.controls[reqField].value);
                });
            }
            else {
                hasValue = !_.isEmpty(value);
            }
            _this.toggleConditionalValidation(hasValue);
        });
    };
    ContributorField.prototype.setValue = function (value, emitEvent, updateTitle) {
        if (emitEvent === void 0) { emitEvent = true; }
        if (updateTitle === void 0) { updateTitle = false; }
        this.setMissingFields(value);
        if (!this.hasInit) {
            this.hasInit = true;
            value.username = _.isUndefined(value.username) ? '' : value.username;
        }
        else {
            if (_.isUndefined(value.username) || (value.email && value.email != this.previousEmail)) {
                value.username = '';
                this.previousEmail = value.email;
            }
        }
        this.formModel.patchValue(value, { emitEvent: emitEvent });
        this.formModel.markAsTouched();
        this.formModel.markAsDirty();
        if (updateTitle && !this.freeText) {
            this.component.ngCompleter.ctrInput.nativeElement.value = this.vocabField.getTitle(value);
        }
        // install the validators if needed
        if (this.splitNames) {
            var hasValue = !_.isEmpty(value.family_name) || !_.isEmpty(value.given_name);
            this.toggleConditionalValidation(hasValue);
        }
        else {
            this.toggleConditionalValidation(!_.isEmpty(value.text_full_name));
        }
    };
    ContributorField.prototype.toggleConditionalValidation = function (hasValue) {
        var _this = this;
        // Resolves #605: Add config flag for each field to enable conditional validation
        // Only one condition for now: names must be set
        if (hasValue) {
            _.forOwn(this.activeValidators, function (vConfig, fName) {
                if (!_.isUndefined(_this.validators[fName])) {
                    _this.formModel.controls[fName].setValidators(_this.validators[fName]);
                }
            });
        }
        else {
            _.forOwn(this.activeValidators, function (vConfig, fName) {
                if (!_.isUndefined(_this.validators[fName])) {
                    _this.formModel.controls[fName].clearValidators();
                }
            });
        }
    };
    ContributorField.prototype.toggleValidator = function (c) {
        var _this = this;
        return function (value) {
            if (value || _.find(_this.formModel.controls, function (c) { return c.value; })) {
                _this.enableValidators();
            }
            else {
                _this.disableValidators();
            }
        };
    };
    ContributorField.prototype.enableValidators = function () {
        var _this = this;
        if (this.enabledValidators) {
            return;
        }
        this.enabledValidators = true;
        _.forEach(this.groupFieldNames, function (f) {
            // Resolves #605: check if there is a validator, because we can disable/remove validators now
            if (!_.isUndefined(_this.validators[f])) {
                _this.formModel.controls[f].setValidators(_this.validators[f]);
            }
        });
    };
    ContributorField.prototype.disableValidators = function () {
        if (!this.enabledValidators) {
            return;
        }
        this.enabledValidators = false;
        _.forEach(this.formModel.controls, function (c) {
            c.setValidators(null);
            c.setErrors(null);
        });
    };
    ContributorField.prototype.postInit = function (value) {
        var _this = this;
        if (value) {
            this.value = value;
            if (!this.freeText) {
                this.vocabField.value = value;
                this.vocabField.initialValue = _.cloneDeep(value);
                this.vocabField.initialValue.title = this.vocabField.getTitle(value);
                this.vocabField.initLookupData();
            }
            // If there is a findRelationship Object in configuration init the value,
            // and not already inited, lookup and complete with a corresponding
            // relationship in Mint
            if (this.findRelationship && _.isEmpty(this.vocabField.initialValue.title)) {
                if (this.findRelationshipFor && this.relationshipFor) {
                    var doInit = _.find(this.findRelationshipFor, function (r) { return r === _this.relationshipFor; });
                    if (doInit) {
                        this.initWithRelationship();
                    }
                }
            }
        }
        else {
            this.setEmptyValue();
        }
    };
    ContributorField.prototype.initWithRelationship = function () {
        var _this = this;
        var related = this.findRelationship['relateWith'];
        var relatedWith = this.options[related];
        var role = this.findRelationship['role'] || '';
        var relationship = this.findRelationship['relationship'] || '';
        var searchField = this.findRelationship['searchField'] || '';
        var searchFieldLower = this.findRelationship['searchFieldLower'];
        var searchRelation = this.findRelationship['searchRelation'] || '';
        var searchRelationLower = this.findRelationship['searchRelationLower'];
        var titleCompleter = this.findRelationship['title'] || '';
        var emailCompleter = this.findRelationship['email'] || '';
        var fullNameHonorificCompleter = this.findRelationship['fullNameHonorific'] || '';
        var honorificCompleter = this.findRelationship['honorific'] || '';
        var givenNameCompleter = this.findRelationship['givenName'] || '';
        var familyNameCompleter = this.findRelationship['familyName'] || '';
        this.vocabField.relationshipLookup(relatedWith, searchFieldLower, searchField)
            .flatMap(function (res) {
            var rel = null;
            if (res && res['status'] === 200) {
                var data = res.json();
                if (!_.isEmpty(data) && !data['error']) {
                    var obj = _.first(data);
                    if (_.isArray(obj[relationship])) {
                        rel = _.first(obj[relationship]);
                    }
                }
            }
            if (rel) {
                return _this.vocabField.relationshipLookup(rel, searchRelationLower, searchRelation);
            }
            else {
                return Rx_1.Observable.of(null);
            }
        })
            .subscribe(function (res) {
            if (res && res['status'] === 200) {
                var data = res.json();
                if (!_.isEmpty(data) && !data['error']) {
                    var obj = _.first(data);
                    if (obj) {
                        var emailCompleterValue = _this.getFirstOrDefault(obj[emailCompleter], '');
                        var titleCompleterValue = _this.getFirstOrDefault(obj[titleCompleter], '');
                        var fullNameHonorificValue = _this.getFirstOrDefault(obj[fullNameHonorificCompleter], '');
                        var honorificValue = _this.getFirstOrDefault(obj[honorificCompleter], '');
                        var givenNameValue = _this.getFirstOrDefault(obj[givenNameCompleter], '');
                        var familyNameValue = _this.getFirstOrDefault(obj[familyNameCompleter], '');
                        _this.vocabField.initialValue = {
                            text_full_name: titleCompleterValue,
                            text_full_name_honorific: fullNameHonorificValue,
                            email: emailCompleterValue,
                            givenName: givenNameValue,
                            familyName: familyNameValue,
                            honorific: honorificValue,
                            full_name_family_name_first: familyNameValue + ", " + givenNameValue,
                            role: role
                        };
                        _this.vocabField.initialValue.title = titleCompleterValue;
                    }
                }
            }
        }, function (error) {
            console.error('initWithRelationship error');
            console.error(error.message);
        });
    };
    ContributorField.prototype.getFirstOrDefault = function (obj, defaultValue) {
        return _.defaultTo(_.isArray(obj) ? _.first(obj) : obj, defaultValue);
    };
    ContributorField.prototype.setEmptyValue = function (emitEvent) {
        if (emitEvent === void 0) { emitEvent = true; }
        this.value = { text_full_name: null, email: null, role: null, username: '' };
        if (this.formModel) {
            _.forOwn(this.formModel.controls, function (c, cName) {
                c.setValue(null, { emitEvent: emitEvent });
            });
        }
        return this.value;
    };
    Object.defineProperty(ContributorField.prototype, "isValid", {
        get: function () {
            var _this = this;
            var validity = false;
            _.forEach(this.groupFieldNames, function (f) {
                validity = validity && _this.formModel.controls[f].valid;
            });
            return validity;
        },
        enumerable: true,
        configurable: true
    });
    ContributorField.prototype.triggerValidation = function () {
        var _this = this;
        _.forEach(this.groupFieldNames, function (f) {
            _this.formModel.controls[f].updateValueAndValidity({ onlySelf: true, emitEvent: false });
            _this.formModel.controls[f].markAsTouched();
        });
    };
    ContributorField.prototype.getValidationError = function () {
        var _this = this;
        var errObj = null;
        if (this.formModel) {
            _.forEach(this.groupFieldNames, function (f) {
                if (!_.isEmpty(_this.formModel.controls[f].errors)) {
                    errObj = _this.formModel.controls[f].errors;
                }
            });
        }
        return errObj;
    };
    /**
     * This method was created to try to guess the family and given names from a value that's got these 2 merged.
     *
     * @author <a target='_' href='https://github.com/shilob'>Shilo Banihit</a>
     * @param  value
     * @return
     */
    ContributorField.prototype.setMissingFields = function (value) {
        if (this.splitNames && (value && value.text_full_name && (_.isEmpty(value.family_name) || _.isUndefined(value.family_name)))) {
            // guess work begins...
            var names = value.text_full_name.split(' ');
            value['given_name'] = names[0];
            names.splice(0, 1);
            value['family_name'] = names.join(' ');
            value['full_name_family_name_first'] = value['family_name'] + ", " + value['given_name'];
        }
        return value;
    };
    ContributorField.prototype.reactEvent = function (eventName, eventData, origData) {
        var _this = this;
        if (_.isEmpty(this.componentReactors)) {
            this.setValue(eventData, false, true);
        }
        else {
            _.each(this.componentReactors, function (compReact) {
                compReact.reactEvent(eventName, eventData, origData, _this);
            });
        }
    };
    return ContributorField;
}(field_base_1.FieldBase));
exports.ContributorField = ContributorField;
var ContributorComponent = /** @class */ (function (_super) {
    __extends(ContributorComponent, _super);
    function ContributorComponent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.isEmbedded = false;
        _this.emptied = false;
        _this.blurred = false;
        return _this;
    }
    ContributorComponent.prototype.ngOnInit = function () {
        this.field.componentReactors.push(this);
        this.field.component = this;
    };
    ContributorComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        if (this.field.editMode && this.ngCompleter) {
            var that_1 = this;
            this.ngCompleter.ctrInput.nativeElement.setAttribute('aria-label', 'Name');
            this.ngCompleter.registerOnChange(function (v) {
                if (_.isEmpty(v) && !that_1.field.forceLookup_clearOnTabThrough) {
                    // if this option is set, we ignore the tab through
                    return;
                }
                that_1.emptied = _.isEmpty(v);
                if (that_1.emptied && that_1.blurred) {
                    that_1.blurred = false;
                    console.log("Forced lookup, clearing data..");
                    _this.field.setEmptyValue(true);
                    _this.lastSelected = null;
                    _this.field.toggleConditionalValidation(false);
                }
            });
        }
    };
    ContributorComponent.prototype.getGroupClass = function (fldName, wideMode) {
        if (wideMode === void 0) { wideMode = false; }
        var hasError = false;
        hasError = hasError || (this.field.formModel.controls[fldName].hasError('required'));
        if (!hasError && fldName == 'email') {
            hasError = hasError || (this.field.formModel.controls[fldName].hasError('email'));
        }
        var additionalClass = this.field.splitNames ? ' padding-remove' : '';
        return "col-xs-" + (wideMode ? '3' : '2') + " form-group" + additionalClass + (hasError ? ' has-error' : '') + " " + (_.isEmpty(this.field.cssClasses) || _.isEmpty(this.field.cssClasses[fldName]) ? '' : this.field.cssClasses[fldName]);
    };
    ContributorComponent.prototype.onSelect = function (selected, emitEvent, updateTitle) {
        if (emitEvent === void 0) { emitEvent = true; }
        if (updateTitle === void 0) { updateTitle = false; }
        if (selected) {
            if ((_.isEmpty(selected.title) || _.isUndefined(selected.title)) && (_.isEmpty(selected.text_full_name) || _.isUndefined(selected.text_full_name))) {
                console.log("Same or empty selection, returning...");
                this.lastSelected = null;
                return;
            }
            else {
                if (selected.title && selected.title == this.field.formModel.value.text_full_name) {
                    console.log("Same or empty selection, returning...");
                    return;
                }
            }
            this.lastSelected = selected;
            var val = void 0;
            if (!this.field.freeText) {
                if (_.isEmpty(selected.text_full_name)) {
                    if (this.field.vocabField.restrictToSelection || selected.originalObject) {
                        val = this.field.vocabField.getValue(selected);
                    }
                    else {
                        val = { text_full_name: selected.title };
                    }
                }
                else if (selected[this.field.fullNameResponseField]) {
                    val = this.field.vocabField.getValue(selected);
                }
                else {
                    val = { text_full_name: selected.title };
                }
                if (!_.isEmpty(selected.orcid) && !_.isUndefined(selected.orcid)) {
                    val['orcid'] = selected.orcid;
                }
                if (!_.isEmpty(selected.username) && !_.isUndefined(selected.username)) {
                    val['username'] = selected.username;
                }
                val.role = this.field.role;
                // console.log(`With selected:`);
                // console.log(JSON.stringify(selected));
                // console.log(`Using val:`);
                // console.log(JSON.stringify(val));
                this.field.setValue(val, emitEvent, updateTitle);
            }
            else {
                val = this.field.setMissingFields(selected);
                this.field.setValue(val, emitEvent, updateTitle);
            }
        }
        else {
            console.log("No selected user.");
            if (this.field.forceLookupOnly) {
                console.log("Forced lookup, clearing data..");
                this.field.setEmptyValue(emitEvent);
                this.lastSelected = null;
            }
        }
    };
    ContributorComponent.prototype.reactEvent = function (eventName, eventData, origData, elem) {
        console.log("Contributor component reacting:");
        console.log(eventData);
        this.onSelect(eventData, false, true);
    };
    ContributorComponent.prototype.shouldClearUnselected = function () {
        if (!this.field.forceLookup_clearOnTabThrough && this.field.forceLookupOnly) {
            return false;
        }
        return this.field.forceLookupOnly;
    };
    ContributorComponent.prototype.onKeydown = function (event) {
        if (event && (event.keyCode === KEY_EN || event.keyCode === KEY_TAB)) {
            if (this.lastSelected && this.emptied) {
                var that_2 = this;
                setTimeout(function () {
                    var value = that_2.lastSelected.title;
                    that_2.ngCompleter.ctrInput.nativeElement.value = that_2.lastSelected.title;
                }, 40);
            }
            else {
                if (this.emptied && this.field.forceLookupOnly) {
                    console.log("Forced lookup, clearing data..");
                    this.field.setEmptyValue(true);
                    this.lastSelected = null;
                    this.field.toggleConditionalValidation(false);
                }
            }
        }
        else {
            var val = this.field.vocabField.getValue({ text_full_name: this.ngCompleter.ctrInput.nativeElement.value });
            this.field.setValue(val, true, false);
        }
    };
    ContributorComponent.prototype.onKeyUp = function (event) {
        var val = this.ngCompleter.ctrInput.nativeElement.value;
        this.field.toggleConditionalValidation(!_.isEmpty(val));
    };
    ContributorComponent.prototype.onBlur = function () {
        if (this.field.forceLookupOnly) {
            this.blurred = true;
        }
    };
    ContributorComponent.prototype.onOpen = function (isOpen) {
        if (isOpen) {
            this.field.toggleConditionalValidation(false);
        }
    };
    __decorate([
        core_1.Input(),
        __metadata("design:type", Boolean)
    ], ContributorComponent.prototype, "isEmbedded", void 0);
    __decorate([
        core_1.ViewChild('ngCompleter'),
        __metadata("design:type", Object)
    ], ContributorComponent.prototype, "ngCompleter", void 0);
    ContributorComponent = __decorate([
        core_1.Component({
            selector: 'rb-contributor',
            template: __webpack_require__("./redbox-portal/angular/shared/form/field-contributor.component.html"),
        })
    ], ContributorComponent);
    return ContributorComponent;
}(field_simple_component_1.SimpleComponent));
exports.ContributorComponent = ContributorComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-control-meta.service.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var Observable_1 = __webpack_require__("./node_modules/rxjs/_esm5/Observable.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var fieldClasses_1 = __webpack_require__("./redbox-portal/angular/shared/fieldClasses.ts");
var config_service_1 = __webpack_require__("./redbox-portal/angular/shared/config-service.ts");
var field_vocab_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-vocab.component.ts");
var ng2_completer_1 = __webpack_require__("./node_modules/ng2-completer/index.js");
var translation_service_1 = __webpack_require__("./redbox-portal/angular/shared/translation-service.ts");
var util_service_1 = __webpack_require__("./redbox-portal/angular/shared/util-service.ts");
var base_service_1 = __webpack_require__("./redbox-portal/angular/shared/base-service.ts");
var http_1 = __webpack_require__("./node_modules/@angular/http/esm5/http.js");
var FieldControlMetaService = /** @class */ (function (_super) {
    __extends(FieldControlMetaService, _super);
    function FieldControlMetaService(http, vocabFieldLookupService, completerService, configService, translationService, utilityService, app) {
        var _this = _super.call(this, http, configService) || this;
        _this.vocabFieldLookupService = vocabFieldLookupService;
        _this.completerService = completerService;
        _this.configService = configService;
        _this.translationService = translationService;
        _this.utilityService = utilityService;
        _this.app = app;
        _this.classes = fieldClasses_1.fieldClasses;
        return _this;
    }
    FieldControlMetaService.prototype.getFieldsMeta = function (fieldsArr) {
        var _this = this;
        var fields = _.map(fieldsArr, function (f) {
            // console.log(f.class);
            // if(typeof this.classes[f.class] != 'undefined'){
            //   console.log(f.class + ' is null');
            // }
            //Todo: break this up and return a more meaningful error when the field name doesn't exist  
            var fieldClass = _this.classes[f.class];
            if (fieldClass === undefined) {
                console.error("Field class with name: " + f.class + " not found field class list. Check spelling and whether it is declared in the following list.");
                console.error(_this.classes);
            }
            var inst = new fieldClass.meta(f.definition, _this.app['_injector']);
            inst.utilityService = _this.getInjectedService('utilityService');
            inst.appConfig = _this.getInjectedService('configService').config;
            // set the component class
            if (_.isArray(_this.classes[f.class].comp)) {
                inst.compClass = _.find(_this.classes[f.class].comp, function (c) {
                    // console.log(`Checking if ${c.clName} == ${f.compClass}`);
                    return c.clName == f.compClass;
                });
                // defaults to the first entry when compClass is undefined
                if (_.isUndefined(inst.compClass)) {
                    inst.compClass = _this.classes[f.class].comp[0];
                }
            }
            else {
                inst.compClass = _this.classes[f.class].comp;
            }
            if (f.definition && f.definition.fields) {
                inst.fields = _this.getFieldsMeta(f.definition.fields);
            }
            return inst;
        });
        return fields;
    };
    FieldControlMetaService.prototype.flattenFields = function (fields, fieldArr) {
        var _this = this;
        _.map(fields, function (f) {
            fieldArr.push(f);
            if (f.fields) {
                _this.flattenFields(f.fields, fieldArr);
            }
        });
    };
    FieldControlMetaService.prototype.getLookupData = function (fields) {
        var _this = this;
        var fieldArray = [];
        this.flattenFields(fields, fieldArray);
        return Observable_1.Observable.from(fieldArray).flatMap(function (f) {
            if (f.hasLookup) {
                var lookupServiceName = _this.classes[f.clName].lookupService;
                var serviceInst = _this.getInjectedService(lookupServiceName);
                f.setLookupServices(_this.getInjectedService('completerService'), serviceInst);
                // f.completerService = this.completerService;
                // f.lookupService = this[lookupServiceName];
                return serviceInst.getLookupData(f);
            }
            else {
                return Observable_1.Observable.of(null);
            }
        })
            .flatMap(function (field) {
            return Observable_1.Observable.of(field);
        })
            .last()
            .flatMap(function (whatever) {
            return Observable_1.Observable.of(fields);
        });
    };
    FieldControlMetaService.prototype.getInjectedService = function (serviceName) {
        var serviceInst = null;
        switch (serviceName) {
            case 'vocabFieldLookupService':
                serviceInst = this.vocabFieldLookupService;
                break;
            case 'completerService':
                serviceInst = this.completerService;
                break;
            case 'configService':
                serviceInst = this.configService;
                break;
            case 'translationService':
                serviceInst = this.translationService;
                break;
            case 'utilityService':
                serviceInst = this.utilityService;
                break;
        }
        return serviceInst;
    };
    FieldControlMetaService = __decorate([
        core_1.Injectable(),
        __param(0, core_1.Inject(http_1.Http)),
        __param(1, core_1.Inject(field_vocab_component_1.VocabFieldLookupService)),
        __param(2, core_1.Inject(ng2_completer_1.CompleterService)),
        __param(3, core_1.Inject(config_service_1.ConfigService)),
        __param(4, core_1.Inject(translation_service_1.TranslationService)),
        __param(5, core_1.Inject(util_service_1.UtilityService)),
        __metadata("design:paramtypes", [http_1.Http,
            field_vocab_component_1.VocabFieldLookupService,
            ng2_completer_1.CompleterService,
            config_service_1.ConfigService,
            translation_service_1.TranslationService,
            util_service_1.UtilityService,
            core_1.ApplicationRef])
    ], FieldControlMetaService);
    return FieldControlMetaService;
}(base_service_1.BaseService));
exports.FieldControlMetaService = FieldControlMetaService;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-control.service.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/observable/of.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/mergeMap.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/last.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/observable/from.js");
var ng2_completer_1 = __webpack_require__("./node_modules/ng2-completer/index.js");
var config_service_1 = __webpack_require__("./redbox-portal/angular/shared/config-service.ts");
var translation_service_1 = __webpack_require__("./redbox-portal/angular/shared/translation-service.ts");
var util_service_1 = __webpack_require__("./redbox-portal/angular/shared/util-service.ts");
var field_control_meta_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-control-meta.service.ts");
var fieldClasses_1 = __webpack_require__("./redbox-portal/angular/shared/fieldClasses.ts");
/**
 * Field / Model Factory Service...
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 *
 */
var FieldControlService = /** @class */ (function () {
    function FieldControlService(completerService, configService, translationService, utilityService, fcmetaService, app) {
        this.completerService = completerService;
        this.configService = configService;
        this.translationService = translationService;
        this.utilityService = utilityService;
        this.fcmetaService = fcmetaService;
        this.app = app;
        this.classes = fieldClasses_1.fieldClasses;
    }
    FieldControlService.prototype.addComponentClasses = function (componentClasses) {
        this.classes = _.merge(this.classes, componentClasses);
    };
    FieldControlService.prototype.getEmptyFormGroup = function () {
        return new forms_1.FormGroup({});
    };
    FieldControlService.prototype.toFormGroup = function (fields, fieldMap) {
        if (fieldMap === void 0) { fieldMap = null; }
        var group = {};
        this.populateFormGroup(fields, group, fieldMap);
        this.setupEventHandlers(fieldMap);
        this.setupVisibility(fieldMap);
        return new forms_1.FormGroup(group);
    };
    FieldControlService.prototype.setupEventHandlers = function (fieldMap) {
        _.forOwn(fieldMap, function (fMap) {
            if (fMap.field) {
                fMap.field.setupEventHandlers();
            }
        });
    };
    FieldControlService.prototype.setupVisibility = function (fieldMap) {
        _.forOwn(fieldMap, function (fMap) {
            if (fMap.field) {
                fMap.field.checkIfVisible();
            }
        });
    };
    FieldControlService.prototype.populateFormGroup = function (fields, group, fieldMap) {
        var _this = this;
        fields.forEach(function (field) {
            if (field.fields && !field.hasGroup) {
                _this.populateFormGroup(field.fields, group, fieldMap);
            }
            else {
                field.getGroup(group, fieldMap);
            }
        });
        return group;
    };
    FieldControlService.prototype.getFieldsMeta = function (fieldsArr) {
        var fields = this.fcmetaService.getFieldsMeta(fieldsArr);
        return fields;
    };
    FieldControlService.prototype.getLookupData = function (fields) {
        return this.fcmetaService.getLookupData(fields);
    };
    FieldControlService = __decorate([
        core_1.Injectable(),
        __param(0, core_1.Inject(ng2_completer_1.CompleterService)),
        __param(1, core_1.Inject(config_service_1.ConfigService)),
        __param(2, core_1.Inject(translation_service_1.TranslationService)),
        __param(3, core_1.Inject(util_service_1.UtilityService)),
        __param(4, core_1.Inject(field_control_meta_service_1.FieldControlMetaService)),
        __metadata("design:paramtypes", [ng2_completer_1.CompleterService,
            config_service_1.ConfigService,
            translation_service_1.TranslationService,
            util_service_1.UtilityService,
            field_control_meta_service_1.FieldControlMetaService,
            core_1.ApplicationRef])
    ], FieldControlService);
    return FieldControlService;
}());
exports.FieldControlService = FieldControlService;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-data-location.html":
/***/ (function(module, exports) {

module.exports = "<!-- Basic Uppy styles -->\n<link rel=\"stylesheet\" href=\"/node_modules/uppy/dist/uppy.min.css\">\n<div class='padding-bottom-10'>\n  <span class=\"label-font\">\n    {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n  </span><br/>\n  <div>\n      <div class=\"table-responsive\" *ngIf=\"getDatalocations() && getDatalocations().length > 0\">\n      <table class=\"table table-bordered table-striped table-hover\">\n        <thead>\n          <tr>\n            <th width=\"15%\">{{ field.typeHeader }}</th>\n            <th width=\"40%\">{{ field.locationHeader }}</th>\n            <th *ngIf=\"field.notesEnabled\" width=\"20%\">{{ field.notesHeader }}</th>\n            <th *ngIf=\"field.iscEnabled\" width=\"20%\">{{ field.iscHeader }}</th>\n            <th width=\"5%\" *ngIf=\"field.editMode\"><span [hidden]=\"true\">Action</span></th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr *ngFor=\"let dataLocation of getDatalocations(); let i = index;\">\n            <td>{{ field.dataTypeLookup[dataLocation.type] }}</td>\n            <td>\n              <ng-container *ngIf=\"dataLocation && dataLocation.type != 'attachment'\">\n              {{ dataLocation.location }}\n              </ng-container>\n              <ng-container *ngIf=\"dataLocation.type == 'attachment'\">\n                <ng-container *ngIf=\"dataLocation.pending\">\n                  {{ dataLocation.name }}\n                </ng-container>\n                <a *ngIf=\"!dataLocation.pending\" href=\"{{ getAbsUrl(dataLocation.location) }}\" target=\"_blank\">\n                  {{ dataLocation.name }}\n                </a>\n              </ng-container>\n            </td>\n            <td *ngIf=\"field.notesEnabled\">\n              {{ dataLocation.notes }}\n              <button *ngIf=\"field.editMode\" type='button' class=\"btn btn-primary pull-right\" (click)=\"editNotes(dataLocation, i)\">{{ field.editNotesButtonText }}</button>\n            </td>\n            <td *ngIf=\"field.iscEnabled\">\n              {{ dataLocation.isc }}\n            </td>\n            <td *ngIf=\"field.editMode\">\n              <a class=\"fa fa-minus-circle btn text-20 btn-danger\" (click)=\"field.removeLocation(dataLocation)\"></a>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n    <div class=\"row padding-bottom-10\" *ngIf=\"field.editMode\">\n      <div class=\"col-xs-3\">\n        <span class=\"label-font\" *ngIf=\"field.iscEnabled\">{{ field.iscHeader }}</span>\n      </div>\n      <div class=\"col-xs-3\">\n        <span class=\"label-font\">{{ field.typeHeader }}</span>\n      </div>\n      <div class=\"col-xs-4\">\n        <span class=\"label-font\">{{ field.locationHeader }}</span>\n      </div>\n      <div class=\"col-xs-2\">\n        <span class=\"label-font\" *ngIf=\"field.newLocation.type != 'attachment' && field.notesEnabled\">{{ field.notesHeader }}</span>\n      </div>\n      <div class=\"col-xs-1\">\n        <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n      </div>\n    </div>\n    <div *ngIf=\"this.helpShow\">\n      <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" [innerHtml]=\"field.help\"></span>\n    </div>\n    <ng-container *ngIf=\"field.editMode\">\n      <div class=\"row\" >\n        <div class=\"col-xs-3\">\n          <select *ngIf=\"field.iscEnabled\" [(ngModel)]=\"field.newLocation.isc\" [id]=\"field.newLocation.isc\" class=\"form-control\" [attr.aria-label]=\"field.iscHeader\">\n            <option *ngFor=\"let opt of field.securityClassificationOptions\" [value]=\"opt.value\">{{opt.label}}</option>\n          </select>\n        </div>\n        <div class=\"col-xs-3\">\n          <select [(ngModel)]=\"field.newLocation.type\" [id]=\"field.newLocation.type\" class=\"form-control\" [attr.aria-label]=\"field.typeHeader\">\n             <option *ngFor=\"let opt of field.dataTypes\" [value]=\"opt.value\">{{opt.label}}</option>\n          </select>\n        </div>\n\n        <div class=\"col-xs-4\">\n          <input [(ngModel)]=\"field.newLocation.location\" *ngIf=\"field.newLocation.type != 'attachment'\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.locationHeader\" />\n          <a [class.disabled]=\"isAttachmentsDisabled()\"\n          class=\"btn btn-info UppyModalOpenerBtn\"\n          [style.display]=\"field.newLocation.type == 'attachment' ? 'inherit' : 'none'\" (click)=\"openModal()\">{{ field.attachmentText }}</a>\n        </div>\n        <div class=\"col-xs-2\">\n          <input [(ngModel)]=\"field.newLocation.notes\"  *ngIf=\"field.newLocation.type != 'attachment' && field.notesEnabled\" type=\"text\" class=\"form-control\" [attr.aria-label]=\"field.notesHeader\" />\n        </div>\n        <div class=\"col-xs-1\">\n          <a  *ngIf=\"field.newLocation.type != 'attachment' && !field.locationAddText\" class=\"fa fa-plus-circle btn text-20 pull-right btn-success\" (click)=\"field.addLocation()\"></a>\n          <button *ngIf=\"field.newLocation.type != 'attachment' && field.locationAddText\" class=\"btn btn-success\" type='button' (click)=\"field.addLocation()\">{{ field.locationAddText }}</button>\n        </div>\n        <!--- Edit notes modal -->\n        <div class=\"modal fade\" id=\"{{ field.name }}_editnotes\" tabindex=\"-1\" role=\"dialog\" >\n          <div class=\"modal-dialog\" role=\"document\">\n            <div class=\"modal-content\">\n              <div class=\"modal-header\">\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n                <span class=\"modal-title\" [innerHtml]=\"field.editNotesTitle\"></span>\n              </div>\n              <div class=\"modal-body\">\n                <input type='text' [ngClass]=\"field.editNotesCssClasses\" [(ngModel)]=\"editingNotes.notes\" [attr.aria-label]=\"field.notesHeader\"/>\n              </div>\n              <div class=\"modal-footer\">\n                <button (click)=\"hideEditNotes()\" type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\" [innerHtml]=\"field.cancelEditNotesButtonText\"></button>\n                <button (click)=\"saveNotes()\" type=\"button\" class=\"btn btn-primary\" [innerHtml]=\"field.applyEditNotesButtonText\"></button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class=\"row\"*ngIf=\"field.required && (field.label || (field.validationMessages && field.validationMessages.required))\" [style.visibility]=\"getFormControl() && getFormControl().hasError('required') && getFormControl().touched ? 'inherit':'hidden'\">\n        <div class=\"col-xs-12\">\n          <div class=\"text-danger\" *ngIf=\"!field.validationMessages?.required\">{{field.label}} is required</div>\n          <div class=\"text-danger\" *ngIf=\"field.validationMessages?.required\">{{field.validationMessages.required}}</div>\n        </div>\n      </div>\n    </ng-container>\n  </div>\n</div>\n"

/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-datalocation.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var records_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/records.service.ts");
var Uppy = __webpack_require__("./node_modules/uppy/lib/index.js");
/**
 * Contributor Model
 *
 *
 * @author <a target='_' href='https://github.com/shilob'>Shilo Banihit</a>
 *
 */
var DataLocationField = /** @class */ (function (_super) {
    __extends(DataLocationField, _super);
    function DataLocationField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.newLocation = { type: "url", location: "", notes: "" };
        _this.attachmentText = "Add attachment(s)";
        _this.dataTypes = [{
                'label': 'URL',
                'value': 'url',
            },
            {
                'label': 'Physical location',
                'value': 'physical',
            },
            {
                'label': 'File path',
                'value': 'file',
            },
            {
                'label': 'Attachment',
                'value': 'attachment'
            }
        ];
        _this.dataTypeLookup = {
            'url': "URL",
            'physical': "Physical location",
            'attachment': "Attachment",
            'file': "File path"
        };
        _this.accessDeniedObjects = [];
        _this.locationAddText = _this.getTranslated(options['locationAddText'], 'Add Location');
        _this.editNotesButtonText = _this.getTranslated(options['editNotesButtonText'], 'Edit');
        _this.editNotesTitle = _this.getTranslated(options['editNotesTitle'], 'Edit Notes');
        _this.cancelEditNotesButtonText = _this.getTranslated(options['cancelEditNotesButtonText'], 'Cancel');
        _this.applyEditNotesButtonText = _this.getTranslated(options['applyEditNotesButtonText'], 'Apply');
        _this.editNotesCssClasses = options['editNotesCssClasses'] || 'form-control';
        _this.typeHeader = _this.getTranslated(options['typeHeader'], 'Type');
        _this.locationHeader = _this.getTranslated(options['locationHeader'], 'Location');
        _this.notesEnabled = !_.isUndefined(options['notesEnabled']) ? options['notesEnabled'] : true;
        _this.notesHeader = options['notesHeader'] ? _this.getTranslated(options['notesHeader'], options['notesHeader']) : null;
        _this.iscHeader = !_.isUndefined(options['iscHeader']) ? _this.getTranslated(options['iscHeader'], options['iscHeader']) : 'Information Security Classification';
        _this.uppyDashboardNote = _this.getTranslated(options['uppyDashboardNote'], 'Maximum upload size: 1 Gb per file');
        _this.iscEnabled = !_.isUndefined(options['iscEnabled']) ? options['iscEnabled'] : false;
        _this.defaultSelect = !_.isUndefined(options['defaultSelect']) ? options['defaultSelect'] : "confidential";
        if (_this.iscEnabled) {
            _this.newLocation['isc'] = _this.defaultSelect;
        }
        _this.securityClassificationOptions = options['securityClassificationOptions'] || [];
        _this.columns = options['columns'] || [];
        _this.maxFileSize = options['maxFileSize'] || null;
        _this.maxNumberOfFiles = options['maxNumberOfFiles'] || null;
        _this.allowedFileTypes = options['allowedFileTypes'] || null;
        _this.value = options['value'] || _this.setEmptyValue();
        _this.recordsService = _this.getFromInjector(records_service_1.RecordsService);
        _this.allowUploadWithoutSave = _.isUndefined(options['allowUploadWithoutSave']) ? false : options['allowUploadWithoutSave'];
        return _this;
    }
    DataLocationField.prototype.setValue = function (value, emitEvent) {
        if (emitEvent === void 0) { emitEvent = true; }
        this.formModel.setValue(value, { emitEvent: emitEvent, emitModelToViewChange: true });
        this.formModel.markAsTouched();
        this.formModel.markAsDirty();
    };
    DataLocationField.prototype.setEmptyValue = function () {
        this.value = [];
        return this.value;
    };
    DataLocationField.prototype.addLocation = function () {
        this.value.push(this.newLocation);
        this.setValue(this.value);
        this.newLocation = { type: "url", location: "", notes: "", isc: this.defaultSelect };
    };
    DataLocationField.prototype.appendLocation = function (newLoc) {
        this.value.push(newLoc);
        this.setValue(this.value, true);
    };
    DataLocationField.prototype.clearPendingAtt = function (value) {
        _.each(value, function (val) {
            if (val.type == 'attachment') {
                _.unset(val, 'pending');
            }
        });
    };
    DataLocationField.prototype.removeLocation = function (loc) {
        _.remove(this.value, function (val) {
            return val.type == loc.type && val.name == loc.name && val.location == loc.location;
        });
        this.setValue(this.value);
    };
    return DataLocationField;
}(field_base_1.FieldBase));
exports.DataLocationField = DataLocationField;
/**
* Component to display information from related objects within ReDBox
*
*
*
*
*/
var DataLocationComponent = /** @class */ (function (_super) {
    __extends(DataLocationComponent, _super);
    function DataLocationComponent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.uppy = null;
        _this.oid = null;
        _this.editingNotes = { notes: '', index: -1 };
        return _this;
    }
    DataLocationComponent.prototype.ngOnInit = function () {
        var oid = this.field.fieldMap._rootComp.oid;
        if (this.field.editMode) {
            if (_.isNull(oid) || _.isUndefined(oid) || _.isEmpty(oid)) {
                // wait for the OID to be set when record is created
                if (!this.field.fieldMap._rootComp.getSubscription('recordCreated')) {
                    console.log("Subscribing to record creation..... " + this.field.name);
                    this.field.fieldMap._rootComp.subscribe('recordCreated', this.field.name, this.eventRecordCreate.bind(this));
                    this.initUppy(oid);
                }
            }
            this.initUppy(oid);
        }
    };
    DataLocationComponent.prototype.ngAfterViewInit = function () {
        if (this.field.editMode) {
            jQuery(".uppy-Dashboard-input").attr('aria-label', this.field.label);
        }
    };
    DataLocationComponent.prototype.getDatalocations = function () {
        return this.field.value;
    };
    DataLocationComponent.prototype.eventRecordCreate = function (createdInfo) {
        console.log("Created record triggered: ");
        console.log(createdInfo);
        this.field.fieldMap[this.field.name].instance.initUppy(createdInfo.oid);
    };
    DataLocationComponent.prototype.tempClearPending = function () {
        // temporarily clearing pending values
        var fieldVal = _.cloneDeep(this.field.fieldMap._rootComp.form.value[this.field.name]);
        this.field.clearPendingAtt(fieldVal);
        this.field.fieldMap._rootComp.form.controls[this.field.name].setValue(fieldVal, { emitEvent: true });
    };
    DataLocationComponent.prototype.applyPendingChanges = function (savedInfo) {
        if (savedInfo.success) {
            // this.field.value = this.field.fieldMap._rootComp.form.value[this.field.name];
            var finalVal = this.field.fieldMap._rootComp.form.controls[this.field.name].value;
            this.field.fieldMap[this.field.name].field.value = finalVal;
        }
        else {
            // reverse the value
            console.log("Resetting....");
            this.field.fieldMap._rootComp.form.controls[this.field.name].setValue(this.field.fieldMap[this.field.name].field.value);
        }
    };
    DataLocationComponent.prototype.initUppy = function (oid) {
        var _this = this;
        if (_.isEmpty(oid) && this.field.allowUploadWithoutSave) {
            oid = "pending-oid";
        }
        this.field.fieldMap[this.field.name].instance.oid = oid;
        if (this.uppy) {
            console.log("Uppy already created... setting oid to: " + oid);
            this.field.fieldMap[this.field.name].instance.uppy.getPlugin('Tus').opts.endpoint = this.field.recordsService.getBrandingAndPortalUrl + "/record/" + oid + "/attach";
            return;
        }
        var appConfig = this.field.recordsService.getConfig();
        var uppyConfig = {
            debug: true,
            autoProceed: false,
            restrictions: {
                maxFileSize: this.field.maxFileSize,
                maxNumberOfFiles: this.field.maxNumberOfFiles,
                allowedFileTypes: this.field.allowedFileTypes
            }
        };
        var uppyDashboardNote = this.field.uppyDashboardNote;
        console.debug("Using Uppy config:");
        console.debug(JSON.stringify(uppyConfig));
        var tusConfig = {
            // added to prevent issues when re-uploading a file that has already been deleted from staging
            removeFingerprintOnSuccess: true,
            endpoint: this.field.recordsService.getBrandingAndPortalUrl + "/record/" + oid + "/attach",
            headers: {
                'X-CSRF-Token': appConfig.csrfToken
            }
        };
        console.debug("Using TUS config:::");
        console.debug(JSON.stringify(tusConfig));
        this.uppy = Uppy.Core(uppyConfig);
        this.uppy.use(Uppy.Dashboard, {
            // trigger: '.UppyModalOpenerBtn',
            inline: false,
            hideProgressAfterFinish: true,
            note: uppyDashboardNote,
            metaFields: [
                { id: 'notes', name: 'Notes', placeholder: 'Notes about this file.' }
            ]
        })
            .use(Uppy.Tus, tusConfig)
            .run();
        console.log(this.uppy);
        var fieldVal = null;
        // attach event handers...
        this.uppy.on('upload-success', function (file, resp, uploadURL) {
            console.debug("File info:");
            console.debug(file);
            console.debug("Response:");
            console.debug(resp);
            console.debug("Upload URL:" + uploadURL);
            // add to form control on each upload...
            var urlParts = uploadURL.split('/');
            var fileId = urlParts[urlParts.length - 1];
            var choppedUrl = urlParts.slice(6, urlParts.length).join('/');
            var newLoc = { type: "attachment", pending: true, location: choppedUrl, notes: file.meta.notes, mimeType: file.type, name: file.meta.name, fileId: fileId, uploadUrl: uploadURL };
            if (_this.field.iscEnabled) {
                newLoc['isc'] = _this.field.newLocation.isc;
            }
            console.debug("Adding new location:");
            console.debug(newLoc);
            _this.field.appendLocation(newLoc);
        });
        // clearing all pending attachments...
        this.field.fieldMap._rootComp.subscribe('onBeforeSave', this.field.name, function (savedInfo) {
            console.log("Before saving record triggered.. ");
            _this.field.fieldMap[_this.field.name].instance.tempClearPending();
        });
        // attach event handling for saving the record
        this.field.fieldMap._rootComp.subscribe('recordSaved', this.field.name, function (savedInfo) {
            console.log("Saved record triggered.. ");
            _this.field.fieldMap[_this.field.name].instance.applyPendingChanges(savedInfo);
        });
    };
    DataLocationComponent.prototype.isAttachmentsDisabled = function () {
        if (_.isEmpty(this.oid) && !this.field.allowUploadWithoutSave) {
            this.field.attachmentText = "Save your record to attach files";
            return true;
        }
        else {
            this.field.attachmentText = "Add attachment(s)";
            return false;
        }
    };
    DataLocationComponent.prototype.getAbsUrl = function (location) {
        return this.field.recordsService.getBrandingAndPortalUrl + "/record/" + location;
    };
    DataLocationComponent.prototype.openModal = function () {
        this.uppy && this.uppy.getPlugin('Dashboard') && this.uppy.getPlugin('Dashboard').openModal();
    };
    DataLocationComponent.prototype.editNotes = function (dataLocation, i) {
        this.editingNotes = { notes: dataLocation.notes, index: i };
        jQuery("#" + this.field.name + "_editnotes").modal('show');
    };
    DataLocationComponent.prototype.hideEditNotes = function () {
        jQuery("#" + this.field.name + "_editnotes").modal('hide');
    };
    DataLocationComponent.prototype.saveNotes = function () {
        jQuery("#" + this.field.name + "_editnotes").modal('hide');
        this.field.value[this.editingNotes.index].notes = this.editingNotes.notes;
    };
    DataLocationComponent = __decorate([
        core_1.Component({
            selector: 'data-location-selector',
            template: __webpack_require__("./redbox-portal/angular/shared/form/field-data-location.html")
        })
    ], DataLocationComponent);
    return DataLocationComponent;
}(field_simple_component_1.SimpleComponent));
exports.DataLocationComponent = DataLocationComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-group.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) 2018 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_repeatable_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-repeatable.component.ts");
/**
#### Generic Group Component

Generic component for grouping components together. The resulting JSON will have the field names as keys.

```
{
   class: 'Container',
   compClass: 'GenericGroupComponent',
   definition: {
     name: "related_website",
     cssClasses: "form-inline",
     fields: [
       {
         class: 'TextField',
         editOnly: true,
         definition: {
           name: 'related_url',
           label: '@dmpt-related-website-url',
           type: 'text',
           required: true,
           groupName: 'related_website',
           groupClasses: 'width-30',
           cssClasses : "width-80 form-control"
         }
       },
       {
         class: 'TextField',
         editOnly: true,
         definition: {
           name: 'related_title',
           label: '@dmpt-related-website-title',
           type: 'text',
           required: true,
           groupName: 'related_website',
           groupClasses: 'width-30',
           cssClasses : "width-80 form-control"
         }
       },
       {
         class: 'TextField',
         editOnly: true,
         definition: {
           name: 'related_notes',
           label: '@dmpt-related-website-notes',
           type: 'text',
           required: true,
           groupName: 'related_website',
           groupClasses: 'width-30',
           cssClasses : "width-80 form-control"
         }
       }
     ]
   }
 }
```
 * @author <a target='_' href='https://github.com/shilob'>Shilo Banihit</a>
 */
var GenericGroupComponent = /** @class */ (function (_super) {
    __extends(GenericGroupComponent, _super);
    function GenericGroupComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    GenericGroupComponent.clName = 'GenericGroupComponent';
    GenericGroupComponent = __decorate([
        core_1.Component({
            selector: 'generic-group-field',
            template: "\n  <ng-container *ngIf=\"field.visible\">\n    <ng-container *ngIf=\"field.editMode\">\n      <div *ngIf=\"field.label\">\n        <label>\n          {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n          <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n        </label>\n        <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\">{{field.help}}</span>\n      </div>\n      <ng-container *ngIf=\"isEmbedded\">\n        <div [formGroup]='form' [ngClass]=\"field.cssClasses\">\n          <div class='row'>\n            <div class=\"col-xs-11\">\n              <dmp-field *ngFor=\"let childField of field.fields\" [name]=\"name\" [index]=\"index\" [field]=\"childField\" [form]=\"form\" [fieldMap]=\"fieldMap\"></dmp-field>\n            </div>\n            <div class=\"col-xs-1\">\n              <button type='button' *ngIf=\"removeBtnText\" [disabled]=\"!canRemove\" (click)=\"onRemove($event)\" [ngClass]=\"removeBtnClass\" >{{removeBtnText}}</button>\n              <button [disabled]=\"!canRemove\" type='button' [ngClass]=\"removeBtnClass\" (click)=\"onRemove($event)\" [attr.aria-label]=\"'remove-button-label' | translate\"></button>\n            </div>\n          </div>\n        </div>\n      </ng-container>\n      <ng-container *ngIf=\"!isEmbedded\">\n        <div [formGroup]='form' [ngClass]=\"field.cssClasses\">\n          <dmp-field *ngFor=\"let field of field.fields\" [field]=\"field\" [form]=\"form\" [fieldMap]=\"fieldMap\"></dmp-field>\n        </div>\n      </ng-container>\n    </ng-container>\n    <ng-container *ngIf=\"!field.editMode\">\n      <div [formGroup]='form' [ngClass]=\"field.cssClasses\">\n        <dmp-field *ngFor=\"let fieldElem of field.fields\" [field]=\"fieldElem\" [form]=\"form\" [fieldMap]=\"fieldMap\"></dmp-field>\n      </div>\n    </ng-container>\n  </ng-container>\n  ",
        })
    ], GenericGroupComponent);
    return GenericGroupComponent;
}(field_repeatable_component_1.EmbeddableComponent));
exports.GenericGroupComponent = GenericGroupComponent;
/**
 * ### Repeatable Generic Component
 *
 *
 * ```
 * {
   class: 'RepeatableContainer',
   compClass: 'RepeatableGroupComponent',
   definition: {
     name: "related_websites",
     label: "@dmpt-related-website",
     help: "@dmpt-related-website-help",
     forceClone: ['fields', 'fieldMap'],
     fields: [
       {
         class: 'Container',
         compClass: 'GenericGroupComponent',
         definition: {
           name: "related_website",
           cssClasses: "form-inline",
           fields: [
             {
               class: 'TextField',
               editOnly: true,
               definition: {
                 name: 'related_url',
                 label: '@dmpt-related-website-url',
                 type: 'text',
                 required: true,
                 groupName: 'related_website',
                 groupClasses: 'width-30',
                 cssClasses : "width-80 form-control"
               }
             },
             {
               class: 'TextField',
               editOnly: true,
               definition: {
                 name: 'related_title',
                 label: '@dmpt-related-website-title',
                 type: 'text',
                 required: true,
                 groupName: 'related_website',
                 groupClasses: 'width-30',
                 cssClasses : "width-80 form-control"
               }
             },
             {
               class: 'TextField',
               editOnly: true,
               definition: {
                 name: 'related_notes',
                 label: '@dmpt-related-website-notes',
                 type: 'text',
                 required: true,
                 groupName: 'related_website',
                 groupClasses: 'width-30',
                 cssClasses : "width-80 form-control"
               }
             }
           ]
         }
       }
     ]
   }
 }
 ```
 * @author <a target='_' href='https://github.com/shilob'>Shilo Banihit</a>
 */
var RepeatableGroupComponent = /** @class */ (function (_super) {
    __extends(RepeatableGroupComponent, _super);
    function RepeatableGroupComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    RepeatableGroupComponent.clName = 'RepeatableGroupComponent';
    RepeatableGroupComponent = __decorate([
        core_1.Component({
            selector: 'repeatable-group',
            template: "\n  <div *ngIf=\"field.editMode\">\n    <div *ngIf=\"field.label\">\n      <span class=\"label-font\">\n        {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n        <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n      </span>\n      <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\">{{field.help}}</span>\n    </div>\n    <ng-container *ngFor=\"let fieldElem of field.fields; let i = index;\" >\n      <div class=\"row\">\n        <span class=\"col-xs-12\">\n          <generic-group-field [name]=\"field.name\" [field]=\"fieldElem\" [form]=\"form\" [fieldMap]=\"fieldMap\" [isEmbedded]=\"true\" [removeBtnText]=\"field.removeButtonText\" [removeBtnClass]=\"field.removeButtonClass\" [canRemove]=\"field.fields.length > 1\" (onRemoveBtnClick)=\"removeElem($event[0], $event[1])\" [index]=\"i\"></generic-group-field>\n        </span>\n      </div>\n      <div class=\"row\">\n        <span class=\"col-xs-12\">&nbsp;</span>\n      </div>\n    </ng-container>\n    <div class=\"row\">\n      <span class=\"col-xs-11\">&nbsp;\n      </span>\n      <span class=\"col-xs-1\">\n        <button *ngIf=\"field.addButtonText\" type='button' (click)=\"addElem($event)\" [ngClass]=\"field.addButtonTextClass\" >{{field.addButtonText}}</button>\n        <button *ngIf=\"!field.addButtonText\" type='button' (click)=\"addElem($event)\" [ngClass]=\"field.addButtonClass\" [attr.aria-label]=\"'add-button-label' | translate\"></button>\n      </span>\n    </div>\n  </div>\n  <li *ngIf=\"!field.editMode\" class=\"key-value-pair\">\n    <span *ngIf=\"field.label\" class=\"key\">{{field.label}}</span>\n    <span class=\"value\">\n      <ul class=\"key-value-list\">\n        <generic-group-field *ngFor=\"let fieldElem of field.fields; let i = index;\" [name]=\"field.name\" [index]=\"i\" [field]=\"fieldElem\" [form]=\"form\" [fieldMap]=\"fieldMap\"></generic-group-field>\n      </ul>\n    </span>\n  </li>\n  ",
        })
    ], RepeatableGroupComponent);
    return RepeatableGroupComponent;
}(field_repeatable_component_1.RepeatableComponent));
exports.RepeatableGroupComponent = RepeatableGroupComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-map.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
/**
 * Map Model
 *
 *
 * @author <a target='_' href='https://github.com/andrewbrazzatti'>Andrew Brazzatti</a>
 *
 */
var MapField = /** @class */ (function (_super) {
    __extends(MapField, _super);
    function MapField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.initialised = false;
        _this.importDataString = "";
        _this.layerGeoJSON = {};
        _this.importFailed = false;
        _this.layers = [];
        _this.drawnItems = new L.FeatureGroup();
        _this.googleMaps = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
            maxZoom: 20,
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
            detectRetina: true
        });
        _this.googleHybrid = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}', {
            maxZoom: 20,
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
            detectRetina: true
        });
        /*
        *
        * Draw options
        */
        /* Draw options that we do not want to be overridden by form config as it'll break functionality */
        _this.masterDrawOptions = {
            edit: {
                featureGroup: _this.drawnItems
            },
        };
        _this.defaultDrawOptions = {
            position: 'topright',
            edit: {
                featureGroup: _this.drawnItems
            },
            draw: {
                marker: {
                    icon: L.icon({
                        iconSize: [25, 41],
                        iconAnchor: [13, 41],
                        iconUrl: 'http://localhost:1500/default/rdmp/images/leaflet/marker-icon.png',
                        shadowUrl: 'http://localhost:1500/default/rdmp/images/leaflet/marker-shadow.png'
                    })
                },
                circlemarker: false,
                circle: false
            }
        };
        _this.drawOptions = _this.defaultDrawOptions;
        /*
        *
        * Leaf options
        */
        _this.masterLeafletOptions = {
            layers: [_this.googleMaps, _this.drawnItems],
        };
        _this.defaultLeafletOptions = {
            zoom: 4,
            center: L.latLng([-24.673148, 134.074574])
        };
        _this.leafletOptions = _this.defaultLeafletOptions;
        _this.layersControl = {
            baseLayers: {
                'Google Maps': _this.googleMaps,
                'Google Hybrid': _this.googleHybrid
            }
        };
        _this.clName = 'MapField';
        _this.leafletOptions = options['leafletOptions'] || _this.defaultLeafletOptions;
        // merge in master options to ensure we have the right layers configured
        _this.leafletOptions = _.merge(_this.leafletOptions, _this.masterLeafletOptions);
        _this.drawOptions = options['drawOptions'] || _this.drawOptions;
        // merge in master options to ensure we have the right layers configured
        _this.drawOptions = _.merge(_this.drawOptions, _this.masterDrawOptions);
        _this.tabId = options['tabId'] || null;
        _this.layerGeoJSON = options.value;
        _this.mainTabId = options['mainTabId'] || null;
        _this.coordinatesHelp = _this.getTranslated(options.coordinatesHelp, undefined);
        return _this;
    }
    MapField.prototype.onMapReady = function (map) {
        this.map = map;
        var that = this;
        this.registerMapEventHandlers(map);
        this.setValue(this.layerGeoJSON);
        if (this.tabId === null) {
            map.invalidateSize();
            map.fitBounds(this.drawnItems.getBounds());
        }
        else {
            if (this.editMode) {
                // Note: this assumes the tabId is unqiue in the page, which may not be when there are multiple tab layouts.
                jQuery('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                    var curTabId = e.target.href.split('#')[1];
                    if (curTabId == that.tabId) {
                        that.initMap(map, that);
                    }
                });
            }
            else {
                var field = this.fieldMap._rootComp.getFieldWithId(this.mainTabId, this.fieldMap._rootComp.fields);
                field.onAccordionCollapseExpand.subscribe(function (event) {
                    if (event.shown == true && event.tabId == that.tabId && !that.initialised) {
                        that.initMap(map, that);
                        that.initialised = true;
                    }
                });
            }
        }
    };
    MapField.prototype.initMap = function (map, that) {
        map.invalidateSize();
        try {
            // if there are no layers present this will throw an error
            map.fitBounds(this.drawnItems.getBounds());
        }
        catch (e) {
        }
    };
    MapField.prototype.registerMapEventHandlers = function (map) {
        var that = this;
        map.on(L.Draw.Event.CREATED, function (e) {
            var type = e.layerType, layer = e.layer;
            that.layers.push(layer);
            that.layerGeoJSON = L.featureGroup(that.layers).toGeoJSON();
            that.setValue(that.layerGeoJSON);
            return false;
        });
        map.on('draw:edited', function (e) {
            var layers = e.layers;
            var that2 = that;
            layers.eachLayer(function (layer) {
                var layerIndex = _.findIndex(that2.layers, function (o) { return o._leaflet_id == layer._leaflet_id; });
                if (layerIndex == -1) {
                    that2.layers.push(layer);
                }
                else {
                    that2.layers[layerIndex] = layer;
                }
            });
        });
        map.on('draw:editstop', function (e) {
            that.layerGeoJSON = L.featureGroup(that.layers).toGeoJSON();
            that.setValue(that.layerGeoJSON);
        });
        map.on('draw:deletestop', function (e) {
            that.layerGeoJSON = L.featureGroup(that.layers).toGeoJSON();
            that.setValue(that.layerGeoJSON);
        });
        map.on('draw:deleted', function (e) {
            var layers = e.layers;
            var that2 = that;
            layers.eachLayer(function (layer) {
                _.remove(that2.layers, function (o) { return o._leaflet_id == layer._leaflet_id; });
            });
        });
    };
    MapField.prototype.drawLayers = function () {
        this.drawnItems.clearLayers();
        var geoJSONLayer = L.geoJSON(this.layerGeoJSON);
        this.layers = [];
        var that = this;
        geoJSONLayer.eachLayer(function (layer) {
            layer.addTo(that.drawnItems);
            that.layers.push(layer);
        });
    };
    MapField.prototype.postInit = function (value) {
        if (!_.isEmpty(value)) {
            this.layerGeoJSON = value;
            this.drawLayers();
        }
    };
    MapField.prototype.createFormModel = function (valueElem) {
        if (valueElem === void 0) { valueElem = undefined; }
        if (valueElem) {
            this.layerGeoJSON = valueElem;
        }
        this.formModel = new forms_1.FormControl(this.layerGeoJSON || {});
        return this.formModel;
    };
    MapField.prototype.setValue = function (value) {
        if (!_.isEmpty(value)) {
            this.layerGeoJSON = value;
            this.drawLayers();
            this.formModel.patchValue(this.layerGeoJSON, { emitEvent: false });
            this.formModel.markAsTouched();
        }
    };
    MapField.prototype.setEmptyValue = function () {
        this.layerGeoJSON = {};
        return this.layerGeoJSON;
    };
    MapField.prototype.importData = function () {
        var _this = this;
        if (this.importDataString.length > 0) {
            try {
                if (this.importDataString.indexOf("<") == 0) {
                    //probably KML
                    var parsedLayers = omnivore.kml.parse(this.importDataString);
                    if (parsedLayers.getLayers().length == 0) {
                        this.importFailed = true;
                        return false;
                    }
                    var that_1 = this;
                    parsedLayers.eachLayer(function (layer) {
                        layer.addTo(that_1.drawnItems);
                        that_1.layers.push(layer);
                        that_1.layerGeoJSON = L.featureGroup(that_1.layers).toGeoJSON();
                        _this.drawLayers();
                        that_1.map.fitBounds(that_1.drawnItems.getBounds());
                    });
                    this.importDataString = "";
                    this.importFailed = false;
                }
                else {
                    var parsedLayers = L.geoJSON(JSON.parse(this.importDataString));
                    var that_2 = this;
                    parsedLayers.eachLayer(function (layer) {
                        layer.addTo(that_2.drawnItems);
                        that_2.layers.push(layer);
                        that_2.layerGeoJSON = L.featureGroup(that_2.layers).toGeoJSON();
                        _this.drawLayers();
                        that_2.map.fitBounds(that_2.drawnItems.getBounds());
                    });
                    this.importDataString = "";
                    this.importFailed = false;
                }
                this.layerGeoJSON = L.featureGroup(this.layers).toGeoJSON();
                this.setValue(this.layerGeoJSON);
            }
            catch (e) {
                this.importFailed = true;
            }
        }
        return false;
    };
    return MapField;
}(field_base_1.FieldBase));
exports.MapField = MapField;
// Setting the template url to a constant rather than directly in the component as the latter breaks document generation
var rbMapDataTemplate = './field-map.html';
if (typeof aotMode == 'undefined') {
    rbMapDataTemplate = '../angular/shared/form/field-map.html';
}
/**
* #### Map Component.
*
* Uses Leaflet.js to render a widget and the Leaflet.draw plugin to be able to select regions
*
* #### Usage
* ```
*  {
*   class: 'MapField',
*   compClass: 'MapComponent',
*   definition: {
*     name: 'geocoords',
*     label: '@dataRecord-coverage',
*     help: '@dataRecord-coverage',
*     tabId: 'coverage',
*     leafletOptions: {
*                      zoom: 3,
*                      center: latLng([108.94248962402342, 34.26516142452615)
*                     }
*     }
*   }
* ```
*
*| Property Name  | Description                                                                                                                                                                                                                                                                                                                       | Required | Default                                                                                                                                                                                                                                                                                  |
*|----------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
*| label          | The label to show above the component                                                                                                                                                                                                                                                                                             | No       *|                                                                                                                                                                                                                                                                                          |
*| help           | Help text                                                                                                                                                                                                                                                                                                                         | No       *|                                                                                                                                                                                                                                                                                          |
*| tabId          | The name of the tab the widget is placed, this is needed as Leaflet needs the map to be visible before the tiles can be loaded correctly. Leave empty if widget isn't placed in a tab.                                                                                                                                            | No       *|                                                                                                                                                                                                                                                                                          |
*| leafletOptions | The leaflet options object. See the [Leaflet's documentation](http://leafletjs.com/reference-1.3.0.html#map-option) for more information. Note: layers cannot be changed as other functionality depends on it being set as it is and will be overridden. Defaults to a map centred on Australia (if no elements are drawn on map) | No       | ```{zoom: 4, center:" latLng([-24.673148, 134.074574]) }```                                                                                                                                                                                                                              |
*| drawOptions    | The leaflet draw options object. See the [Leaflet Draw's documentation](https://leaflet.github.io/Leaflet.draw/docs/leaflet-draw-latest.html#options) for more information. Note: the edit featureGroup cannot be changed as other functionality depends on it being set as it is and will be overridden.                         | No       | ```{position:"topright",draw:{marker:{icon:icon({iconSize:[25,41],iconAnchor:[13,41],iconUrl:"http://localhost:1500/default/rdmp/images/leaflet/marker-icon.png",shadowUrl:"http://localhost:1500/default/rdmp/images/leaflet/marker-shadow.png"})},circlemarker:false,circle:false}}``` |
*/
var MapComponent = /** @class */ (function (_super) {
    __extends(MapComponent, _super);
    function MapComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    MapComponent.prototype.ngAfterViewInit = function () {
        if (!this.field.editMode) {
            this.field.initMap(this.field.map, this.field);
        }
    };
    MapComponent.prototype.toggleCoordinatesHelp = function () {
        this.coordinatesHelpShow = !this.coordinatesHelpShow;
    };
    MapComponent = __decorate([
        core_1.Component({
            selector: 'rb-mapdata',
            template: __webpack_require__("./redbox-portal/angular/shared/form/field-map.html")
        })
    ], MapComponent);
    return MapComponent;
}(field_simple_component_1.SimpleComponent));
exports.MapComponent = MapComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-map.html":
/***/ (function(module, exports) {

module.exports = "<div class='padding-bottom-10'>\n  <div *ngIf=\"field.editMode\" [formGroup]='form' class=\"form-group\">\n  <label [attr.for]=\"field.name\">\n    {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n    <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n   </label><br/>\n  <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\"></span>\n\n  <div leaflet style=\"height: 450px;\"\n       leafletDraw\n       [leafletOptions]=\"field.leafletOptions\"\n       [leafletDrawOptions]=\"field.drawOptions\"\n       (leafletMapReady)=\"field.onMapReady($event)\"\n       [leafletLayersControl]=\"field.layersControl\">\n  </div>\n  <div class='padding-top-10'>\n  <div>\n    <label [attr.for]=\"field.name\">Enter KML or GeoJSON\n      <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.editMode && field.coordinatesHelp\" (click)=\"toggleCoordinatesHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n    </label><br/>\n    <span id=\"{{ 'helpBlock_' + field.name + '_coordinates' }}\" class=\"help-block\" *ngIf=\"field.editMode && this.coordinatesHelpShow\">{{field.coordinatesHelp}}</span>\n    <textarea [id]=\"field.name\" class=\"form-control\" rows=\"5\" [(ngModel)]=\"field.importDataString\" [ngModelOptions]=\"{standalone: true}\"></textarea></div>\n  <div class=\"padding-top-10\"><a class=\"btn btn-info\" (click)=\"field.importData()\">Import</a> <span *ngIf=\"field.importFailed\" class=\"text-danger\">Entered text is not a valid KML or GeoJSON</span></div>\n</div>\n</div>\n</div>\n<div *ngIf=\"!field.editMode\">\n  <div leaflet style=\"height: 450px;\"\n       [leafletOptions]=\"field.leafletOptions\"\n       (leafletMapReady)=\"field.onMapReady($event)\"\n       [leafletLayersControl]=\"field.layersControl\">\n  </div>\n</div>\n"

/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-pdflist.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var records_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/records.service.ts");
var moment = __webpack_require__("./node_modules/moment/moment.js");
/**
 * Contributor Model
 *
 *
 * @author <a target='_' href='https://github.com/shilob'>Shilo Banihit</a>
 *
 */
var PDFListField = /** @class */ (function (_super) {
    __extends(PDFListField, _super);
    function PDFListField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.showHistoryTable = false;
        _this.showVersionColumn = false;
        _this.versionColumnValueField = "";
        _this.versionColumnLabelKey = "";
        _this.useVersionLabelForFileName = false;
        _this.downloadBtnLabel = "";
        _this.downloadPreviousBtnLabel = "";
        _this.downloadPrefix = "";
        _this.relatedObjects = [];
        _this.accessDeniedObjects = [];
        _this.failedObjects = [];
        _this.columns = options['columns'] || [];
        _this.startsWith = options['startsWith'] || 'rdmp-pdf';
        var relatedObjects = _this.relatedObjects;
        _this.recordsService = _this.getFromInjector(records_service_1.RecordsService);
        _this.pdfAttachments = [];
        _this.showVersionColumn = _.isUndefined(options['showVersionColumn']) ? _this.showVersionColumn : options['showVersionColumn'];
        _this.useVersionLabelForFileName = _.isUndefined(options['useVersionLabelForFileName']) ? _this.showVersionColumn : options['useVersionLabelForFileName'];
        _this.versionColumnValueField = options['versionColumnValueField'] || _this.versionColumnValueField;
        _this.versionColumnLabelKey = options['versionColumnLabelKey'] || _this.versionColumnLabelKey;
        _this.downloadBtnLabel = _.isEmpty(options['downloadBtnLabel']) ? "Download a PDF of this plan" : _this.getTranslated(options['downloadBtnLabel'], "Download a PDF of this plan");
        _this.downloadPreviousBtnLabel = _.isEmpty(options['downloadPreviousBtnLabel']) ? "Download a previous version" : _this.getTranslated(options['downloadPreviousBtnLabel'], "Download a previous version");
        _this.downloadPrefix = _.isEmpty(options['downloadPrefix']) ? "rdmp" : _this.getTranslated(options["downloadPrefix"], "rdmp");
        return _this;
    }
    PDFListField.prototype.getVersionLabel = function (attachment, index) {
        var versionValue = this.fieldMap[this.versionColumnValueField].field.value;
        var version = null;
        if (_.isArray(versionValue)) {
            version = versionValue[versionValue.length - (index + 1)];
        }
        else {
            version = _.toNumber(versionValue) - index;
        }
        return "" + this.getTranslated(this.versionColumnLabelKey, "") + version;
    };
    PDFListField.prototype.createFormModel = function (valueElem) {
        if (valueElem === void 0) { valueElem = undefined; }
        if (valueElem) {
            this.value = valueElem;
        }
        this.formModel = new forms_1.FormControl(this.value || []);
        if (this.value) {
            this.setValue(this.value);
        }
        return this.formModel;
    };
    PDFListField.prototype.setValue = function (value) {
        this.formModel.patchValue(value, { emitEvent: false });
        this.formModel.markAsTouched();
    };
    PDFListField.prototype.setEmptyValue = function () {
        this.value = [];
        return this.value;
    };
    return PDFListField;
}(field_base_1.FieldBase));
exports.PDFListField = PDFListField;
/**
* Component to display PDFs related to this record
*
*/
var PDFListComponent = /** @class */ (function (_super) {
    __extends(PDFListComponent, _super);
    function PDFListComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    PDFListComponent.prototype.ngOnInit = function () {
        var oid = this.fieldMap._rootComp.oid;
        if (oid) {
            var allAttachmentsPromise = this.field.recordsService.getAttachments(oid);
            var matchingExpression_1 = new RegExp(this.field.startsWith + "-[0-9a-fA-F]{32}-[0-9]+.pdf");
            var that = this;
            allAttachmentsPromise.then(function (allAttachments) {
                that.field.latestPdf = null;
                _.forEach(allAttachments, function (attachment) {
                    if (matchingExpression_1.test(attachment.label)) {
                        attachment.dateUpdated = moment(attachment.dateUpdated).format('LLL');
                        that.field.pdfAttachments.push(attachment);
                        if (that.field.latestPdf == null || moment(that.field.latestPdf['dateUpdated'], 'LLL').isBefore(moment(attachment.dateUpdated, 'LLL'))) {
                            that.field.latestPdf = attachment;
                        }
                    }
                });
                that.field.pdfAttachments.sort(function compare(a, b) {
                    var before = moment(a['dateUpdated'], 'LLL').isBefore(moment(b['dateUpdated'], 'LLL'));
                    //We want descending order so let's reverse it
                    return before ? 1 : -1;
                });
            });
        }
    };
    PDFListComponent.prototype.getDownloadUrl = function (attachment, hasFileName, index) {
        if (hasFileName === void 0) { hasFileName = false; }
        if (index === void 0) { index = 0; }
        var oid = this.fieldMap._rootComp.oid;
        var url = this.field.recordsService.getBrandingAndPortalUrl + "/record/" + oid + "/datastream?datastreamId=" + attachment.label;
        if (hasFileName) {
            if (this.field.useVersionLabelForFileName) {
                return url + "&fileName=" + this.field.downloadPrefix + "-" + this.field.getVersionLabel(attachment, index) + ".pdf";
            }
            else {
                return url + "&fileName=" + this.field.downloadPrefix + ".pdf";
            }
        }
        else {
            return url;
        }
    };
    // as of writing, there seems to be issues with selecting the dialog by ID, switching to selecting by style
    PDFListComponent.prototype.showDialog = function () {
        var diagSel = "." + this.field.downloadPrefix + "PdfDialog";
        jQuery(diagSel).modal('show');
    };
    PDFListComponent = __decorate([
        core_1.Component({
            selector: 'rb-pdf-list',
            template: __webpack_require__("./redbox-portal/angular/shared/form/field-pdflist.html")
        })
    ], PDFListComponent);
    return PDFListComponent;
}(field_simple_component_1.SimpleComponent));
exports.PDFListComponent = PDFListComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-pdflist.html":
/***/ (function(module, exports) {

module.exports = "<span class=\"print-hidden\">\n\n<span *ngIf=\"field.pdfAttachments.length > 0\">\n  <!-- <a [attr.href]=\"getDownloadUrl(field.latestPdf)+'&fileName=rdmp.pdf'\" target=\"_blank\" [ngClass]=\"field.cssClasses\"><i class=\"fa fa-file-pdf-o\">&nbsp;</i> Download a PDF of this plan</a>\n  <a *ngIf=\"field.pdfAttachments.length > 1\" data-toggle=\"modal\" data-target=\"#pdfHistoryModal\" [ngClass]=\"field.cssClasses\">Download a previous version</a> -->\n\n\n  <div class=\"btn-group\">\n    <a type=\"button\" [attr.href]=\"getDownloadUrl(field.latestPdf, true)\" target=\"_blank\" class=\"btn btn-danger\"><i class=\"fa fa-file-pdf-o\">&nbsp;</i>{{ field.downloadBtnLabel }}</a>\n    <button type=\"button\" class=\"btn btn-danger dropdown-toggle\" data-toggle=\"dropdown\">\n      <span class=\"caret\"></span>\n      <span class=\"sr-only\" [innerHtml]=\"'toggle-dropdown' | translate\"></span>\n    </button>\n    <ul class=\"dropdown-menu\" role=\"menu\">\n      <li><a (click)=\"showDialog()\" >{{ field.downloadPreviousBtnLabel }}</a></li>\n    </ul>\n  </div>\n</span>\n\n<!-- Modal -->\n<div class=\"modal fade {{field.downloadPrefix}}PdfDialog\" tabindex=\"-1\" role=\"dialog\" [attr.aria-label]=\"'pdf-history-modal-label' | translate\" aria-hidden=\"true\">\n  <div class=\"modal-dialog\" role=\"document\">\n    <div class=\"modal-content\">\n      <div class=\"modal-body\">\n        <table class=\"table\">\n          <thead>\n              <tr>\n                  <th *ngIf=\"field.showVersionColumn\">{{ '@pdf-column-version' | translate }}</th><th>{{ '@pdf-column-date-created' | translate }}</th><th>{{ '@pdf-column-download' | translate }}</th>\n              </tr>\n          </thead>\n          <tbody>\n            <tr *ngFor=\"let item of field.pdfAttachments; index as i;\">\n              <td *ngIf=\"field.showVersionColumn\"><span [innerHtml]=\"field.getVersionLabel(attachment, i)\"></span></td>\n              <td>{{ item.dateUpdated }}</td>\n              <td><a [attr.href]=\"getDownloadUrl(item, field.useVersionLabelForFileName, i)\" target=\"_blank\"><i class=\"fa fa-file-pdf-o\"></i> {{ '@pdf-column-download' | translate }}</a></td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n      <div class=\"modal-footer\">\n        <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">{{ '@pdf-close' | translate }}</button>\n      </div>\n    </div>\n  </div>\n</div>\n</span>\n"

/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-publish-data-location-refresh.component.html":
/***/ (function(module, exports) {

module.exports = "<div *ngIf=\"field.visible && field.editMode\">\n  <button class=\"btn btn-info\" (click)=\"field.getAttachments($event)\">{{ field.label }}</button>\n  <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.editMode && field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n  <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"field.editMode && this.helpShow\">{{field.help}}</span>\n</div>\n"

/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-publish-data-location-refresh.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) 2019 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var records_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/records.service.ts");
/**
 * Published Data Refresher Component Model
 *
 *
 * @author <a target='_' href='https://github.com/shilob'>Shilo Banihit</a>
 *
 */
var PublishDataLocationRefreshField = /** @class */ (function (_super) {
    __extends(PublishDataLocationRefreshField, _super);
    function PublishDataLocationRefreshField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.value = options['value'];
        _this.recordsService = _this.getFromInjector(records_service_1.RecordsService);
        _this.origDisabledExpr = options['disabledExpression'];
        return _this;
    }
    PublishDataLocationRefreshField.prototype.getAttachments = function (event) {
        var _this = this;
        event.preventDefault();
        this.options['disabledExpression'] = "true";
        this.recordsService.getRecordMeta(this.value).then(function (data) {
            _this.onValueUpdate.emit(data);
            _this.options['disabledExpression'] = _this.origDisabledExpr;
        });
    };
    PublishDataLocationRefreshField.prototype.getRelatedRecordId = function () {
        this.value = this.fieldMap._rootComp.relatedRecordId;
    };
    return PublishDataLocationRefreshField;
}(field_base_1.FieldBase));
exports.PublishDataLocationRefreshField = PublishDataLocationRefreshField;
/**
* Component to refresh data pub data locations from the related Data Record
*
*
*
* @author <a target='_' href='https://github.com/shilob'>Shilo Banihit</a>
*/
var PublishDataLocationRefreshComponent = /** @class */ (function (_super) {
    __extends(PublishDataLocationRefreshComponent, _super);
    function PublishDataLocationRefreshComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    PublishDataLocationRefreshComponent = __decorate([
        core_1.Component({
            selector: 'publish-data-location-refresh',
            template: __webpack_require__("./redbox-portal/angular/shared/form/field-publish-data-location-refresh.component.html")
        })
    ], PublishDataLocationRefreshComponent);
    return PublishDataLocationRefreshComponent;
}(field_simple_component_1.SimpleComponent));
exports.PublishDataLocationRefreshComponent = PublishDataLocationRefreshComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-publishdatalocationselector.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var records_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/records.service.ts");
/**
 * Contributor Model
 *
 *
 * @author <a target='_' href='https://github.com/shilob'>Shilo Banihit</a>
 *
 */
var PublishDataLocationSelectorField = /** @class */ (function (_super) {
    __extends(PublishDataLocationSelectorField, _super);
    function PublishDataLocationSelectorField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.newLocation = { type: "url", location: "", notes: "" };
        _this.dataTypes = [{
                'label': 'URL',
                'value': 'url',
            },
            {
                'label': 'Physical location',
                'value': 'physical',
            },
            {
                'label': 'File path',
                'value': 'file',
            },
            {
                'label': 'Attachment',
                'value': 'attachment'
            }
        ];
        _this.dataTypeLookup = {
            'url': "URL",
            'physical': "Physical location",
            'attachment': "Attachment",
            'file': "File path"
        };
        _this.accessDeniedObjects = [];
        _this.columns = options['columns'] || [];
        _this.editNotesButtonText = _this.getTranslated(options['editNotesButtonText'], 'Edit');
        _this.editNotesTitle = _this.getTranslated(options['editNotesTitle'], 'Edit Notes');
        _this.cancelEditNotesButtonText = _this.getTranslated(options['cancelEditNotesButtonText'], 'Cancel');
        _this.applyEditNotesButtonText = _this.getTranslated(options['applyEditNotesButtonText'], 'Apply');
        _this.editNotesCssClasses = options['editNotesCssClasses'] || 'form-control';
        _this.typeHeader = _this.getTranslated(options['typeHeader'], 'Type');
        _this.locationHeader = _this.getTranslated(options['locationHeader'], 'Location');
        _this.notesHeader = _this.getTranslated(options['notesHeader'], 'Notes');
        _this.iscEnabled = !_.isUndefined(options['iscEnabled']) ? options['iscEnabled'] : false;
        _this.notesEnabled = !_.isUndefined(options['notesEnabled']) ? options['notesEnabled'] : true;
        _this.iscHeader = !_.isUndefined(options['iscHeader']) ? _this.getTranslated(options['iscHeader'], options['iscHeader']) : 'Information Security Classification';
        _this.noLocationSelectedText = !_.isUndefined(options['noLocationSelectedText']) ? _this.getTranslated(options['noLocationSelectedText'], options['noLocationSelectedText']) : 'Publish Metadata Only';
        _this.noLocationSelectedHelp = !_.isUndefined(options['noLocationSelectedHelp']) ? _this.getTranslated(options['noLocationSelectedHelp'], options['noLocationSelectedHelp']) : 'Publicise only metadata (or description)';
        _this.publicCheck = !_.isUndefined(options['publicCheck']) ? _this.getTranslated(options['publicCheck'], options['publicCheck']) : 'public';
        _this.selectionCriteria = !_.isUndefined(options['selectionCriteria']) ? _this.getTranslated(options['selectionCriteria'], options['selectionCriteria']) : [{ isc: 'public', type: 'attachment' }];
        _this.value = options['value'] || _this.setEmptyValue();
        _this.recordsService = _this.getFromInjector(records_service_1.RecordsService);
        return _this;
    }
    PublishDataLocationSelectorField.prototype.setValue = function (value, emitEvent) {
        if (emitEvent === void 0) { emitEvent = true; }
        this.formModel.setValue(value, { emitEvent: emitEvent, emitModelToViewChange: true });
        this.formModel.markAsTouched();
        this.formModel.markAsDirty();
    };
    PublishDataLocationSelectorField.prototype.setEmptyValue = function () {
        this.value = [];
        return this.value;
    };
    PublishDataLocationSelectorField.prototype.addLocation = function () {
        this.value.push(this.newLocation);
        this.setValue(this.value);
        this.newLocation = { type: "url", location: "", notes: "" };
    };
    PublishDataLocationSelectorField.prototype.appendLocation = function (newLoc) {
        this.value.push(newLoc);
        this.setValue(this.value, true);
    };
    PublishDataLocationSelectorField.prototype.clearPendingAtt = function (value) {
        _.each(value, function (val) {
            if (val.type == 'attachment') {
                _.unset(val, 'pending');
            }
        });
    };
    PublishDataLocationSelectorField.prototype.populateDataLocation = function (oid, config) {
        var _this = this;
        console.log(oid);
        this.recordsService.getRecordMeta(oid).then(function (record) {
            _this.value = record.dataLocations;
        });
    };
    PublishDataLocationSelectorField.prototype.removeLocation = function (loc) {
        _.remove(this.value, function (val) {
            return val.type == loc.type && val.name == loc.name && val.location == loc.location;
        });
        this.setValue(this.value);
    };
    PublishDataLocationSelectorField.prototype.selectAllPublic = function () {
        this.applySelectionCriteria(true);
        this.checkIfLocationsSelected();
    };
    PublishDataLocationSelectorField.prototype.applySelectionCriteria = function (checked) {
        var _this = this;
        _.each(this.value, function (dL) {
            _.each(_this.selectionCriteria, function (sC) {
                var isSelected = _.filter(sC, function (val, key) { return dL[key] && dL[key] === val; });
                if (isSelected.length === Object.keys(sC).length) {
                    dL.selected = checked;
                }
            });
        });
    };
    ;
    PublishDataLocationSelectorField.prototype.canBeSelected = function (dL) {
        var canBeSelected = false;
        _.each(this.selectionCriteria, function (sC) {
            var isSelected = _.filter(sC, function (val, key) { return dL[key] && dL[key] === val; });
            if (isSelected.length === Object.keys(sC).length) {
                canBeSelected = true;
            }
        });
        return canBeSelected && this.editMode ? null : '';
    };
    PublishDataLocationSelectorField.prototype.checkIfLocationsSelected = function () {
        var locationSelected = _.find(this.value, function (dataLocation) {
            return dataLocation.selected;
        });
        if (locationSelected) {
            this.noLocationSelected = false;
        }
        else {
            this.noLocationSelected = true;
        }
    };
    return PublishDataLocationSelectorField;
}(field_base_1.FieldBase));
exports.PublishDataLocationSelectorField = PublishDataLocationSelectorField;
/**
* Component to display information from related objects within ReDBox
*
*
*
*
*/
var PublishDataLocationSelectorComponent = /** @class */ (function (_super) {
    __extends(PublishDataLocationSelectorComponent, _super);
    function PublishDataLocationSelectorComponent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.editingNotes = { notes: '', index: -1 };
        return _this;
    }
    PublishDataLocationSelectorComponent.prototype.ngOnInit = function () {
        this.field.checkIfLocationsSelected();
    };
    PublishDataLocationSelectorComponent.prototype.selectAllLocations = function (checked) {
        if (this.field.iscEnabled) {
            this.field.applySelectionCriteria(checked);
        }
        else {
            _.each(this.field.value, function (dataLocation) {
                dataLocation.selected = checked;
            });
        }
        this.field.checkIfLocationsSelected();
    };
    PublishDataLocationSelectorComponent.prototype.getDatalocations = function () {
        return this.field.value;
    };
    PublishDataLocationSelectorComponent.prototype.getAbsUrl = function (location) {
        return this.field.recordsService.getBrandingAndPortalUrl + "/record/" + location;
    };
    PublishDataLocationSelectorComponent.prototype.editNotes = function (dataLocation, i) {
        this.editingNotes = { notes: dataLocation.notes, index: i };
        jQuery("#" + this.field.name + "_editnotes").modal('show');
    };
    PublishDataLocationSelectorComponent.prototype.hideEditNotes = function () {
        jQuery("#" + this.field.name + "_editnotes").modal('hide');
    };
    PublishDataLocationSelectorComponent.prototype.saveNotes = function () {
        jQuery("#" + this.field.name + "_editnotes").modal('hide');
        this.field.value[this.editingNotes.index].notes = this.editingNotes.notes;
    };
    PublishDataLocationSelectorComponent = __decorate([
        core_1.Component({
            selector: 'publish-data-location-selector',
            template: __webpack_require__("./redbox-portal/angular/shared/form/field-publishdatalocationselector.html")
        })
    ], PublishDataLocationSelectorComponent);
    return PublishDataLocationSelectorComponent;
}(field_simple_component_1.SimpleComponent));
exports.PublishDataLocationSelectorComponent = PublishDataLocationSelectorComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-publishdatalocationselector.html":
/***/ (function(module, exports) {

module.exports = "<div class='padding-bottom-10' *ngIf=\"field.visible\">\n  <span class=\"label-font\">\n    {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n    <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n  </span><br/>\n  <div>\n    <div class=\"table-responsive\">\n    <table class=\"table table-bordered table-striped table-hover\">\n      <thead>\n        <tr>\n          <th width=\"5%\"><input type=\"checkbox\" (change)=\"selectAllLocations($event.target.checked)\" *ngIf=\"field.editMode\" [attr.aria-label]=\"'select-all-items' | translate\"/><span [hidden]=\"true\">Select</span></th>\n          <th width=\"15%\">{{ field.typeHeader }}</th>\n          <th width=\"40%\">{{ field.locationHeader }}</th>\n          <th *ngIf=\"field.notesEnabled\" width=\"20%\">{{ field.notesHeader }}</th>\n          <th *ngIf=\"field.iscEnabled\" width=\"20%\">{{ field.iscHeader }}</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr *ngFor=\"let dataLocation of getDatalocations(); let i = index;\">\n          <td>\n            <input (change)=\"field.checkIfLocationsSelected($event)\" type=\"checkbox\" [(ngModel)]=\"dataLocation.selected\" [attr.disabled]=\"field.canBeSelected(dataLocation)\"  [attr.aria-label]=\"'select-item' | translate\"/>\n          </td>\n          <td>{{ field.dataTypeLookup[dataLocation.type] }}</td>\n          <td>\n            <ng-container *ngIf=\"dataLocation && dataLocation.type != 'attachment'\">\n            {{ dataLocation.location }}\n            </ng-container>\n            <ng-container *ngIf=\"dataLocation.type == 'attachment'\">\n              <ng-container *ngIf=\"dataLocation.pending\">\n                {{ dataLocation.name }}\n              </ng-container>\n              <a *ngIf=\"!dataLocation.pending\" href=\"{{ getAbsUrl(dataLocation.location) }}\" target=\"_blank\">\n                {{ dataLocation.name }}\n              </a>\n            </ng-container>\n          </td>\n          <td *ngIf=\"field.notesEnabled\">\n            {{ dataLocation.notes }}\n            <button *ngIf=\"field.editMode\" type='button' class=\"btn btn-primary pull-right\" (click)=\"editNotes(dataLocation, i)\">{{ field.editNotesButtonText }}</button>\n          </td>\n          <td *ngIf=\"field.iscEnabled\">\n            {{ dataLocation.isc }}\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n  <div *ngIf=\"field.noLocationSelected\">\n    <h5 class=\"font-weight-bold\">{{ field.noLocationSelectedText }}</h5>\n    <p>{{ field.noLocationSelectedHelp }}</p>\n  </div>\n  <!-- <div><button class=\"btn btn-info\">Export</button></div> -->\n</div>\n</div>\n<!--- Edit notes modal -->\n<div *ngIf=\"field.editMode\" class=\"modal fade\" id=\"{{ field.name }}_editnotes\" tabindex=\"-1\" role=\"dialog\" >\n  <div class=\"modal-dialog\" role=\"document\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n        <span class=\"modal-title\" [innerHtml]=\"field.editNotesTitle\"></span>\n      </div>\n      <div class=\"modal-body\">\n        <input type='text' [ngClass]=\"field.editNotesCssClasses\" [(ngModel)]=\"editingNotes.notes\" [attr.aria-label]=\"field.notesHeader\"/>\n      </div>\n      <div class=\"modal-footer\">\n        <button (click)=\"hideEditNotes()\" type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\" [innerHtml]=\"field.cancelEditNotesButtonText\"></button>\n        <button (click)=\"saveNotes()\" type=\"button\" class=\"btn btn-primary\" [innerHtml]=\"field.applyEditNotesButtonText\"></button>\n      </div>\n    </div>\n  </div>\n</div>\n"

/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-recordpermissions.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var records_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/records.service.ts");
var Observable_1 = __webpack_require__("./node_modules/rxjs/_esm5/Observable.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/observable/zip.js");
var fromPromise_1 = __webpack_require__("./node_modules/rxjs/_esm5/observable/fromPromise.js");
var platform_browser_1 = __webpack_require__("./node_modules/@angular/platform-browser/esm5/platform-browser.js");
/**
 * Record Permissions Model
 *
 *
 * @author <a target='_' href='https://github.com/andrewbrazzati'>Andrew Brazzatti</a>
 *
 */
var RecordPermissionsField = /** @class */ (function (_super) {
    __extends(RecordPermissionsField, _super);
    function RecordPermissionsField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.permissions = { edit: [], view: [], editRoles: [], viewRoles: [], editPending: [], viewPending: [] };
        _this.value = options['value'] || _this.setEmptyValue();
        _this.recordsService = _this.getFromInjector(records_service_1.RecordsService);
        return _this;
    }
    /**
    * Loading the metadata for each related object in the array
    */
    RecordPermissionsField.prototype.asyncLoadData = function () {
        var oid = this.fieldMap._rootComp.oid;
        var getRecordMetaObs = [];
        var that = this;
        if (oid == null || oid == "") {
            return Observable_1.Observable.of(null);
        }
        else {
            return fromPromise_1.fromPromise(this.recordsService.getPermissions(oid)).flatMap(function (permissions) {
                that.permissions = permissions;
                return Observable_1.Observable.of(permissions);
            });
        }
    };
    RecordPermissionsField.prototype.createFormModel = function (valueElem) {
        if (valueElem === void 0) { valueElem = undefined; }
        if (valueElem) {
            this.value = valueElem;
        }
        this.formModel = new forms_1.FormControl(this.value || []);
        if (this.value) {
            this.setValue(this.value);
        }
        return this.formModel;
    };
    RecordPermissionsField.prototype.setValue = function (value) {
        this.formModel.patchValue(value, { emitEvent: false });
        this.formModel.markAsTouched();
    };
    RecordPermissionsField.prototype.setEmptyValue = function () {
        this.value = [];
        return this.value;
    };
    return RecordPermissionsField;
}(field_base_1.FieldBase));
exports.RecordPermissionsField = RecordPermissionsField;
// Setting the template url to a constant rather than directly in the component as the latter breaks document generation
var rbRelatedObjectDataTemplate = './field-recordpermissions.html';
if (typeof aotMode == 'undefined') {
    rbRelatedObjectDataTemplate = '../angular/shared/form/field-recordpermissions.html';
}
/**
* Component to display information from related objects within ReDBox
*
*
*
*
*/
var RecordPermissionsComponent = /** @class */ (function (_super) {
    __extends(RecordPermissionsComponent, _super);
    function RecordPermissionsComponent(sanitizer) {
        var _this = _super.call(this) || this;
        _this.sanitizer = sanitizer;
        return _this;
    }
    RecordPermissionsComponent.prototype.sanitizeUrl = function (url) {
        return this.sanitizer.bypassSecurityTrustUrl(url);
    };
    RecordPermissionsComponent = __decorate([
        core_1.Component({
            selector: 'rb-recordpermissions',
            template: __webpack_require__("./redbox-portal/angular/shared/form/field-recordpermissions.html")
        }),
        __metadata("design:paramtypes", [platform_browser_1.DomSanitizer])
    ], RecordPermissionsComponent);
    return RecordPermissionsComponent;
}(field_simple_component_1.SimpleComponent));
exports.RecordPermissionsComponent = RecordPermissionsComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-recordpermissions.html":
/***/ (function(module, exports) {

module.exports = "\n<div *ngIf=\"field.editMode\" class='padding-bottom-10'>\n  \n  <div class=\"row\">\n    <h4 [innerHtml]=\"'form-record-permissions-usereditheading' | translate\"></h4>\n    <table class=\"table\">\n      <thead>\n          <tr>\n             <th [innerHtml]=\"'form-record-permissions-usernametableheading' | translate\"></th><th [innerHtml]=\"'form-record-permissions-nametableheading' | translate\"></th><th [innerHtml]=\"'form-record-permissions-emailtableheading' | translate\"></th>\n          </tr>\n      </thead>\n      <tbody>\n        <tr *ngFor=\"let permission of field.permissions.edit\">\n          <td>{{permission.username}}</td><td>{{permission.name}}</td><td>{{permission.email}}</td>\n        </tr>\n        \n      </tbody>\n    </table>\n\n    <h4 [innerHtml]=\"'form-record-permissions-userviewheading' | translate\"></h4>\n    <table class=\"table\">\n      <thead>\n          <tr>\n            <th [innerHtml]=\"'form-record-permissions-usernametableheading' | translate\"></th><th [innerHtml]=\"'form-record-permissions-nametableheading' | translate\"></th><th [innerHtml]=\"'form-record-permissions-emailtableheading' | translate\"></th>\n          </tr>\n      </thead>\n      <tbody>\n        <tr *ngFor=\"let permission of field.permissions.view\">\n          <td>{{permission.username}}</td><td>{{permission.name}}</td><td>{{permission.email}}</td>\n        </tr>\n        \n      </tbody>\n    </table>\n\n    <h4 [innerHtml]=\"'form-record-permissions-userpendingeditheading' | translate\"></h4>\n    <table class=\"table\">\n      <thead>\n          <tr>\n             <th [innerHtml]=\"'form-record-permissions-emailtableheading' | translate\"></th>\n          </tr>\n      </thead>\n      <tbody>\n        <tr *ngFor=\"let permission of field.permissions.editPending\">\n          <td>{{permission}}</td>\n        </tr>\n      </tbody>\n    </table>\n\n    <h4 [innerHtml]=\"'form-record-permissions-userpendingviewheading' | translate\"></h4>\n    <table class=\"table\">\n      <thead>\n          <tr>\n             <th [innerHtml]=\"'form-record-permissions-emailtableheading' | translate\"></th>\n          </tr>\n      </thead>\n\n        <tbody>\n          <tr *ngFor=\"let permission of field.permissions.viewPending\">\n            <td>{{permission}}</td>\n          </tr>\n        </tbody>\n        \n    </table>\n\n    <h4 [innerHtml]=\"'form-record-permissions-roleeditheading' | translate\"></h4>\n    <table class=\"table\">\n      <thead>\n          <tr>\n             <th [innerHtml]=\"'form-record-permissions-rolenametableheading' | translate\"></th>\n          </tr>\n      </thead>\n      <tbody>\n        <tr *ngFor=\"let permission of field.permissions.editRoles\">\n          <td>{{permission}}</td>\n        </tr>\n      </tbody>\n    </table>\n\n    <h4 [innerHtml]=\"'form-record-permissions-roleviewheading' | translate\"></h4>\n    <table class=\"table\">\n      <thead>\n          <tr>\n             <th [innerHtml]=\"'form-record-permissions-rolenametableheading' | translate\"></th>\n          </tr>\n      </thead>\n      <tbody>\n        <tr *ngFor=\"let permission of field.permissions.viewRoles\">\n          <td>{{permission}}</td>\n        </tr>\n        \n      </tbody>\n    </table>\n  </div>\n</div>\n"

/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-related-fileupload.html":
/***/ (function(module, exports) {

module.exports = "<!-- Basic Uppy styles -->\n<link rel=\"stylesheet\" href=\"/node_modules/uppy/dist/uppy.min.css\">\n<div>\n  <span class=\"label-font\">\n    {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n    <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help && field.editMode\" (click)=\"toggleHelp()\"\n            [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\"\n                                                          aria-hidden=\"true\"></span></button>\n  </span>\n</div>\n<div *ngIf=\"this.helpShow\">\n  <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" [innerHtml]=\"field.help\"></span>\n</div>\n<div>\n  <div class=\"table-responsive\" *ngIf=\"getDatalocations() && getDatalocations().length > 0\">\n    <table class=\"table table-bordered table-striped table-hover\">\n      <thead>\n      <tr>\n        <th width=\"40%\">{{ field.locationHeader }}</th>\n        <th *ngIf=\"field.notesEnabled\" width=\"20%\">{{ field.notesHeader }}</th>\n        <th width=\"5%\" *ngIf=\"field.editMode\"><span [hidden]=\"true\">Action</span></th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr *ngFor=\"let dataLocation of getDatalocations(); let i = index;\">\n        <td>\n          <ng-container *ngIf=\"dataLocation\">\n            <ng-container *ngIf=\"dataLocation.pending\">\n              {{ dataLocation.name }}\n            </ng-container>\n            <a *ngIf=\"!dataLocation.pending\" href=\"{{ getAbsUrl(dataLocation.location) }}\" target=\"_blank\">\n              {{ dataLocation.name }}\n            </a>\n          </ng-container>\n        </td>\n        <td *ngIf=\"field.notesEnabled\">\n          <input *ngIf=\"field.editMode\" type='text' [ngClass]=\"form-control\" [(ngModel)]=\"dataLocation.notes\"\n                 [attr.aria-label]=\"field.notesHeader\" (change)=\"field.updateNote(opt, $event)\"/>\n          <span *ngIf=\"!field.editMode\">{{ dataLocation.notes }}</span>\n        </td>\n        <td *ngIf=\"field.editMode\">\n          <a class=\"fa fa-minus-circle btn text-20 btn-danger\" (click)=\"field.removeLocation(dataLocation)\"></a>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n  <div class=\"row padding-bottom-10\" *ngIf=\"field.editMode\">\n    <div *ngIf=\"field.editMode\">\n      <div class=\"col-sm-6\">\n        <a [class.disabled]=\"isAttachmentsDisabled()\"\n           class=\"btn btn-info UppyModalOpenerBtn\"\n           [style.display]=\"inherit\" (click)=\"openModal()\">{{ field.attachmentText }}</a>\n      </div>\n    </div>\n  </div>\n</div>\n"

/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-relatedfileupload.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var records_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/records.service.ts");
var Uppy = __webpack_require__("./node_modules/uppy/lib/index.js");
/**
 * Contributor Model
 * @author <a target='_' href='https://github.com/moisbo'>Moises Sacal</a>
 *
 */
var RelatedFileUploadField = /** @class */ (function (_super) {
    __extends(RelatedFileUploadField, _super);
    function RelatedFileUploadField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.newLocation = { location: "", notes: "" };
        _this.dataTypes = [{
                'label': 'Attachment',
                'value': 'attachment'
            }];
        _this.accessDeniedObjects = [];
        _this.locationHeader = _this.getTranslated(options['locationHeader'], 'Location');
        _this.notesEnabled = !_.isUndefined(options['notesEnabled']) ? options['notesEnabled'] : true;
        _this.notesHeader = options['notesHeader'] ? _this.getTranslated(options['notesHeader'], options['notesHeader']) : null;
        _this.uppyDashboardNote = _this.getTranslated(options['uppyDashboardNote'], 'Maximum upload size: 1 Gb per file');
        _this.columns = options['columns'] || [];
        _this.maxFileSize = options['maxFileSize'] || null;
        _this.maxNumberOfFiles = options['maxNumberOfFiles'] || null;
        _this.allowedFileTypes = options['allowedFileTypes'] || null;
        _this.attachmentText = options['attachmentText'] || 'Add attachment(s)';
        _this.attachmentTextDisabled = options['attachmentTextDisabled'] || 'Save your record to attach files';
        _this.value = options['value'] || _this.setEmptyValue();
        _this.recordsService = _this.getFromInjector(records_service_1.RecordsService);
        return _this;
    }
    RelatedFileUploadField.prototype.setValue = function (value, emitEvent) {
        if (emitEvent === void 0) { emitEvent = true; }
        this.formModel.setValue(value, { emitEvent: emitEvent, emitModelToViewChange: true });
        this.formModel.markAsTouched();
        this.formModel.markAsDirty();
    };
    RelatedFileUploadField.prototype.setEmptyValue = function () {
        this.value = [];
        return this.value;
    };
    RelatedFileUploadField.prototype.addLocation = function () {
        this.value.push(this.newLocation);
        this.setValue(this.value);
        this.newLocation = { location: "", notes: "" };
    };
    RelatedFileUploadField.prototype.appendLocation = function (newLoc) {
        this.value.push(newLoc);
        this.setValue(this.value, true);
    };
    RelatedFileUploadField.prototype.clearPendingAtt = function (value) {
        _.each(value, function (val) {
            _.unset(val, 'pending');
        });
    };
    RelatedFileUploadField.prototype.removeLocation = function (loc) {
        _.remove(this.value, function (val) {
            return val.name == loc.name && val.location == loc.location;
        });
        this.setValue(this.value);
    };
    RelatedFileUploadField.prototype.updateNote = function (opt, event) {
        this.fieldMap._rootComp.needsSave = true;
    };
    return RelatedFileUploadField;
}(field_base_1.FieldBase));
exports.RelatedFileUploadField = RelatedFileUploadField;
/**
 * Related File Upload Component
 */
var RelatedFileUploadComponent = /** @class */ (function (_super) {
    __extends(RelatedFileUploadComponent, _super);
    function RelatedFileUploadComponent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.uppy = null;
        _this.oid = null;
        _this.editingNotes = { notes: '', index: -1 };
        return _this;
    }
    RelatedFileUploadComponent.prototype.ngOnInit = function () {
        var oid = this.field.fieldMap._rootComp.oid;
        if (this.field.editMode) {
            if (_.isNull(oid) || _.isUndefined(oid) || _.isEmpty(oid)) {
                // wait for the OID to be set when record is created
                if (!this.field.fieldMap._rootComp.getSubscription('recordCreated')) {
                    console.log("Subscribing to record creation..... " + this.field.name);
                    this.field.fieldMap._rootComp.subscribe('recordCreated', this.field.name, this.eventRecordCreate.bind(this));
                    this.initUppy(oid);
                }
            }
            this.initUppy(oid);
        }
    };
    RelatedFileUploadComponent.prototype.ngAfterViewInit = function () {
        if (this.field.editMode) {
            jQuery(".uppy-Dashboard-input").attr('aria-label', this.field.label);
        }
    };
    RelatedFileUploadComponent.prototype.getDatalocations = function () {
        return this.field.value;
    };
    RelatedFileUploadComponent.prototype.eventRecordCreate = function (createdInfo) {
        console.log("Created record triggered: ");
        console.log(createdInfo);
        this.field.fieldMap[this.field.name].instance.initUppy(createdInfo.oid);
    };
    RelatedFileUploadComponent.prototype.tempClearPending = function () {
        // temporarily clearing pending values
        var fieldVal = _.cloneDeep(this.field.fieldMap._rootComp.form.value[this.field.name]);
        this.field.clearPendingAtt(fieldVal);
        this.field.fieldMap._rootComp.form.controls[this.field.name].setValue(fieldVal, { emitEvent: true });
    };
    RelatedFileUploadComponent.prototype.applyPendingChanges = function (savedInfo) {
        if (savedInfo.success) {
            // this.field.value = this.field.fieldMap._rootComp.form.value[this.field.name];
            var finalVal = this.field.fieldMap._rootComp.form.controls[this.field.name].value;
            this.field.fieldMap[this.field.name].field.value = finalVal;
        }
        else {
            // reverse the value
            console.log("Resetting....");
            this.field.fieldMap._rootComp.form.controls[this.field.name].setValue(this.field.fieldMap[this.field.name].field.value);
        }
    };
    RelatedFileUploadComponent.prototype.initUppy = function (oid) {
        var _this = this;
        this.field.fieldMap[this.field.name].instance.oid = oid;
        if (this.uppy) {
            console.log("Uppy already created... setting oid to: " + oid);
            this.field.fieldMap[this.field.name].instance.uppy.getPlugin('Tus').opts.endpoint = this.field.recordsService.getBrandingAndPortalUrl + "/record/" + oid + "/attach";
            return;
        }
        var appConfig = this.field.recordsService.getConfig();
        var uppyConfig = {
            debug: true,
            autoProceed: false,
            restrictions: {
                maxFileSize: this.field.maxFileSize,
                maxNumberOfFiles: this.field.maxNumberOfFiles,
                allowedFileTypes: this.field.allowedFileTypes
            }
        };
        var uppyDashboardNote = this.field.uppyDashboardNote;
        console.debug("Using Uppy config:");
        console.debug(JSON.stringify(uppyConfig));
        var tusConfig = {
            endpoint: this.field.recordsService.getBrandingAndPortalUrl + "/record/" + oid + "/attach",
            headers: {
                'X-CSRF-Token': appConfig.csrfToken
            }
        };
        console.debug("Using TUS config:::");
        console.debug(JSON.stringify(tusConfig));
        this.uppy = Uppy.Core(uppyConfig);
        this.uppy.use(Uppy.Dashboard, {
            // trigger: '.UppyModalOpenerBtn',
            inline: false,
            hideProgressAfterFinish: true,
            note: uppyDashboardNote,
            metaFields: [
                { id: 'notes', name: 'Notes', placeholder: 'Notes about this file.' }
            ]
        })
            .use(Uppy.Tus, tusConfig)
            .run();
        console.log(this.uppy);
        var fieldVal = null;
        // attach event handers...
        this.uppy.on('upload-success', function (file, resp, uploadURL) {
            console.debug("File info:");
            console.debug(file);
            console.debug("Response:");
            console.debug(resp);
            console.debug("Upload URL:" + uploadURL);
            // add to form control on each upload...
            var urlParts = uploadURL.split('/');
            var fileId = urlParts[urlParts.length - 1];
            var choppedUrl = urlParts.slice(6, urlParts.length).join('/');
            var newLoc = {
                type: "attachment",
                pending: true,
                location: choppedUrl,
                notes: file.meta.notes,
                mimeType: file.type,
                name: file.meta.name,
                fileId: fileId,
                uploadUrl: uploadURL
            };
            console.log("Adding new location:");
            console.log(newLoc);
            _this.field.appendLocation(newLoc);
        });
        // clearing all pending attachments...
        this.field.fieldMap._rootComp.subscribe('onBeforeSave', this.field.name, function (savedInfo) {
            console.log("Before saving record triggered.. ");
            _this.field.fieldMap[_this.field.name].instance.tempClearPending();
        });
        // attach event handling for saving the record
        this.field.fieldMap._rootComp.subscribe('recordSaved', this.field.name, function (savedInfo) {
            console.log("Saved record triggered.. ");
            _this.field.fieldMap[_this.field.name].instance.applyPendingChanges(savedInfo);
        });
    };
    RelatedFileUploadComponent.prototype.isAttachmentsDisabled = function () {
        if (_.isEmpty(this.oid)) {
            this.field.attachmentText = this.field.attachmentTextDisabled;
            return true;
        }
        return false;
    };
    RelatedFileUploadComponent.prototype.getAbsUrl = function (location) {
        return this.field.recordsService.getBrandingAndPortalUrl + "/record/" + location;
    };
    RelatedFileUploadComponent.prototype.openModal = function () {
        this.uppy && this.uppy.getPlugin('Dashboard') && this.uppy.getPlugin('Dashboard').openModal();
    };
    RelatedFileUploadComponent = __decorate([
        core_1.Component({
            selector: 'related-fileupload-selector',
            template: __webpack_require__("./redbox-portal/angular/shared/form/field-related-fileupload.html")
        })
    ], RelatedFileUploadComponent);
    return RelatedFileUploadComponent;
}(field_simple_component_1.SimpleComponent));
exports.RelatedFileUploadComponent = RelatedFileUploadComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-relatedobjectdata.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var records_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/records.service.ts");
var Observable_1 = __webpack_require__("./node_modules/rxjs/_esm5/Observable.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/observable/zip.js");
var fromPromise_1 = __webpack_require__("./node_modules/rxjs/_esm5/observable/fromPromise.js");
/**
 * Contributor Model
 *
 *
 * @author <a target='_' href='https://github.com/shilob'>Shilo Banihit</a>
 *
 */
var RelatedObjectDataField = /** @class */ (function (_super) {
    __extends(RelatedObjectDataField, _super);
    function RelatedObjectDataField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.isEditable = false;
        _this.isEditing = false;
        _this.formGroup = {};
        _this.archiveCurrentItem = {};
        _this.relatedObjects = [];
        _this.accessDeniedObjects = [];
        _this.failedObjects = [];
        _this.columns = options['columns'] || [];
        _this.isEditable = options['isEditable'] || false;
        _this.arhiveConfirmMessage = options['arhiveConfirmMessage'] || 'Confirm archiving your workspace from the plan';
        _this.confirmArchiveTitle = options['confirmArchiveTitle'] || 'Confirm Archive';
        var relatedObjects = _this.relatedObjects;
        _this.value = options['value'] || _this.setEmptyValue();
        _this.recordsService = _this.getFromInjector(records_service_1.RecordsService);
        _this.formBuilder = _this.getFromInjector(forms_1.FormBuilder);
        _this.currentItemForm = _this.formBuilder.group({});
        _this.setEmptyArchive();
        return _this;
    }
    /**
     * Loading the metadata for each related object in the array
     */
    RelatedObjectDataField.prototype.asyncLoadData = function () {
        var _this = this;
        var getRecordMetaObs = [];
        var that = this;
        _.forEach(this.value, function (item) {
            getRecordMetaObs.push(fromPromise_1.fromPromise(_this.recordsService.getRecordMeta(item.id)).flatMap(function (meta) {
                if (!meta) {
                    that.failedObjects.push(meta);
                }
                else if (meta['status'] == "Access Denied") {
                    that.accessDeniedObjects.push(meta);
                }
                else if (meta['title']) {
                    that.relatedObjects.push(meta);
                }
                else {
                    that.failedObjects.push(meta);
                }
                return Observable_1.Observable.of(null);
            }));
        });
        if (getRecordMetaObs.length > 0) {
            return Observable_1.Observable.zip.apply(Observable_1.Observable, getRecordMetaObs);
        }
        else {
            return Observable_1.Observable.of(null);
        }
    };
    RelatedObjectDataField.prototype.createFormModel = function (valueElem) {
        if (valueElem === void 0) { valueElem = undefined; }
        if (valueElem) {
            this.value = valueElem;
        }
        this.formModel = new forms_1.FormControl(this.value || []);
        if (this.value) {
            this.setValue(this.value);
        }
        return this.formModel;
    };
    RelatedObjectDataField.prototype.setValue = function (value) {
        this.formModel.patchValue(value, { emitEvent: false });
        this.formModel.markAsTouched();
    };
    RelatedObjectDataField.prototype.setEmptyValue = function () {
        this.value = [];
        return this.value;
    };
    RelatedObjectDataField.prototype.lockItem = function () {
        this.currentItemEditing = -1;
    };
    RelatedObjectDataField.prototype.isUnLocked = function (itemIndex) {
        return this.currentItemEditing == itemIndex;
    };
    RelatedObjectDataField.prototype.editRelatedObject = function (item, itemIndex) {
        this.currentItemEditing = itemIndex;
        this.currentItemForm.reset();
        for (var name_1 in item) {
            this.formGroup[name_1] = new forms_1.FormControl(item[name_1]);
        }
        this.currentItemForm = this.formBuilder.group(this.formGroup);
    };
    RelatedObjectDataField.prototype.archiveItem = function (item, itemIndex) {
        jQuery('#relatedObjectConfirmArchiveModal').modal({ backdrop: 'static', keyboard: false, show: true });
        this.archiveCurrentItem = {
            item: item,
            itemIndex: itemIndex,
            title: item['title'] || 'workspace'
        };
    };
    RelatedObjectDataField.prototype.confirmArchive = function (confirmArchiveRecord) {
        if (confirmArchiveRecord) {
            this.archiveCurrentItem['item']['archive'] = true;
            this.saveItem(this.archiveCurrentItem['item']);
        }
        this.archiveCurrentItem = {};
        jQuery('#relatedObjectConfirmArchiveModal').modal('hide');
    };
    RelatedObjectDataField.prototype.setEmptyArchive = function () {
        this.archiveCurrentItem = {
            item: {},
            itemIndex: undefined,
            title: ''
        };
    };
    RelatedObjectDataField.prototype.saveItem = function (value) {
        var _this = this;
        var object = this.value[this.currentItemEditing];
        this.recordsService.update(object['id'], value, 'draft')
            .subscribe(function (res) {
            if (res.success) {
                _this.relatedObjects[_this.currentItemEditing] = value;
                _this.lockItem();
                _this.setEmptyArchive();
            }
            else {
                console.log(res.success);
            }
        });
    };
    return RelatedObjectDataField;
}(field_base_1.FieldBase));
exports.RelatedObjectDataField = RelatedObjectDataField;
// Setting the template url to a constant rather than directly in the component as the latter breaks document generation
var rbRelatedObjectDataTemplate = './field-relatedobjectdata.html';
if (typeof aotMode == 'undefined') {
    rbRelatedObjectDataTemplate = '../angular/shared/form/field-relatedobjectdata.html';
}
/**
 * Component to display information from related objects within ReDBox
 *
 *
 *
 *
 */
var RelatedObjectDataComponent = /** @class */ (function (_super) {
    __extends(RelatedObjectDataComponent, _super);
    function RelatedObjectDataComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    RelatedObjectDataComponent = __decorate([
        core_1.Component({
            selector: 'rb-relatedobjectdata',
            template: __webpack_require__("./redbox-portal/angular/shared/form/field-relatedobjectdata.html")
        })
    ], RelatedObjectDataComponent);
    return RelatedObjectDataComponent;
}(field_simple_component_1.SimpleComponent));
exports.RelatedObjectDataComponent = RelatedObjectDataComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-relatedobjectdata.html":
/***/ (function(module, exports) {

module.exports = "<div class='padding-bottom-10'>\n  <div class=\"row\">\n    <form [formGroup]=\"field.currentItemForm\"\n          (ngSubmit)=\"field.saveItem(field.currentItemForm['value'])\"\n    >\n      <div class=\"table-responsive\">\n      <table class=\"table\">\n        <thead>\n        <tr>\n          <ng-container *ngFor=\"let header of field.columns\">\n            <th class=\"{{header.cssClasses}}\" *ngIf='header.show != false'>{{ header.label }}</th>\n          </ng-container>\n          <th class=\"col-md-2\">&nbsp;</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr *ngFor=\"let item of field.relatedObjects; let i = index\" [attr.data-index]=\"i\">\n          <ng-container *ngIf=\"!item['archive']\">\n            <ng-container *ngFor=\"let column of field.columns\">\n              <td\n                *ngIf=\"column.show != false && (!field.isUnLocked(i) || !column.isEditable) \">\n                <span *ngIf='column.link === \"relative\"; then relative'></span>\n                <span *ngIf='column.link === \"absolute\"; then absolute; else noProcessing'></span>\n                <ng-template #multivalue></ng-template>\n                <ng-template #relative><a\n                  href=\"/{{ branding }}/{{ portal }}/{{ column.link.pattern}}\">{{ column.link.pattern | stringTemplate:item }}</a>\n                </ng-template>\n                <ng-template #absolute><a target=\"_blank\" rel=\"noopener noreferrer\"\n                                          href=\"{{item[column.property]}}\">{{item[column.property]}}</a></ng-template>\n                <ng-template #noProcessing>{{ item[column.property] }}</ng-template>\n              </td>\n              <td *ngIf=\"column.show != false && field.isUnLocked(i) && column.isEditable\">\n                <div class=\"form-group\">\n                  <input class=\"form-control\" type=\"text\" [value]=\"item[column.property]\"\n                         formControlName=\"{{ column.property }}\">\n                </div>\n              </td>\n            </ng-container>\n            <td>\n              <button type=\"button\" *ngIf=\"field.editMode && field.isEditable && field.isUnLocked(i)\"\n                      class=\"btn btn-block\" (click)=\"field.lockItem()\">\n                <i aria-hidden=\"true\" class=\"fa fa-pencil-square-o\"></i>\n              </button>\n              <button type=\"button\" *ngIf=\"field.editMode &&   field.isEditable && !field.isUnLocked(i)\"\n                      class=\"btn btn-block\" (click)=\"field.editRelatedObject(item, i)\">\n                <i aria-hidden=\"true\" class=\"fa fa-pencil\"></i>\n              </button>\n              <button type=\"submit\" *ngIf=\"field.editMode && field.isEditable && field.isUnLocked(i)\"\n                      class=\"btn btn-block btn-success\">\n                <i aria-hidden=\"true\" class=\"fa fa-save\"></i>\n              </button>\n              <button type=\"button\"\n                      *ngIf=\"field.editMode && field.isEditable && field.isUnLocked(i) && !item['archive']\"\n                      class=\"btn btn-block btn-danger\" (click)=\"field.archiveItem(item, i)\">\n                <i aria-hidden=\"true\" class=\"fa fa-archive\"></i>\n              </button>\n            </td>\n          </ng-container>\n        </tr>\n        </tbody>\n      </table>\n      </div>\n    </form>\n    <p *ngIf=\"field.failedObjects.length > 0\">There were {{ field.failedObjects.length }} records that failed to\n      load</p>\n    <p *ngIf=\"field.accessDeniedObjects.length > 0\">There were {{ field.accessDeniedObjects.length }} records that you\n      do not have access to</p>\n  </div>\n</div>\n<div id=\"relatedObjectConfirmArchiveModal\" class=\"modal fade\" role=\"dialog\">\n  <div class=\"modal-dialog\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>\n        <h4 class=\"modal-title\">{{field.confirmArchiveTitle}}</h4>\n      </div>\n      <div class=\"modal-body\">\n        <p>\n          <code>{{ field.archiveCurrentItem['title'] }}</code>\n          {{field.arhiveConfirmMessage}}\n        </p>\n        <p>\n          <button class=\"btn btn-block btn-danger\"\n                  (click)=\"field.confirmArchive(true)\">{{field.confirmArchiveTitle}}\n          </button>\n        </p>\n      </div>\n      <div class=\"modal-footer\">\n        <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Close</button>\n      </div>\n    </div>\n  </div>\n</div>\n"

/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-relatedobjectselector.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var dashboard_service_1 = __webpack_require__("./redbox-portal/angular/shared/dashboard-service.ts");
/**
 * Contributor Model
 *
 *
 * @author <a target='_' href='https://github.com/shilob'>Shilo Banihit</a>
 *
 */
var RelatedObjectSelectorField = /** @class */ (function (_super) {
    __extends(RelatedObjectSelectorField, _super);
    function RelatedObjectSelectorField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.relatedObjectSelected = new core_1.EventEmitter();
        _this.resetSelectorEvent = new core_1.EventEmitter();
        _this.clName = 'RelatedObjectDataField';
        _this.columnTitle = options['columnTitle'] || "Record title";
        _this.value = options['value'] || _this.setEmptyValue();
        _this.recordType = options['recordType'];
        _this.dashboardService = _this.getFromInjector(dashboard_service_1.DashboardService);
        var that = _this;
        _this.dashboardService.getAllRecordsCanEdit(_this.recordType, '').then(function (draftPlans) {
            _this.plans = draftPlans;
        });
        return _this;
    }
    RelatedObjectSelectorField.prototype.recordSelected = function (record, config) {
        this.setValue({ oid: record.oid, title: record.title });
        if (this.fieldMap) {
            this.fieldMap._rootComp.setRelatedRecordId(record.oid);
        }
    };
    RelatedObjectSelectorField.prototype.recordSelectedEmit = function (record, event) {
        this.setValue({ oid: record.oid, title: record.title });
        if (this.fieldMap) {
            this.fieldMap._rootComp.setRelatedRecordId(record.oid);
        }
        this.relatedObjectSelected.emit(record.oid);
    };
    RelatedObjectSelectorField.prototype.resetSelector = function () {
        this.setEmptyValue();
        if (this.fieldMap) {
            this.fieldMap._rootComp.setRelatedRecordId(null);
        }
        this.resetSelectorEvent.emit();
    };
    RelatedObjectSelectorField.prototype.createFormModel = function (valueElem) {
        if (valueElem === void 0) { valueElem = undefined; }
        if (valueElem) {
            this.value = valueElem;
        }
        this.formModel = new forms_1.FormControl(this.value || []);
        if (this.value) {
            this.setValue(this.value);
            if (this.fieldMap) {
                this.fieldMap._rootComp.setRelatedRecordId(this.value.oid);
            }
        }
        return this.formModel;
    };
    RelatedObjectSelectorField.prototype.setValue = function (value) {
        this.value = value;
        this.formModel.patchValue(value, { emitEvent: false });
        this.formModel.markAsTouched();
    };
    RelatedObjectSelectorField.prototype.setEmptyValue = function () {
        this.value = {};
        return this.value;
    };
    RelatedObjectSelectorField.prototype.onFilterChange = function () {
        var _this = this;
        this.filteredPlans = _.filter(this.plans.items, function (plan) {
            plan.selected = false;
            var title = _.isArray(plan.title) ? plan.title[0] : plan.title;
            return _.toLower(title).includes(_.toLower(_this.searchFilterName));
        });
    };
    RelatedObjectSelectorField.prototype.resetFilter = function () {
        this.searchFilterName = null;
        this.onFilterChange();
    };
    return RelatedObjectSelectorField;
}(field_base_1.FieldBase));
exports.RelatedObjectSelectorField = RelatedObjectSelectorField;
/**
* Component to display information from related objects within ReDBox
*
*
*
*/
var RelatedObjectSelectorComponent = /** @class */ (function (_super) {
    __extends(RelatedObjectSelectorComponent, _super);
    function RelatedObjectSelectorComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    RelatedObjectSelectorComponent.prototype.hasFilteredResults = function () {
        return this.field.searchFilterName && !_.isEmpty(_.trim(this.field.searchFilterName)) && this.field.filteredPlans && this.field.filteredPlans.length > 0;
    };
    __decorate([
        core_1.Input(),
        __metadata("design:type", RelatedObjectSelectorField)
    ], RelatedObjectSelectorComponent.prototype, "field", void 0);
    RelatedObjectSelectorComponent = __decorate([
        core_1.Component({
            selector: 'rb-RelatedObjectSelector',
            template: __webpack_require__("./redbox-portal/angular/shared/form/field-relatedobjectselector.html")
        })
    ], RelatedObjectSelectorComponent);
    return RelatedObjectSelectorComponent;
}(field_simple_component_1.SimpleComponent));
exports.RelatedObjectSelectorComponent = RelatedObjectSelectorComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-relatedobjectselector.html":
/***/ (function(module, exports) {

module.exports = "<div *ngIf=\"field.value.oid && !field.editMode\" class=\"key-value-pair\">\n   <span *ngIf=\"field.label\" class=\"key\">{{field.label}}</span>\n   <span class=\"value\">{{ field.value.title }}</span>\n</div>\n<div class=\"panel panel-primary\" *ngIf=\"field.editMode\">\n  <div class=\"panel-body\">\n    <span class=\"label-font\">\n      {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n      <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n    </span><br/>\n    <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\"></span>\n    <div *ngIf=\"field.value.oid\">\n       {{ field.value.title }} <button type=\"button\" class=\"btn btn-info\" (click)=\"field.resetSelector()\">{{ 'change-text' | translate }}</button>\n    </div>\n    <div *ngIf=\"!field.value.oid\">\n      <div class=\"input-group\">\n        <span class=\"input-group-addon\" id=\"name-addon\">{{ 'search-by-name' | translate }}</span>\n        <input [attr.aria-label]=\"field.label\" type=\"text\" (keyup)=\"field.onFilterChange()\" [(ngModel)]=\"field.searchFilterName\" class=\"form-control\" placeholder=\"Name\" aria-describedby=\"name-addon\">\n        <span  (click)=\"field.resetFilter()\" class=\"input-group-btn\"><button class=\"btn btn-primary\" type='button'>{{ 'transfer-ownership-reset' | translate }}</button></span>\n      </div>\n      <div><br/></div>\n      <div class=\"table-responsive\" *ngIf=\"hasFilteredResults()\">\n        <table class=\"table table-bordered table-striped table-hover\">\n          <thead>\n            <tr>\n              <th>{{ field.columnTitle }}</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr *ngFor=\"let plan of field.filteredPlans\" (click)=\"field.recordSelectedEmit(plan,$event)\">\n              <td>{{ plan.title }}</td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    </div>\n  </div>\n</div>\n"

/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-repeatable.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_simple_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.ts");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
/**
 * Repeatable Field Container
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 *
 */
var RepeatableContainer = /** @class */ (function (_super) {
    __extends(RepeatableContainer, _super);
    function RepeatableContainer(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.hasGroup = true;
        _this.addButtonText = options['addButtonText'] || '';
        _this.removeButtonText = options['removeButtonText'] || null;
        _this.skipClone = options['skipClone'] || [];
        _this.forceClone = options['forceClone'] || [];
        _this.addButtonTextClass = options['addButtonTextClass'] || 'btn btn-success pull-right';
        _this.addButtonClass = options['addButtonClass'] || 'fa fa-plus-circle btn text-20 pull-right btn-success';
        _this.removeButtonTextClass = options['removeButtonTextClass'] || 'btn btn-danger pull-right';
        _this.removeButtonClass = options['removeButtonClass'] || 'fa fa-minus-circle btn text-20 pull-right btn-danger';
        _this.moveUpButtonClass = options['addButtonClass'] || 'fa fa-chevron-circle-up btn text-20 pull-left btn-primary';
        _this.moveDownButtonClass = options['addButtonClass'] || 'fa fa-chevron-circle-down btn text-20 pull-left btn-primary';
        _this.delegateErrorHandling = !_.isUndefined(options['delegateErrorHandling']) ? options['delegateErrorHandling'] : true;
        return _this;
    }
    RepeatableContainer.prototype.getInitArrayEntry = function () {
        if (this.fields[0].isGroup) {
            var grp = {};
            var fm = {};
            var fg = this.fields[0].getGroup(grp, fm);
            return [fg];
        }
        return [this.fields[0].createFormModel()];
    };
    RepeatableContainer.prototype.getGroup = function (group, fieldMap) {
        var _this = this;
        this.fieldMap = fieldMap;
        fieldMap[this.name] = { field: this };
        if (!this.value || this.value.length == 0) {
            this.formModel = this.required ? new forms_1.FormArray(this.getInitArrayEntry(), forms_1.Validators.required) : new forms_1.FormArray(this.getInitArrayEntry());
        }
        else {
            var fieldCtr_1 = 0;
            var baseField_1 = this.fields[0];
            var elems_1 = [];
            this.fields = _.map(this.value, function (valueElem) {
                var fieldClone = null;
                if (fieldCtr_1 == 0) {
                    fieldClone = baseField_1;
                    fieldClone.value = _.isArray(valueElem) ? valueElem[fieldCtr_1] : valueElem;
                }
                else {
                    fieldClone = _this.createNewElem(baseField_1, _.isArray(valueElem) ? valueElem[fieldCtr_1] : valueElem);
                    fieldClone.value = _.isArray(valueElem) ? valueElem[fieldCtr_1] : valueElem;
                }
                fieldCtr_1++;
                elems_1.push(fieldClone.createFormModel());
                return fieldClone;
            });
            this.formModel = this.required ? new forms_1.FormArray(elems_1, forms_1.Validators.required) : new forms_1.FormArray(elems_1);
            _.each(this.fields, function (f) {
                f.setupEventHandlers();
            });
        }
        fieldMap[this.name].control = this.formModel;
        if (this.groupName) {
            if (group[this.groupName]) {
                group[this.groupName].addControl(this.name, this.formModel);
            }
            else {
                var fg = {};
                fg[this.name] = this.formModel;
                group[this.groupName] = fg;
            }
        }
        else {
            group[this.name] = this.formModel;
        }
    };
    RepeatableContainer.prototype.createNewElem = function (baseFieldInst, value) {
        var _this = this;
        if (value === void 0) { value = null; }
        var newOpts = _.cloneDeep(baseFieldInst.options);
        newOpts.value = value;
        var newInst = new baseFieldInst.constructor(newOpts, this.injector);
        _.forEach(this.skipClone, function (f) {
            newInst[f] = null;
        });
        _.forEach(this.forceClone, function (f) {
            if (_.isString(f)) {
                newInst[f] = _.cloneDeepWith(baseFieldInst[f], _this.getCloneCustomizer({
                    skipClone: ['fields', 'fieldMap', 'formModel', 'injector', 'onValueUpdate', 'onValueLoaded', 'translationService', 'utilityService', 'componentReactors'],
                    copy: ['fieldMap', 'injector', 'translationService', 'utilityService']
                }));
            }
            else {
                newInst[f.field] = _.cloneDeepWith(baseFieldInst[f.field], _this.getCloneCustomizer(f));
            }
        });
        if (_.isFunction(newInst.postInit)) {
            newInst.postInit(value);
        }
        return newInst;
    };
    RepeatableContainer.prototype.getCloneCustomizer = function (cloneOpts) {
        var that = this;
        return function (value, key) {
            if (_.includes(cloneOpts.skipClone, key)) {
                if (_.includes(cloneOpts.copy, key)) {
                    return that[key];
                }
                return false;
            }
        };
    };
    RepeatableContainer.prototype.addElem = function (val) {
        if (val === void 0) { val = null; }
        var newElem = this.createNewElem(this.fields[0], val);
        if (val == null && _.isFunction(newElem.setEmptyValue)) {
            newElem.setEmptyValue();
        }
        this.fields.push(newElem);
        var newFormModel = newElem.createFormModel();
        this.formModel.push(newFormModel);
        return newElem;
    };
    RepeatableContainer.prototype.removeElem = function (index) {
        _.remove(this.fields, function (val, idx) { return idx == index; });
        this.formModel.removeAt(index);
    };
    RepeatableContainer.prototype.swap = function (fromIdx, toIdx) {
        var temp = this.fields[toIdx];
        this.fields[toIdx] = this.fields[fromIdx];
        this.fields[fromIdx] = temp;
        temp = this.formModel.at(toIdx);
        this.formModel.setControl(toIdx, this.formModel.at(fromIdx));
        this.formModel.setControl(fromIdx, temp);
    };
    RepeatableContainer.prototype.setValueAtElem = function (index, value) {
        this.fields[index].setValue(value, true);
    };
    RepeatableContainer.prototype.triggerValidation = function () {
        _.forEach(this.fields, function (f) {
            f.triggerValidation();
        });
    };
    RepeatableContainer.prototype.reactEvent = function (eventName, eventData, origData) {
        var _this = this;
        console.log("Repeatable container field reacting: " + eventName);
        console.log(eventData);
        // delete first...
        for (var toDelIdx = 1; toDelIdx < this.fields.length; toDelIdx++) {
            this.removeElem(toDelIdx);
        }
        _.each(eventData, function (entry, idx) {
            if (idx >= _this.formModel.controls.length) {
                _this.addElem(entry);
            }
            else {
                _this.setValueAtElem(idx, entry);
            }
        });
    };
    RepeatableContainer.prototype.removeAllElems = function () {
        var _this = this;
        _.each(this.fields, function (f, idx) {
            _this.removeElem(idx);
        });
    };
    RepeatableContainer.prototype.reset = function (data, eventConfig) {
        if (data === void 0) { data = null; }
        if (eventConfig === void 0) { eventConfig = null; }
        this.fields[0].setValue(null);
        if (this.fields.length > 1) {
            for (var i = 1; i < this.fields.length; i++) {
                this.removeElem(i);
            }
        }
        return data;
    };
    return RepeatableContainer;
}(field_simple_1.Container));
exports.RepeatableContainer = RepeatableContainer;
var EmbeddableComponent = /** @class */ (function (_super) {
    __extends(EmbeddableComponent, _super);
    function EmbeddableComponent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.canRemove = false;
        _this.removeBtnText = null;
        _this.removeBtnClass = 'btn fa fa-minus-circle btn text-20 pull-left btn btn-danger';
        _this.onRemoveBtnClick = new core_1.EventEmitter();
        return _this;
    }
    EmbeddableComponent.prototype.onRemove = function (event) {
        this.onRemoveBtnClick.emit([event, this.index]);
    };
    EmbeddableComponent.prototype.getGroupClass = function (fldName) {
        if (fldName === void 0) { fldName = null; }
        var baseClass = 'form-group';
        if (this.isEmbedded) {
            baseClass = '';
        }
        return baseClass + " " + (this.hasRequiredError() ? 'has-error' : '') + " " + this.field.groupClasses;
    };
    __decorate([
        core_1.Input(),
        __metadata("design:type", Boolean)
    ], EmbeddableComponent.prototype, "canRemove", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", String)
    ], EmbeddableComponent.prototype, "removeBtnText", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", String)
    ], EmbeddableComponent.prototype, "removeBtnClass", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Number)
    ], EmbeddableComponent.prototype, "index", void 0);
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], EmbeddableComponent.prototype, "onRemoveBtnClick", void 0);
    return EmbeddableComponent;
}(field_simple_component_1.SimpleComponent));
exports.EmbeddableComponent = EmbeddableComponent;
var RepeatableComponent = /** @class */ (function (_super) {
    __extends(RepeatableComponent, _super);
    function RepeatableComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    RepeatableComponent.prototype.addElem = function (event) {
        this.field.addElem();
    };
    RepeatableComponent.prototype.removeElem = function (event, i) {
        this.field.removeElem(i);
    };
    RepeatableComponent.prototype.hasRequiredError = function () {
        var hasError = false;
        _.each(this.field.formModel.controls, function (c) {
            if (c.hasError('required')) {
                hasError = true;
                return false;
            }
        });
        return hasError;
    };
    return RepeatableComponent;
}(field_simple_component_1.SimpleComponent));
exports.RepeatableComponent = RepeatableComponent;
var RepeatableVocab = /** @class */ (function (_super) {
    __extends(RepeatableVocab, _super);
    function RepeatableVocab(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.clName = 'RepeatableVocab';
        return _this;
    }
    RepeatableVocab.prototype.setValueAtElem = function (index, value) {
        console.log("Repeatable vocab setting value at: " + index);
        console.log(value);
        var selected = {};
        selected['originalObject'] = value;
        this.fields[index].component.onSelect(selected, false, true);
    };
    return RepeatableVocab;
}(RepeatableContainer));
exports.RepeatableVocab = RepeatableVocab;
var RepeatableVocabComponent = /** @class */ (function (_super) {
    __extends(RepeatableVocabComponent, _super);
    function RepeatableVocabComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    RepeatableVocabComponent.clName = 'RepeatableVocabComponent';
    RepeatableVocabComponent = __decorate([
        core_1.Component({
            selector: 'repeatable-vocab',
            template: "\n  <div *ngIf=\"field.editMode\">\n    <div class=\"row\">\n      <div class=\"col-xs-12\">\n      <label [attr.for]=\"field.name\">{{field.label}}\n        <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n      </label>\n      <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\"></span>\n      </div>\n    </div>\n    <div *ngFor=\"let fieldElem of field.fields; let i = index;\" class=\"row\">\n      <span class=\"col-xs-12 no-horizontal-padding\">\n        <rb-vocab [name]=\"field.name\" [field]=\"fieldElem\" [form]=\"form\" [fieldMap]=\"fieldMap\" [isEmbedded]=\"true\" [removeBtnText]=\"field.removeButtonText\" [removeBtnClass]=\"field.removeButtonClass\" [canRemove]=\"field.fields.length > 1\" (onRemoveBtnClick)=\"removeElem($event[0], $event[1])\" [index]=\"i\"></rb-vocab>\n      </span>\n    </div>\n    <div class=\"row\">\n      <span class=\"col-xs-11\">&nbsp;\n      </span>\n      <span class=\"col-xs-1\">\n        <button *ngIf=\"field.addButtonText\" type='button' (click)=\"addElem($event)\" [ngClass]=\"field.addButtonTextClass\" >{{field.addButtonText}}</button>\n        <button *ngIf=\"!field.addButtonText\" type='button' (click)=\"addElem($event)\" [ngClass]=\"field.addButtonClass\" [attr.aria-label]=\"'add-button-label' | translate\"></button>\n      </span>\n    </div>\n  </div>\n  <li *ngIf=\"!field.editMode\" class=\"key-value-pair\">\n    <span *ngIf=\"field.label\" class=\"key\">{{field.label}}</span>\n    <span class=\"value\">\n      <ul class=\"key-value-list\">\n        <rb-vocab *ngFor=\"let fieldElem of field.fields; let i = index;\" [field]=\"fieldElem\" [form]=\"form\" [fieldMap]=\"fieldMap\"></rb-vocab>\n      </ul>\n    </span>\n  </li>\n  ",
        })
    ], RepeatableVocabComponent);
    return RepeatableVocabComponent;
}(RepeatableComponent));
exports.RepeatableVocabComponent = RepeatableVocabComponent;
var RepeatableContributor = /** @class */ (function (_super) {
    __extends(RepeatableContributor, _super);
    function RepeatableContributor(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.canSort = _.isUndefined(options['canSort']) ? false : options['canSort'];
        return _this;
    }
    RepeatableContributor.prototype.setValueAtElem = function (index, value) {
        this.fields[index].component.onSelect(value, false, true);
    };
    RepeatableContributor.prototype.addElem = function (val) {
        if (val === void 0) { val = null; }
        this.fields[0].setMissingFields(val);
        return _super.prototype.addElem.call(this, val);
    };
    return RepeatableContributor;
}(RepeatableContainer));
exports.RepeatableContributor = RepeatableContributor;
var RepeatableContributorComponent = /** @class */ (function (_super) {
    __extends(RepeatableContributorComponent, _super);
    function RepeatableContributorComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    RepeatableContributorComponent.prototype.ngOnInit = function () {
        this.field.fields[0]['showHeader'] = false;
        this.field.fields[0].marginTop = this.field.fields[0].baseMarginTop;
        this.field.fields[0].componentReactors.push(this);
    };
    RepeatableContributorComponent.prototype.addElem = function (event) {
        var newElem = this.field.addElem();
        newElem.marginTop = '0px';
        if (!_.isUndefined(newElem.vocabField)) {
            newElem.vocabField.initialValue = null;
        }
        newElem.setupEventHandlers();
        newElem.showHeader = false;
        newElem.componentReactors.push(this);
    };
    RepeatableContributorComponent.prototype.removeElem = function (event, i) {
        this.field.removeElem(i);
        if (i == 0) {
            this.field.fields[0].marginTop = this.field.fields[0].baseMarginTop;
        }
    };
    RepeatableContributorComponent.prototype.reactEvent = function (eventName, eventData, origData, elem) {
        if (this.field.fields.length > 0) {
            elem.marginTop = '0px';
            elem.vocabField.initialValue = eventData;
            elem.setupEventHandlers();
            elem.componentReactors.push(this);
        }
    };
    RepeatableContributorComponent.prototype.moveUp = function (event, i) {
        var newIdx = i - 1;
        if (newIdx >= 0) {
            this.field.swap(i, newIdx);
            if (newIdx == 0) {
                this.field.fields[i].marginTop = '';
                this.field.fields[newIdx].marginTop = this.field.fields[newIdx].baseMarginTop;
            }
        }
    };
    RepeatableContributorComponent.prototype.moveDown = function (event, i) {
        var newIdx = i + 1;
        if (newIdx < this.field.fields.length) {
            this.field.swap(i, newIdx);
            if (i == 0) {
                this.field.fields[i].marginTop = this.field.fields[i].baseMarginTop;
                this.field.fields[newIdx].marginTop = '';
            }
        }
    };
    RepeatableContributorComponent = __decorate([
        core_1.Component({
            selector: 'repeatable-contributor',
            template: "\n  <div *ngIf=\"field.editMode\">\n    <div class=\"row\" *ngIf=\"field.fields[0].label\">\n      <div class=\"col-xs-12\">\n        <span class=\"label-font\">\n          {{field.fields[0].label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n          <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.fields[0].help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n        </span>\n      </div>\n    </div>\n    <div class=\"row\"  *ngIf=\"this.helpShow\">\n      <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"col-xs-12 help-block\" [innerHtml]=\"field.fields[0].help\"></span>\n    </div>\n    <div *ngFor=\"let fieldElem of field.fields; let i = index;\" class=\"row\">\n      <span class=\"col-xs-10\">\n        <rb-contributor [field]=\"fieldElem\" [form]=\"form\" [fieldMap]=\"fieldMap\" [isEmbedded]=\"true\"></rb-contributor>\n      </span>\n      <span class=\"col-xs-2\">\n        <button type='button' *ngIf=\"field.fields.length > 1 && field.canSort\"  (click)=\"moveUp($event, i)\" [ngClass]=\"field.moveUpButtonClass\" [ngStyle]=\"{'margin-top': fieldElem.marginTop}\" [attr.aria-label]=\"'move-up-button' | translate\"></button>\n        <button type='button' *ngIf=\"field.fields.length > 1 && field.canSort\"  (click)=\"moveDown($event, i)\" [ngClass]=\"field.moveDownButtonClass\" [ngStyle]=\"{'margin-top': fieldElem.marginTop}\" [attr.aria-label]=\"'move-down-button' | translate\"></button>\n        <button type='button' *ngIf=\"field.fields.length > 1 && field.removeButtonText\" (click)=\"removeElem($event, i)\"  [ngClass]=\"field.removeButtonTextClass\" [ngStyle]=\"{'margin-top': fieldElem.marginTop}\" >{{field.removeButtonText}}</button>\n        <button type='button' *ngIf=\"field.fields.length > 1 && !field.removeButtonText\" (click)=\"removeElem($event, i)\" [ngClass]=\"field.removeButtonClass\" [ngStyle]=\"{'margin-top': fieldElem.marginTop}\" [attr.aria-label]=\"'remove-button-label' | translate\" ></button>\n      </span>\n    </div>\n    <div class=\"row\">\n      <span class=\"col-xs-12\">\n        <button *ngIf=\"field.addButtonText\" type='button' (click)=\"addElem($event)\" [ngClass]=\"field.addButtonTextClass\" >{{field.addButtonText}}</button>\n        <button *ngIf=\"!field.addButtonText\" type='button' (click)=\"addElem($event)\" [ngClass]=\"field.addButtonClass\" [attr.aria-label]=\"'add-button-label' | translate\" ></button>\n      </span>\n    </div>\n  </div>\n  <ng-container  *ngIf=\"!field.editMode\">\n    <div class=\"view-contributor\">\n      <div *ngIf=\"field.fields[0].label\" class=\"row\">\n        <div class=\"col-xs-12 key-value-pair\"><span class=\"key\">{{field.fields[0].label}}</span></div>\n      </div>\n      <div class=\"row view-contributor\">\n        <div *ngIf=\"field.fields[0].showTitle\" class=\"col-xs-1 label-font\">{{field.fields[0].titleColHdr}}</div>\n        <div class=\"col-xs-3 label-font\">{{field.fields[0].nameColHdr}}</div>\n        <div [attr.class]=\"field.showRole? 'label-font col-xs-3':'label-font col-xs-4'\" class=\"\">{{field.fields[0].emailColHdr}}</div>\n        <div class=\"label-font\" [attr.class]=\"field.showRole? 'label-font col-xs-3':'hidden'\" >{{field.fields[0].roleColHdr}}</div>\n        <div class=\"col-xs-2 label-font\">{{field.fields[0].orcidColHdr}}</div>\n      </div>\n      <div class=\"row view-contributor\" *ngFor=\"let fieldElem of field.fields; let i = index;\">\n        <div *ngIf=\"fieldElem.showTitle\" class=\"col-xs-1\">{{fieldElem.value.honorific}}</div>\n        <div class=\"col-xs-3\">{{fieldElem.value.text_full_name}}</div>\n        <div [attr.class]=\"field.showRole? 'col-xs-3':'col-xs-4'\">{{fieldElem.value.email}}</div>\n        <div [attr.class]=\"field.showRole? 'col-xs-3':'hidden'\">{{fieldElem.value.role}}</div>\n        <div class=\"col-xs-2\">{{fieldElem.value.orcid}}</div>\n      </div>\n    </div>\n  </ng-container>\n  ",
        })
    ], RepeatableContributorComponent);
    return RepeatableContributorComponent;
}(RepeatableComponent));
exports.RepeatableContributorComponent = RepeatableContributorComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-simple.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
/**
 * A component base class
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 */
var SimpleComponent = /** @class */ (function () {
    function SimpleComponent() {
        this.isEmbedded = false;
    }
    /**
     * Return the NG2 FormControl or subclass thereof
     * @param  {string = null} name
     * @return {FormControl}
     */
    SimpleComponent.prototype.getFormControl = function (name, ctrlIndex) {
        if (name === void 0) { name = null; }
        if (ctrlIndex === void 0) { ctrlIndex = null; }
        var fc = null;
        if (_.isEmpty(name)) {
            name = this.name;
        }
        if (_.isEmpty(name)) {
            name = this.field.name;
        }
        if (this.fieldMap && this.field) {
            // console.log(name);
            fc = this.field.getControl(name, this.fieldMap);
        }
        if (!_.isNull(ctrlIndex) && !_.isUndefined(ctrlIndex)) {
            if (!_.isNull(fc.controls) && !_.isUndefined(fc.controls)) {
                fc = fc.controls[ctrlIndex];
            }
        }
        else if (this.index != null) {
            fc = fc.controls[this.index];
        }
        if (name != this.field.name && !_.isEmpty(this.field.name) && !_.isUndefined(fc.controls)) {
            fc = fc.controls[this.field.name];
        }
        return fc;
    };
    /**
     * Returns the CSS class
     * @param  {string=null} fldName
     * @return {string}
     */
    SimpleComponent.prototype.getGroupClass = function (fldName) {
        if (fldName === void 0) { fldName = null; }
        return this.field.groupClasses + " form-group " + (this.hasRequiredError() ? 'has-error' : '');
    };
    /**
     * If this field has a 'required' error.
     * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
     * @return {[type]}
     */
    SimpleComponent.prototype.hasRequiredError = function () {
        return (this.field.formModel ? this.field.formModel.touched && this.field.formModel.hasError('required') : false);
    };
    /**
     * Convenience method to toggle help mode.
     * @return {[type]}
     */
    SimpleComponent.prototype.toggleHelp = function () {
        this.helpShow = !this.helpShow;
    };
    /**
     * Returns label
     * @return {string}
     */
    SimpleComponent.prototype.getRequiredLabelStr = function () {
        return this.field.required ? '<span class="text-danger">(*)</span>' : '';
    };
    /**
     * Returns the NG2 root injector
     * @param  {any} token
     * @return {any}
     */
    SimpleComponent.prototype.getFromInjector = function (token) {
        return this.injector.get(token);
    };
    __decorate([
        core_1.Input(),
        __metadata("design:type", field_base_1.FieldBase)
    ], SimpleComponent.prototype, "field", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", forms_1.FormGroup)
    ], SimpleComponent.prototype, "form", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Object)
    ], SimpleComponent.prototype, "fieldMap", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Object)
    ], SimpleComponent.prototype, "index", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Object)
    ], SimpleComponent.prototype, "name", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Boolean)
    ], SimpleComponent.prototype, "isEmbedded", void 0);
    return SimpleComponent;
}());
exports.SimpleComponent = SimpleComponent;
var SelectionComponent = /** @class */ (function (_super) {
    __extends(SelectionComponent, _super);
    function SelectionComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    SelectionComponent.prototype.getLabel = function (val) {
        if (_.isEmpty(val)) {
            return '';
        }
        var opt = _.find(this.field.selectOptions, function (opt) {
            return opt.value == val;
        });
        if (opt) {
            return opt.label;
        }
        else {
            return '';
        }
    };
    return SelectionComponent;
}(SimpleComponent));
exports.SelectionComponent = SelectionComponent;
var DropdownFieldComponent = /** @class */ (function (_super) {
    __extends(DropdownFieldComponent, _super);
    function DropdownFieldComponent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.compare = _this.compareFn.bind(_this);
        return _this;
    }
    DropdownFieldComponent.prototype.compareFn = function (a, b) {
        if (this.field.storeValueAndLabel) {
            if (b == null || b == "") {
                return a.value == b;
            }
            return a.value == b.value;
        }
        return a == b;
    };
    DropdownFieldComponent.clName = 'DropdownFieldComponent';
    DropdownFieldComponent = __decorate([
        core_1.Component({
            selector: 'dropdownfield',
            template: "\n  <div [formGroup]='form' *ngIf=\"field.editMode && field.visible\" [ngClass]=\"getGroupClass()\">\n     <label [attr.for]=\"field.name\">\n       {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n      <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n     </label><br/>\n     <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\"></span>\n     <select [compareWith]=\"compare\" [formControl]=\"getFormControl()\"  [id]=\"field.name\" [ngClass]=\"field.cssClasses\">\n        <ng-template [ngIf]=\"!field.storeValueAndLabel\">\n          <option *ngFor=\"let opt of field.selectOptions\" [value]=\"opt.value\">{{opt.label}}</option>\n        </ng-template>\n        <ng-template [ngIf]=\"field.storeValueAndLabel\">\n          <option *ngFor=\"let opt of field.selectOptions\" [ngValue]=\"opt\">{{opt.label}}</option>\n        </ng-template>\n     </select>\n     <div class=\"text-danger\" *ngIf=\"getFormControl().hasError('required') && getFormControl().touched && !field.validationMessages?.required\">{{field.label}} is required</div>\n     <div class=\"text-danger\" *ngIf=\"getFormControl().hasError('required') && getFormControl().touched && field.validationMessages?.required\">{{field.validationMessages.required}}</div>\n  </div>\n  <div *ngIf=\"!field.editMode && field.visible\" class=\"key-value-pair\">\n    <span class=\"key\" *ngIf=\"field.label\">{{field.label}}</span>\n    <ng-template [ngIf]=\"!field.storeValueAndLabel\">\n    <span *ngIf=\"!field.valueIsLink\" target=\"_blank\" class=\"value\">{{getLabel(field.value)}}</span>\n    <a *ngIf=\"field.valueIsLink\" href=\"{{field.value}}\" class=\"value\">{{getLabel(field.value)}}</a>\n    </ng-template>\n    <ng-template [ngIf]=\"field.storeValueAndLabel && field.value.value != ''\">\n    <span class=\"value\">{{getLabel(field.value.value)}}</span>\n    </ng-template>\n  </div>\n  ",
        })
    ], DropdownFieldComponent);
    return DropdownFieldComponent;
}(SelectionComponent));
exports.DropdownFieldComponent = DropdownFieldComponent;
var SelectionFieldComponent = /** @class */ (function (_super) {
    __extends(SelectionFieldComponent, _super);
    function SelectionFieldComponent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.defer = {};
        _this.defered = false;
        _this.confirmChanges = true;
        return _this;
    }
    SelectionFieldComponent.prototype.isValArray = function () {
        return _.isArray(this.field.value) || this.field.controlType == 'checkbox';
    };
    SelectionFieldComponent.prototype.isRadio = function () {
        return this.field.controlType == 'radio';
    };
    SelectionFieldComponent.prototype.getControlFromOption = function (opt) {
        var fc = this.getFormControl();
        var control = _.find(fc['controls'], function (ctrl) {
            return opt.value == ctrl.value;
        });
        return control;
    };
    SelectionFieldComponent.prototype.getCheckedFromOption = function (opt) {
        var control = this.getControlFromOption(opt);
        var checked = !_.isUndefined(control);
        return checked;
    };
    SelectionFieldComponent.prototype.modifies = function (opt, event, defered) {
        var _this = this;
        this.confirmChanges = true;
        var fieldName = this.field['name'];
        var fields = this.fieldMap;
        this.defer['fields'] = new Array();
        _.each(opt['modifies'], function (e) {
            var contval = _this.fieldMap[e].control.value;
            //this.fieldMap[e].control.getRawValue();
            if (!_.isEmpty(contval) || contval === true) {
                jQuery("#modal_" + fieldName).modal({ backdrop: 'static', keyboard: false, show: true });
                _this.defer['opt'] = opt;
                _this.defer['event'] = event;
                _this.defer['fields'].push(_this.field.getFieldDisplay(_this.fieldMap[e]));
                _this.confirmChanges = false;
            }
        });
        if (this.confirmChanges) {
            this.defer = {};
            this.onChange(opt, event, true);
        }
    };
    SelectionFieldComponent.prototype.confirmChange = function (doConfirm) {
        var fieldName = this.field['name'];
        jQuery("#modal_" + fieldName).modal('hide');
        this.confirmChanges = doConfirm;
        var defer = this.defer;
        if (this.isRadio()) {
            // modifies is not available for radio
            defer.event.target.checked = doConfirm;
            if (!doConfirm) {
                var revert = this.defer['opt']['revert'];
                this.field.setValue(revert);
                defer.opt = _.find(this.field.options.options, { value: revert });
            }
        }
        else {
            defer.event.target.checked = !doConfirm;
        }
        this.defer = {};
        this.onChange(defer.opt, defer.event, true);
    };
    SelectionFieldComponent.prototype.onChange = function (opt, event, defered) {
        defered = defered || !_.isUndefined(defered);
        var formcontrol = this.getFormControl();
        if (event.target.checked) {
            if (_.isObject(formcontrol.push)) {
                formcontrol.push(new forms_1.FormControl(opt.value));
            }
            else if (this.isRadio()) {
                // modifies defers the changes on radio
                if (opt['modifies'] && !defered) {
                    this.modifies(opt, event, defered);
                }
                else {
                    defered = true;
                }
            }
        }
        else {
            if (opt['modifies'] && !defered) {
                this.modifies(opt, event, defered);
            }
            if (!defered) {
                var idx_1 = null;
                _.forEach(formcontrol.controls, function (ctrl, i) {
                    if (ctrl.value == opt.value) {
                        idx_1 = i;
                        return false;
                    }
                });
                formcontrol.removeAt(idx_1);
            }
        }
        if (this.field.publish && this.confirmChanges) {
            if (this.field.publish.onItemSelect) {
                this.field.onItemSelect.emit({ value: opt['publishTag'], checked: event.target.checked, defered: defered });
            }
            if (this.field.publish.onValueUpdate) {
                this.field.onValueUpdate.emit({ value: opt['publishTag'], checked: event.target.checked, defered: defered });
            }
        }
    };
    SelectionFieldComponent.clName = 'SelectionFieldComponent';
    SelectionFieldComponent = __decorate([
        core_1.Component({
            selector: 'selectionfield',
            template: "\n  <div [formGroup]='form' *ngIf=\"field.editMode && field.visible\" class=\"form-group\">\n     <span class=\"label-font\">\n      {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n      <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n     </span><br/>\n     <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\"></span>\n     <fieldset>\n      <legend [hidden]=\"true\"><span></span></legend>\n        <span *ngFor=\"let opt of field.selectOptions\">\n          <!-- radio type hard-coded otherwise accessor directive will not work! -->\n          <input *ngIf=\"isRadio()\" type=\"radio\" name=\"{{field.name}}\" [id]=\"field.name + '_' + opt.value\" [formControl]=\"getFormControl()\" [value]=\"opt.value\" [attr.disabled]=\"field.readOnly ? '' : null \" (change)=\"onChange(opt, $event)\" [attr.checked]=\"getControlFromOption(opt)\">\n          <input *ngIf=\"!isRadio()\" type=\"{{field.controlType}}\" name=\"{{field.name}}\" [id]=\"field.name + '_' + opt.value\" [value]=\"opt.value\" (change)=\"onChange(opt, $event)\" [attr.selected]=\"getCheckedFromOption(opt)\" [checked]=\"getCheckedFromOption(opt)\" [attr.disabled]=\"field.readOnly ? '' : null \">\n          <label for=\"{{field.name + '_' + opt.value}}\" class=\"radio-label\"  [innerHtml]=\"opt.label\"></label>\n          <br/>\n        </span>\n     </fieldset>\n     <div class=\"text-danger\" *ngIf=\"hasRequiredError() && !field.validationMessages?.required\">{{field.label}} is required</div>\n     <div class=\"text-danger\" *ngIf=\"hasRequiredError() && field.validationMessages?.required\">{{field.validationMessages.required}}</div>\n  </div>\n  <div *ngIf=\"!field.editMode && field.visible\" class=\"key-value-pair\">\n    <ng-container *ngIf=\"isRadio()\">\n      <span *ngIf=\"field.label\" [innerHtml]=\"field.label\" class=\"key\"></span>\n      <span class=\"value\" [innerHtml]=\"getLabel(field.value)\"></span>\n    </ng-container>\n    <ng-container *ngIf=\"!isRadio()\">\n      <span *ngIf=\"field.label\" [innerHtml]=\"field.label\" class=\"key\"></span>\n      <span class=\"value\" *ngIf=\"!isValArray()\" [innerHtml]=\"getLabel(field.value)\"></span>\n      <ng-container *ngIf=\"isValArray()\">\n        <div class=\"value\" *ngFor=\"let val of field.value\" [innerHtml]=\"getLabel(val)\">\n        </div>\n      </ng-container>\n    </ng-container>\n\n  </div>\n  <div class=\"modal fade\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"selectionComponent\" aria-hidden=\"true\" id=\"{{ 'modal_' + field.name }}\">\n    <div class=\"modal-dialog modal-lg\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h4 class=\"modal-title\">{{field.confirmChangesLabel}}</h4>\n          <p>{{field.confirmChangesParagraphLabel}}</p>\n          <p *ngFor=\"let f of defer.fields\">\n            <strong>{{f.label}}</strong><br/>\n            {{f.valueLabel}}\n          </p>\n        </div>\n        <div class=\"modal-footer\">\n          <button type=\"button\" class=\"btn btn-default\" (click)=\"confirmChange(true)\">Yes</button>\n          <button type=\"button\" class=\"btn btn-primary\" (click)=\"confirmChange(false)\">No</button>\n        </div>\n      </div>\n    </div>\n  </div>\n  ",
        })
    ], SelectionFieldComponent);
    return SelectionFieldComponent;
}(SelectionComponent));
exports.SelectionFieldComponent = SelectionFieldComponent;
/****************************************************************************
Container components
*****************************************************************************/
var TabOrAccordionContainerComponent = /** @class */ (function (_super) {
    __extends(TabOrAccordionContainerComponent, _super);
    function TabOrAccordionContainerComponent(changeRef) {
        var _this = _super.call(this) || this;
        _this.changeRef = changeRef;
        return _this;
    }
    TabOrAccordionContainerComponent.prototype.ngAfterViewInit = function () {
        var _this = this;
        var that = this;
        setTimeout(function () {
            _.each(_this.field.fields, function (tab) {
                tab['expandedChar'] = '+';
                jQuery("#" + tab.id).on('shown.bs.collapse', function () {
                    tab["expandedChar"] = '-';
                    that.changeRef.detectChanges();
                    that.field.onAccordionCollapseExpand.emit({ shown: true, tabId: tab.id });
                });
                jQuery("#" + tab.id).on('hidden.bs.collapse', function () {
                    tab["expandedChar"] = '+';
                    that.changeRef.detectChanges();
                    that.field.onAccordionCollapseExpand.emit({ shown: false, tabId: tab.id });
                });
            });
        });
        if (!this.field.editMode && this.field.expandAccordionsOnOpen) {
            this.field.allExpanded = false;
            this.expandCollapseAll();
        }
    };
    TabOrAccordionContainerComponent.prototype.expandCollapseAll = function () {
        if (this.field.allExpanded) {
            _.each(this.field.fields, function (tab) {
                jQuery("#" + tab.id).collapse('hide');
            });
            this.field.allExpanded = false;
        }
        else {
            _.each(this.field.fields, function (tab) {
                jQuery("#" + tab.id).collapse('show');
            });
            this.field.allExpanded = true;
        }
        return false;
    };
    TabOrAccordionContainerComponent = __decorate([
        core_1.Component({
            selector: 'tabcontainer',
            template: "\n  <div *ngIf=\"field.editMode\" class=\"row\" style=\"min-height:300px;\">\n    <div [ngClass]=\"field.cssClasses\">\n      <div [ngClass]=\"field.tabNavContainerClass\">\n        <ul [ngClass]=\"field.tabNavClass\">\n          <li *ngFor=\"let tab of field.fields\" [ngClass]=\"{'active': tab.active}\"><a href=\"#{{tab.id}}\" data-toggle=\"tab\" role=\"tab\">{{tab.label}}</a></li>\n        </ul>\n      </div>\n      <div [ngClass]=\"field.tabContentContainerClass\">\n        <div [ngClass]=\"field.tabContentClass\">\n      <!--\n      Inlined the tab definition instead of creating it's own component otherwise Bootstrap refuses to toggle the panes\n      Likely because of the extra DOM node (component selector) that it doesn't know what to do.\n      TODO: remove inlining, or perhaps consider a 3rd-party NG2 tab component\n      -->\n        <ng-container *ngFor=\"let tab of field.fields\" >\n          <div *ngIf=\"tab.visible\" [ngClass]=\"{'tab-pane': true, 'fade': true, 'active': tab.active==true, 'in': tab.active==true}\" id=\"{{tab.id}}\">\n            <dmp-field *ngFor=\"let field of tab.fields\" [field]=\"field\" [form]=\"form\" class=\"form-row\" [fieldMap]=\"fieldMap\" [parentId]=\"tab.id\"></dmp-field>\n          </div>\n        </ng-container>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div *ngIf=\"!field.editMode\" [ngClass]=\"field.accContainerClass\">\n    <div class=\"panel-group\">\n      <a href=\"#\" class=\"main-expand-collapse\" (click)=\"expandCollapseAll(); false\">Expand/Collapse all</a>\n      <div *ngFor=\"let tab of field.fields\" [ngClass]=\"field.accClass\">\n        <ng-container *ngIf=\"tab.visible\">\n          <div class=\"panel-heading\">\n            <span class=\"panel-title tab-header-font\">\n              <a data-toggle=\"collapse\" href=\"#{{tab.id}}\">\n                {{ tab.expandedChar }} {{ tab.label }}\n              </a>\n            </span>\n          </div>\n          <div id=\"{{tab.id}}\" class=\"panel-collapse collapse\">\n            <div class=\"panel-body\">\n              <ul class=\"key-value-list\">\n                <dmp-field *ngFor=\"let field of tab.fields\" [field]=\"field\" [form]=\"form\" class=\"form-row\" [fieldMap]=\"fieldMap\"></dmp-field>\n              </ul>\n            </div>\n          </div>\n        </ng-container>\n      </div>\n    </div>\n  </div>\n  "
        }),
        __metadata("design:paramtypes", [core_1.ChangeDetectorRef])
    ], TabOrAccordionContainerComponent);
    return TabOrAccordionContainerComponent;
}(SimpleComponent));
exports.TabOrAccordionContainerComponent = TabOrAccordionContainerComponent;
var ButtonBarContainerComponent = /** @class */ (function (_super) {
    __extends(ButtonBarContainerComponent, _super);
    function ButtonBarContainerComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ButtonBarContainerComponent = __decorate([
        core_1.Component({
            selector: 'buttonbarcontainer',
            template: "\n    <div *ngIf=\"field.editMode\" class=\"form-row\">\n      <div class=\"pull-right col-md-10\">\n      <dmp-field *ngFor=\"let field1 of field.fields\" [field]=\"field1\" [form]=\"form\" class=\"form-row\" [fieldMap]=\"fieldMap\"></dmp-field>\n    </div>\n  "
        })
    ], ButtonBarContainerComponent);
    return ButtonBarContainerComponent;
}(SimpleComponent));
exports.ButtonBarContainerComponent = ButtonBarContainerComponent;
// Break in case of an emergency....
var HtmlRawComponent = /** @class */ (function (_super) {
    __extends(HtmlRawComponent, _super);
    function HtmlRawComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    HtmlRawComponent = __decorate([
        core_1.Component({
            selector: 'htmlraw',
            template: "\n  <span *ngIf=\"field.visible\" [innerHtml]=\"field.value\" [ngClass]=\"field.cssClasses\"></span>\n  ",
        })
    ], HtmlRawComponent);
    return HtmlRawComponent;
}(SimpleComponent));
exports.HtmlRawComponent = HtmlRawComponent;
// For creating text blocks with help sections?
var TextBlockComponent = /** @class */ (function (_super) {
    __extends(TextBlockComponent, _super);
    function TextBlockComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    TextBlockComponent.clName = 'TextBlockComponent';
    TextBlockComponent = __decorate([
        core_1.Component({
            selector: 'text-block',
            template: "\n  <div *ngIf=\"field.visible\" [ngSwitch]=\"field.type\">\n    <span *ngSwitchCase=\"'h1'\" [ngClass]=\"field.cssClasses\">{{field.value == null? '' : field.value}}</span>\n    <span *ngSwitchCase=\"'h2'\" [ngClass]=\"field.cssClasses\">{{field.value == null? '' : field.value}}</span>\n    <span *ngSwitchCase=\"'h3'\" [ngClass]=\"field.cssClasses\">{{field.value == null? '' : field.value}}</span>\n    <span *ngSwitchCase=\"'h4'\" [ngClass]=\"field.cssClasses\">{{field.value == null? '' : field.value}}</span>\n    <span *ngSwitchCase=\"'h5'\" [ngClass]=\"field.cssClasses\">{{field.value == null? '' : field.value}}</span>\n    <span *ngSwitchCase=\"'h6'\" [ngClass]=\"field.cssClasses\">{{field.value == null? '' : field.value}}</span>\n    <hr *ngSwitchCase=\"'hr'\" [ngClass]=\"field.cssClasses\">\n    <span *ngSwitchCase=\"'span'\" [ngClass]=\"field.cssClasses\">{{field.value == null? '' : field.value}}</span>\n    <p *ngSwitchDefault [ngClass]=\"field.cssClasses\" [innerHtml]=\"field.value == null? '' : field.value\"></p>\n    <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.editMode && field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n  </div>\n  <div class=\"row\" *ngIf=\"field.editMode && this.helpShow\">\n      <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"col-xs-12 help-block\" [innerHtml]=\"field.help\"></span>\n  </div>\n  ",
        })
    ], TextBlockComponent);
    return TextBlockComponent;
}(SimpleComponent));
exports.TextBlockComponent = TextBlockComponent;
/**
* #### Save Button Component.
*
* Calls the form framework's save function to create or update the record.
*
* #### Usage
* ```
*     {
*          class: "SaveButton",
*          definition: {
*            label: 'Save & Close',
*            closeOnSave: true,
*            redirectLocation: '/@branding/@portal/dashboard'
*          }
*        }
* ```
*
*| Property Name       | Description                                                    | Required | Default |
*|---------------------|----------------------------------------------------------------|----------|---------|
*| label               | The text to display on the button                              | Yes      |         |
*| closeOnSave         | Flag to leave the page on successful save                      | No       | false   |
*| redirectLocation    | The location to redirect to if closeOnSave flag is set to true | No       |         |
*/
var SaveButtonComponent = /** @class */ (function (_super) {
    __extends(SaveButtonComponent, _super);
    function SaveButtonComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    SaveButtonComponent.prototype.onClick = function (event) {
        if (this.field.confirmationMessage) {
            this.showConfirmDlg();
            return;
        }
        this.doAction();
    };
    SaveButtonComponent.prototype.showConfirmDlg = function () {
        jQuery("#" + this.field.name + "_confirmation").modal('show');
    };
    SaveButtonComponent.prototype.hideConfirmDlg = function () {
        jQuery("#" + this.field.name + "_confirmation").modal('hide');
    };
    SaveButtonComponent.prototype.doAction = function () {
        var _this = this;
        var successObs = null;
        if (this.field.isDelete) {
            successObs = this.fieldMap._rootComp.delete();
        }
        else {
            successObs = this.field.targetStep ?
                this.fieldMap._rootComp.onSubmit(this.field.targetStep, false, this.field.additionalData)
                : this.fieldMap._rootComp.onSubmit(null, false, this.field.additionalData);
        }
        successObs.subscribe(function (status) {
            if (status) {
                if (_this.field.closeOnSave == true) {
                    window.location.href = _this.field.redirectLocation;
                }
            }
            if (_this.field.confirmationMessage) {
                _this.hideConfirmDlg();
            }
        });
    };
    SaveButtonComponent = __decorate([
        core_1.Component({
            selector: 'save-button',
            template: "\n    <button type=\"button\" (click)=\"onClick($event)\" class=\"btn\" [ngClass]=\"field.cssClasses\" [disabled]=\"(!fieldMap._rootComp.needsSave || fieldMap._rootComp.isSaving()) && !field.isSubmissionButton\">{{field.label}}</button>\n    <div *ngIf=\"field.confirmationMessage\" class=\"modal fade\" id=\"{{ field.name }}_confirmation\" tabindex=\"-1\" role=\"dialog\" >\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header\">\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n            <h4 class=\"modal-title\" id=\"{{ field.name }}_confirmation_label\" [innerHtml]=\"field.confirmationTitle\"></h4>\n          </div>\n          <div class=\"modal-body\" [innerHtml]=\"field.confirmationMessage\"></div>\n          <div class=\"modal-footer\">\n            <button (click)=\"hideConfirmDlg()\" type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\" [innerHtml]=\"field.cancelButtonMessage\"></button>\n            <button (click)=\"doAction()\" type=\"button\" class=\"btn btn-primary\" [innerHtml]=\"field.confirmButtonMessage\"></button>\n          </div>\n        </div>\n      </div>\n    </div>\n  ",
        })
    ], SaveButtonComponent);
    return SaveButtonComponent;
}(SimpleComponent));
exports.SaveButtonComponent = SaveButtonComponent;
/**
* # Cancel Button Component
*
* #### Button designed to
*  @param  {CancelButton} cancelButton
*   @return {FormControl}
*/
var CancelButtonComponent = /** @class */ (function (_super) {
    __extends(CancelButtonComponent, _super);
    function CancelButtonComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CancelButtonComponent.prototype.showConfirmDlg = function () {
        jQuery("#" + this.field.name + "_confirmation").modal('show');
    };
    CancelButtonComponent.prototype.hideConfirmDlg = function () {
        jQuery("#" + this.field.name + "_confirmation").modal('hide');
    };
    CancelButtonComponent.prototype.cancel = function () {
        if (this.field.confirmationMessage != null && this.fieldMap._rootComp.needsSave) {
            this.showConfirmDlg();
        }
        else {
            this.doAction();
        }
    };
    CancelButtonComponent.prototype.doAction = function () {
        this.fieldMap._rootComp.onCancel();
    };
    CancelButtonComponent = __decorate([
        core_1.Component({
            selector: 'cancel-button',
            template: "\n    <button type=\"button\" class=\"btn btn-warning\" [disabled]=\"fieldMap._rootComp.isSaving()\" (click)=\"cancel()\">{{field.label}}</button>\n    <div *ngIf=\"field.confirmationMessage\" class=\"modal fade\" id=\"{{ field.name }}_confirmation\" tabindex=\"-1\" role=\"dialog\" >\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header\">\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\n            <h4 class=\"modal-title\" id=\"{{ field.name }}_confirmation_label\" [innerHtml]=\"field.confirmationTitle\"></h4>\n          </div>\n          <div class=\"modal-body\" [innerHtml]=\"field.confirmationMessage\"></div>\n          <div class=\"modal-footer\">\n            <button (click)=\"hideConfirmDlg()\" type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\" [innerHtml]=\"field.cancelButtonMessage\"></button>\n            <button (click)=\"doAction()\" type=\"button\" class=\"btn btn-primary\" [innerHtml]=\"field.confirmButtonMessage\"></button>\n          </div>\n        </div>\n      </div>\n    </div>\n  ",
        })
    ], CancelButtonComponent);
    return CancelButtonComponent;
}(SimpleComponent));
exports.CancelButtonComponent = CancelButtonComponent;
var AnchorOrButtonComponent = /** @class */ (function (_super) {
    __extends(AnchorOrButtonComponent, _super);
    function AnchorOrButtonComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    AnchorOrButtonComponent.prototype.onClick = function (event) {
        this.fieldMap._rootComp[this.field.onClick_RootFn]();
    };
    AnchorOrButtonComponent.prototype.isDisabled = function () {
        if (this.field.isDisabledFn) {
            return this.fieldMap._rootComp[this.field.isDisabledFn]();
        }
        return false;
    };
    AnchorOrButtonComponent = __decorate([
        core_1.Component({
            selector: 'anchor-button',
            template: "\n  <button *ngIf=\"field.controlType=='button'\" type=\"{{field.type}}\" [ngClass]=\"field.cssClasses\" (click)=\"onClick($event)\" [disabled]=\"isDisabled()\">{{field.label}}</button>\n  <a *ngIf=\"field.controlType=='anchor'\" href='{{field.value}}' [ngClass]=\"field.cssClasses\" ><span *ngIf=\"field.showPencil\" class=\"glyphicon glyphicon-pencil\">&nbsp;</span>{{field.label}}</a>\n  <a *ngIf=\"field.controlType=='htmlAnchor'\" href='{{field.value}}' [ngClass]=\"field.cssClasses\" [innerHtml]=\"field.anchorHtml\"></a>\n  ",
        })
    ], AnchorOrButtonComponent);
    return AnchorOrButtonComponent;
}(SimpleComponent));
exports.AnchorOrButtonComponent = AnchorOrButtonComponent;
var TabNavButtonComponent = /** @class */ (function (_super) {
    __extends(TabNavButtonComponent, _super);
    function TabNavButtonComponent(changeRef) {
        var _this = _super.call(this) || this;
        _this.changeRef = changeRef;
        return _this;
    }
    TabNavButtonComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.field.getTabs();
        jQuery('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            var tabId = e.target.href.split('#')[1];
            _this.field.currentTab = tabId;
            _this.changeRef.detectChanges();
        });
    };
    TabNavButtonComponent.prototype.ngAfterViewInit = function () {
        var focusTabId = this.getUrlParameter('focusTabId');
        if (!_.isEmpty(focusTabId)) {
            this.fieldMap._rootComp.gotoTab(focusTabId);
        }
    };
    TabNavButtonComponent.prototype.stepToTab = function (step) {
        var tabId = this.field.getTabId(step);
        if (tabId) {
            this.fieldMap._rootComp.gotoTab(tabId);
        }
        else {
            console.log("Invalid tab: " + tabId);
        }
    };
    TabNavButtonComponent.prototype.getUrlParameter = function (param) {
        var pageURL = decodeURIComponent(window.location.search.substring(1)), urlVariables = pageURL.split('&'), parameterName, i;
        for (i = 0; i < urlVariables.length; i++) {
            parameterName = urlVariables[i].split('=');
            if (parameterName[0] === param) {
                return parameterName[1] === undefined ? null : parameterName[1];
            }
        }
    };
    TabNavButtonComponent = __decorate([
        core_1.Component({
            selector: 'tab-nav-button',
            template: "\n    <span *ngIf=\"field.endDisplayMode == 'disabled'\">\n    <button type='button'[ngClass]='field.cssClasses' [disabled]=\"!field.getTabId(-1)\" (click)=\"stepToTab(-1)\" >{{field.prevLabel}}</button>\n    <button type='button'[ngClass]='field.cssClasses' [disabled]=\"!field.getTabId(1)\" (click)=\"stepToTab(1)\" >{{field.nextLabel}}</button>\n    </span>\n    <span *ngIf=\"field.endDisplayMode == 'hidden'\">\n    <button type='button'[ngClass]='field.cssClasses' [style.display]=\"!field.getTabId(-1)?'none':'inherit'\" (click)=\"stepToTab(-1)\" >{{field.prevLabel}}</button>\n    <button type='button'[ngClass]='field.cssClasses' [style.display]=\"!field.getTabId(1)?'none':'inherit'\" (click)=\"stepToTab(1)\" >{{field.nextLabel}}</button>\n    </span>\n  ",
        }),
        __metadata("design:paramtypes", [core_1.ChangeDetectorRef])
    ], TabNavButtonComponent);
    return TabNavButtonComponent;
}(SimpleComponent));
exports.TabNavButtonComponent = TabNavButtonComponent;
var LinkValueComponent = /** @class */ (function (_super) {
    __extends(LinkValueComponent, _super);
    function LinkValueComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LinkValueComponent.prototype.isVisible = function () {
        return !_.isEmpty(this.field.value);
    };
    LinkValueComponent = __decorate([
        core_1.Component({
            selector: 'link-value',
            template: "\n  <li *ngIf=\"isVisible()\" class=\"key-value-pair padding-bottom-10\">\n    <span class=\"key\" *ngIf=\"field.label\">{{field.label}}</span>\n    <span class=\"value\"><a href='{{field.value}}' target=\"field.target\">{{field.value}}</a></span>\n  </li>\n  ",
        })
    ], LinkValueComponent);
    return LinkValueComponent;
}(SimpleComponent));
exports.LinkValueComponent = LinkValueComponent;
var HiddenValueComponent = /** @class */ (function (_super) {
    __extends(HiddenValueComponent, _super);
    function HiddenValueComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    HiddenValueComponent.prototype.handleChange = function (value, source) {
        var _this = this;
        console.log("Hidden Value change: " + source);
        console.log(value);
        var targetVal = null;
        if (_.isArray(value)) {
            targetVal = [];
            _.forEach(value, function (v) {
                var tVal = '';
                _.forEach(_this.field.onChange.control.subFields, function (subField) {
                    tVal = "" + (_.isEmpty(tVal) ? tVal : "" + tVal + _this.field.onChange.control.delim) + v[subField];
                });
                targetVal.push(tVal);
            });
        }
        this.getFormControl().setValue(targetVal, this.field.onChange.updateConf);
        console.log("Form now has value:");
        console.log(this.form.value);
    };
    HiddenValueComponent = __decorate([
        core_1.Component({
            selector: 'hidden-field',
            template: "\n  <div [formGroup]='form'>\n    <input type=\"hidden\" name=\"{{field.name}}\" [formControl]=\"getFormControl()\" />\n  </div>\n  ",
        })
    ], HiddenValueComponent);
    return HiddenValueComponent;
}(SimpleComponent));
exports.HiddenValueComponent = HiddenValueComponent;
/**
Wrapped: https://github.com/nkalinov/ng2-datetime
Based on: https://bootstrap-datepicker.readthedocs.io/en/stable/
*/
var DateTimeComponent = /** @class */ (function (_super) {
    __extends(DateTimeComponent, _super);
    function DateTimeComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    DateTimeComponent.prototype.ngAfterViewInit = function () {
        if (this.field.editMode) {
            jQuery("#" + this.dateTime.idDatePicker).attr('aria-label', this.field.label);
        }
    };
    /**
     * Component method that formats the value, delegates to field.
     */
    DateTimeComponent.prototype.formatValue = function () {
        return this.field.formatValue(this.getFormControl().value);
    };
    __decorate([
        core_1.ViewChild('dateTime'),
        __metadata("design:type", Object)
    ], DateTimeComponent.prototype, "dateTime", void 0);
    DateTimeComponent = __decorate([
        core_1.Component({
            selector: 'date-time',
            template: "\n  <div *ngIf=\"field.editMode\" [formGroup]='form' class=\"form-group\">\n    <span class=\"label-font\">\n      {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n      <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n    </span><br/>\n    <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\"></span>\n    <datetime #dateTime [formControl]=\"getFormControl()\" [timepicker]=\"field.timePickerOpts\" [datepicker]=\"field.datePickerOpts\" [hasClearButton]=\"field.hasClearButton\"></datetime>\n    <div *ngIf=\"field.required\" [style.visibility]=\"getFormControl() && getFormControl().hasError('required') && getFormControl().touched ? 'inherit':'hidden'\">\n      <div class=\"text-danger\" *ngIf=\"!field.validationMessages?.required\">{{field.label}} is required</div>\n      <div class=\"text-danger\" *ngIf=\"field.validationMessages?.required\">{{field.validationMessages.required}}</div>\n    </div>\n  </div>\n  <li *ngIf=\"!field.editMode\" class=\"key-value-pair\">\n    <span class=\"key\" *ngIf=\"field.label\">{{field.label}}</span>\n    <span class=\"value\">{{field.formatValueForDisplay()}}</span>\n  </li>\n  "
        })
    ], DateTimeComponent);
    return DateTimeComponent;
}(SimpleComponent));
exports.DateTimeComponent = DateTimeComponent;
var ParameterRetrieverComponent = /** @class */ (function (_super) {
    __extends(ParameterRetrieverComponent, _super);
    function ParameterRetrieverComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ParameterRetrieverComponent.prototype.ngAfterViewInit = function () {
        var paramValue = this.getUrlParameter(this.field.parameterName);
        if (paramValue) {
            this.field.publishParameterValue(paramValue);
        }
    };
    ParameterRetrieverComponent.prototype.getUrlParameter = function (param) {
        var pageURL = decodeURIComponent(window.location.search.substring(1)), urlVariables = pageURL.split('&'), parameterName, i;
        for (i = 0; i < urlVariables.length; i++) {
            parameterName = urlVariables[i].split('=');
            if (parameterName[0] === param) {
                return parameterName[1] === undefined ? true : parameterName[1];
            }
        }
    };
    ParameterRetrieverComponent = __decorate([
        core_1.Component({
            selector: 'parameter-retriever',
            template: "\n  <div>\n\n  </div>\n  ",
        })
    ], ParameterRetrieverComponent);
    return ParameterRetrieverComponent;
}(SimpleComponent));
exports.ParameterRetrieverComponent = ParameterRetrieverComponent;
var SpacerComponent = /** @class */ (function (_super) {
    __extends(SpacerComponent, _super);
    function SpacerComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    SpacerComponent = __decorate([
        core_1.Component({
            selector: 'spacer',
            template: "\n  <span [style.display]=\"'inline-block'\" [style.width]=\"field.width\" [style.height]=\"field.height\">&nbsp;</span>\n  ",
        })
    ], SpacerComponent);
    return SpacerComponent;
}(SimpleComponent));
exports.SpacerComponent = SpacerComponent;
var ToggleComponent = /** @class */ (function (_super) {
    __extends(ToggleComponent, _super);
    function ToggleComponent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.defer = {};
        _this.confirmChanges = true;
        return _this;
    }
    ToggleComponent.prototype.onChange = function (opt, event, defered) {
        var _this = this;
        defered = defered || !_.isUndefined(defered);
        console.log("ToggleComponent, onChanged Checked: " + event.target.checked);
        if (opt['modifies'] && !defered) {
            var fieldName_1 = this.field['name'];
            var fields = this.fieldMap;
            this.defer['fields'] = new Array();
            opt['modifies'].some(function (e) {
                var contval = _this.fieldMap[e].control.value;
                //this.fieldMap[e].control.getRawValue();
                if (!_.isEmpty(contval) || contval === true) {
                    jQuery("#modal_" + fieldName_1).modal({ backdrop: 'static', keyboard: false, show: true });
                    _this.defer['opt'] = opt;
                    _this.defer['event'] = event;
                    _this.defer['fields'].push(_this.field.getFieldDisplay(_this.fieldMap[e]));
                    _this.confirmChanges = false;
                }
            });
        }
        if (this.field.publish && this.confirmChanges) {
            setTimeout(function () {
                _this.field.onItemSelect.emit({ value: opt['publishTag'], checked: event.target.checked });
            });
        }
    };
    ToggleComponent.prototype.confirmChange = function (doConfirm) {
        var fieldName = this.field['name'];
        jQuery("#modal_" + fieldName).modal('hide');
        this.confirmChanges = doConfirm;
        var defer = this.defer;
        this.defer = {};
        defer.event.target.checked = !doConfirm;
        this.onChange(defer.opt, defer.event, true);
    };
    ToggleComponent = __decorate([
        core_1.Component({
            selector: 'toggle',
            template: "\n    <div *ngIf=\"field.type == 'checkbox' && field.visible\" [formGroup]='form'>\n      <input type=\"checkbox\" [checked]=\"field.value\" name=\"{{field.name}}\" [id]=\"field.name\" [formControl]=\"getFormControl()\" [attr.disabled]=\"field.editMode ? null : ''\" (change)=\"onChange(field.options, $event)\">\n      <label for=\"{{ field.name }}\" class=\"radio-label\">{{ field.label }} <button *ngIf=\"field.editMode && field.help\" type=\"button\" class=\"btn btn-default\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button></label>\n      <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\"></span>\n    </div>\n    <div class=\"modal fade\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"toggleComponent\" aria-hidden=\"true\" id=\"{{ 'modal_' + field.name }}\">\n      <div class=\"modal-dialog modal-lg\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header\">\n            <h4 class=\"modal-title\">{{ field.confirmChangesLabel }}</h4>\n            <p>{{ field.confirmChangesParagraphLabel }}</p>\n            <p *ngFor=\"let f of defer.fields\">\n              <strong>{{f.label}}</strong><br/>\n              {{f.valueLabel}}\n            </p>\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-default\" (click)=\"confirmChange(true)\">Yes</button>\n            <button type=\"button\" class=\"btn btn-primary\" (click)=\"confirmChange(false)\">No</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  "
        })
    ], ToggleComponent);
    return ToggleComponent;
}(SimpleComponent));
exports.ToggleComponent = ToggleComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-simple.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var moment = __webpack_require__("./node_modules/moment/moment.js");
var NotInFormField = /** @class */ (function (_super) {
    __extends(NotInFormField, _super);
    function NotInFormField(options, injector) {
        return _super.call(this, options, injector) || this;
    }
    NotInFormField.prototype.createFormModel = function (valueElem) {
        if (valueElem === void 0) { valueElem = null; }
    };
    NotInFormField.prototype.getGroup = function (group, fieldMap) {
        this.fieldMap = fieldMap;
        _.set(fieldMap, this.getFullFieldName() + ".field", this);
    };
    NotInFormField.prototype.reactEvent = function (eventName, eventData, origData) {
    };
    return NotInFormField;
}(field_base_1.FieldBase));
exports.NotInFormField = NotInFormField;
var SelectionField = /** @class */ (function (_super) {
    __extends(SelectionField, _super);
    function SelectionField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.selectOptions = [];
        _this.storeValueAndLabel = false;
        _this.onItemSelect = new core_1.EventEmitter();
        // this.options = options['options'] || [];
        if (options.selectFor && options.defaultSelect) {
            var newOptions = _.defaultTo(_.find(options['options'], function (f) { return f.key === options.selectFor; }), _.find(options['options'], function (f) { return f.key === options.defaultSelect; }));
            options['options'] = newOptions.value;
        }
        _this.selectOptions = _.map(options['options'] || [], function (option) {
            option['label'] = _this.getTranslated(option['label'], option['label']);
            option['value'] = _this.getTranslated(option['value'], option['value']);
            return option;
        });
        if (options['storeValueAndLabel']) {
            _this.storeValueAndLabel = true;
            if (options['value'] == undefined) {
                var emptyOptions = _.find(_this.selectOptions, function (selectOption) {
                    return selectOption.value == "";
                });
                if (emptyOptions != null) {
                    _this.value = emptyOptions;
                }
            }
        }
        return _this;
    }
    SelectionField.prototype.createFormModel = function () {
        var _this = this;
        if (this.controlType == 'checkbox') {
            var fgDef_1 = [];
            _.map(this.selectOptions, function (opt) {
                var hasValue = _.find(_this.value, function (val) {
                    return val == opt.value;
                });
                if (hasValue) {
                    fgDef_1.push(new forms_1.FormControl(opt.value));
                }
            });
            // const fg = new FormArray(fgDef);
            // return fg;
            return new forms_1.FormArray(fgDef_1);
        }
        else {
            // const model = super.createFormModel();
            // console.log(`Created form model:`);
            // console.log(model);
            // return model;
            return _super.prototype.createFormModel.call(this);
        }
    };
    SelectionField.prototype.nextOption = function () {
        var _this = this;
        if (this.controlType == 'radio') {
            var nextIdx_1 = 0;
            var opt = _.find(this.selectOptions, function (opt, idx) {
                var match = opt.value == _this.value;
                if (match) {
                    nextIdx_1 = ++idx;
                }
                return match;
            });
            if (nextIdx_1 >= this.selectOptions.length) {
                nextIdx_1 = 0;
            }
            var value = this.selectOptions[nextIdx_1].value;
            this.setValue(value);
        }
        return this.value;
    };
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], SelectionField.prototype, "onItemSelect", void 0);
    return SelectionField;
}(field_base_1.FieldBase));
exports.SelectionField = SelectionField;
var Container = /** @class */ (function (_super) {
    __extends(Container, _super);
    function Container(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.controlType = 'div';
        _this.content = options['content'] || '';
        _this.active = options['active'] || false;
        _this.type = options['type'] || '';
        _this.isGroup = true;
        _this.hasControl = _.isUndefined(_this.groupName);
        if (_.isEmpty(_this.cssClasses) && _.startsWith(_this.type, 'h')) {
            _this.cssClasses = [_this.type + "-header"];
        }
        return _this;
    }
    Container.prototype.getGroup = function (group, fieldMap) {
        this.fieldMap = fieldMap;
        _.set(fieldMap, this.getFullFieldName() + ".field", this);
        group[this.name] = this.required ? new forms_1.FormGroup({}, forms_1.Validators.required) : new forms_1.FormGroup({});
        _.each(this.fields, function (field) {
            field.getGroup(group, fieldMap);
        });
        return group[this.name];
    };
    Container.prototype.createFormModel = function (valueElem) {
        var _this = this;
        if (valueElem === void 0) { valueElem = null; }
        var grp = {};
        _.each(this.fields, function (field) {
            var fldVal = null;
            if (_this.value) {
                fldVal = _.get(_this.value, field.name);
            }
            field.value = fldVal;
            grp[field.name] = field.createFormModel(fldVal);
        });
        this.formModel = this.required ? new forms_1.FormGroup(grp, forms_1.Validators.required) : new forms_1.FormGroup(grp);
        return this.formModel;
    };
    Container.prototype.setValue = function (value, emitEvent) {
        var _this = this;
        if (emitEvent === void 0) { emitEvent = true; }
        this.value = value;
        _.forOwn(value, function (val, key) {
            var fld = _.find(_this.fields, function (fldItem) {
                return fldItem.name == key;
            });
            fld.setValue(val, emitEvent);
        });
        // this.formModel.setValue(value, { onlySelf: true, emitEvent: emitEvent });
    };
    return Container;
}(field_base_1.FieldBase));
exports.Container = Container;
var TabOrAccordionContainer = /** @class */ (function (_super) {
    __extends(TabOrAccordionContainer, _super);
    function TabOrAccordionContainer(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.onTabChange = new core_1.EventEmitter();
        _this.onAccordionCollapseExpand = new core_1.EventEmitter();
        _this.expandAccordionsOnOpen = false;
        _this.allExpanded = false;
        // defaults to nav-pills, nav-stacked, nav size col-md-2, tab content col-md-10
        _this.tabNavContainerClass = options['tabNavContainerClass'] || 'col-md-2';
        _this.tabNavClass = options['tabNavClass'] || 'nav nav-pills nav-stacked';
        _this.tabContentContainerClass = options['tabContentContainerClass'] || 'col-md-10';
        _this.tabContentClass = options['tabContentClass'] || 'tab-content';
        _this.accContainerClass = options['accContainerClass'] || 'col-md-12';
        _this.accClass = options['accClass'] || 'panel panel-default';
        _this.expandAccordionsOnOpen = options['expandAccordionsOnOpen'] || false;
        return _this;
    }
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], TabOrAccordionContainer.prototype, "onTabChange", void 0);
    return TabOrAccordionContainer;
}(Container));
exports.TabOrAccordionContainer = TabOrAccordionContainer;
var ButtonBarContainer = /** @class */ (function (_super) {
    __extends(ButtonBarContainer, _super);
    function ButtonBarContainer(options, injector) {
        return _super.call(this, options, injector) || this;
    }
    return ButtonBarContainer;
}(Container));
exports.ButtonBarContainer = ButtonBarContainer;
var DateTime = /** @class */ (function (_super) {
    __extends(DateTime, _super);
    function DateTime(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.datePickerOpts = options['datePickerOpts'] || false;
        _this.timePickerOpts = options['timePickerOpts'] || false;
        _this.hasClearButton = options['hasClearButton'] || false;
        _this.valueFormat = options['valueFormat'] || 'YYYY-MM-DD';
        _this.displayFormat = options['displayFormat'] || 'YYYY-MM-DD';
        _this.controlType = 'datetime';
        _this.value = _this.value ? _this.parseToDate(_this.value) : _this.value;
        _this.adjustStartRange = !_.isUndefined(options['adjustStartRange']) ? options['adjustStartRange'] : false;
        return _this;
    }
    DateTime.prototype.setValue = function (value) {
        this.value = value;
        this.formModel.patchValue(value, { emitEvent: true, emitModelToViewChange: true });
        this.formModel.markAsTouched();
    };
    DateTime.prototype.formatValue = function (value) {
        // assume local date
        console.log("Formatting value: " + value);
        return value ? moment(value).local().format(this.valueFormat) : value;
    };
    DateTime.prototype.parseToDate = function (value) {
        return moment(value, this.valueFormat).local().toDate();
    };
    DateTime.prototype.formatValueForDisplay = function () {
        var locale = window.navigator.language; // commented out, no support for below IE 11: window.navigator.userLanguage || window.navigator.language;
        return this.value ? moment(this.value).locale(locale).format(this.displayFormat) : '';
    };
    DateTime.prototype.reactEvent = function (eventName, eventData, origData) {
        if (this.adjustStartRange) {
            var thisDate = moment(eventData);
            var prevStartDate = moment(this.formModel.value);
            if (!prevStartDate.isValid() || thisDate.isAfter(prevStartDate)) {
                this.formModel.setValue(eventData);
            }
            var newOpts = _.cloneDeep(this.datePickerOpts);
            newOpts.startDate = eventData;
            this.datePickerOpts = newOpts;
        }
        else {
            var value = this.parseToDate(eventData);
            this.setValue(value);
        }
    };
    return DateTime;
}(field_base_1.FieldBase));
exports.DateTime = DateTime;
var SaveButton = /** @class */ (function (_super) {
    __extends(SaveButton, _super);
    function SaveButton(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.label = _this.getTranslated(options['label'], 'Save');
        _this.closeOnSave = options['closeOnSave'] || false;
        _this.redirectLocation = options['redirectLocation'] || false;
        _this.cssClasses = options['cssClasses'] || "btn-primary";
        _this.targetStep = options['targetStep'] || null;
        _this.additionalData = options['additionalData'] || null;
        _this.confirmationMessage = options['confirmationMessage'] ? _this.getTranslated(options['confirmationMessage'], null) : null;
        _this.confirmationTitle = options['confirmationTitle'] ? _this.getTranslated(options['confirmationTitle'], null) : null;
        _this.cancelButtonMessage = options['cancelButtonMessage'] ? _this.getTranslated(options['cancelButtonMessage'], null) : null;
        _this.confirmButtonMessage = options['confirmButtonMessage'] ? _this.getTranslated(options['confirmButtonMessage'], null) : null;
        _this.isDelete = options['isDelete'];
        _this.isSubmissionButton = options['isSubmissionButton'] || false; // defaults to it is, unless specifically set, for backwards compat
        return _this;
    }
    return SaveButton;
}(NotInFormField));
exports.SaveButton = SaveButton;
var CancelButton = /** @class */ (function (_super) {
    __extends(CancelButton, _super);
    function CancelButton(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.label = _this.getTranslated(options['label'], 'Cancel');
        _this.confirmationMessage = options['confirmationMessage'] ? _this.getTranslated(options['confirmationMessage'], null) : null;
        _this.confirmationTitle = options['confirmationTitle'] ? _this.getTranslated(options['confirmationTitle'], null) : null;
        _this.cancelButtonMessage = options['cancelButtonMessage'] ? _this.getTranslated(options['cancelButtonMessage'], null) : null;
        _this.confirmButtonMessage = options['confirmButtonMessage'] ? _this.getTranslated(options['confirmButtonMessage'], null) : null;
        return _this;
    }
    return CancelButton;
}(field_base_1.FieldBase));
exports.CancelButton = CancelButton;
var TabNavButton = /** @class */ (function (_super) {
    __extends(TabNavButton, _super);
    function TabNavButton(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.tabs = [];
        _this.prevLabel = _this.getTranslated(options.prevLabel, 'Previous');
        _this.nextLabel = _this.getTranslated(options.nextLabel, 'Next');
        _this.targetTabContainerId = options.targetTabContainerId;
        _this.endDisplayMode = options.endDisplayMode == 'hidden' ? 'hidden' : 'disabled';
        return _this;
    }
    TabNavButton.prototype.getTabs = function () {
        var _this = this;
        var targetContainerTab = this.getTargetTab(this.fieldMap._rootComp.formDef.fields);
        if (targetContainerTab) {
            _.each(targetContainerTab.definition.fields, function (tab) {
                _this.tabs.push(tab.definition.id);
            });
            this.currentTab = this.tabs[0];
        }
        else {
            console.log("Target Container Tab not found: " + this.targetTabContainerId);
        }
    };
    TabNavButton.prototype.getTargetTab = function (fields) {
        var _this = this;
        var targetTab = _.find(fields, function (f) {
            if (f.definition && f.definition.id == _this.targetTabContainerId) {
                return true;
            }
            if (f.definition && f.definition.fields) {
                return _this.getTargetTab(f.definition.fields);
            }
        });
        return targetTab;
    };
    TabNavButton.prototype.getCurrentTabIdx = function () {
        var _this = this;
        return _.findIndex(this.tabs, function (curTab) { return curTab == _this.currentTab; });
    };
    TabNavButton.prototype.getTabId = function (step) {
        var curTabIdx = this.getCurrentTabIdx();
        var tabIdx = curTabIdx + step;
        if (tabIdx >= 0 && tabIdx < this.tabs.length) {
            return this.tabs[tabIdx];
        }
        return null;
    };
    return TabNavButton;
}(field_base_1.FieldBase));
exports.TabNavButton = TabNavButton;
var AnchorOrButton = /** @class */ (function (_super) {
    __extends(AnchorOrButton, _super);
    function AnchorOrButton(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.onClick_RootFn = options['onClick_RootFn'] || null;
        _this.isDisabledFn = options['isDisabledFn'] || null;
        _this.type = options['type'] || 'button';
        _this.controlType = options['controlType'] || 'button';
        _this.hasControl = false;
        _this.showPencil = options['showPencil'] || false;
        _this.anchorHtml = options['anchorHtml'] || '';
        return _this;
    }
    return AnchorOrButton;
}(field_base_1.FieldBase));
exports.AnchorOrButton = AnchorOrButton;
var HiddenValue = /** @class */ (function (_super) {
    __extends(HiddenValue, _super);
    function HiddenValue(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.controlType = 'hidden';
        return _this;
    }
    return HiddenValue;
}(field_base_1.FieldBase));
exports.HiddenValue = HiddenValue;
var LinkValue = /** @class */ (function (_super) {
    __extends(LinkValue, _super);
    function LinkValue(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.controlType = 'link';
        _this.target = options.target || '_blank';
        return _this;
    }
    return LinkValue;
}(field_base_1.FieldBase));
exports.LinkValue = LinkValue;
var ParameterRetrieverField = /** @class */ (function (_super) {
    __extends(ParameterRetrieverField, _super);
    function ParameterRetrieverField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.parameterName = options.parameterName || '';
        return _this;
    }
    ParameterRetrieverField.prototype.publishParameterValue = function (value) {
        this.onValueUpdate.emit(value);
    };
    return ParameterRetrieverField;
}(field_base_1.FieldBase));
exports.ParameterRetrieverField = ParameterRetrieverField;
var Spacer = /** @class */ (function (_super) {
    __extends(Spacer, _super);
    function Spacer(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.width = options.width;
        _this.height = options.height;
        return _this;
    }
    return Spacer;
}(NotInFormField));
exports.Spacer = Spacer;
var Toggle = /** @class */ (function (_super) {
    __extends(Toggle, _super);
    function Toggle(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.onItemSelect = new core_1.EventEmitter();
        _this.type = options['type'] || 'checkbox';
        _this.value = _this.setToggle();
        return _this;
    }
    Toggle.prototype.setToggle = function () {
        if (_.isUndefined(this.options['value'])) {
            if (this.options.valueCheck && this.options['checkedWhen'] && this.editMode) {
                return this.options.valueCheck === this.options['checkedWhen'];
            }
            else {
                return false;
            }
        }
        {
            return this.options['value'];
        }
    };
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], Toggle.prototype, "onItemSelect", void 0);
    return Toggle;
}(field_base_1.FieldBase));
exports.Toggle = Toggle;
var HtmlRaw = /** @class */ (function (_super) {
    __extends(HtmlRaw, _super);
    function HtmlRaw() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    HtmlRaw.prototype.getGroup = function (group, fieldMap) {
        _super.prototype.getGroup.call(this, group, fieldMap);
        this.value = this.replaceValWithConfig(this.value);
    };
    return HtmlRaw;
}(NotInFormField));
exports.HtmlRaw = HtmlRaw;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-textfield.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var field_repeatable_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-repeatable.component.ts");
/**
 * Text Field Model
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>

 */
var TextField = /** @class */ (function (_super) {
    __extends(TextField, _super);
    function TextField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.type = options['type'] || '';
        _this.controlType = 'textbox';
        _this.cssClasses = _.isEmpty(_this.cssClasses) ? 'form-control' : _this.cssClasses;
        // default value from: https://www.w3schools.com/tags/att_input_maxlength.asp
        _this.maxLength = _.isUndefined(options['maxLength']) ? 524288 : options['maxLength'];
        return _this;
    }
    TextField.prototype.postInit = function (value) {
        if (_.isEmpty(value)) {
            this.value = this.defaultValue ? this.defaultValue : '';
        }
        else {
            this.value = value;
        }
    };
    return TextField;
}(field_base_1.FieldBase));
exports.TextField = TextField;
var MarkdownTextArea = /** @class */ (function (_super) {
    __extends(MarkdownTextArea, _super);
    function MarkdownTextArea(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.rows = options['rows'] || 5;
        _this.cols = options['cols'] || null;
        _this.controlType = 'textarea';
        if (_.isUndefined(_this.value)) {
            _this.value = "";
        }
        _this.cssClasses = _.isEmpty(_this.cssClasses) ? 'form-control' : _this.cssClasses;
        return _this;
    }
    MarkdownTextArea.prototype.formatValueForDisplay = function () {
        this.lines = this.value ? this.value.split("\n") : [];
    };
    return MarkdownTextArea;
}(field_base_1.FieldBase));
exports.MarkdownTextArea = MarkdownTextArea;
var TextArea = /** @class */ (function (_super) {
    __extends(TextArea, _super);
    function TextArea(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.rows = options['rows'] || 5;
        _this.cols = options['cols'] || null;
        _this.controlType = 'textarea';
        _this.cssClasses = _.isEmpty(_this.cssClasses) ? 'form-control' : _this.cssClasses;
        return _this;
    }
    TextArea.prototype.formatValueForDisplay = function () {
        this.lines = this.value ? this.value.split("\n") : [];
    };
    return TextArea;
}(field_base_1.FieldBase));
exports.TextArea = TextArea;
var TextFieldComponent = /** @class */ (function (_super) {
    __extends(TextFieldComponent, _super);
    function TextFieldComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    TextFieldComponent = __decorate([
        core_1.Component({
            selector: 'textfield',
            template: "\n  <div *ngIf=\"field.editMode && field.visible\" [ngClass]=\"getGroupClass()\">\n    <div *ngIf=\"!isEmbedded\" >\n      <label [attr.for]=\"field.name\">\n        {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n        <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n      </label>\n        <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\"></span>\n      <input [formGroup]='form' [formControl]=\"getFormControl()\"  [id]=\"field.name\" [type]=\"field.type\" [readonly]=\"field.readOnly\" [ngClass]=\"field.cssClasses\" [attr.aria-label]=\"''\" [attr.maxlength]=\"field.maxLength\" >\n    </div>\n    <div *ngIf=\"isEmbedded\" class=\"input-group padding-bottom-15\">\n      <input [formControl]=\"getFormControl(name, index)\"  [id]=\"field.name\" [type]=\"field.type\" [readonly]=\"field.readOnly\" [ngClass]=\"field.cssClasses\" [attr.aria-labelledby]=\"name\" [attr.maxlength]=\"field.maxLength\">\n      <span class=\"input-group-btn\">\n        <button type='button' *ngIf=\"removeBtnText\" [disabled]=\"!canRemove\" (click)=\"onRemove($event)\" [ngClass]=\"removeBtnClass\" >{{removeBtnText}}</button>\n        <button [disabled]=\"!canRemove\" type='button' [ngClass]=\"removeBtnClass\" (click)=\"onRemove($event)\" [attr.aria-label]=\"'remove-button-label' | translate\"></button>\n      </span>\n    </div>\n    <div *ngIf=\"field.required && (field.label || (field.validationMessages && field.validationMessages.required))\" [style.visibility]=\"getFormControl() && getFormControl().hasError('required') && getFormControl().touched ? 'inherit':'hidden'\">\n      <div class=\"text-danger\" *ngIf=\"!field.validationMessages?.required\">{{field.label}} is required</div>\n      <div class=\"text-danger\" *ngIf=\"field.validationMessages?.required\">{{field.validationMessages.required}}</div>\n    </div>\n  </div>\n  <div *ngIf=\"!field.editMode && field.visible\" class=\"key-value-pair\">\n    <span class=\"key\" *ngIf=\"field.label\">{{field.label}}</span>\n    <span class=\"value\">{{field.value}}</span>\n  </div>\n  ",
        })
    ], TextFieldComponent);
    return TextFieldComponent;
}(field_repeatable_component_1.EmbeddableComponent));
exports.TextFieldComponent = TextFieldComponent;
var RepeatableTextfieldComponent = /** @class */ (function (_super) {
    __extends(RepeatableTextfieldComponent, _super);
    function RepeatableTextfieldComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    RepeatableTextfieldComponent.prototype.ngOnInit = function () {
    };
    RepeatableTextfieldComponent.prototype.addElem = function (event) {
        var newElem = this.field.addElem();
    };
    RepeatableTextfieldComponent.prototype.removeElem = function (event, i) {
        this.field.removeElem(i);
    };
    RepeatableTextfieldComponent.clName = 'RepeatableTextfieldComponent';
    RepeatableTextfieldComponent = __decorate([
        core_1.Component({
            selector: 'repeatable-textfield',
            template: "\n  <div *ngIf=\"field.editMode\">\n    <div class=\"row\">\n      <div class=\"col-xs-12\">\n      <span class=\"label-font\" [id]=\"field.name\">\n        {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n        <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n      </span>\n      <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\"></span>\n      </div>\n    </div>\n    <div *ngFor=\"let fieldElem of field.fields; let i = index;\" class=\"row\">\n      <span class=\"col-xs-12\">\n        <textfield [name]=\"field.name\" [field]=\"fieldElem\" [form]=\"form\" [fieldMap]=\"fieldMap\" [isEmbedded]=\"true\" [removeBtnText]=\"field.removeButtonText\" [removeBtnClass]=\"field.removeButtonClass\" [canRemove]=\"field.fields.length > 1\" (onRemoveBtnClick)=\"removeElem($event[0], $event[1])\" [index]=\"i\"></textfield>\n      </span>\n    </div>\n    <div class=\"row\">\n      <div class=\"col-xs-12\" *ngIf=\"field.required && !field.delegateErrorHandling && (field.label || (field.validationMessages && field.validationMessages.required))\" [style.visibility]=\"getFormControl() && hasRequiredError() && getFormControl().touched ? 'inherit':'hidden'\">\n        <div class=\"text-danger\" *ngIf=\"!field.validationMessages?.required\">{{field.label}} is required</div>\n        <div class=\"text-danger\" *ngIf=\"field.validationMessages?.required\">{{field.validationMessages.required}}</div>\n      </div>\n    </div>\n    <div class=\"row\">\n      <span class=\"col-xs-12\">\n        <button *ngIf=\"field.addButtonText\" type='button' (click)=\"addElem($event)\" [ngClass]=\"field.addButtonTextClass\" >{{field.addButtonText}}</button>\n        <button *ngIf=\"!field.addButtonText\" type='button' (click)=\"addElem($event)\" [ngClass]=\"field.addButtonClass\" [attr.aria-label]=\"'add-button-label' | translate\"></button>\n      </span>\n    </div>\n  </div>\n  <li *ngIf=\"!field.editMode\" class=\"key-value-pair\">\n    <span *ngIf=\"field.label\" class=\"key\">{{field.label}}</span>\n    <span class=\"value\">\n      <ul class=\"key-value-list\">\n        <textfield *ngFor=\"let fieldElem of field.fields; let i = index;\"  [field]=\"fieldElem\" [form]=\"form\" [fieldMap]=\"fieldMap\"></textfield>\n      </ul>\n    </span>\n  </li>\n  ",
        })
    ], RepeatableTextfieldComponent);
    return RepeatableTextfieldComponent;
}(field_repeatable_component_1.RepeatableComponent));
exports.RepeatableTextfieldComponent = RepeatableTextfieldComponent;
/**
 * Component
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 */
var TextAreaComponent = /** @class */ (function (_super) {
    __extends(TextAreaComponent, _super);
    function TextAreaComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    TextAreaComponent.prototype.ngOnInit = function () {
        if (!this.field.editMode) {
            this.field.formatValueForDisplay();
        }
    };
    TextAreaComponent = __decorate([
        core_1.Component({
            selector: 'text-area',
            template: "\n  <div *ngIf=\"field.editMode && field.visible\" [formGroup]='form' [ngClass]=\"getGroupClass()\">\n    <label [attr.for]=\"field.name\">\n      {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n      <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n    </label>\n    <!-- Normal version -->\n    <ng-container *ngIf=\"!field.isEmbedded\">\n      <ng-container *ngIf=\"this.helpShow\">\n        <br/>\n        <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" [innerHtml]=\"field.help\"></span>\n      </ng-container>\n      <textarea [formControl]=\"getFormControl()\"  [attr.rows]=\"field.rows\" [attr.cols]=\"field.cols\" [id]=\"field.name\" [ngClass]=\"field.cssClasses\" >{{field.value}}</textarea>\n    </ng-container>\n    <!-- Embedded version -->\n    <div *ngIf=\"isEmbedded\" class=\"input-group padding-bottom-15\">\n      <textarea [formControl]=\"getFormControl(name, index)\"  [attr.rows]=\"field.rows\" [attr.cols]=\"field.cols\" [id]=\"field.name\" [ngClass]=\"field.cssClasses\">{{field.value}}</textarea>\n    </div>\n    <!-- Validation messages -->\n    <div *ngIf=\"field.required\" [style.visibility]=\"getFormControl() && getFormControl().hasError('required') && getFormControl().touched ? 'inherit':'hidden'\">\n      <div class=\"text-danger\" *ngIf=\"getFormControl().hasError('required') && getFormControl().touched && !field.validationMessages?.required\">{{field.label}} is required</div>\n      <div class=\"text-danger\" *ngIf=\"getFormControl().hasError('required') && getFormControl().touched && field.validationMessages?.required\">{{field.validationMessages.required}}</div>\n    </div>\n  </div>\n  <li *ngIf=\"!field.editMode && field.visible\" class=\"key-value-pair\">\n    <span class=\"key\" *ngIf=\"field.label\">{{field.label}}</span>\n    <span *ngFor=\"let line of field.lines\">\n      {{line}}\n      <br/>\n    </span>\n\n  </li>\n  "
        })
    ], TextAreaComponent);
    return TextAreaComponent;
}(field_repeatable_component_1.EmbeddableComponent));
exports.TextAreaComponent = TextAreaComponent;
var MarkdownTextAreaComponent = /** @class */ (function (_super) {
    __extends(MarkdownTextAreaComponent, _super);
    function MarkdownTextAreaComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    MarkdownTextAreaComponent.prototype.ngOnInit = function () {
        if (!this.field.editMode) {
            this.field.formatValueForDisplay();
        }
    };
    MarkdownTextAreaComponent = __decorate([
        core_1.Component({
            selector: 'markdown-text-area',
            template: "\n  <div *ngIf=\"field.editMode\" [formGroup]='form' class=\"form-group\">\n    <label [attr.for]=\"field.name\">\n      {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n      <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n    </label><br/>\n    <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\"></span>\n    <textarea [formControl]=\"getFormControl()\"  [attr.rows]=\"field.rows\" [attr.cols]=\"field.cols\" [id]=\"field.name\" [ngClass]=\"field.cssClasses\" [(ngModel)]=\"field.value\"></textarea>\n    <div *ngIf=\"field.value\" style='font-weight:bold'>Preview</div>\n    <markdown *ngIf=\"field.value\" [data]=\"field.value\"></markdown>\n    <div class=\"text-danger\" *ngIf=\"getFormControl().hasError('required') && getFormControl().touched && !field.validationMessages?.required\">{{field.label}} is required</div>\n    <div class=\"text-danger\" *ngIf=\"getFormControl().hasError('required') && getFormControl().touched && field.validationMessages?.required\">{{field.validationMessages.required}}</div>\n  </div>\n  <li *ngIf=\"!field.editMode\" class=\"key-value-pair\">\n    <span class=\"key\" *ngIf=\"field.label\">{{field.label}}</span>\n    <markdown *ngIf=\"field.value\" [data]=\"field.value\"></markdown>\n    <br/>\n  </li>\n  "
        })
    ], MarkdownTextAreaComponent);
    return MarkdownTextAreaComponent;
}(field_repeatable_component_1.EmbeddableComponent));
exports.MarkdownTextAreaComponent = MarkdownTextAreaComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/field-vocab.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var rxjs_1 = __webpack_require__("./node_modules/rxjs/Rx.js");
var Subject_1 = __webpack_require__("./node_modules/rxjs/_esm5/Subject.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/toPromise.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/observable/of.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/map.js");
var http_1 = __webpack_require__("./node_modules/@angular/http/esm5/http.js");
var base_service_1 = __webpack_require__("./redbox-portal/angular/shared/base-service.ts");
var config_service_1 = __webpack_require__("./redbox-portal/angular/shared/config-service.ts");
var luceneEscapeQuery = __webpack_require__("./node_modules/lucene-escape-query/index.js");
/**
 * Vocabulary Field
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 *
 */
var VocabField = /** @class */ (function (_super) {
    __extends(VocabField, _super);
    function VocabField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.onItemSelect = new core_1.EventEmitter();
        _this.clName = 'VocabField';
        _this.hasLookup = true;
        _this.vocabId = options['vocabId'] || '';
        _this.controlType = 'textbox';
        _this.titleFieldName = options['titleFieldName'] || 'title';
        _this.titleFieldArr = options['titleFieldArr'] || [];
        _this.searchFields = options['searchFields'] || '';
        _this.titleFieldDelim = options['titleFieldDelim'] || ' - ';
        _this.titleCompleterDescription = options['titleCompleterDescription'] || '';
        _this.fieldNames = options['fieldNames'] || [];
        _this.sourceType = options['sourceType'] || 'vocab';
        _this.placeHolder = options['placeHolder'] || 'Select a valid value';
        _this.disableEditAfterSelect = options['disableEditAfterSelect'] == undefined ? true : options['disableEditAfterSelect'];
        _this.stringLabelToField = options['stringLabelToField'] ? options['stringLabelToField'] : 'dc_title';
        _this.restrictToSelection = _.isUndefined(options['restrictToSelection']) ? false : options['restrictToSelection'];
        _this.storeLabelOnly = options['storeLabelOnly'] ? options['storeLabelOnly'] : false;
        _this.provider = options['provider'] ? options['provider'] : '';
        _this.resultArrayProperty = options['resultArrayProperty'] ? options['resultArrayProperty'] : '';
        _this.unflattenFlag = _.isUndefined(options['unflattenFlag']) ? false : options['unflattenFlag'];
        _this.dontEmitEventOnLoad = _.isUndefined(options['dontEmitEventOnLoad']) ? false : options['dontEmitEventOnLoad'];
        _this.groupClasses = _.isUndefined(options['groupClasses']) ? '' : options['groupClasses'];
        _this.cssClasses = _.isUndefined(options['cssClasses']) ? '' : options['cssClasses'];
        return _this;
    }
    VocabField.prototype.createFormModel = function (valueElem, createFormGroup) {
        var _this = this;
        if (valueElem === void 0) { valueElem = undefined; }
        if (createFormGroup === void 0) { createFormGroup = false; }
        if (valueElem) {
            this.value = valueElem;
        }
        if (createFormGroup) {
            var flds_1 = {};
            _.forEach(this.fieldNames, function (fld) {
                _.forOwn(fld, function (srcFld, targetFld) {
                    flds_1[targetFld] = new forms_1.FormControl(_this.value[targetFld] || '');
                });
            });
            this.formModel = new forms_1.FormGroup(flds_1);
        }
        else {
            this.formModel = new forms_1.FormControl(this.value || '');
        }
        if (this.value) {
            if (!_.isString(this.value)) {
                var init = _.cloneDeep(this.value);
                init.title = this.getTitle(this.value);
                this.initialValue = init;
            }
            else {
                var init = {};
                init['title'] = this.value;
                init[this.stringLabelToField] = this.value;
                this.initialValue = init;
            }
        }
        if (this.required) {
            this.formModel.setValidators([forms_1.Validators.required]);
        }
        return this.formModel;
    };
    VocabField.prototype.postInit = function (value) {
        if (value) {
            this.value = value;
        }
        else {
            this.setEmptyValue();
        }
        this.initLookupData();
    };
    VocabField.prototype.setEmptyValue = function (updateTitle) {
        if (updateTitle === void 0) { updateTitle = false; }
        this.value = null;
        if (this.formModel) {
            this.formModel.setValue(null, { emitEvent: true });
        }
        if (updateTitle && this.component && this.component.ngCompleter) {
            this.component.ngCompleter.ctrInput.nativeElement.value = null;
        }
        return this.value;
    };
    VocabField.prototype.setLookupServices = function (completerService, lookupService) {
        this.completerService = completerService;
        this.lookupService = lookupService;
    };
    VocabField.prototype.initLookupData = function () {
        var _this = this;
        if (this.sourceType == "vocab") {
            // Hack for creating the intended title...
            _.forEach(this.sourceData, function (data) {
                data.title = _this.getTitle(data);
            });
            this.dataService = this.completerService.local(this.sourceData, this.searchFields, 'title');
        }
        else if (this.sourceType == "collection" || this.sourceType == "user") {
            var url = this.lookupService.getCollectionRootUrl(this.vocabId);
            if (this.sourceType == "user") {
                url = this.lookupService.getUserLookupUrl();
            }
            console.log("Using: " + url);
            // at the moment, multiple titles arrays are not supported
            // TODO: consider replacing with ngx-bootstrap typeahead
            var title = this.titleFieldArr.length == 1 ? this.titleFieldArr[0] : 'title';
            console.log("Using title: " + title);
            this.dataService = this.completerService.remote(url, this.searchFields, title);
        }
        else if (this.sourceType == "mint") {
            var url = this.lookupService.getMintRootUrl(this.vocabId);
            console.log("Using: " + url);
            this.dataService = new MintLookupDataService(url, this.lookupService.http, this.fieldNames, this.titleFieldName, this.titleFieldArr, this.titleFieldDelim, this.titleCompleterDescription, this.searchFields, this.unflattenFlag);
        }
        else if (this.sourceType == "external") {
            var url = this.lookupService.getExternalServiceUrl(this.provider);
            this.dataService = new ExternalLookupDataService(url, this.lookupService.http, this.resultArrayProperty, this.titleFieldName, this.titleFieldArr, this.titleFieldDelim);
        }
    };
    VocabField.prototype.getTitle = function (data) {
        var _this = this;
        var title = '';
        if (data) {
            if (_.isString(data)) {
                return data;
            }
            if (_.isString(this.titleFieldDelim)) {
                _.forEach(this.titleFieldArr, function (titleFld) {
                    var titleVal = data[titleFld];
                    if (titleVal) {
                        title = "" + title + (_.isEmpty(title) ? '' : _this.titleFieldDelim) + titleVal;
                    }
                });
            }
            else {
                // expecting a delim pair array, 'prefix', 'suffix'
                _.forEach(this.titleFieldArr, function (titleFld, idx) {
                    var delimPair = _this.titleFieldDelim[idx];
                    var titleVal = data[titleFld];
                    if (titleVal) {
                        title = "" + title + (_.isEmpty(title) ? '' : delimPair.prefix) + titleVal + (_.isEmpty(title) ? '' : delimPair.suffix);
                    }
                });
            }
        }
        return title;
    };
    VocabField.prototype.getValue = function (data) {
        var _this = this;
        var valObj = {};
        if (!_.isUndefined(data) && !_.isEmpty(data)) {
            if (_.isString(data)) {
                console.log("Data is string...");
                if (this.storeLabelOnly) {
                    return data;
                }
                else {
                    valObj[this.stringLabelToField] = data;
                }
                return valObj;
            }
            _.forEach(this.fieldNames, function (fldName) {
                if (data.originalObject) {
                    _this.getFieldValuePair(fldName, data.originalObject, valObj);
                }
                else {
                    _this.getFieldValuePair(fldName, data, valObj);
                }
            });
        }
        return valObj;
    };
    VocabField.prototype.getFieldValuePair = function (fldName, data, valObj) {
        if (_.isString(fldName)) {
            valObj[fldName] = _.get(data, fldName);
        }
        else {
            // expects a value pair
            _.forOwn(fldName, function (srcFld, targetFld) {
                if (_.get(data, srcFld)) {
                    valObj[targetFld] = _.get(data, srcFld);
                }
                else {
                    valObj[targetFld] = _.get(data, targetFld);
                }
            });
        }
    };
    VocabField.prototype.setValue = function (value, emitEvent, updateTitle) {
        if (emitEvent === void 0) { emitEvent = true; }
        if (updateTitle === void 0) { updateTitle = false; }
        this.formModel.setValue(value, { emitEvent: emitEvent });
        if (updateTitle) {
            this.component.ngCompleter.ctrInput.nativeElement.value = this.getTitle(value);
        }
    };
    VocabField.prototype.relationshipLookup = function (searchTerm, lowerTerm, searchFields) {
        var url = this.lookupService.getMintRootUrl(this.vocabId);
        console.log("Using: " + url);
        var mlu = new MintRelationshipLookup(url, this.lookupService.http, searchFields);
        return mlu.search(searchTerm, lowerTerm);
    };
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], VocabField.prototype, "onItemSelect", void 0);
    return VocabField;
}(field_base_1.FieldBase));
exports.VocabField = VocabField;
var ExternalLookupDataService = /** @class */ (function (_super) {
    __extends(ExternalLookupDataService, _super);
    function ExternalLookupDataService(url, http, arrayProperty, compositeTitleName, titleFieldArr, titleFieldDelim) {
        var _this = _super.call(this) || this;
        _this.url = url;
        _this.http = http;
        _this.arrayProperty = arrayProperty;
        _this.compositeTitleName = compositeTitleName;
        _this.titleFieldArr = titleFieldArr;
        _this.titleFieldDelim = titleFieldDelim;
        return _this;
    }
    ExternalLookupDataService.prototype.search = function (term) {
        var _this = this;
        this.http.post(this.url, { options: { query: term } }).map(function (res, index) {
            // Convert the result to CompleterItem[]
            var data = res.json();
            var itemArray = _.get(data, _this.arrayProperty);
            var matches = [];
            _.each(itemArray, function (item) {
                matches.push(_this.convertToItem(item));
            });
            _this.next(matches);
        }).subscribe();
    };
    ExternalLookupDataService.prototype.cancel = function () {
        // Handle cancel
    };
    ExternalLookupDataService.prototype.convertToItem = function (data) {
        if (!data) {
            return null;
        }
        var completerItem = {};
        completerItem[this.compositeTitleName] = this.getTitle(data);
        completerItem['originalObject'] = data;
        return completerItem;
    };
    ExternalLookupDataService.prototype.getTitle = function (data) {
        var _this = this;
        var title = '';
        if (data) {
            if (_.isString(this.titleFieldDelim)) {
                _.forEach(this.titleFieldArr, function (titleFld) {
                    var titleVal = _.get(data, titleFld);
                    if (titleVal) {
                        title = "" + title + (_.isEmpty(title) ? '' : _this.titleFieldDelim) + titleVal;
                    }
                });
            }
            else {
                // // expecting a delim pair array, 'prefix', 'suffix'
                // _.forEach(this.titleFieldArr, (titleFld: string, idx) => {
                //   const delimPair = this.titleFieldDelim[idx];
                //   const titleVal = data[titleFld];
                //   if (titleVal) {
                //     title = `${title} ${titleVal}`;
                //   }
                // });
            }
        }
        return title;
    };
    return ExternalLookupDataService;
}(Subject_1.Subject));
var MintLookupDataService = /** @class */ (function (_super) {
    __extends(MintLookupDataService, _super);
    function MintLookupDataService(url, http, fields, compositeTitleName, titleFieldArr, titleFieldDelim, titleCompleterDescription, searchFieldStr, unflattenFlag) {
        var _this = _super.call(this) || this;
        _this.url = url;
        _this.http = http;
        _this.fields = fields;
        _this.compositeTitleName = compositeTitleName;
        _this.titleFieldArr = titleFieldArr;
        _this.titleFieldDelim = titleFieldDelim;
        _this.titleCompleterDescription = titleCompleterDescription;
        _this.unflattenFlag = unflattenFlag;
        _this.searchFields = searchFieldStr.split(',');
        return _this;
    }
    MintLookupDataService.prototype.search = function (term) {
        var _this = this;
        term = _.trim(luceneEscapeQuery.escape(term));
        var searchString = '';
        if (!_.isEmpty(term)) {
            term = _.toLower(term);
            _.forEach(this.searchFields, function (searchFld) {
                searchString = "" + searchString + (_.isEmpty(searchString) ? '' : ' OR ') + searchFld + ":" + term + "*";
            });
        }
        var searchUrl = "" + this.url + searchString + "&unflatten=" + this.unflattenFlag;
        this.http.get("" + searchUrl).map(function (res, index) {
            // Convert the result to CompleterItem[]
            var data = res.json();
            var matches = _.map(data, function (mintDataItem) { return _this.convertToItem(mintDataItem); });
            _this.next(matches);
        }).subscribe();
    };
    MintLookupDataService.prototype.cancel = function () {
        // Handle cancel
    };
    MintLookupDataService.prototype.convertToItem = function (data) {
        if (!data) {
            return null;
        }
        var item = {};
        _.forEach(this.fields, function (fieldName) {
            if (_.isString(fieldName)) {
                item[fieldName] = data[fieldName];
            }
            else {
                // expects a value pair
                _.forOwn(fieldName, function (srcFld, targetFld) {
                    if (_.get(data, srcFld)) {
                        item[srcFld] = _.get(data, srcFld);
                    }
                    else {
                        item[targetFld] = _.get(data, targetFld);
                    }
                });
            }
        });
        // build the title,
        var completerItem = {};
        completerItem[this.compositeTitleName] = this.getTitle(data);
        completerItem['description'] = this.getCompleterDescription(data);
        completerItem['originalObject'] = item;
        return completerItem;
    };
    MintLookupDataService.prototype.getCompleterDescription = function (data) {
        var _this = this;
        var description = '';
        var fieldDesc = this.titleCompleterDescription;
        if (data) {
            if (_.isString(fieldDesc)) {
                var ele = data[fieldDesc];
                description = _.toString(_.head(ele)) || '';
            }
            else if (_.isArray(fieldDesc)) {
                // enable descriptions to be built as an array
                _.forEach(fieldDesc, function (fDesc) {
                    description = "" + description + (_.isEmpty(description) ? '' : _this.titleFieldDelim) + data[fDesc];
                });
            }
        }
        return description;
    };
    MintLookupDataService.prototype.getTitle = function (data) {
        var _this = this;
        var title = '';
        if (data) {
            if (_.isString(this.titleFieldDelim)) {
                _.forEach(this.titleFieldArr, function (titleFld) {
                    var titleVal = data[titleFld];
                    if (titleVal) {
                        title = "" + title + (_.isEmpty(title) ? '' : _this.titleFieldDelim) + data[titleFld];
                    }
                });
            }
            else {
                // expecting a delim pair array, 'prefix', 'suffix'
                _.forEach(this.titleFieldArr, function (titleFld, idx) {
                    var delimPair = _this.titleFieldDelim[idx];
                    var titleVal = data[titleFld];
                    if (titleVal) {
                        title = title + " " + titleVal + delimPair.suffix;
                    }
                });
            }
        }
        return title;
    };
    return MintLookupDataService;
}(Subject_1.Subject));
var VocabFieldLookupService = /** @class */ (function (_super) {
    __extends(VocabFieldLookupService, _super);
    function VocabFieldLookupService(http, configService) {
        var _this = _super.call(this, http, configService) || this;
        _this.configService = configService;
        return _this;
    }
    VocabFieldLookupService.prototype.getLookupData = function (field) {
        var _this = this;
        var vocabId = field.vocabId;
        // only retrieving static data when on vocab mode
        if (field.sourceType == "vocab") {
            var url = this.brandingAndPortalUrl + "/" + this.config.vocabRootUrl + "/" + vocabId;
            return this.http.get(url, this.options)
                .flatMap(function (res) {
                var data = _this.extractData(res);
                field.sourceData = data;
                field.postInit(field.value);
                return rxjs_1.Observable.of(field);
            });
        }
        field.postInit(field.value);
        return rxjs_1.Observable.of(field);
    };
    VocabFieldLookupService.prototype.getCollectionRootUrl = function (collectionId) {
        return this.brandingAndPortalUrl + "/" + this.config.collectionRootUri + "/" + collectionId + "/?search=";
    };
    VocabFieldLookupService.prototype.getUserLookupUrl = function (searchSource) {
        if (searchSource === void 0) { searchSource = ''; }
        return this.brandingAndPortalUrl + "/" + this.config.userRootUri + "/?source=" + searchSource + "&name=";
    };
    VocabFieldLookupService.prototype.findLookupData = function (field, search) {
    };
    VocabFieldLookupService.prototype.getMintRootUrl = function (source) {
        return this.brandingAndPortalUrl + "/" + this.config.mintRootUri + "/" + source + "/?search=";
    };
    VocabFieldLookupService.prototype.getExternalServiceUrl = function (provider) {
        return this.brandingAndPortalUrl + "/external/vocab/" + provider;
    };
    VocabFieldLookupService = __decorate([
        core_1.Injectable(),
        __param(0, core_1.Inject(http_1.Http)), __param(1, core_1.Inject(config_service_1.ConfigService)),
        __metadata("design:paramtypes", [http_1.Http, config_service_1.ConfigService])
    ], VocabFieldLookupService);
    return VocabFieldLookupService;
}(base_service_1.BaseService));
exports.VocabFieldLookupService = VocabFieldLookupService;
var VocabFieldComponent = /** @class */ (function (_super) {
    __extends(VocabFieldComponent, _super);
    function VocabFieldComponent() {
        var _this = _super.call(this) || this;
        _this.isEmbedded = false;
        _this.canRemove = false;
        _this.removeBtnText = null;
        _this.removeBtnClass = 'fa fa-minus-circle btn text-20 pull-right btn-danger';
        _this.disableEditAfterSelect = true;
        _this.onRemoveBtnClick = new core_1.EventEmitter();
        return _this;
    }
    VocabFieldComponent.prototype.ngOnInit = function () {
        this.field.component = this;
        if (_.isEmpty(this.field.value) || _.isNull(this.field.value) || _.isUndefined(this.field.value)) {
            this.loaded = true;
        }
    };
    VocabFieldComponent.prototype.getGroupClass = function (fldName) {
        if (fldName === void 0) { fldName = null; }
        if (this.isEmbedded) {
            return "col-xs-12 form-group " + (this.hasRequiredError() ? 'has-error' : '');
        }
        else {
            if (!_.isEmpty(this.field.groupClasses)) {
                return this.field.groupClasses;
            }
            return '';
        }
    };
    VocabFieldComponent.prototype.onSelect = function (selected, emitEvent, updateTitle) {
        if (emitEvent === void 0) { emitEvent = true; }
        if (updateTitle === void 0) { updateTitle = false; }
        console.log("On select:");
        console.log(selected);
        var disableEditAfterSelect = this.disableEditAfterSelect && this.field.disableEditAfterSelect;
        if (selected) {
            if (this.loaded) {
                this.field.onItemSelect.emit(selected['originalObject']);
            }
            else {
                if (this.field.dontEmitEventOnLoad) {
                    emitEvent = false;
                }
                // set the flag after initial call
                this.loaded = true;
            }
            if (this.field.storeLabelOnly) {
                this.field.setValue(this.field.getValue(selected.title), emitEvent, updateTitle);
            }
            else {
                this.field.setValue(this.field.getValue(selected['originalObject']), emitEvent, updateTitle);
            }
            if (disableEditAfterSelect)
                this.disableInput = true;
        }
        else {
            if (disableEditAfterSelect) {
                // means user can't edit, so no worries!
                this.field.setValue(null, emitEvent, updateTitle);
            }
            else {
                // set whatever value on the searchStr, let the fields decide how to parse the string...
                this.field.setValue(this.field.getValue(this.field.searchStr), emitEvent, updateTitle);
            }
        }
    };
    VocabFieldComponent.prototype.onKeyup = function (value) {
        var disableEditAfterSelect = this.disableEditAfterSelect && this.field.disableEditAfterSelect;
        if (!disableEditAfterSelect && !this.field.restrictToSelection) {
            this.field.formModel.setValue(this.field.getValue(this.field.searchStr));
        }
    };
    VocabFieldComponent.prototype.onRemove = function (event) {
        this.onRemoveBtnClick.emit([event, this.index]);
    };
    VocabFieldComponent.prototype.getTitle = function () {
        return this.field && _.isFunction(this.field.getTitle) ? this.field.getTitle(this.field.value) : '';
    };
    VocabFieldComponent.prototype.getClearUnselected = function () {
        if (this.field.restrictToSelection) {
            return true;
        }
        else {
            return this.disableEditAfterSelect && this.field.disableEditAfterSelect;
        }
    };
    __decorate([
        core_1.Input(),
        __metadata("design:type", VocabField)
    ], VocabFieldComponent.prototype, "field", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Boolean)
    ], VocabFieldComponent.prototype, "isEmbedded", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Boolean)
    ], VocabFieldComponent.prototype, "canRemove", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", String)
    ], VocabFieldComponent.prototype, "removeBtnText", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", String)
    ], VocabFieldComponent.prototype, "removeBtnClass", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Number)
    ], VocabFieldComponent.prototype, "index", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Boolean)
    ], VocabFieldComponent.prototype, "disableEditAfterSelect", void 0);
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], VocabFieldComponent.prototype, "onRemoveBtnClick", void 0);
    __decorate([
        core_1.ViewChild('ngCompleter'),
        __metadata("design:type", core_1.ElementRef)
    ], VocabFieldComponent.prototype, "ngCompleter", void 0);
    VocabFieldComponent = __decorate([
        core_1.Component({
            selector: 'rb-vocab',
            template: "\n  <div *ngIf=\"field.editMode && !isEmbedded\" [formGroup]='form' [ngClass]=\"getGroupClass()\">\n    <label [attr.for]=\"field.name\" *ngIf=\"field.label\">\n      {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n      <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n    </label>\n    <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\">{{field.help}}</span>\n    <ng2-completer #ngCompleter  (keyup)=\"onKeyup($event)\" [inputId]=\"field.name\" [(ngModel)]=\"field.searchStr\" [ngModelOptions]=\"{standalone: true}\" [disableInput]=\"disableInput\" [placeholder]=\"field.placeHolder\" [clearUnselected]=\"getClearUnselected()\" (selected)=\"onSelect($event)\" [datasource]=\"field.dataService\" [minSearchLength]=\"0\" [inputClass]=\"'form-control ' + field.cssClasses\" [initialValue]=\"field.initialValue\"></ng2-completer>\n    <div class=\"text-danger\" *ngIf=\"hasRequiredError()\">{{field.validationMessages.required}}</div>\n  </div>\n  <div *ngIf=\"field.editMode && isEmbedded\" [formGroup]='form' [ngClass]=\"getGroupClass()\">\n    <div class=\"row\">\n      <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\">{{field.help}}</span>\n      <div class=\"col-xs-11 padding-remove\">\n        <ng2-completer #ngCompleter  (keyup)=\"onKeyup($event)\" [inputId]=\"name\" [(ngModel)]=\"field.searchStr\" [ngModelOptions]=\"{standalone: true}\" [disableInput]=\"disableInput\" [placeholder]=\"field.placeHolder\" [clearUnselected]=\"getClearUnselected()\" (selected)=\"onSelect($event)\" [datasource]=\"field.dataService\" [minSearchLength]=\"0\" [inputClass]=\"'form-control '\" [initialValue]=\"field.initialValue\"></ng2-completer>\n      </div>\n      <div class=\"col-xs-1 padding-remove\">\n        <button type='button' *ngIf=\"removeBtnText\" [disabled]=\"!canRemove\" (click)=\"onRemove($event)\" [ngClass]=\"removeBtnClass\" >{{removeBtnText}}</button>\n        <button [disabled]=\"!canRemove\" type='button' [ngClass]=\"removeBtnClass\" (click)=\"onRemove($event)\" [attr.aria-label]=\"'remove-button-label' | translate\"></button>\n      </div>\n    </div>\n    <div class=\"row\">\n      <div class=\"col-xs-12 text-danger\" *ngIf=\"hasRequiredError()\">{{field.validationMessages.required}}</div>\n    </div>\n  </div>\n\n  <li *ngIf=\"!field.editMode\" class=\"key-value-pair\">\n    <span *ngIf=\"field.label\" class=\"key\">{{field.label}}</span>\n    <span class=\"value\">{{getTitle()}}</span>\n  </li>\n  ",
        }),
        __metadata("design:paramtypes", [])
    ], VocabFieldComponent);
    return VocabFieldComponent;
}(field_simple_component_1.SimpleComponent));
exports.VocabFieldComponent = VocabFieldComponent;
var MintRelationshipLookup = /** @class */ (function () {
    function MintRelationshipLookup(url, http, searchFieldStr) {
        this.url = url;
        this.http = http;
        this.searchFieldStr = searchFieldStr;
    }
    MintRelationshipLookup.prototype.search = function (term, lower) {
        term = _.trim(luceneEscapeQuery.escape(term));
        var searchString = '';
        if (!_.isEmpty(term)) {
            if (lower)
                term = _.toLower(term);
            if (_.isEmpty(this.searchFieldStr)) {
                searchString = term;
            }
            else {
                _.forEach(this.searchFieldStr.split(','), function (searchFld) {
                    searchString = "" + searchString + (_.isEmpty(searchString) ? '' : ' OR ') + searchFld + ":" + term;
                });
            }
        }
        var searchUrl = "" + this.url + searchString;
        return this.http.get("" + searchUrl);
    };
    return MintRelationshipLookup;
}());
exports.MintRelationshipLookup = MintRelationshipLookup;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/html-event.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_simple_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.ts");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
/**
 * Handles low-level event handling. Warning: for data changes, etc. please use the field-level subscribe-publish model.
 *
 * Currently it allows lose coupling which events enable it. If you don't specify a custom 'subscribe' configuration, it will begin listening when the form loads.
 *
 * Specify an 'eventName' to handle, any of the following: https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers-on-elements,-document-objects,-and-window-objects:event-beforeunload
 *
 * Has basic support for 'onbeforeload' event. Anything more complex than this will need to be wired via publish-subscribe pattern, for example when calling utility methods, service methods, form methods, etc.
 *
 * @author <a target='_' href='https://github.com/shilob'>Shilo Banihit</a>
 * @param  options
 * @param  injector
 */
var EventHandler = /** @class */ (function (_super) {
    __extends(EventHandler, _super);
    function EventHandler(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.eventName = options['eventName'];
        _this.eventSource = _.isUndefined(options['eventSource']) ? 'window' : options['eventSource'];
        return _this;
    }
    EventHandler.prototype.getGroup = function (group, fieldMap) {
        var _this = this;
        var retval = _super.prototype.getGroup.call(this, group, fieldMap);
        // by now, we've got the fieldMap and can begin to listen to the form events if 'subscribe' is unspecified
        if (_.isEmpty(this.options.subscribe)) {
            this.getEventEmitter('onFormLoaded', 'form').subscribe(function (oid) {
                _this.start();
            });
        }
        return retval;
    };
    EventHandler.prototype.start = function () {
        if (!this.listening) {
            this.listening = true;
            // sink our hooks into the event we're after...
            var that_1 = this;
            var defHandler = function (event) {
                if (that_1.eventName == 'beforeunload' && that_1.eventSource == 'window') {
                    that_1.fieldMap._rootComp.handleBeforeUnload(event);
                }
            };
            if (this.eventSource == 'window') {
                window.addEventListener(this.eventName, defHandler);
            }
            else {
                jQuery(this.eventSource).on(this.eventName, defHandler);
            }
        }
    };
    return EventHandler;
}(field_simple_1.NotInFormField));
exports.EventHandler = EventHandler;
var EventHandlerComponent = /** @class */ (function (_super) {
    __extends(EventHandlerComponent, _super);
    function EventHandlerComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    EventHandlerComponent = __decorate([
        core_1.Component({
            selector: 'event-handler',
            template: "\n  <!-- Event Handler placeholder. Nothing really to see here, move on. -->\n  ",
        })
    ], EventHandlerComponent);
    return EventHandlerComponent;
}(field_simple_component_1.SimpleComponent));
exports.EventHandlerComponent = EventHandlerComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/record-meta.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var records_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/records.service.ts");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var RecordMetadataRetrieverField = /** @class */ (function (_super) {
    __extends(RecordMetadataRetrieverField, _super);
    function RecordMetadataRetrieverField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.recordsService = _this.getFromInjector(records_service_1.RecordsService);
        _this.parameterName = options.parameterName || '';
        return _this;
    }
    RecordMetadataRetrieverField.prototype.publishMetadata = function (oid, config) {
        var _this = this;
        this.recordsService.getRecordMeta(oid).then(function (data) {
            data.oid = oid;
            _this.onValueUpdate.emit(data);
            _this.onValueLoaded.emit(data);
        });
    };
    return RecordMetadataRetrieverField;
}(field_base_1.FieldBase));
exports.RecordMetadataRetrieverField = RecordMetadataRetrieverField;
var RecordMetadataRetrieverComponent = /** @class */ (function (_super) {
    __extends(RecordMetadataRetrieverComponent, _super);
    function RecordMetadataRetrieverComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    RecordMetadataRetrieverComponent = __decorate([
        core_1.Component({
            selector: 'record-metadata-retriever',
            template: "\n  ",
        })
    ], RecordMetadataRetrieverComponent);
    return RecordMetadataRetrieverComponent;
}(field_simple_component_1.SimpleComponent));
exports.RecordMetadataRetrieverComponent = RecordMetadataRetrieverComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/records.service.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var base_service_1 = __webpack_require__("./redbox-portal/angular/shared/base-service.ts");
var http_1 = __webpack_require__("./node_modules/@angular/http/esm5/http.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/toPromise.js");
var field_control_meta_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-control-meta.service.ts");
var Observable_1 = __webpack_require__("./node_modules/rxjs/_esm5/Observable.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var config_service_1 = __webpack_require__("./redbox-portal/angular/shared/config-service.ts");
/**
 * Plan Client-side services
 *
 *
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 */
var RecordsService = /** @class */ (function (_super) {
    __extends(RecordsService, _super);
    function RecordsService(http, fcmetaService, configService, app) {
        var _this = _super.call(this, http, configService) || this;
        _this.fcmetaService = fcmetaService;
        _this.configService = configService;
        _this.app = app;
        return _this;
    }
    RecordsService.prototype.getForm = function (oid, recordType, editable, formName) {
        var _this = this;
        if (oid === void 0) { oid = null; }
        if (recordType === void 0) { recordType = null; }
        if (editable === void 0) { editable = true; }
        if (formName === void 0) { formName = null; }
        if (_.isEmpty(oid)) {
            oid = null;
        }
        return this.getFormFieldsMeta(recordType, editable, oid, formName).then(function (form) {
            return _this.fcmetaService.getLookupData(form.fieldsMeta).flatMap(function (fields) {
                form.fieldsMata = fields;
                return Observable_1.Observable.of(form);
            });
        });
    };
    RecordsService.prototype.addRenderCompleteElement = function (fieldsMeta) {
        var renderCompleteElement = {
            "class": "Container",
            "compClass": "TextBlockComponent",
            "definition": {
                "value": "",
                "type": "span",
                "cssClasses": "form-render-complete"
            }
        };
        fieldsMeta.push(renderCompleteElement);
    };
    RecordsService.prototype.getFormFields = function (recordType, oid, editable, formName) {
        var _this = this;
        if (oid === void 0) { oid = null; }
        if (formName === void 0) { formName = null; }
        var ts = new Date().getTime();
        console.log("Oid is: " + oid);
        var url = oid ? this.brandingAndPortalUrl + "/record/form/auto/" + oid + "?edit=" + editable + "&ts=" + ts + "&formName=" + formName : this.brandingAndPortalUrl + "/record/form/" + recordType + "?edit=" + editable + "&ts=" + ts;
        console.log("URL is: " + url);
        return this.http.get(url, this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.getFormFieldsMeta = function (recordType, editable, oid, formName) {
        var _this = this;
        if (oid === void 0) { oid = null; }
        if (formName === void 0) { formName = null; }
        return this.getFormFields(recordType, oid, editable, formName).then(function (form) {
            if (form && form.fields) {
                if (!editable) {
                    // Add an empty element to the end of the form so a screenshot tool can detect the rendered form reliably
                    _this.addRenderCompleteElement(form.fields);
                }
                form.fieldsMeta = _this.fcmetaService.getFieldsMeta(form.fields);
            }
            else {
                console.error("Error loading form:" + recordType);
                throw form;
            }
            return form;
        });
    };
    RecordsService.prototype.create = function (record, recordType, targetStep) {
        var _this = this;
        if (targetStep === void 0) { targetStep = ''; }
        return this.http.post(this.brandingAndPortalUrl + "/recordmeta/" + recordType + this.getTargetStepParam(targetStep, '?'), record, this.getOptionsClient())
            .map(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.update = function (oid, record, targetStep) {
        var _this = this;
        if (targetStep === void 0) { targetStep = ''; }
        return this.http.put(this.brandingAndPortalUrl + "/recordmeta/" + oid + this.getTargetStepParam(targetStep, '?'), record, this.getOptionsClient())
            .map(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.getTargetStepParam = function (targetStep, delim) {
        return _.isEmpty(targetStep) ? '' : delim + "targetStep=" + targetStep;
    };
    RecordsService.prototype.stepTo = function (oid, record, targetStep) {
        var _this = this;
        return this.http.post(this.brandingAndPortalUrl + "/record/workflow/step/" + targetStep + "/" + oid, record, this.getOptionsClient())
            .map(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.getDashboardUrl = function (recType) {
        if (recType === void 0) { recType = 'rdmp'; }
        return this.brandingAndPortalUrl + "/dashboard/" + recType;
    };
    RecordsService.prototype.getAttachments = function (oid) {
        var _this = this;
        return this.http.get(this.brandingAndPortalUrl + "/record/" + oid + "/attachments", this.getOptionsClient()).toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.modifyEditors = function (records, username, email) {
        var _this = this;
        return this.http.post(this.brandingAndPortalUrl + "/record/editors/modify", { records: records, username: username, email: email }, this.getOptionsClient())
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.updateResponsibilities = function (records, role, updateData) {
        var _this = this;
        return this.http.post(this.brandingAndPortalUrl + "/record/responsibility/update", { records: records, role: role, updateData: updateData }, this.getOptionsClient())
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.getTransferResponsibility = function (recordType) {
        var _this = this;
        return this.http.get(this.brandingAndPortalUrl + "/transferconfig/" + recordType, this.getOptionsClient())
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.search = function (params) {
        var _this = this;
        var refinedSearchStr = '';
        params.filterActiveRefinersWithNoData();
        if (_.size(params.activeRefiners) > 0) {
            var exactSearchNames_1 = '';
            var exactSearchValues_1 = '';
            var facetSearchNames_1 = '';
            var facetSearchValues_1 = '';
            _.forEach(params.activeRefiners, function (refiner) {
                switch (refiner.type) {
                    case "exact":
                        exactSearchNames_1 = "" + (_.isEmpty(exactSearchNames_1) ? "&exactNames=" : exactSearchNames_1 + ",") + refiner.name;
                        exactSearchValues_1 = exactSearchValues_1 + "&exact_" + refiner.name + "=" + refiner.value;
                        break;
                    case "facet":
                        facetSearchNames_1 = "" + (_.isEmpty(facetSearchNames_1) ? "&facetNames=" : facetSearchNames_1 + ",") + refiner.name;
                        if (!_.isEmpty(refiner.activeValue)) {
                            facetSearchValues_1 = facetSearchValues_1 + "&facet_" + refiner.name + "=" + refiner.activeValue;
                        }
                        break;
                }
            });
            refinedSearchStr = "" + exactSearchNames_1 + exactSearchValues_1 + facetSearchNames_1 + facetSearchValues_1;
        }
        return this.http.get(this.brandingAndPortalUrl + "/record/search/" + params.recordType + "/?searchStr=" + params.basicSearch + "&rows=" + params.rows + "&page=" + params.currentPage + refinedSearchStr, this.getOptionsClient())
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.getType = function (name) {
        var _this = this;
        return this.http.get(this.brandingAndPortalUrl + "/record/type/" + name, this.getOptionsClient())
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.getAllTypes = function () {
        var _this = this;
        return this.http.get(this.brandingAndPortalUrl + "/record/type/", this.getOptionsClient())
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.getAllTypesOfPackageType = function (packageType) {
        return __awaiter(this, void 0, void 0, function () {
            var allTypes;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.getAllTypes()];
                    case 1:
                        allTypes = _a.sent();
                        return [2 /*return*/, _.filter(allTypes, function (recType) { return recType.packageType == packageType; })];
                }
            });
        });
    };
    RecordsService.prototype.getWorkflowSteps = function (name) {
        var _this = this;
        return this.http.get(this.brandingAndPortalUrl + "/record/wfSteps/" + name, this.getOptionsClient())
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.getRecordMeta = function (oid) {
        var _this = this;
        if (oid === void 0) { oid = null; }
        return this.http.get(this.brandingAndPortalUrl + "/record/metadata/" + oid, this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.getPermissions = function (oid) {
        var _this = this;
        if (oid === void 0) { oid = null; }
        return this.http.get(this.brandingAndPortalUrl + "/record/" + oid + "/permissions", this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.executeAction = function (action, params) {
        var _this = this;
        return this.http.post(this.brandingAndPortalUrl + "/action/" + action, params, this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.getAsyncProgress = function (fq) {
        var _this = this;
        return this.http.get(this.brandingAndPortalUrl + "/asynch?fq=" + fq, this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    RecordsService.prototype.subscribeToAsyncProgress = function (oid, connectCb) {
        if (oid === void 0) { oid = null; }
        io.socket.get(this.brandingAndPortalUrl + "/asynch/subscribe/" + oid, connectCb);
    };
    RecordsService.prototype.delete = function (oid) {
        var _this = this;
        return this.http.delete(this.brandingAndPortalUrl + "/record/delete/" + oid, this.getOptionsClient())
            .map(function (res) { return _this.extractData(res); });
    };
    RecordsService = __decorate([
        core_1.Injectable(),
        __param(0, core_1.Inject(http_1.Http)),
        __param(1, core_1.Inject(field_control_meta_service_1.FieldControlMetaService)),
        __param(2, core_1.Inject(config_service_1.ConfigService)),
        __metadata("design:paramtypes", [http_1.Http,
            field_control_meta_service_1.FieldControlMetaService,
            config_service_1.ConfigService,
            core_1.ApplicationRef])
    ], RecordsService);
    return RecordsService;
}(base_service_1.BaseService));
exports.RecordsService = RecordsService;
var RecordActionResult = /** @class */ (function () {
    function RecordActionResult() {
    }
    return RecordActionResult;
}());
exports.RecordActionResult = RecordActionResult;
var RecordSearchRefiner = /** @class */ (function () {
    function RecordSearchRefiner(opts) {
        if (opts === void 0) { opts = {}; }
        this.name = opts.name;
        this.title = opts.title;
        this.type = opts.type;
        this.value = opts.value;
        this.typeLabel = opts.typeLabel;
        this.alwaysActive = opts.alwaysActive;
    }
    RecordSearchRefiner.prototype.setCurrentValue = function (value) {
        if (this.type == "facet") {
            this.activeValue = value;
        }
        else {
            this.value = value;
        }
    };
    return RecordSearchRefiner;
}());
exports.RecordSearchRefiner = RecordSearchRefiner;
var RecordSearchParams = /** @class */ (function () {
    function RecordSearchParams(recType) {
        this.rows = 10;
        this.currentPage = 1;
        this.recordType = recType;
        this.activeRefiners = [];
        this.clear();
    }
    RecordSearchParams.prototype.clear = function () {
        this.basicSearch = null;
        this.currentPage = 1;
        _.remove(this.activeRefiners, function (refiner) {
            refiner.value = null;
            refiner.activeValue = null;
            return !refiner.alwaysActive;
        });
    };
    RecordSearchParams.prototype.getRefinerConfig = function (name) {
        return _.find(this.refinerConfig, function (config) {
            return config.name == name;
        });
    };
    RecordSearchParams.prototype.setRefinerConfig = function (config) {
        var _this = this;
        this.refinerConfig = config;
        // parse through and activate those set as active...
        _.forEach(this.refinerConfig, function (refinerConfig) {
            if (refinerConfig.alwaysActive) {
                _this.addActiveRefiner(refinerConfig);
            }
        });
    };
    RecordSearchParams.prototype.getHttpQuery = function (searchUrl) {
        var refinerValues = '';
        _.forEach(this.activeRefiners, function (refiner) {
            if (refiner.type == "facet") {
                refinerValues = refinerValues + "&refiner|" + refiner.name + "=" + (_.isEmpty(refiner.activeValue) ? '' : refiner.activeValue);
            }
            else {
                refinerValues = refinerValues + "&refiner|" + refiner.name + "=" + (_.isEmpty(refiner.value) ? '' : refiner.value);
            }
        });
        return searchUrl + "?q=" + this.basicSearch + "&type=" + this.recordType + refinerValues + "&page=" + this.currentPage;
    };
    RecordSearchParams.prototype.getRefinerConfigs = function () {
        return this.refinerConfig;
    };
    RecordSearchParams.prototype.addActiveRefiner = function (refiner) {
        var existingRefiner = _.find(this.activeRefiners, function (activeRefiner) {
            return activeRefiner.name == refiner.name;
        });
        if (existingRefiner) {
            existingRefiner.value = refiner.value;
        }
        else {
            this.activeRefiners.push(refiner);
        }
    };
    RecordSearchParams.prototype.parseQueryStr = function (queryStr) {
        var _this = this;
        queryStr = decodeURI(queryStr);
        var refinerValues = {};
        _.forEach(queryStr.split('&'), function (q) {
            var qObj = q.split('=');
            if (_.startsWith(qObj[0], "q")) {
                _this.basicSearch = _.replace(qObj[1], /\+/gi, ' ');
            }
            if (_.startsWith(qObj[0], "refiner|")) {
                var refinerName = qObj[0].split('|')[1];
                refinerValues[refinerName] = qObj[1];
            }
            if (_.startsWith(qObj[0], "page")) {
                _this.currentPage = _.toNumber(qObj[1]);
            }
        });
        _.forOwn(refinerValues, function (value, name) {
            var config = _this.getRefinerConfig(name);
            config.setCurrentValue(value);
            _this.addActiveRefiner(config);
        });
    };
    RecordSearchParams.prototype.filterActiveRefinersWithNoData = function () {
        var removed = _.remove(this.activeRefiners, function (refiner) {
            var value = refiner.type == 'exact' ? refiner.value : refiner.activeValue;
            return !refiner.alwaysActive && (_.isEmpty(value) || _.isUndefined(value));
        });
    };
    RecordSearchParams.prototype.hasActiveRefiners = function () {
        var hasActive = false;
        _.forEach(this.activeRefiners, function (refiner) {
            if (!hasActive && (!_.isEmpty(refiner.value))) {
                hasActive = true;
            }
        });
        return hasActive;
    };
    RecordSearchParams.prototype.setFacetValues = function (facets) {
        var _this = this;
        _.forEach(facets, function (facet) {
            var refiner = _.find(_this.activeRefiners, function (refinerConfig) {
                return refinerConfig.name == facet.name;
            });
            if (refiner) {
                refiner.value = facet.values;
            }
        });
    };
    return RecordSearchParams;
}());
exports.RecordSearchParams = RecordSearchParams;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/tree-node-checkbox.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var angular_tree_component_1 = __webpack_require__("./node_modules/angular-tree-component/dist/angular-tree-component.js");
var TreeNodeCheckboxComponent = /** @class */ (function () {
    function TreeNodeCheckboxComponent() {
    }
    __decorate([
        core_1.Input(),
        __metadata("design:type", angular_tree_component_1.TreeNode)
    ], TreeNodeCheckboxComponent.prototype, "node", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", String)
    ], TreeNodeCheckboxComponent.prototype, "ariaLabel", void 0);
    TreeNodeCheckboxComponent = __decorate([
        core_1.Component({
            selector: 'rb-tree-node-checkbox',
            encapsulation: core_1.ViewEncapsulation.None,
            styles: [],
            template: "\n    <ng-container *mobxAutorun=\"{dontDetach: true}\">\n      <input\n        class=\"tree-node-checkbox\"\n        type=\"checkbox\"\n        [attr.aria-label]=\"ariaLabel\" \n        (click)=\"node.mouseAction('checkboxClick', $event)\"\n        [checked]=\"node.isSelected\"\n        [indeterminate]=\"node.isPartiallySelected\"/>\n    </ng-container>\n  "
        })
    ], TreeNodeCheckboxComponent);
    return TreeNodeCheckboxComponent;
}());
exports.TreeNodeCheckboxComponent = TreeNodeCheckboxComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/workflow-button.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_simple_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.ts");
var WorkflowStepButton = /** @class */ (function (_super) {
    __extends(WorkflowStepButton, _super);
    function WorkflowStepButton(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.targetStep = options['targetStep'] || null;
        return _this;
    }
    return WorkflowStepButton;
}(field_simple_1.AnchorOrButton));
exports.WorkflowStepButton = WorkflowStepButton;
// For workflow buttons
var WorkflowStepButtonComponent = /** @class */ (function (_super) {
    __extends(WorkflowStepButtonComponent, _super);
    function WorkflowStepButtonComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    WorkflowStepButtonComponent.prototype.gotoTargetStep = function (event) {
        return this.fieldMap._rootComp.stepTo(this.field.targetStep);
    };
    WorkflowStepButtonComponent = __decorate([
        core_1.Component({
            selector: 'workflowstep-button',
            template: "\n  <button type=\"{{field.type}}\" [ngClass]=\"field.cssClasses\" (click)=\"gotoTargetStep($event)\" [disabled]=\"isDisabled()\">{{field.label}}</button>\n  ",
        })
    ], WorkflowStepButtonComponent);
    return WorkflowStepButtonComponent;
}(field_simple_component_1.AnchorOrButtonComponent));
exports.WorkflowStepButtonComponent = WorkflowStepButtonComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/workspace-field.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var workspace_service_1 = __webpack_require__("./redbox-portal/angular/shared/workspace-service.ts");
var ng2_completer_1 = __webpack_require__("./node_modules/ng2-completer/index.js");
/**
 * Base component for a Workspace field.
 *
 * Author: <a href='https://github.com/moisbo' target='_blank'>moisbo</a>
 *
 */
var WorkspaceFieldComponent = /** @class */ (function () {
    /**
     * For DI'ing...
     */
    function WorkspaceFieldComponent(componentFactoryResolver, app) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.app = app;
        this.disabledElements = [];
    }
    Object.defineProperty(WorkspaceFieldComponent.prototype, "isValid", {
        /**
         * If the form is valid.
         */
        get: function () {
            if (this.form && this.form.controls) {
                return this.form.controls[this.field.name].valid;
            }
            return false;
        },
        enumerable: true,
        configurable: true
    });
    /**
     *
     */
    WorkspaceFieldComponent.prototype.isDisabled = function () {
        var disabledExpression = this.field.options['disabledExpression'];
        if (disabledExpression != null) {
            var imports = this.fieldAnchor;
            var variables = {};
            variables['imports'] = this.fieldMap._rootComp;
            var compiled = _.template(disabledExpression, variables);
            var parentElement = jQuery(this.fieldElement.nativeElement.parentElement);
            if (compiled() == "true") {
                //take note of which elements where already disabled as we dont want to enable them if whole component becomes enabled again
                this.disabledElements = parentElement.find('*:disabled');
                parentElement.find('input').prop("disabled", true);
                return 'disabled';
            }
            else {
                if (jQuery(this.fieldElement.nativeElement).prop('disabled') == 'disabled') {
                    //previously disabled so lets re-enable
                    parentElement.find('input').prop("disabled", false);
                    _.each(this.disabledElements, function (disabledElement) { return disabledElement.prop("disabled", true); });
                }
                return null;
            }
        }
        return null;
    };
    /**
     * Change handler, instantiates the field component.
     */
    WorkspaceFieldComponent.prototype.ngOnChanges = function () {
        if (!this.field || !this.componentFactoryResolver) {
            return;
        }
        this.fieldAnchor.clear();
        var compFactory = this.componentFactoryResolver.resolveComponentFactory(this.field.compClass);
        var fieldCompRef = this.fieldAnchor.createComponent(compFactory, undefined, this.app['_injector']);
        fieldCompRef.instance.injector = this.app['_injector'];
        fieldCompRef.instance.field = this.field;
        fieldCompRef.instance.form = this.form;
        fieldCompRef.instance.fieldMap = this.fieldMap;
        fieldCompRef.instance.parentId = this.parentId;
        this.fieldMap[this.field.name].instance = fieldCompRef.instance;
    };
    __decorate([
        core_1.Input(),
        __metadata("design:type", field_base_1.FieldBase)
    ], WorkspaceFieldComponent.prototype, "field", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", forms_1.FormGroup)
    ], WorkspaceFieldComponent.prototype, "form", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Object)
    ], WorkspaceFieldComponent.prototype, "value", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Object)
    ], WorkspaceFieldComponent.prototype, "fieldMap", void 0);
    __decorate([
        core_1.ViewChild('field', { read: core_1.ViewContainerRef }),
        __metadata("design:type", core_1.ViewContainerRef)
    ], WorkspaceFieldComponent.prototype, "fieldAnchor", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", String)
    ], WorkspaceFieldComponent.prototype, "parentId", void 0);
    __decorate([
        core_1.ViewChild('field'),
        __metadata("design:type", Object)
    ], WorkspaceFieldComponent.prototype, "fieldElement", void 0);
    WorkspaceFieldComponent = __decorate([
        core_1.Component({
            selector: 'ws-field',
            template: '<span [attr.disabled]="isDisabled()" #field></span>'
        }),
        __param(0, core_1.Inject(core_1.ComponentFactoryResolver)),
        __metadata("design:paramtypes", [core_1.ComponentFactoryResolver, core_1.ApplicationRef])
    ], WorkspaceFieldComponent);
    return WorkspaceFieldComponent;
}());
exports.WorkspaceFieldComponent = WorkspaceFieldComponent;
var WorkspaceSelectorField = /** @class */ (function (_super) {
    __extends(WorkspaceSelectorField, _super);
    function WorkspaceSelectorField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.workspaceApps = [];
        _this.services = [];
        _this.workspaceTypeService = _this.getFromInjector(workspace_service_1.WorkspaceTypeService);
        _this.open = _this.getTranslated(options['open'], options['open']);
        _this.saveFirst = _this.getTranslated(options['saveFirst'], options['saveFirst']);
        _this.rdmp = undefined;
        _this.displayAsList = _.isUndefined(options['displayAsList']) ? false : options['displayAsList'];
        _this.shouldSaveForm = _.isUndefined(options['shouldSaveForm']) ? true : options['shouldSaveForm'];
        // this.options = options['options'] || [];
        _this.workspaceApps = _.map(options['defaultSelection'] || [], function (option) {
            _.forOwn(option, function (val, key) {
                option[key] = _this.getTranslated(val, val);
            });
            return option;
        });
        _this.appLink = _this.workspaceTypeService.getBrand() + '/record/';
        _this.workspaceTypeService.getWorkspaceTypes().then(function (response) {
            if (response['status']) {
                //append / merge results from database into workspaceApps
                _.each(response['workspaceTypes'], function (wType) {
                    _.forOwn(wType, function (val, key) {
                        // all keys will go through the translation file by default
                        wType[key] = _this.getTranslated(val, val);
                    });
                    var existingWtype = _.find(_this.workspaceApps, function (w) { return w['name'] == wType['name']; });
                    if (!_.isUndefined(existingWtype)) {
                        _.assign(existingWtype, wType);
                        _this.workspaceApp = existingWtype;
                    }
                    else {
                        _this.workspaceApps.push(wType);
                    }
                });
            }
            else {
                throw new Error('cannot get workspaces');
            }
        }).catch(function (error) {
            console.log(error);
        });
        _this.workspaceTypeService.getAvailableWorkspaces().then(function (response) {
            if (response['status']) {
                _this.services = _.concat(_this.services, response['workspaces']);
            }
            else {
                throw new Error('cannot get workspaces');
            }
        }).catch(function (error) {
            console.error(error);
        });
        return _this;
    }
    WorkspaceSelectorField.prototype.init = function () {
        this.rdmp = this.fieldMap._rootComp.oid || undefined;
    };
    WorkspaceSelectorField.prototype.registerEvents = function () {
        this.fieldMap._rootComp.recordCreated.subscribe(this.setOid.bind(this));
        this.fieldMap._rootComp.recordSaved.subscribe(this.setOid.bind(this));
    };
    WorkspaceSelectorField.prototype.setOid = function (o) {
        this.rdmp = o.oid;
    };
    WorkspaceSelectorField.prototype.loadWorkspaceDetails = function (value) {
        //GET me the value from the database
        if (!value) {
            this.workspaceApp = null;
        }
        else {
            this.workspaceApp = _.find(this.workspaceApps, function (w) {
                return w['name'] == value;
            });
        }
    };
    WorkspaceSelectorField.prototype.createFormModel = function () {
        var _this = this;
        if (this.controlType == 'checkbox') {
            var fgDef_1 = [];
            _.map(this.options, function (opt) {
                var hasValue = _.find(_this.value, function (val) {
                    return val == opt.value;
                });
                if (hasValue) {
                    fgDef_1.push(new forms_1.FormControl(opt.value));
                }
            });
            // const fg = new FormArray(fgDef);
            // return fg;
            return new forms_1.FormArray(fgDef_1);
        }
        else {
            // const model = super.createFormModel();
            // console.log(`Created form model:`);
            // console.log(model);
            // return model;
            return _super.prototype.createFormModel.call(this);
        }
    };
    return WorkspaceSelectorField;
}(field_base_1.FieldBase));
exports.WorkspaceSelectorField = WorkspaceSelectorField;
var WorkspaceRegisterField = /** @class */ (function (_super) {
    __extends(WorkspaceRegisterField, _super);
    function WorkspaceRegisterField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.workspaceApps = [];
        _this.services = [];
        _this.submitted = false;
        _this.disabledType = false;
        _this.stepHidden = [false, true];
        _this.clearSelected = false;
        _this.vstate = 0;
        _this.isCreating = false;
        _this.created = false;
        _this.workspaceCreated = {};
        _this.workspaceTypeService = _this.getFromInjector(workspace_service_1.WorkspaceTypeService);
        _this.completerService = _this.getFromInjector(ng2_completer_1.CompleterService);
        _this.formBuilder = _this.getFromInjector(forms_1.FormBuilder);
        _this.open = _this.getTranslated(options['open'], options['open']);
        _this.saveFirst = _this.getTranslated(options['saveFirst'], options['saveFirst']);
        _this.rdmp = undefined;
        _this.workspaceApps = _.map(options['workspaceApps'] || [], function (option) {
            option['label'] = _this.getTranslated(option['label'], option['label']);
            return option;
        });
        _this.workspaceRegisterForm = _this.formBuilder.group({
            name: new forms_1.FormControl('', forms_1.Validators.required),
            location: new forms_1.FormControl('', forms_1.Validators.required),
            details: new forms_1.FormControl('', forms_1.Validators.required),
            workspaceType: new forms_1.FormControl('', forms_1.Validators.required),
        });
        _this.dataService = _this.completerService.local(_this.workspaceApps, 'label,description,keywords', 'label').imageField("image").descriptionField("description");
        return _this;
    }
    WorkspaceRegisterField.prototype.init = function () {
        this.rdmp = this.fieldMap._rootComp.oid || undefined;
    };
    WorkspaceRegisterField.prototype.registerEvents = function () {
        this.fieldMap._rootComp.recordCreated.subscribe(this.setOid.bind(this));
        this.fieldMap._rootComp.recordSaved.subscribe(this.setOid.bind(this));
    };
    WorkspaceRegisterField.prototype.setOid = function (o) {
        this.rdmp = o.oid;
    };
    WorkspaceRegisterField.prototype.saveAndOpenWorkspace = function () {
        var _this = this;
        this.fieldMap._rootComp.onSubmit().subscribe(function (response) {
            _this.disabledType = false;
            _this.vstate = 0;
            _this.stepHidden = [false, true];
            _this.workspaceRegisterForm.reset();
            _this.clearSelected = true;
            _this.submitted = false;
            _this.isCreating = false;
            _this.createdError = undefined;
            _this.created = false;
            _this.workspaceCreated = {};
            jQuery('#workspaceRegisterModal').modal({ backdrop: 'static', keyboard: false, show: true });
        });
    };
    WorkspaceRegisterField.prototype.onSelect = function (event) {
        this.disabledType = true;
        this.workspaceType = event['originalObject'];
        this.stepHidden = [true, false];
    };
    WorkspaceRegisterField.prototype.clearWorkspaceSelected = function () {
        this.clearSelected = true;
        this.disabledType = false;
        this.stepHidden = [false, true];
    };
    Object.defineProperty(WorkspaceRegisterField.prototype, "f", {
        get: function () {
            return this.workspaceRegisterForm.controls;
        },
        enumerable: true,
        configurable: true
    });
    WorkspaceRegisterField.prototype.registerWorkspace = function (value) {
        return __awaiter(this, void 0, void 0, function () {
            var workspaceType, res;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        console.log("registerWorkspace " + value);
                        this.createdError = '';
                        this.workspaceRegisterForm.patchValue({ workspaceType: this.workspaceType.value });
                        this.submitted = true;
                        if (!!this.workspaceRegisterForm.invalid) return [3 /*break*/, 2];
                        this.isCreating = true;
                        workspaceType = this.workspaceType.value;
                        return [4 /*yield*/, this.workspaceTypeService.createWorkspace(this.rdmp, value, workspaceType)];
                    case 1:
                        res = _a.sent();
                        if (!res.status) {
                            this.createdError = res.message;
                        }
                        else {
                            this.workspaceCreated = res.workspace;
                            this.created = true;
                        }
                        this.isCreating = false;
                        _a.label = 2;
                    case 2: return [2 /*return*/];
                }
            });
        });
    };
    WorkspaceRegisterField.prototype.close = function () {
        jQuery('#workspaceRegisterModal').modal('hide');
        if (this.created) {
            // cop-out till we can send updates to the rdmp without reloading
            window.location.href = this.appConfig.baseUrl + "/" + this.appConfig.branding + "/" + this.appConfig.portal + "/record/edit/" + this.rdmp + "?focusTabId=workspaces";
        }
    };
    return WorkspaceRegisterField;
}(field_base_1.FieldBase));
exports.WorkspaceRegisterField = WorkspaceRegisterField;
var WorkspaceType = /** @class */ (function () {
    function WorkspaceType() {
        this.label = '';
        this.description = '';
        this.image = '';
        this.value = '';
    }
    return WorkspaceType;
}());


/***/ }),

/***/ "./redbox-portal/angular/shared/form/workspace-register.component.css":
/***/ (function(module, exports) {

module.exports = ":host {\n  padding: 5em 0;\n}\n\n:host /deep/ .match {\n  color: darkred;\n}\n\n.completer-limit /deep/ .completer-dropdown {\n  overflow-y: auto;\n  max-height: 20rem;\n}\n\n:host >>> .completer-image-holder {\n  width: 200px;\n}\n\n:host >>> .completer-image {\n  width: 300px;\n}\n\n:host >>> .completer-row {\n}\n\n.completer-dropdown-holder {\n  position: absolute;\n  background: white;\n  border: solid #000;\n  border-width: 1px 1px;\n  width: 20em;\n}\n\n.completer-item-text .completer-item-text-image {\n\n}\n\n.completer-title {\n\n}\n\n.ng-invalid.ng-touched , .ng-invalid.ng-dirty{\n  border-bottom: 3px solid red;\n}\n\n/*\n/deep/ .completer-input {\n  display: block;\n  width: 75%;\n  height: 34px;\n  padding: 6px 12px;\n  font-size: 14px;\n  line-height: 1.42857143;\n  color: #555;\n  background-color: #fff;\n  background-image: none;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);\n  box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);\n  -webkit-transition: border-color ease-in-out .15s, -webkit-box-shadow ease-in-out .15s;\n  -o-transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;\n  transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;\n} */\n"

/***/ }),

/***/ "./redbox-portal/angular/shared/form/workspace-register.component.html":
/***/ (function(module, exports) {

module.exports = "<div [formGroup]='form' *ngIf=\"field.editMode\" [ngClass]=\"getGroupClass()\">\n  <label [attr.for]=\"field.name\">\n    {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n    <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\"\n            [attr.aria-label]=\"'help' | translate \"><span\n      class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n  </label>\n  <a *ngIf=\"field.rdmp\" (click)=\"field.saveAndOpenWorkspace()\" class=\"btn btn-block btn-primary\">\n    {{ field.open }}\n  </a>\n  <a *ngIf=\"!field.rdmp\" [attr.disabled]=\"field.rdmp ? null : ''\" class=\"btn btn-block btn-secondary\">\n    {{ field.saveFirst }}\n  </a>\n  <br/>\n  <div class=\"modal\" id=\"workspaceRegisterModal\" tabindex=\"-1\" role=\"dialog\"\n       aria-labelledby=\"workspaceRegisterModalTitle\">\n    <div class=\"modal-dialog modal-lg\" role=\"document\">\n      <div class=\"modal-content\">\n        <div class=\"modal-header\">\n          <h3 class=\"modal-title\">Register Workspace</h3>\n        </div>\n        <div class=\"modal-body\">\n          <p>To register a workspace select a type from the list and include details.</p>\n          <p><span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\"\n                   [innerHtml]=\"field.help\"></span></p>\n          <form [formGroup]=\"field.workspaceRegisterForm\"\n                (ngSubmit)=\"field.registerWorkspace(field.workspaceRegisterForm.value)\">\n            <div class=\"form-group\" [hidden]=\"field.stepHidden[0]\">\n              <label for=\"workspaceRegisterType\">Workspace</label>\n              <div *ngIf=\"!field.disabledType\">\n                <ng2-completer #ngCompleter [(ngModel)]=\"field.searchStr\" [required]=true [autoMatch]=false\n                               [datasource]=\"field.dataService\" [minSearchLength]=\"0\"\n                               [ngModelOptions]=\"{standalone: true}\"\n                               [inputClass]=\"'form-control'\" (selected)=\"field.onSelect($event)\"\n                               [inputId]=\"'workspaceRegisterType'\"\n                               [textNoResults]=\"'Workspace not listed'\"\n                               [openOnClick]=true [clearSelected]=\"field.clearSelected\">\n                </ng2-completer>\n                <small id=\"workspaceRegisterTypeHelp\" class=\"form-text text-muted\">The type of your\n                  workspace</small>\n              </div>\n            </div>\n            <div class=\"container-fluid\" [hidden]=\"field.stepHidden[1]\">\n              <div class=\"row\">\n                <div class=\"col-md-5\">\n                  <div *ngIf=\"field.disabledType\">\n                    <div class=\"card service col-lg-4 col-md-5 col-sm-6 col-xs-12\"\n                         style=\"display: flex; flex-direction: column;width: 30rem;\">\n                      <div class=\"panel panel-default\">\n                        <div class=\"panel-heading\">\n                          <h5 class=\"panel-title card-title\" style=\"margin-top: 1px\">\n                            <span>{{ field.workspaceType.label }}</span>\n                          </h5>\n                        </div>\n                        <div class=\"panel-body workspaces-panel-body\">\n                          <img class=\"card-img-top\" style=\"max-height:100px;\"\n                               src=\"{{ field.workspaceType.image }}\"\n                               alt=\"{{ field.workspaceType.label }}\">\n                          <div class=\"card-body\" style=\"margin-bottom: auto;\">\n                            <h5 class=\"card-title\"\n                                style=\"margin-top: 2px\">{{ field.workspaceType.label }}</h5>\n                            <p class=\"card-text\">{{ field.workspaceType.description }}</p>\n                          </div>\n                        </div>\n                        <div class=\"card-footer\" style=\"margin-top: auto;\">\n                          <a class=\"btn btn-block btn-secondary\"\n                             (click)=\"field.clearWorkspaceSelected()\"\n                             [hidden]=\"field.isCreating\"\n                             *ngIf=\"!field.created\">Change Workspace</a>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n                <div class=\"col-md-7\">\n                  <div class=\"form-group\">\n                    <label for=\"name\">Name</label>\n                    <input type=\"text\" id=\"name\"\n                           aria-describedby=\"nameHelp\" required=\"\"\n                           formControlName=\"name\" placeholder=\"Type a name\"\n                           [ngClass]=\"{ 'form-control': true, 'is-invalid': field.submitted && field.f.name.errors }\">\n                    <div *ngIf=\"field.submitted && field.f.name.errors\" class=\"invalid-feedback\">\n                      <div class=\"text-danger\" *ngIf=\"field.f.name.errors.required\">Name is required</div>\n                    </div>\n                    <small id=\"nameHelp\" class=\"form-text text-muted\">The name of your\n                      workspace</small>\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"location\">Location</label>\n                    <input type=\"text\" id=\"location\"\n                           aria-describedby=\"locationHelp\" placeholder=\"Type a location\"\n                           formControlName=\"location\" required=\"\"\n                           [ngClass]=\"{ 'form-control': true, 'is-invalid': field.submitted && field.f.location.errors }\">\n                    <div *ngIf=\"field.submitted && field.f.location.errors\" class=\"invalid-feedback\">\n                      <div class=\"text-danger\" *ngIf=\"field.f.location.errors.required\">Location is required</div>\n                    </div>\n                    <small id=\"locationHelp\" class=\"form-text text-muted\">The location or URL of your workspace</small>\n                  </div>\n                  <div class=\"form-group\">\n                    <label for=\"details\">Details</label>\n                    <textarea rows=\"4\" cols=\"50\" id=\"details\"\n                              aria-describedby=\"detailsHelp\" placeholder=\"Type details\"\n                              formControlName=\"details\" required=\"\"\n                              [ngClass]=\"{ 'form-control': true, 'is-invalid': field.submitted && field.f.details.errors }\"></textarea>\n                    <div *ngIf=\"field.submitted && field.f.details.errors\" class=\"invalid-feedback\">\n                      <div class=\"text-danger\" *ngIf=\"field.f.details.errors.required\">Details is required</div>\n                    </div>\n                    <small id=\"detailsHelp\" class=\"form-text text-muted\">\n                      Input short details of your workspace\n                    </small>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class=\"form-group\" [hidden]=\"field.stepHidden[1]\">\n              <div class=\"row row-no-gutters\">\n                <small *ngIf=\"!field.created\" id=\"workspaceRegisterConfirmHelp\"\n                       class=\"form-text text-muted\">\n                  Click confirm to register workspace</small>\n                <br/>\n                <button *ngIf=\"!field.created\"\n                        type=\"submit\" class=\"btn btn-block btn-primary\"\n                        [disabled]=\"field.isCreating\">Confirm\n                </button>\n                <p class=\"text-danger\" *ngIf=\"field.createdError\">{{ field.createdError }}</p>\n                <p class=\"alert alert-success\" *ngIf=\"field.created\">Workspace Registered Successfully</p>\n              </div>\n            </div>\n          </form>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-secondary\"\n                    [disabled]=\"field.isCreating\"\n                    (click)=\"field.close()\">Close\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n"

/***/ }),

/***/ "./redbox-portal/angular/shared/form/workspace-register.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var WorkspaceRegisterComponent = /** @class */ (function (_super) {
    __extends(WorkspaceRegisterComponent, _super);
    function WorkspaceRegisterComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    WorkspaceRegisterComponent.prototype.getLabel = function (val) {
        var opt = _.find(this.field.options, function (opt) {
            return opt.value == val;
        });
        if (opt) {
            return opt.label;
        }
        else {
            return '';
        }
    };
    WorkspaceRegisterComponent.clName = 'WorkspaceRegisterComponent';
    WorkspaceRegisterComponent = __decorate([
        core_1.Component({
            selector: 'workspace-register-parent',
            template: ''
        })
    ], WorkspaceRegisterComponent);
    return WorkspaceRegisterComponent;
}(field_simple_component_1.SimpleComponent));
exports.WorkspaceRegisterComponent = WorkspaceRegisterComponent;
var WorkspaceRegisterFieldComponent = /** @class */ (function (_super) {
    __extends(WorkspaceRegisterFieldComponent, _super);
    function WorkspaceRegisterFieldComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    WorkspaceRegisterFieldComponent.prototype.ngOnInit = function () {
        this.field.init();
        this.field.registerEvents();
    };
    WorkspaceRegisterFieldComponent.clName = 'WorkspaceRegisterFieldComponent';
    WorkspaceRegisterFieldComponent = __decorate([
        core_1.Component({
            selector: 'workspace-register',
            styles: [__webpack_require__("./redbox-portal/angular/shared/form/workspace-register.component.css")],
            template: __webpack_require__("./redbox-portal/angular/shared/form/workspace-register.component.html")
        })
    ], WorkspaceRegisterFieldComponent);
    return WorkspaceRegisterFieldComponent;
}(WorkspaceRegisterComponent));
exports.WorkspaceRegisterFieldComponent = WorkspaceRegisterFieldComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/workspace-select.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var WorkspaceSelectComponent = /** @class */ (function (_super) {
    __extends(WorkspaceSelectComponent, _super);
    function WorkspaceSelectComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    WorkspaceSelectComponent.prototype.getLabel = function (val) {
        var opt = _.find(this.field.options, function (opt) {
            return opt.value == val;
        });
        if (opt) {
            return opt.label;
        }
        else {
            return '';
        }
    };
    WorkspaceSelectComponent.clName = 'WorkspaceSelectComponent';
    WorkspaceSelectComponent = __decorate([
        core_1.Component({
            selector: 'workspace-select-parent',
            template: ''
        })
    ], WorkspaceSelectComponent);
    return WorkspaceSelectComponent;
}(field_simple_component_1.SimpleComponent));
exports.WorkspaceSelectComponent = WorkspaceSelectComponent;
var WorkspaceSelectFieldComponent = /** @class */ (function (_super) {
    __extends(WorkspaceSelectFieldComponent, _super);
    function WorkspaceSelectFieldComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    WorkspaceSelectFieldComponent.prototype.ngOnInit = function () {
        this.field.init();
        this.field.registerEvents();
    };
    WorkspaceSelectFieldComponent.prototype.saveAndOpenWorkspace = function (app) {
        var _this = this;
        this.fieldMap._rootComp.onSubmit().subscribe(function (response) {
            var href = '';
            if (app && app.id) {
                var type = '';
                if (app.type) {
                    type = "&appType=" + app.type;
                    href = "" + _this.field.appLink + app.id + "/edit?rdmp=" + _this.field.rdmp + type;
                }
                else {
                    href = "" + _this.field.appLink + app.id + "/edit?rdmp=" + _this.field.rdmp;
                }
                window.location.href = href;
            }
            else {
                console.error('No App with app id was found, please check config/workspaces.js');
            }
        });
    };
    WorkspaceSelectFieldComponent.clName = 'WorkspaceSelectFieldComponent';
    WorkspaceSelectFieldComponent = __decorate([
        core_1.Component({
            selector: 'workspace-select',
            template: "\n    <div [formGroup]='form' *ngIf=\"field.editMode\" [ngClass]=\"getGroupClass()\">\n      <label [attr.for]=\"field.name\">\n        {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n        <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span\n          class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n      </label>\n      <br/>\n      <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\"></span>\n      <div class=\"row\">\n        <div class=\"card-deck\">\n          <div class=\"card service col-lg-4 col-md-5 col-sm-6 col-xs-12\" *ngFor=\"let s of field.services\" style=\"display: flex; flex-direction: column;width: 30rem;\">\n            <div class=\"panel panel-default\">\n              <div class=\"panel-heading\">\n                <h5 class=\"panel-title card-title\" style=\"margin-top: 1px\">\n                  <span *ngIf=\"s.displayName\">{{ s.displayName }}</span>\n                </h5>\n              </div>\n              <div class=\"panel-body workspaces-panel-body\">\n                <img style=\"max-height:100px;\" class=\"card-img-top\" src=\"{{ s.logo }}\" alt=\"{{ s.name }}\">\n                <div class=\"card-body\" style=\"margin-bottom: auto;\">\n                  <h5 class=\"card-title\" style=\"margin-top: 2px\">\n                    <span *ngIf=\"s.title\">{{ s.title }}</span>\n                  </h5>\n                  <p class=\"card-text\">{{ s.desc }}</p>\n                </div>\n              </div>\n              <div class=\"card-footer\" style=\"margin-top: auto;\">\n                <a *ngIf=\"field.rdmp\" (click)=\"saveAndOpenWorkspace(s.app)\" class=\"btn btn-block btn-primary\">\n                  {{ field.open }}\n                </a>\n                <a *ngIf=\"!field.rdmp\" [attr.disabled]=\"field.rdmp ? null : ''\" class=\"btn btn-block btn-secondary\">\n                  {{ field.saveFirst }}\n                </a>\n              </div>\n            </div>\n          </div>\n          <br />\n        </div>\n      </div>\n      <div class=\"row\">\n        <div *ngIf=\"field.workspaceApp\" class=\"panel panel-default\">\n          <div class=\"panel-heading\">\n            <h4 class=\"panel-title\">{{ field.workspaceApp.name | uppercase }}</h4>\n          </div>\n          <div class=\"panel-body\">\n            <div class=\"row\">\n              <div class=\"col-md-8 col-sm-8 col-xs-8 col-lg-8\">\n                <h5>{{ field.workspaceApp.subtitle }}</h5>\n                <span *ngIf=\"field.rdmp\">\n              <p>{{ field.workspaceApp.description }}</p>\n              <button (click)=\"saveAndOpenWorkspace()\"  class=\"btn btn-primary\">{{ field.open }}</button>\n            </span>\n                <span *ngIf=\"!field.rdmp\">\n              <p class=\"text-danger\">\n                <strong>{{ field.saveFirst }}</strong>\n              </p>\n            </span>\n              </div>\n              <div class=\"col-md-4 col-sm-4 col-xs-4 col-lg-4\">\n                <img src=\"{{ field.workspaceApp.logo }}\" alt=\"{{field.workspaceApp.name}}\">\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  ",
        })
    ], WorkspaceSelectFieldComponent);
    return WorkspaceSelectFieldComponent;
}(WorkspaceSelectComponent));
exports.WorkspaceSelectFieldComponent = WorkspaceSelectFieldComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/form/workspace-selector.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var WorkspaceSelectorComponent = /** @class */ (function (_super) {
    __extends(WorkspaceSelectorComponent, _super);
    function WorkspaceSelectorComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    WorkspaceSelectorComponent.prototype.getLabel = function (val) {
        var opt = _.find(this.field.options, function (opt) {
            return opt.value == val;
        });
        if (opt) {
            return opt.label;
        }
        else {
            return '';
        }
    };
    WorkspaceSelectorComponent.clName = 'WorkspaceSelectorComponent';
    WorkspaceSelectorComponent = __decorate([
        core_1.Component({
            selector: 'workspace-selector-parent',
            template: ''
        })
    ], WorkspaceSelectorComponent);
    return WorkspaceSelectorComponent;
}(field_simple_component_1.SimpleComponent));
exports.WorkspaceSelectorComponent = WorkspaceSelectorComponent;
var WorkspaceSelectorFieldComponent = /** @class */ (function (_super) {
    __extends(WorkspaceSelectorFieldComponent, _super);
    function WorkspaceSelectorFieldComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    WorkspaceSelectorFieldComponent.prototype.ngOnInit = function () {
        this.field.init();
        this.field.registerEvents();
    };
    WorkspaceSelectorFieldComponent.prototype.saveAndOpenWorkspace = function (workspaceType) {
        var _this = this;
        if (workspaceType === void 0) { workspaceType = undefined; }
        if (_.isUndefined(workspaceType)) {
            workspaceType = this.field.workspaceApp;
        }
        if (this.field.shouldSaveForm) {
            this.fieldMap._rootComp.onSubmit().subscribe(function (response) {
                if (response == true) {
                    window.location.href = "" + _this.field.appLink + workspaceType.name + "/edit?rdmp=" + _this.field.rdmp;
                }
            });
        }
        else {
            window.location.href = "" + this.field.appLink + workspaceType.name + "/edit?rdmp=" + this.field.rdmp;
        }
    };
    WorkspaceSelectorFieldComponent.clName = 'WorkspaceSelectorFieldComponent';
    WorkspaceSelectorFieldComponent = __decorate([
        core_1.Component({
            selector: 'workspace-selector',
            template: "\n  <div [formGroup]='form' *ngIf=\"field.editMode\" [ngClass]=\"getGroupClass()\">\n    <label [attr.for]=\"field.name\">\n      {{field.label}} <span [innerHTML]=\"getRequiredLabelStr()\"></span>\n      <button type=\"button\" class=\"btn btn-default\" *ngIf=\"field.help\" (click)=\"toggleHelp()\" [attr.aria-label]=\"'help' | translate \"><span\n        class=\"glyphicon glyphicon-question-sign\" aria-hidden=\"true\"></span></button>\n    </label>\n    <br/>\n    <span id=\"{{ 'helpBlock_' + field.name }}\" class=\"help-block\" *ngIf=\"this.helpShow\" [innerHtml]=\"field.help\"></span>\n    <!-- The SELECT field if not displaying as a list -->\n    <ng-container *ngIf=\"field.displayAsList == false\">\n      <select [id]=\"field.name\" [ngClass]=\"field.cssClasses\"\n              (change)=\"field.loadWorkspaceDetails($event.target.value)\">\n        <option *ngFor=\"let opt of field.workspaceApps; let i = index\"\n         [ngValue]=\"opt\" [selected]=\"i == 0\"\n         [value]=\"opt.name\">{{opt.label}}\n        </option>\n      </select>\n      <!-- divider -->\n      <br/><br/><br/>\n    </ng-container>\n    <!-- The selected workspace type when choosing from the dropdown -->\n    <ng-container *ngIf=\"field.displayAsList == false\">\n      <div class=\"row\">\n        <div *ngIf=\"field.workspaceApp\" class=\"panel panel-default\">\n          <div class=\"panel-heading\">\n            <h4 class=\"panel-title\">{{ field.workspaceApp.label | uppercase }}</h4>\n          </div>\n          <div class=\"panel-body\">\n            <div class=\"row\">\n              <div class=\"col-md-8 col-sm-8 col-xs-8 col-lg-8\">\n                <h5>{{ field.workspaceApp.subtitle }}</h5>\n                <span *ngIf=\"field.rdmp\">\n                  <p>{{ field.workspaceApp.description }}</p>\n                  <button type='button' (click)=\"saveAndOpenWorkspace()\"  class=\"btn btn-primary\">{{ field.open }}</button>\n                </span>\n                <span *ngIf=\"!field.rdmp\">\n                  <p class=\"text-danger\">\n                    <strong>{{ field.saveFirst }}</strong>\n                  </p>\n                </span>\n              </div>\n              <div class=\"col-md-4 col-sm-4 col-xs-4 col-lg-4\">\n                <img src=\"{{ field.workspaceApp.logo }}\" alt=\"{{field.workspaceApp.name}}\">\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n    <!-- When displayed as a list -->\n    <ng-container *ngIf=\"field.displayAsList == true\">\n      <div class=\"row\" *ngFor=\"let workspaceType of field.workspaceApps\">\n        <div class=\"panel panel-default\">\n          <div class=\"panel-heading\">\n            <h4 class=\"panel-title\">{{ workspaceType.label | uppercase }}</h4>\n          </div>\n          <div class=\"panel-body\">\n            <div class=\"row\">\n              <div class=\"col-md-8 col-sm-8 col-xs-8 col-lg-8\">\n                <h5>{{ workspaceType.subtitle }}</h5>\n                <span *ngIf=\"field.rdmp\">\n                  <p>{{ workspaceType.description }}</p>\n                  <button type='button' (click)=\"saveAndOpenWorkspace(workspaceType)\"  class=\"btn btn-primary\">{{ field.open }}</button>\n                </span>\n                <span *ngIf=\"!field.rdmp\">\n                  <p class=\"text-danger\">\n                    <strong>{{ field.saveFirst }}</strong>\n                  </p>\n                </span>\n              </div>\n              <div class=\"col-md-4 col-sm-4 col-xs-4 col-lg-4\">\n                <img src=\"{{ workspaceType.logo }}\" alt=\"{{workspaceType.name}}\">\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n  </div>\n  ",
        })
    ], WorkspaceSelectorFieldComponent);
    return WorkspaceSelectorFieldComponent;
}(WorkspaceSelectorComponent));
exports.WorkspaceSelectorFieldComponent = WorkspaceSelectorFieldComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/loadable.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
/**
 * Convenience class to wrap JQuery calls ...
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 *
 */
var LoadableComponent = /** @class */ (function () {
    function LoadableComponent() {
        this.spinnerElem = "<i class=\"fa fa-spinner fa-pulse fa-1x fa-fw\"></i>";
        this.isLoading = true;
        this.synchLoading();
    }
    LoadableComponent.prototype.initTranslator = function (translationService) {
        var _this = this;
        this.translationService = translationService;
        translationService.isReady(function (tService) {
            _this.translatorReady = true;
        });
    };
    LoadableComponent.prototype.translatorLoaded = function () {
        this.translatorReady = true;
        this.checkIfHasLoaded();
    };
    LoadableComponent.prototype.checkIfHasLoaded = function () {
        if (this.hasLoaded()) {
            this.setLoading(false);
        }
    };
    LoadableComponent.prototype.hasLoaded = function () {
        return this.isLoading && (this.translationService ? this.translatorReady : true);
    };
    LoadableComponent.prototype.setLoading = function (loading) {
        if (loading === void 0) { loading = true; }
        this.isLoading = loading;
        this.synchLoading();
    };
    LoadableComponent.prototype.synchLoading = function () {
        if (this.isLoading) {
            jQuery("#loading").removeClass("hidden");
        }
        else {
            jQuery("#loading").addClass("hidden");
        }
    };
    LoadableComponent.prototype.getTranslated = function (key, defValue) {
        if (!_.isEmpty(key) && !_.isUndefined(key)) {
            // Keys can now be any string, previously, these were required to start with the '@' character
            if (this.translationService) {
                return this.translationService.t(key);
            }
            else {
                return key;
            }
        }
        else {
            return defValue;
        }
    };
    LoadableComponent.prototype.waitForInit = function (serviceArr, handler) {
        var subs = _.map(serviceArr, function (service) { return service.getInitSubject(); });
        var subTracker = { loaded: {}, subs: {} };
        var subTrackerFn = function (serviceIdx) {
            return function (serviceInst) {
                subTracker.loaded["" + serviceIdx] = serviceInst;
                if (_.keys(subTracker.loaded).length >= subs.length) {
                    subTracker.subs["" + serviceIdx].unsubscribe();
                    handler();
                }
            };
        };
        _.forOwn(serviceArr, function (service, serviceIdx) {
            subTracker.subs["" + serviceIdx] = service.getInitSubject().subscribe(subTrackerFn(serviceIdx));
            service.emitInit();
        });
    };
    return LoadableComponent;
}());
exports.LoadableComponent = LoadableComponent;


/***/ }),

/***/ "./redbox-portal/angular/shared/roles-service.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var http_1 = __webpack_require__("./node_modules/@angular/http/esm5/http.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/map.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/toPromise.js");
var base_service_1 = __webpack_require__("./redbox-portal/angular/shared/base-service.ts");
var config_service_1 = __webpack_require__("./redbox-portal/angular/shared/config-service.ts");
/**
 * Role related service
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 */
var RolesService = /** @class */ (function (_super) {
    __extends(RolesService, _super);
    function RolesService(http, configService) {
        var _this = _super.call(this, http, configService) || this;
        _this.configService = configService;
        return _this;
    }
    RolesService.prototype.getBrandRoles = function () {
        var _this = this;
        return this.http.get(this.brandingAndPortalUrl + "/admin/roles/get", this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    RolesService.prototype.updateUserRoles = function (userid, roleIds) {
        var _this = this;
        return this.http.post(this.brandingAndPortalUrl + "/admin/roles/user", { userid: userid, roles: roleIds }, this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    RolesService = __decorate([
        core_1.Injectable(),
        __param(0, core_1.Inject(http_1.Http)), __param(1, core_1.Inject(config_service_1.ConfigService)),
        __metadata("design:paramtypes", [http_1.Http, config_service_1.ConfigService])
    ], RolesService);
    return RolesService;
}(base_service_1.BaseService));
exports.RolesService = RolesService;


/***/ }),

/***/ "./redbox-portal/angular/shared/shared.module.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var angular2_markdown_1 = __webpack_require__("./node_modules/angular2-markdown/index.js");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var platform_browser_1 = __webpack_require__("./node_modules/@angular/platform-browser/esm5/platform-browser.js");
var records_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/records.service.ts");
var field_control_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-control.service.ts");
var field_textfield_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-textfield.component.ts");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var record_meta_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/record-meta.component.ts");
var field_vocab_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-vocab.component.ts");
var field_repeatable_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-repeatable.component.ts");
var field_contributor_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-contributor.component.ts");
var field_pdflist_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-pdflist.component.ts");
var field_relatedobjectdata_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-relatedobjectdata.component.ts");
var field_relatedobjectselector_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-relatedobjectselector.component.ts");
var field_recordpermissions_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-recordpermissions.component.ts");
var field_datalocation_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-datalocation.component.ts");
var field_relatedfileupload_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-relatedfileupload.component.ts");
var field_publishdatalocationselector_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-publishdatalocationselector.component.ts");
var field_andsvocab_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-andsvocab.component.ts");
var field_map_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-map.component.ts");
var workflow_button_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/workflow-button.component.ts");
var action_button_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/action-button.component.ts");
var config_service_1 = __webpack_require__("./redbox-portal/angular/shared/config-service.ts");
var translation_service_1 = __webpack_require__("./redbox-portal/angular/shared/translation-service.ts");
var ng2_datetime_1 = __webpack_require__("./node_modules/ng2-datetime/ng2-datetime.ts");
var ng2_completer_1 = __webpack_require__("./node_modules/ng2-completer/index.js");
var ngx_i18next_1 = __webpack_require__("./node_modules/ngx-i18next/index.js");
var ngx_leaflet_1 = __webpack_require__("./node_modules/@asymmetrik/ngx-leaflet/dist/index.js");
var ngx_leaflet_draw_1 = __webpack_require__("./node_modules/@asymmetrik/ngx-leaflet-draw/dist/index.js");
var dmp_field_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/dmp-field.component.ts");
var user_service_simple_1 = __webpack_require__("./redbox-portal/angular/shared/user.service-simple.ts");
var dashboard_service_1 = __webpack_require__("./redbox-portal/angular/shared/dashboard-service.ts");
var ands_service_1 = __webpack_require__("./redbox-portal/angular/shared/ands-service.ts");
var StringTemplatePipe_1 = __webpack_require__("./redbox-portal/angular/shared/StringTemplatePipe.ts");
var roles_service_1 = __webpack_require__("./redbox-portal/angular/shared/roles-service.ts");
var util_service_1 = __webpack_require__("./redbox-portal/angular/shared/util-service.ts");
var email_service_1 = __webpack_require__("./redbox-portal/angular/shared/email-service.ts");
var field_group_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-group.component.ts");
var workspace_selector_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/workspace-selector.component.ts");
var workspace_service_1 = __webpack_require__("./redbox-portal/angular/shared/workspace-service.ts");
var workspace_field_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/workspace-field.component.ts");
var workspace_selector_component_2 = __webpack_require__("./redbox-portal/angular/shared/form/workspace-selector.component.ts");
var workspace_select_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/workspace-select.component.ts");
var workspace_register_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/workspace-register.component.ts");
var field_control_meta_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-control-meta.service.ts");
var angular_tree_component_1 = __webpack_require__("./node_modules/angular-tree-component/dist/angular-tree-component.js");
var field_asynch_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-asynch.component.ts");
var tree_node_checkbox_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/tree-node-checkbox.component.ts");
var field_publish_data_location_refresh_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-publish-data-location-refresh.component.ts");
var mobx_angular_1 = __webpack_require__("./node_modules/mobx-angular/dist/mobx-angular.js");
var html_event_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/html-event.component.ts");
var SharedModule = /** @class */ (function () {
    function SharedModule() {
    }
    SharedModule = __decorate([
        core_1.NgModule({
            imports: [platform_browser_1.BrowserModule, forms_1.FormsModule, forms_1.ReactiveFormsModule, ng2_datetime_1.NKDatetimeModule, ng2_completer_1.Ng2CompleterModule, ngx_i18next_1.TranslateI18NextModule, ngx_leaflet_1.LeafletModule.forRoot(), ngx_leaflet_draw_1.LeafletDrawModule.forRoot(), angular2_markdown_1.MarkdownModule.forRoot(), angular_tree_component_1.TreeModule, mobx_angular_1.MobxAngularModule],
            exports: [ng2_datetime_1.NKDatetimeModule, ng2_completer_1.Ng2CompleterModule, ngx_i18next_1.TranslateI18NextModule, dmp_field_component_1.DmpFieldComponent, field_textfield_component_1.TextFieldComponent, field_simple_component_1.DropdownFieldComponent, field_simple_component_1.TabOrAccordionContainerComponent, field_simple_component_1.ButtonBarContainerComponent, field_simple_component_1.TextBlockComponent, field_textfield_component_1.MarkdownTextAreaComponent, field_textfield_component_1.TextAreaComponent, field_simple_component_1.DateTimeComponent, field_simple_component_1.AnchorOrButtonComponent, field_vocab_component_1.VocabFieldComponent, field_repeatable_component_1.RepeatableVocabComponent, field_contributor_component_1.ContributorComponent, field_repeatable_component_1.RepeatableContributorComponent, field_simple_component_1.HtmlRawComponent, field_simple_component_1.HiddenValueComponent, workflow_button_component_1.WorkflowStepButtonComponent, action_button_component_1.ActionButtonComponent, field_simple_component_1.LinkValueComponent, field_simple_component_1.SelectionFieldComponent, field_textfield_component_1.RepeatableTextfieldComponent, StringTemplatePipe_1.StringTemplatePipe, field_group_component_1.GenericGroupComponent, field_group_component_1.RepeatableGroupComponent, field_map_component_1.MapComponent, field_simple_component_1.ParameterRetrieverComponent, record_meta_component_1.RecordMetadataRetrieverComponent, field_relatedobjectselector_component_1.RelatedObjectSelectorComponent, field_datalocation_component_1.DataLocationComponent, field_relatedfileupload_component_1.RelatedFileUploadComponent, field_publishdatalocationselector_component_1.PublishDataLocationSelectorComponent, workspace_selector_component_1.WorkspaceSelectorFieldComponent, field_simple_component_1.TabNavButtonComponent, field_simple_component_1.SpacerComponent, workspace_field_component_1.WorkspaceFieldComponent, workspace_selector_component_2.WorkspaceSelectorComponent, workspace_select_component_1.WorkspaceSelectComponent, workspace_select_component_1.WorkspaceSelectFieldComponent, workspace_register_component_1.WorkspaceRegisterComponent, workspace_register_component_1.WorkspaceRegisterFieldComponent, field_andsvocab_component_1.ANDSVocabComponent, field_pdflist_component_1.PDFListComponent, angular_tree_component_1.TreeModule, field_asynch_component_1.AsynchComponent, field_simple_component_1.ToggleComponent, tree_node_checkbox_component_1.TreeNodeCheckboxComponent, field_publish_data_location_refresh_component_1.PublishDataLocationRefreshComponent, html_event_component_1.EventHandlerComponent],
            declarations: [dmp_field_component_1.DmpFieldComponent, field_textfield_component_1.TextFieldComponent, field_simple_component_1.DropdownFieldComponent, field_simple_component_1.TabOrAccordionContainerComponent, field_simple_component_1.ButtonBarContainerComponent, field_simple_component_1.TextBlockComponent, field_textfield_component_1.MarkdownTextAreaComponent, field_textfield_component_1.TextAreaComponent, field_simple_component_1.DateTimeComponent, field_simple_component_1.AnchorOrButtonComponent, field_simple_component_1.SaveButtonComponent, field_simple_component_1.CancelButtonComponent, field_vocab_component_1.VocabFieldComponent, field_repeatable_component_1.RepeatableVocabComponent, field_contributor_component_1.ContributorComponent, field_repeatable_component_1.RepeatableContributorComponent, field_simple_component_1.HtmlRawComponent, field_simple_component_1.HiddenValueComponent, workflow_button_component_1.WorkflowStepButtonComponent, action_button_component_1.ActionButtonComponent, field_simple_component_1.LinkValueComponent, field_simple_component_1.SelectionFieldComponent, field_textfield_component_1.RepeatableTextfieldComponent, field_relatedobjectdata_component_1.RelatedObjectDataComponent, StringTemplatePipe_1.StringTemplatePipe, field_group_component_1.GenericGroupComponent, field_group_component_1.RepeatableGroupComponent, field_map_component_1.MapComponent, field_simple_component_1.ParameterRetrieverComponent, record_meta_component_1.RecordMetadataRetrieverComponent, field_relatedobjectselector_component_1.RelatedObjectSelectorComponent, field_datalocation_component_1.DataLocationComponent, field_relatedfileupload_component_1.RelatedFileUploadComponent, field_publishdatalocationselector_component_1.PublishDataLocationSelectorComponent, workspace_selector_component_1.WorkspaceSelectorFieldComponent, field_simple_component_1.TabNavButtonComponent, field_simple_component_1.SpacerComponent, workspace_field_component_1.WorkspaceFieldComponent, workspace_selector_component_2.WorkspaceSelectorComponent, workspace_select_component_1.WorkspaceSelectComponent, workspace_select_component_1.WorkspaceSelectFieldComponent, workspace_register_component_1.WorkspaceRegisterComponent, workspace_register_component_1.WorkspaceRegisterFieldComponent, field_andsvocab_component_1.ANDSVocabComponent, field_pdflist_component_1.PDFListComponent, field_asynch_component_1.AsynchComponent, field_simple_component_1.ToggleComponent, tree_node_checkbox_component_1.TreeNodeCheckboxComponent, field_publish_data_location_refresh_component_1.PublishDataLocationRefreshComponent, field_recordpermissions_component_1.RecordPermissionsComponent, html_event_component_1.EventHandlerComponent],
            providers: [field_control_service_1.FieldControlService, records_service_1.RecordsService, field_vocab_component_1.VocabFieldLookupService, config_service_1.ConfigService, translation_service_1.TranslationService, user_service_simple_1.UserSimpleService, dashboard_service_1.DashboardService, roles_service_1.RolesService, email_service_1.EmailNotificationService, util_service_1.UtilityService, workspace_service_1.WorkspaceTypeService, field_control_meta_service_1.FieldControlMetaService, ands_service_1.ANDSService],
            bootstrap: [],
            entryComponents: [dmp_field_component_1.DmpFieldComponent, field_textfield_component_1.TextFieldComponent, field_simple_component_1.DropdownFieldComponent, field_simple_component_1.TabOrAccordionContainerComponent, field_simple_component_1.ButtonBarContainerComponent, field_simple_component_1.TextBlockComponent, field_textfield_component_1.MarkdownTextAreaComponent, field_textfield_component_1.TextAreaComponent, field_simple_component_1.DateTimeComponent, field_simple_component_1.AnchorOrButtonComponent, field_simple_component_1.SaveButtonComponent, field_simple_component_1.CancelButtonComponent, field_vocab_component_1.VocabFieldComponent, field_repeatable_component_1.RepeatableVocabComponent, field_contributor_component_1.ContributorComponent, field_repeatable_component_1.RepeatableContributorComponent, field_simple_component_1.HtmlRawComponent, field_simple_component_1.HiddenValueComponent, workflow_button_component_1.WorkflowStepButtonComponent, action_button_component_1.ActionButtonComponent, field_simple_component_1.LinkValueComponent, field_simple_component_1.SelectionFieldComponent, field_textfield_component_1.RepeatableTextfieldComponent, field_relatedobjectdata_component_1.RelatedObjectDataComponent, field_group_component_1.GenericGroupComponent, field_group_component_1.RepeatableGroupComponent, field_map_component_1.MapComponent, field_simple_component_1.ParameterRetrieverComponent, record_meta_component_1.RecordMetadataRetrieverComponent, field_relatedobjectselector_component_1.RelatedObjectSelectorComponent, field_datalocation_component_1.DataLocationComponent, field_relatedfileupload_component_1.RelatedFileUploadComponent, field_publishdatalocationselector_component_1.PublishDataLocationSelectorComponent, workspace_selector_component_1.WorkspaceSelectorFieldComponent, field_simple_component_1.TabNavButtonComponent, field_simple_component_1.SpacerComponent, workspace_field_component_1.WorkspaceFieldComponent, workspace_selector_component_2.WorkspaceSelectorComponent, workspace_select_component_1.WorkspaceSelectComponent, workspace_select_component_1.WorkspaceSelectFieldComponent, workspace_register_component_1.WorkspaceRegisterComponent, workspace_register_component_1.WorkspaceRegisterFieldComponent, field_andsvocab_component_1.ANDSVocabComponent, field_pdflist_component_1.PDFListComponent, field_asynch_component_1.AsynchComponent, field_simple_component_1.ToggleComponent, tree_node_checkbox_component_1.TreeNodeCheckboxComponent, field_publish_data_location_refresh_component_1.PublishDataLocationRefreshComponent, field_recordpermissions_component_1.RecordPermissionsComponent, html_event_component_1.EventHandlerComponent]
        })
    ], SharedModule);
    return SharedModule;
}());
exports.SharedModule = SharedModule;


/***/ }),

/***/ "./redbox-portal/angular/shared/translation-service.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var ngx_i18next_1 = __webpack_require__("./node_modules/ngx-i18next/index.js");
var Subject_1 = __webpack_require__("./node_modules/rxjs/_esm5/Subject.js");
var config_service_1 = __webpack_require__("./redbox-portal/angular/shared/config-service.ts");
/**
 * Translation service...
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 *
 */
var TranslationService = /** @class */ (function () {
    function TranslationService(translateI18Next, configService) {
        this.translateI18Next = translateI18Next;
        this.configService = configService;
        this.subjects = {};
        this.initTranslator();
    }
    TranslationService.prototype.initTranslator = function () {
        var _this = this;
        this.subjects['init'] = new Subject_1.Subject();
        var ts = new Date().getTime();
        this.translateI18Next.init({
            debug: true,
            returnNull: false,
            returnEmptyString: true,
            // mapping: {"specific_backend_message": "message_for_translate"},     // optional
            // browserLanguageDetector: injectableCustomLanguageDetectorService,   // optional - the specific application language detector (allows you to return the language of the user.
            //                                                                     //            If it is absent, the service uses default "angular2 locale detector" behaviour using LOCALE_ID.
            // // supportedLanguages: ['en', 'pt'],                                //            Therefore you can pass the optional supportedLanguages parameter which indicates your supported languages.
            //                                                                     //            For example, LOCALE_ID = 'en-AU' or 'en-US' or 'en', you can pass only ['en'] -> locales/en/translation.json
            //                                                                     //                         LOCALE_ID = 'pt-BR' or 'pt', you can pass only ['pt'] -> locales/pt/translation.json
            // backend: injectableBackendConfigFactory                             // optional - allows to change "loadPath" i18next parameter
            lng: 'en',
            fallbackLng: 'en',
            backend: { loadPath: "/locales/{{lng}}/{{ns}}.json?ts=" + ts }
        }).then(function () {
            console.log("Translator loaded...");
            _this.translatorReady = true;
            _this.translatorLoaded();
        });
    };
    TranslationService.prototype.translatorLoaded = function () {
        if (this.translatorReady) {
            this.subjects['init'].next(this);
        }
    };
    TranslationService.prototype.isReady = function (handler) {
        var subs = this.subjects['init'].subscribe(handler);
        this.translatorLoaded();
        return subs;
    };
    TranslationService.prototype.t = function (key) {
        return this.translateI18Next.translate(key);
    };
    TranslationService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [ngx_i18next_1.TranslateI18Next, config_service_1.ConfigService])
    ], TranslationService);
    return TranslationService;
}());
exports.TranslationService = TranslationService;


/***/ }),

/***/ "./redbox-portal/angular/shared/user.service-simple.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var http_1 = __webpack_require__("./node_modules/@angular/http/esm5/http.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/map.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/toPromise.js");
var base_service_1 = __webpack_require__("./redbox-portal/angular/shared/base-service.ts");
var config_service_1 = __webpack_require__("./redbox-portal/angular/shared/config-service.ts");
/**
 * User related service...
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 *
 */
var UserSimpleService = /** @class */ (function (_super) {
    __extends(UserSimpleService, _super);
    function UserSimpleService(http, configService) {
        var _this = _super.call(this, http, configService) || this;
        _this.configService = configService;
        return _this;
    }
    UserSimpleService.prototype.getInfo = function () {
        var _this = this;
        return this.http.get(this.baseUrl + "/user/info")
            .toPromise()
            .then(function (res) { return _this.extractData(res, 'user'); });
    };
    UserSimpleService.prototype.loginLocal = function (username, password) {
        console.log("Loggin in locally using brand: " + this.config.branding + ", portal: " + this.config.portal);
        return this.http.post(this.baseUrl + "/user/login_local", { username: username, password: password, branding: this.config.branding, portal: this.config.portal }, this.getOptionsClient())
            .toPromise()
            .then(this.extractData);
    };
    UserSimpleService.prototype.getUsers = function () {
        var _this = this;
        return this.http.get(this.brandingAndPortalUrl + "/admin/users/get", this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    UserSimpleService.prototype.updateUserDetails = function (userid, details) {
        var _this = this;
        return this.http.post(this.brandingAndPortalUrl + "/admin/users/update", { userid: userid, details: details }, this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    UserSimpleService.prototype.addLocalUser = function (username, details) {
        var _this = this;
        return this.http.post(this.brandingAndPortalUrl + "/admin/users/newUser", { username: username, details: details }, this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    UserSimpleService.prototype.genKey = function (userid) {
        var _this = this;
        return this.http.post(this.brandingAndPortalUrl + "/admin/users/genKey", { userid: userid }, this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    UserSimpleService.prototype.revokeKey = function (userid) {
        var _this = this;
        return this.http.post(this.brandingAndPortalUrl + "/admin/users/revokeKey", { userid: userid }, this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    UserSimpleService.prototype.updateUserProfile = function (details) {
        var _this = this;
        return this.http.post(this.brandingAndPortalUrl + "/user/update", { details: details }, this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    UserSimpleService.prototype.genUserKey = function () {
        var _this = this;
        return this.http.post(this.brandingAndPortalUrl + "/user/genKey", {}, this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    UserSimpleService.prototype.revokeUserKey = function () {
        var _this = this;
        return this.http.post(this.brandingAndPortalUrl + "/user/revokeKey", {}, this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    UserSimpleService = __decorate([
        core_1.Injectable(),
        __param(0, core_1.Inject(http_1.Http)), __param(1, core_1.Inject(config_service_1.ConfigService)),
        __metadata("design:paramtypes", [http_1.Http, config_service_1.ConfigService])
    ], UserSimpleService);
    return UserSimpleService;
}(base_service_1.BaseService));
exports.UserSimpleService = UserSimpleService;


/***/ }),

/***/ "./redbox-portal/angular/shared/util-service.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var _ = __webpack_require__("./node_modules/lodash/lodash.js");
var moment = __webpack_require__("./node_modules/moment/moment.js");
var numeral = __webpack_require__("./node_modules/numeral/numeral.js");
/**
 * Utility service...
 *
 * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
 *
 */
var UtilityService = /** @class */ (function () {
    function UtilityService() {
    }
    /**
     * returns concatenated string
     *
     * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
     * @param  {any} config
     * @return {string}
     */
    UtilityService.prototype.concatenate = function (data, config) {
        var result = '';
        _.each(config.fields, function (f) {
            if (_.isArray(data)) {
                result = [];
                var itemResult_1 = '';
                _.each(data, function (d) {
                    var fldData = _.get(d, f);
                    // checking if field has data, otherwise will be skipping concat
                    if (fldData) {
                        itemResult_1 = "" + itemResult_1 + (_.isEmpty(itemResult_1) ? '' : config.delim) + fldData;
                    }
                });
                result.push(itemResult_1);
            }
            else {
                var fldData = _.get(data, f);
                if (fldData) {
                    result = "" + result + (_.isEmpty(result) ? '' : config.delim) + fldData;
                }
            }
        });
        return result;
    };
    /**
     * returns a property from the provided object.
     *
     * Author: <a href='https://github.com/andrewbrazzatti' target='_blank'>Andrew Brazzatti</a>
     * @param  {any} config
     * @return {string}
     */
    UtilityService.prototype.getPropertyFromObject = function (data, config) {
        var fieldPath = config.field;
        return _.get(data, fieldPath);
    };
    /**
     * returns a property as Array of 1 item from the provided object.
     *
     * Author: <a href='https://github.com/mattRedBox' target='_blank'>Matt Mulholland</a>
     * @param data
     * @param config
     */
    UtilityService.prototype.getPropertyAsArrayFromObject = function (data, config) {
        return [this.getPropertyFromObject(data, config)];
    };
    /**
     * returns value based on mapping
     *
     * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
     * @param {any} data
     * @param  {any} config - dict of field: field path of data, mapping - array of dict with 'key', the value and the actual mapping value 'val', 'default' - the value if there's no match
     * @return {any}
     */
    UtilityService.prototype.getPropertyFromObjectMapping = function (data, config) {
        var fieldPath = config.field;
        var val = _.isUndefined(fieldPath) ? data : _.get(data, fieldPath);
        var foundMapping = _.find(config.mapping, function (mapEntry) {
            return "" + mapEntry.key == "" + val;
        });
        return foundMapping ? foundMapping.value : config.default;
    };
    /**
     * returns true if value is not null, undefined, empty
     *
     * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
     * @param {any} data
     * @param  {any} config
     * @return {string}
     */
    UtilityService.prototype.hasValue = function (data, config) {
        if (config === void 0) { config = null; }
        return !_.isEmpty(data) && !_.isUndefined(data) && !_.isNull(data);
    };
    /**
     * returns an array of concatenated values
     *
     * Author: <a href='https://github.com/shilob' target='_blank'>Shilo Banihit</a>
     * @param {any} data
     * @param  {any} config - dict of field: array of field paths to concat
     * @return {string}
     */
    UtilityService.prototype.getPropertyFromObjectConcat = function (data, config) {
        var values = [];
        _.each(config.field, function (f) {
            values.push(_.get(data, f));
        });
        return _.concat.apply(_, [[]].concat(values));
    };
    /**
     * Splits a string into an array by it's delimiter
     *
     * Author: <a href='https://github.com/andrewbrazzatti' target='_blank'>Andrew Brazzatti</a>
     * @param {any} data
     * @param  {any} config - The delimiter
     * @return {string}
     */
    UtilityService.prototype.splitStringToArray = function (data, config) {
        var delim = config.delim;
        var field = config.field;
        var value = data;
        if (field) {
            value = _.get(data, field);
        }
        return value.split(delim);
    };
    /**
     * Splits a string of arrays into an array by it's delimiter
     *
     * Author: <a href='https://github.com/moisbo' target='_blank'>Moises Sacal Bonequi</a>
     * @param {any} data
     * @param  {any} config - The delimiter
     * @return {array}
     */
    UtilityService.prototype.splitArrayStringsToArray = function (data, config) {
        var regex = config.regex || ',';
        var flags = config.flags || 'g';
        var reg = new RegExp(regex, flags);
        var regexTrail = config.regexTrail || '(^,)|(,$)';
        var flagsTrail = config.flagsTrail || 'g';
        var regTrail = new RegExp(regexTrail, flagsTrail);
        var field = config.field;
        var value = data;
        if (field) {
            value = _.get(data, field);
        }
        var values = [];
        _.each(value, function (v) {
            if (v) {
                v = v.replace(regTrail, '');
            }
            values.push(v.split(reg).map(function (item) { return item.trim(); }));
        });
        return _.concat.apply(_, [[]].concat(values));
    };
    /**
     * Splits a string of arrays into an array by it's delimiter
     *
     * Author: <a href='https://github.com/moisbo' target='_blank'>Moises Sacal Bonequi</a>
     * @param {any} data
     * @param  {any} config - The delimiter
     * @return {array}
     */
    UtilityService.prototype.getFirstofArray = function (data, config) {
        var delim = config.delim;
        var field = config.field;
        var value = data;
        if (field) {
            value = _.get(data, field);
        }
        return _.first(value);
    };
    /**
     * Format date with moment from origin to target
     *
     * Author: <a href='https://github.com/moisbo' target='_blank'>Moises Sacal Bonequi</a>
     * @param {any} data
     * @param  {any} config - field, formatOrigin, formatTarget
     * @return {array}
     */
    UtilityService.prototype.convertToDateFormat = function (data, config) {
        var delim = config.delim;
        var field = config.field;
        var formatOrigin = config.formatOrigin || 'DD-MMM-YY';
        var formatTarget = config.formatTarget || 'YYYY-MM-DD';
        var value = data;
        if (field) {
            value = _.get(data, field);
        }
        var converted = moment(value, formatOrigin).format(formatTarget);
        console.log("convertToDateFormat " + converted);
        return converted;
    };
    UtilityService.prototype.joinArray = function (data, config, fieldName, fieldSeparator) {
        if (fieldName === void 0) { fieldName = null; }
        if (fieldSeparator === void 0) { fieldSeparator = null; }
        return _.join(_.get(data, fieldName ? fieldName : config.field), fieldSeparator ? fieldSeparator : config.separator);
    };
    UtilityService.prototype.runTemplate = function (data, config) {
        var imports = _.extend({ data: data, config: config, moment: moment, numeral: numeral }, this);
        var templateData = { imports: imports };
        var template = _.template(config.template, templateData);
        var templateRes = template();
        // added ability to parse the string template result into JSON
        // requirement: template must return a valid JSON string object
        if (config.json == true && !_.isEmpty(templateRes)) {
            return JSON.parse(templateRes);
        }
        return templateRes;
    };
    UtilityService.prototype.todaysDate = function (data, config) {
        var format = config.format || 'YYYY-MM-DD';
        return moment().local().format(format);
    };
    UtilityService = __decorate([
        core_1.Injectable()
    ], UtilityService);
    return UtilityService;
}());
exports.UtilityService = UtilityService;


/***/ }),

/***/ "./redbox-portal/angular/shared/workspace-service.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) 2017 Queensland Cyber Infrastructure Foundation (http://www.qcif.edu.au/)
//
// GNU GENERAL PUBLIC LICENSE
//    Version 2, June 1991
//
// This program is free software; you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation; either version 2 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License along
// with this program; if not, write to the Free Software Foundation, Inc.,
// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var http_1 = __webpack_require__("./node_modules/@angular/http/esm5/http.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/map.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/toPromise.js");
var base_service_1 = __webpack_require__("./redbox-portal/angular/shared/base-service.ts");
var config_service_1 = __webpack_require__("./redbox-portal/angular/shared/config-service.ts");
/**
 * Role related service
 *
 * Author: <a href='https://github.com/moisbo' target='_blank'>moisbo</a>
 */
var WorkspaceTypeService = /** @class */ (function (_super) {
    __extends(WorkspaceTypeService, _super);
    function WorkspaceTypeService(http, configService) {
        var _this = _super.call(this, http, configService) || this;
        _this.configService = configService;
        return _this;
    }
    WorkspaceTypeService.prototype.getBrand = function () {
        return this.brandingAndPortalUrl;
    };
    WorkspaceTypeService.prototype.getWorkspaceTypes = function () {
        var _this = this;
        return this.http.get(this.brandingAndPortalUrl + "/workspaces/types", this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    WorkspaceTypeService.prototype.getWorkspaceType = function (name) {
        var _this = this;
        return this.http.get(this.brandingAndPortalUrl + "/workspaces/types/" + name, this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    WorkspaceTypeService.prototype.getAvailableWorkspaces = function () {
        var _this = this;
        console.log('getting workspaces list');
        return this.http.get(this.brandingAndPortalUrl + "/workspaces/available", this.options)
            .toPromise()
            .then(function (res) { return _this.extractData(res); });
    };
    WorkspaceTypeService.prototype.createWorkspace = function (rdmpId, workspaceInfo, workspaceType) {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_1;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/workspaces/create';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.http.post(wsUrl, {
                                rdmp: rdmpId,
                                workspaceInfo: workspaceInfo,
                                workspaceType: workspaceType
                            }, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve(this.extractData(result))];
                    case 3:
                        e_1 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_1))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    WorkspaceTypeService = __decorate([
        core_1.Injectable(),
        __param(0, core_1.Inject(http_1.Http)), __param(1, core_1.Inject(config_service_1.ConfigService)),
        __metadata("design:paramtypes", [http_1.Http, config_service_1.ConfigService])
    ], WorkspaceTypeService);
    return WorkspaceTypeService;
}(base_service_1.BaseService));
exports.WorkspaceTypeService = WorkspaceTypeService;


/***/ }),

/***/ "./src/$$_lazy_route_resource lazy recursive":
/***/ (function(module, exports) {

function webpackEmptyAsyncContext(req) {
	// Here Promise.resolve().then() is used instead of new Promise() to prevent
	// uncatched exception popping up in devtools
	return Promise.resolve().then(function() {
		throw new Error("Cannot find module '" + req + "'.");
	});
}
webpackEmptyAsyncContext.keys = function() { return []; };
webpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;
module.exports = webpackEmptyAsyncContext;
webpackEmptyAsyncContext.id = "./src/$$_lazy_route_resource lazy recursive";

/***/ }),

/***/ "./src/app/components/helpers.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var WorkspaceUser = /** @class */ (function () {
    function WorkspaceUser() {
    }
    return WorkspaceUser;
}());
exports.WorkspaceUser = WorkspaceUser;
var Checks = /** @class */ (function () {
    function Checks() {
        this.link = undefined;
        this.rdmp = false;
        this.linkCreated = false;
        this.linkWithOther = false;
        this.master = false;
        this.comparing = false;
    }
    Checks.prototype.clear = function () {
        this.linkCreated = false;
        this.linkWithOther = false;
    };
    return Checks;
}());
exports.Checks = Checks;
var Creation = /** @class */ (function () {
    function Creation() {
        this.created = false;
        this.name = '';
        this.blank = true;
        this.description = '';
    }
    Creation.prototype.clear = function () {
        this.location = '';
        this.description = '';
        this.name = '';
        this.id = '';
    };
    Creation.prototype.nameHasSpaces = function () {
        return /\s/g.test(this.name);
    };
    return Creation;
}());
exports.Creation = Creation;
var CreationAlert = /** @class */ (function () {
    function CreationAlert() {
        this.message = '';
        this.className = 'danger';
        this.status = '';
    }
    CreationAlert.prototype.set = function (_a) {
        var message = _a.message, status = _a.status, className = _a.className;
        this.message = message;
        this.status = status;
        this.className = className;
    };
    CreationAlert.prototype.clear = function () {
        this.message = '';
        this.className = 'danger';
        this.status = '';
    };
    return CreationAlert;
}());
exports.CreationAlert = CreationAlert;
var CurrentWorkspace = /** @class */ (function () {
    function CurrentWorkspace() {
        this.path_with_namespace = '';
        this.web_url = '';
    }
    return CurrentWorkspace;
}());
exports.CurrentWorkspace = CurrentWorkspace;


/***/ }),

/***/ "./src/app/components/labarchives-create.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var helpers_1 = __webpack_require__("./src/app/components/helpers.ts");
var labarchives_service_1 = __webpack_require__("./src/app/labarchives.service.ts");
/**
 * Contributor Model
 *
 * @author <a target='_' href='https://github.com/moisbo'>moisbo</a>
 *
 */
var LabarchivesCreateField = /** @class */ (function (_super) {
    __extends(LabarchivesCreateField, _super);
    function LabarchivesCreateField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.processing = false;
        _this.processingStart = true;
        _this.processingFinished = false;
        _this.errorMessages = [];
        _this.LinkItem = new core_1.EventEmitter();
        _this.link = new core_1.EventEmitter();
        _this.labarchivesService = _this.getFromInjector(labarchives_service_1.LabarchivesService);
        _this.closeLabel = 'Close';
        _this.processing = false;
        _this.workspaceDetailsTitle = 'Workspace';
        _this.workspaceDefinition = '';
        _this.currentWorkspace = {};
        _this.createNotebookHelp = options['createNotebookHelp'] || '';
        _this.createNotebookHelp2 = options['createNotebookHelp2'] || '';
        _this.createNotebookLabel = options['createNotebookLabel'] || '';
        _this.notebookLabel = options['notebookLabel'] || '';
        _this.supervisorLabel = options['supervisorLabel'] || '';
        _this.creatingLabel = options['creatingLabel'] || '';
        _this.linkingLabel = options['linkingLabel'] || '';
        _this.supervisorFailMessage = options['supervisorFailMessage'] || 'Supervisor has not logged in to LabArchives';
        _this.processingSuccess = options['processingSuccess'] || 'Success';
        _this.processingFail = options['processingFail'] || 'There was a problem linking your workspace, please try again later';
        _this.processingStatus = '';
        _this.processingNoPermission = options['processingNoPermission'] || 'You are not allowed to modify this item';
        _this.processingLabel = options['processingLabel'] || 'Processing...';
        _this.processingMessage = '';
        _this.checks = new helpers_1.Checks();
        return _this;
    }
    LabarchivesCreateField.prototype.init = function () {
        this.rdmp = this.fieldMap._rootComp.rdmp;
    };
    LabarchivesCreateField.prototype.registerEvents = function () {
        this.fieldMap['List'].field['create'].subscribe(this.createModal.bind(this));
    };
    LabarchivesCreateField.prototype.createFormModel = function (valueElem) {
        if (valueElem === void 0) { valueElem = undefined; }
        if (valueElem) {
            this.value = valueElem;
        }
        this.formModel = new forms_1.FormControl(this.value || []);
        if (this.value) {
            this.setValue(this.value);
        }
        return this.formModel;
    };
    LabarchivesCreateField.prototype.setValue = function (value) {
        this.formModel.patchValue(value, { emitEvent: false });
        this.formModel.markAsTouched();
    };
    LabarchivesCreateField.prototype.setEmptyValue = function () {
        this.value = [];
        return this.value;
    };
    LabarchivesCreateField.prototype.createModal = function () {
        return __awaiter(this, void 0, void 0, function () {
            var rdmpInfo, userInfo, user, recordMetadata;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.labarchivesService.rdmpInfo(this.rdmp)];
                    case 1:
                        rdmpInfo = _a.sent();
                        return [4 /*yield*/, this.labarchivesService.getUserInfo()];
                    case 2:
                        userInfo = _a.sent();
                        user = userInfo['user'];
                        this.userEmail = user['email'];
                        recordMetadata = rdmpInfo['recordMetadata'];
                        if (recordMetadata['contributor_ci'] && recordMetadata['contributor_ci']['email']) {
                            this.supervisorEmail = recordMetadata['contributor_ci']['email'];
                        }
                        jQuery('#createModal').modal('show');
                        return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesCreateField.prototype.createNotebook = function () {
        return __awaiter(this, void 0, void 0, function () {
            var createNotebook, e_1;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        this.processing = false;
                        if (!this.validate()) return [3 /*break*/, 5];
                        this.processing = true;
                        this.processingStart = true;
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        this.processingStatus = 'Creating Notebook...';
                        return [4 /*yield*/, this.labarchivesService.createNotebook(this.rdmp, this.notebookName, this.supervisorEmail, this.userEmail)];
                    case 2:
                        createNotebook = _a.sent();
                        console.log(createNotebook);
                        this.processingStart = false;
                        this.processingFinished = true;
                        this.processingStatus = 'Your notebook has been created';
                        jQuery('#createModal').modal('hide');
                        this.link.emit({ name: createNotebook.name, id: createNotebook.nb });
                        return [3 /*break*/, 4];
                    case 3:
                        e_1 = _a.sent();
                        this.processingStatus = 'There was an error creating your notebook';
                        return [3 /*break*/, 4];
                    case 4: return [3 /*break*/, 6];
                    case 5:
                        this.processingFail = '';
                        _a.label = 6;
                    case 6: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesCreateField.prototype.validate = function () {
        this.errorMessages = [];
        if (this.notebookName) {
            //other validations
        }
        else {
            this.errorMessages.push('verify Notebook Name');
        }
        if (this.supervisorEmail) {
            //other validations
        }
        else {
            this.errorMessages.push('supervisor Email is blank');
        }
        if (this.errorMessages.length > 0) {
            return false;
        }
        else {
            return true;
        }
    };
    __decorate([
        core_1.Input(),
        __metadata("design:type", core_1.EventEmitter)
    ], LabarchivesCreateField.prototype, "LinkItem", void 0);
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], LabarchivesCreateField.prototype, "link", void 0);
    return LabarchivesCreateField;
}(field_base_1.FieldBase));
exports.LabarchivesCreateField = LabarchivesCreateField;
/**
 * Component that Links Workspaces to Workspace Records in Stash
 */
var LabarchivesCreateComponent = /** @class */ (function (_super) {
    __extends(LabarchivesCreateComponent, _super);
    function LabarchivesCreateComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabarchivesCreateComponent.prototype.ngOnInit = function () {
        this.field.init();
        this.field.registerEvents();
    };
    LabarchivesCreateComponent = __decorate([
        core_1.Component({
            selector: 'ws-labarchivescreate',
            template: "\n    <div id=\"createModal\" class=\"modal fade\" data-keyboard=\"false\">\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header\">\n            <h4 class=\"modal-title\">Create Workspace</h4>\n          </div>\n          <div class=\"modal-body\">\n            <div *ngIf=\"field.processingStart\">\n              <h5>{{ field.createNotebookHelp }}</h5>\n              <p>{{ field.createNotebookHelp2 }}</p>\n              <div class=\"form-group\">\n                <label>{{ field.notebookLabel }}</label>\n                <input type=\"text\" class=\"form-control\" [(ngModel)]=\"field.notebookName\" name=\"notebookName\" ngModel\n                       attr.aria-label=\"{{ field.notebookName }}\">\n              </div>\n              <div class=\"form-group\">\n                <label>{{ field.supervisorLabel }}</label>\n                <input type=\"text\" class=\"form-control\" [(ngModel)]=\"field.supervisorEmail\" name=\"supervisorLabel\"\n                       ngModel\n                       attr.aria-label=\"{{ field.supervisorEmail }}\" disabled=\"true\">\n              </div>\n              <div class=\"form-group\">\n                <button *ngIf=\"waitForProcessing\" type=\"button\" class=\"form-control btn btn-block btn-primary\"\n                        (click)=\"field.createNotebook()\"\n                        attr.aria-label=\"{{ field.createNotebookLabel }}\">{{ field.createNotebookLabel }}</button>\n              </div>\n              <div class=\"form-group\">\n                <div>{{ field.processingStatus }}</div>\n              </div>\n              <div class=\"form-group\">\n                <div class=\"alert-danger\">\n                  <ul class=\"list-group\">\n                    <li class=\"list-group-item\" *ngFor=\"let msg of field.errorMessages\">{{msg}}</li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n            <div *ngIf=\"field.processingFinished\"></div>\n          </div>\n          <div class=\"modal-footer\">\n            <span *ngIf=\"field.processing; then waitForProcessing; else finishProcessing\"></span>\n            <ng-template #finishProcessing>\n              <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">{{ field.closeLabel }}</button>\n            </ng-template>\n            <ng-template #waitForProcessing>\n              <button type=\"button\" class=\"btn btn-secondary disabled\" data-dismiss=\"modal\">{{ field.closeLabel }}\n              </button>\n            </ng-template>\n          </div>\n        </div>\n      </div>\n    </div>\n  "
        })
    ], LabarchivesCreateComponent);
    return LabarchivesCreateComponent;
}(field_simple_component_1.SimpleComponent));
exports.LabarchivesCreateComponent = LabarchivesCreateComponent;


/***/ }),

/***/ "./src/app/components/labarchives-export.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var labarchives_service_1 = __webpack_require__("./src/app/labarchives.service.ts");
var LabarchivesExportField = /** @class */ (function (_super) {
    __extends(LabarchivesExportField, _super);
    function LabarchivesExportField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.list = new core_1.EventEmitter();
        _this.labarchivesService = _this.getFromInjector(labarchives_service_1.LabarchivesService);
        _this.iscValues = [
            { name: 'Confidential', value: 'confidential' },
            { name: 'Sensitive', value: 'sensitive' },
            { name: 'Internal', value: 'internal' },
            { name: 'Public', value: 'public' }
        ];
        _this.retentionValues = [
            { name: '1 year', value: '1year' },
            { name: '5 years', value: '5years' },
            { name: '7 years', value: '7years' },
            { name: '25 years', value: '25years' },
            { name: 'Permanent', value: 'permanent' }
        ];
        _this.pleaseSelectLabel = 'Please Select';
        return _this;
    }
    LabarchivesExportField.prototype.registerEvents = function () {
        this.fieldMap['List'].field['goToExporter'].subscribe(this.showNotebook.bind(this));
    };
    LabarchivesExportField.prototype.init = function () {
        this.rdmp = this.fieldMap._rootComp.rdmp;
        this.action = this.fieldMap._rootComp.action;
        this.workspaceId = this.fieldMap._rootComp.workspaceId;
        this.restartExport();
        if (this.action === 'archive') {
            console.log('loaded exporter');
            this.showNotebook();
        }
        else {
            console.log('loaded list');
            this.list.emit();
        }
        this.loading = true;
    };
    LabarchivesExportField.prototype.showNotebook = function (item) {
        var _this = this;
        this.retention = new forms_1.FormControl('');
        this.disposal = new forms_1.FormControl('');
        this.isc = new forms_1.FormControl('');
        this.requestGroupForm = new forms_1.FormGroup({ retention: this.retention, disposal: this.disposal, isc: this.isc });
        this.nbId = null;
        if (item.id) {
            this.nbId = item.id;
            this.labarchivesService.notebookInfo(this.rdmp, this.nbId)
                .then(function (response) {
                if (response.nb && response.nb.notebooks && response.nb.notebooks.notebook) {
                    _this.workspace = response.nb.notebooks.notebook;
                }
            }).catch(function (e) {
                console.error(e);
            });
        }
        else {
            // Find the Id of the notebook
            this.rdmp = this.fieldMap._rootComp.rdmp;
            this.workspaceId = this.fieldMap._rootComp.workspaceId;
            this.loading = true;
            this.workspace = null;
            console.log('showNotebook');
            this.labarchivesService.findNotebook(this.rdmp, this.workspaceId)
                .then(function (response) {
                _this.workspace = response.nb.notebook;
            }).catch(function (e) {
                _this.anyError = e.message;
                console.error(e);
            });
        }
    };
    LabarchivesExportField.prototype.requiredFields = function () {
        return this.retention.value && this.disposal.value && this.isc.value;
    };
    LabarchivesExportField.prototype.exportNotebook = function () {
        var _this = this;
        if (!this.requiredFields()) {
            this.anyError = 'Please input required fields: Retention Period, Disposal Date and Security Classification';
        }
        else {
            this.anyError = null;
            this.processingExport = true;
            this.labarchivesService.exportNotebook(this.rdmp, this.nbId)
                .then(function (response) {
                if (response.status) {
                    _this.processedNotebook = response.nb;
                    _this.notebookExported = true;
                }
                else {
                    console.log('there was an error starting the export');
                }
                _this.processingExport = false;
                return _this.zipAndReturn();
            }).catch(function (e) {
                console.error(e);
                _this.anyError = e.message;
                _this.processingExport = false;
            });
        }
    };
    LabarchivesExportField.prototype.zipAndReturn = function () {
        var _this = this;
        this.processingZipAndReturn = true;
        if (this.processedNotebook) {
            this.labarchivesService.zipNotebook(this.processedNotebook)
                .then(function (zip) {
                _this.exportStatus = zip;
                _this.zipReturnInterval = setInterval(function () {
                    _this.labarchivesService.returnNotebook(_this.processedNotebook)
                        .then(function (returnNotebook) {
                        if (returnNotebook.status) {
                            clearInterval(_this.zipReturnInterval);
                            _this.exportStatus = returnNotebook;
                            _this.notebookProcessed = true;
                            _this.processingZipAndReturn = false;
                            return _this.createDataRecord();
                        }
                    }).catch(function (e) {
                        console.error(e);
                        _this.processingZipAndReturn = false;
                    });
                }, 1000);
            }).catch(function (e) {
                _this.anyError = e.message;
                console.error(e);
            });
        }
        else {
            console.log('notebook not yet processed');
        }
    };
    LabarchivesExportField.prototype.createDataRecord = function () {
        return __awaiter(this, void 0, void 0, function () {
            var notebookTitle, notebookFile, rdmpTitle, isHdr, contributor_ci, contributor_data_manager, keywords, dataRecord;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        this.processingDataRecord = true;
                        notebookTitle = this.workspace.name;
                        if (!this.exportStatus['nb']) return [3 /*break*/, 2];
                        notebookFile = this.exportStatus['nb'];
                        rdmpTitle = this.fieldMap._rootComp.rdmpMetadata['title'];
                        isHdr = this.fieldMap._rootComp.rdmpMetadata['project_hdr'] || false;
                        contributor_ci = this.fieldMap._rootComp.rdmpMetadata['contributor_ci'];
                        contributor_data_manager = this.fieldMap._rootComp.rdmpMetadata['contributor_data_manager'];
                        keywords = this.fieldMap._rootComp.rdmpMetadata['finalKeywords'] || [];
                        return [4 /*yield*/, this.labarchivesService.createDataRecord(this.rdmp, rdmpTitle, isHdr, notebookFile, notebookTitle, this.retention.value.value, this.disposal.value, this.isc.value.value, contributor_ci, contributor_data_manager, keywords)];
                    case 1:
                        dataRecord = _a.sent();
                        if (dataRecord.status) {
                            this.dataRecord = dataRecord.recordId;
                            this.dataRecordURL = this.labarchivesService.recordURL + '/' + this.dataRecord;
                            this.dataRecordSaved = true;
                        }
                        else {
                            this.anyError = dataRecord.message;
                            this.dataRecordError = true;
                        }
                        return [3 /*break*/, 3];
                    case 2:
                        alert('no notebook exported');
                        _a.label = 3;
                    case 3:
                        this.processingDataRecord = false;
                        return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesExportField.prototype.checkExport = function (item) {
        var _this = this;
        this.workspaces = null;
        this.labarchivesService.checkExport(this.workspace)
            .then(function (response) {
            console.log(response);
            _this.exportStatus = 'working';
        })
            .catch(function (error) {
            console.error(error);
        });
    };
    LabarchivesExportField.prototype.restartExport = function () {
        this.dataRecordURL = null;
        this.processingDataRecord = false;
        this.processingZipAndReturn = false;
        this.processingDataRecord = false;
        this.notebookExported = false;
        this.dataRecordSaved = false;
        this.notebookProcessed = false;
        this.dataRecordError = false;
        this.anyError = null;
    };
    LabarchivesExportField.prototype.showWorkspaces = function () {
        this.workspace = null;
        this.list.emit();
    };
    LabarchivesExportField.prototype.logOut = function () {
        alert('not implemented');
    };
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], LabarchivesExportField.prototype, "list", void 0);
    return LabarchivesExportField;
}(field_base_1.FieldBase));
exports.LabarchivesExportField = LabarchivesExportField;
var LabarchivesExportComponent = /** @class */ (function (_super) {
    __extends(LabarchivesExportComponent, _super);
    function LabarchivesExportComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabarchivesExportComponent.prototype.ngOnInit = function () {
        this.field.registerEvents();
    };
    LabarchivesExportComponent.prototype.ngAfterContentInit = function () {
        this.field.init();
    };
    LabarchivesExportComponent = __decorate([
        core_1.Component({
            selector: 'ws-labarchivesexport',
            template: "\n    <div class=\"container-fluid\">\n      <div *ngIf=\"field.workspace\" class=\"row\">\n        <form [formGroup]=\"field.requestGroupForm\"\n              id=\"form\"\n              novalidate autocomplete=\"off\">\n          <h2>Export your notebook: <strong>{{ field.workspace.name }}</strong></h2>\n          <div class=\"container-fluid\">\n            <div class=\"row\">\n              <div class=\"col-sm-4 col-md-4\">\n                <div class=\"form-group\">\n                  <label>Retention Period:</label>\n                  <select [formControl]=\"field.retention\"\n                          class=\"form-control\">\n                    <option [ngValue]=\"null\" [selected]=\"true\">{{ field.pleaseSelectLabel }}</option>\n                    <option *ngFor=\"let t of field.retentionValues\"\n                            [ngValue]=\"t\">{{t.name}}</option>\n                  </select>\n                </div>\n              </div>\n              <div class=\"col-sm-4 col-md-4\">\n                <div class=\"form-group\">\n                  <label>Disposal Date:</label>\n                  <datetime #dateTime [formControl]=\"field.disposal\"\n                            [timepicker]=\"false\"\n                            [datepicker]=\"{format: 'dd/mm/yyyy', icon: 'fa fa-calendar', autoclose: true}\"\n                            [hasClearButton]=\"false\"></datetime>\n                </div>\n              </div>\n              <div class=\"col-sm-4 col-md-4\">\n                <div class=\"form-group\">\n                  <label>Security Classification:</label>\n                  <select [formControl]=\"field.isc\"\n                          class=\"form-control\">\n                    <option [ngValue]=\"null\" [selected]=\"true\">{{ field.pleaseSelectLabel }}</option>\n                    <option *ngFor=\"let t of field.iscValues\"\n                            [ngValue]=\"t\">{{t.name}}</option>\n                  </select>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div class=\"container-fluid\">\n            <div class=\"row\">\n              <div class=\"col-sm-4 col-md-4\">\n                <div class=\"card\">\n                  <div class=\"panel panel-default\">\n                    <div class=\"panel-heading\">\n                      <h5 class=\"panel-title card-title\" style=\"margin-top: 1px\">\n                        <span>Export</span>\n                      </h5>\n                    </div>\n                    <div class=\"panel-body\" [ngClass]=\"field.processingExport === true ? 'overlay-div' : ''\">\n                      <div class=\"text-center\">\n                        <i class=\"fa fa-book fa-5x\" aria-hidden=\"true\"></i>\n                        <div class=\"card-body\" style=\"margin-bottom: auto;\">\n                          <h5 class=\"card-title\" style=\"margin-top: 2px\">\n                            <span>Generate Export</span>\n                          </h5>\n                        </div>\n                        <span *ngIf=\"!field.notebookExported && !field.processingExport\">\n                          <i class=\"fa fa-circle-o fa-4x\" style=\"color:#cccccc\"></i>\n                        </span>\n                        <span *ngIf=\"field.notebookExported\">\n                          <i class=\"fa fa-check fa-4x\" style=\"color:green\"></i>\n                        </span>\n                        <span *ngIf=\"field.processingExport\">\n                          <i class=\"fa fa-spinner fa-spin fa-4x\"></i>\n                        </span>\n                      </div>\n                    </div>\n                    <div class=\"card-footer\" style=\"margin-top: auto;\">\n                      <button (click)=\"field.exportNotebook()\"\n                              [attr.disabled]=\"field.processingExport || field.notebookExported ? '' : null\"\n                              class=\"btn btn-block btn-primary\">Export Notebook\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"col-sm-4 col-md-4\">\n                <div class=\"card\">\n                  <div class=\"panel panel-default\">\n                    <div class=\"panel-heading\">\n                      <h5 class=\"panel-title card-title\" style=\"margin-top: 1px\">\n                        <span>Process</span>\n                      </h5>\n                    </div>\n                    <div class=\"panel-body\" [ngClass]=\"field.processingZipAndReturn ? 'overlay-div' : ''\">\n                      <div class=\"text-center\">\n                        <i class=\"fa fa-file-archive-o fa-5x\" aria-hidden=\"true\"></i>\n                        <div class=\"card-body\" style=\"margin-bottom: auto;\">\n                          <h5 class=\"card-title\" style=\"margin-top: 2px\">\n                            <span>Process {{field.workspace.name }}</span>\n                          </h5>\n                        </div>\n                        <span *ngIf=\"!field.notebookProcessed && !field.processingZipAndReturn\">\n                          <i class=\"fa fa-circle-o fa-4x\" style=\"color:#cccccc\"></i>\n                        </span>\n                        <span *ngIf=\"field.notebookProcessed\">\n                          <i class=\"fa fa-check fa-4x\" style=\"color:green\"></i>\n                        </span>\n                        <span *ngIf=\"field.processingZipAndReturn\">\n                          <i class=\"fa fa-spinner fa-spin fa-4x\"></i>\n                        </span>\n                      </div>\n                    </div>\n                    <div class=\"card-footer\" style=\"margin-top: auto;\">\n                      <button (click)=\"field.zipAndReturn()\"\n                              [attr.disabled]=\"field.processingZipAndReturn || field.notebookProcessed ? '' : null\"\n                              class=\"btn btn-block btn-primary\">Process Notebook\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class=\"col-sm-4 col-md-4\">\n                <div class=\"card\">\n                  <div class=\"panel panel-default\">\n                    <div class=\"panel-heading\">\n                      <h5 class=\"panel-title card-title\" style=\"margin-top: 1px\">\n                        <span>Register</span>\n                      </h5>\n                    </div>\n                    <div class=\"panel-body\" [ngClass]=\"field.processingDataRecord ? 'overlay-div' : ''\">\n                      <div class=\"text-center\">\n                        <i class=\"fa fa-floppy-o fa-5x\" aria-hidden=\"true\"></i>\n                        <div class=\"card-body\" style=\"margin-bottom: auto;\">\n                          <h5 class=\"card-title\" style=\"margin-top: 2px\">\n                            <span>Create Data Record</span>\n                          </h5>\n                        </div>\n                        <span *ngIf=\"!field.dataRecordSaved && !field.processingDataRecord && !field.dataRecordError\">\n                          <i class=\"fa fa-circle-o fa-4x\" style=\"color:#cccccc\"></i>\n                        </span>\n                        <span *ngIf=\"field.dataRecordSaved\">\n                          <i class=\"fa fa-check fa-4x\" style=\"color:green\"></i>\n                        </span>\n                        <span *ngIf=\"field.dataRecordError\">\n                          <i class=\"fa fa-exclamation fa-4x\" style=\"color:red\"></i>\n                        </span>\n                        <span *ngIf=\"field.processingDataRecord\">\n                          <i class=\"fa fa-spinner fa-spin fa-4x\"></i>\n                        </span>\n                      </div>\n                    </div>\n                    <div class=\"card-footer\" style=\"margin-top: auto;\">\n                      <button (click)=\"field.createDataRecord()\"\n                              [attr.disabled]=\"field.processingDataRecord || field.dataRecordSaved ? '' : null\"\n                              class=\"btn btn-block btn-primary\">Create Data Record\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </form>\n      </div>\n      <div class=\"container-fluid text-center\">\n        <div class=\"row\">\n          <div *ngIf=\"field.dataRecordURL\" class=\"col-sm-12 alert alert-success\">\n            <p>Data Record generated; <a class=\"underline\" href=\"{{ field.dataRecordURL }}\">\n              click here to open</a></p>\n          </div>\n        </div>\n        <div class=\"row\">\n          <div *ngIf=\"field.anyError\" class=\"col-sm-12 alert alert-danger\">\n            <p>\n              {{ field.anyError }}\n            </p>\n          </div>\n        </div>\n      </div>\n      <div class=\"container-fluid\">\n        <div class=\"row\">&nbsp;</div>\n        <div class=\"row\">\n          <button (click)=\"field.restartExport()\"\n                  class=\"btn btn-secondary\">Restart Export\n          </button>\n          <button (click)=\"field.showWorkspaces()\"\n                  class=\"btn btn-primary\">Back to your Notebooks\n          </button>\n        </div>\n        <div class=\"row\">&nbsp;</div>\n      </div>\n    </div>\n  ",
            styles: ['.overlay-div { height:100%; width: 100%; background-color:#ccc; opacity:.7;}']
        })
    ], LabarchivesExportComponent);
    return LabarchivesExportComponent;
}(field_simple_component_1.SimpleComponent));
exports.LabarchivesExportComponent = LabarchivesExportComponent;


/***/ }),

/***/ "./src/app/components/labarchives-link.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var helpers_1 = __webpack_require__("./src/app/components/helpers.ts");
var labarchives_service_1 = __webpack_require__("./src/app/labarchives.service.ts");
/**
 * Contributor Model
 *
 * @author <a target='_' href='https://github.com/moisbo'>moisbo</a>
 *
 */
var LabarchivesLinkField = /** @class */ (function (_super) {
    __extends(LabarchivesLinkField, _super);
    function LabarchivesLinkField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.LinkItem = new core_1.EventEmitter();
        _this.list = new core_1.EventEmitter();
        _this.labarchivesService = _this.getFromInjector(labarchives_service_1.LabarchivesService);
        _this.closeLabel = 'Close';
        _this.processing = false;
        _this.workspaceDetailsTitle = 'Workspace';
        _this.workspaceDefinition = '';
        _this.currentWorkspace = {};
        _this.processingLabel = options['processingLabel'] || 'Processing...';
        _this.processingMessage = '';
        _this.checks = new helpers_1.Checks();
        _this.processingSuccess = options['processingSuccess'] || 'Success';
        _this.processingFail = options['processingFail'] || 'There was a problem linking your workspace, please try again later';
        _this.processingStatus = '';
        _this.processingNoPermission = options['processingNoPermission'] || 'You are not allowed to modify this item';
        return _this;
    }
    LabarchivesLinkField.prototype.init = function () {
        this.rdmp = this.fieldMap._rootComp.rdmp;
    };
    LabarchivesLinkField.prototype.registerEvents = function () {
        this.fieldMap['List'].field['link'].subscribe(this.linkItem.bind(this));
        this.fieldMap['Create'].field['link'].subscribe(this.linkItem.bind(this));
    };
    LabarchivesLinkField.prototype.createFormModel = function (valueElem) {
        if (valueElem === void 0) { valueElem = undefined; }
        if (valueElem) {
            this.value = valueElem;
        }
        this.formModel = new forms_1.FormControl(this.value || []);
        if (this.value) {
            this.setValue(this.value);
        }
        return this.formModel;
    };
    LabarchivesLinkField.prototype.setValue = function (value) {
        this.formModel.patchValue(value, { emitEvent: false });
        this.formModel.markAsTouched();
    };
    LabarchivesLinkField.prototype.setEmptyValue = function () {
        this.value = [];
        return this.value;
    };
    LabarchivesLinkField.prototype.linkItem = function (item) {
        return __awaiter(this, void 0, void 0, function () {
            var link, e_1;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        jQuery('#linkModal').modal('show');
                        this.processing = true;
                        this.processingStatus = 'linking';
                        return [4 /*yield*/, this.labarchivesService.link(item, this.rdmp)];
                    case 1:
                        link = _a.sent();
                        this.processingStatus = 'done';
                        this.checks.link = true;
                        this.processing = false;
                        if (link.status) {
                            this.checks.linkCreated = true;
                            this.checks.master = true;
                            this.processingFail = undefined;
                            this.list.emit();
                        }
                        else if (link.message === 'cannot insert node') {
                            this.processingFail = this.processingNoPermission;
                            this.checks.linkWithOther = true;
                        }
                        return [3 /*break*/, 3];
                    case 2:
                        e_1 = _a.sent();
                        this.processing = false;
                        this.checks.linkWithOther = true;
                        return [3 /*break*/, 3];
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    __decorate([
        core_1.Input(),
        __metadata("design:type", core_1.EventEmitter)
    ], LabarchivesLinkField.prototype, "LinkItem", void 0);
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], LabarchivesLinkField.prototype, "list", void 0);
    return LabarchivesLinkField;
}(field_base_1.FieldBase));
exports.LabarchivesLinkField = LabarchivesLinkField;
/**
 * Component that Links Workspaces to Workspace Records in Stash
 */
var LabarchivesLinkComponent = /** @class */ (function (_super) {
    __extends(LabarchivesLinkComponent, _super);
    function LabarchivesLinkComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabarchivesLinkComponent.prototype.ngOnInit = function () {
        this.field.init();
        this.field.registerEvents();
    };
    LabarchivesLinkComponent = __decorate([
        core_1.Component({
            selector: 'ws-labarchiveslink',
            template: "\n    <div id=\"linkModal\" class=\"modal fade\" data-keyboard=\"false\">\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header\">\n            <h4 class=\"modal-title\">Link Workspace</h4>\n          </div>\n          <div class=\"modal-body\">\n            <h5>{{ field.workspaceDetailsTitle }}</h5>\n            <p *ngFor=\"let item of field.workspaceDefinition\">{{ item.label }} :\n              {{ field.currentWorkspace[item.name]}}</p>\n            <h5 *ngIf=\"field.processing\">{{ field.processingLabel }}</h5>\n            <p *ngIf=\"field.processing\">{{ field.processingMessage }}&nbsp;</p>\n            <p class=\"alert alert-success\" *ngIf=\"field.checks.linkCreated\">{{ field.processingSuccess }}</p>\n            <p class=\"alert alert-danger\" *ngIf=\"field.processingStatus === 'done' && field.processingFail\">\n              {{ field.processingFail }}</p>\n            <ng-template #isDone>\n              <i class=\"fa fa-check-circle\"></i>\n            </ng-template>\n            <ng-template #isSpinning>\n              <i class=\"fa fa-spinner fa-spin\"></i>\n            </ng-template>\n          </div>\n          <div class=\"modal-footer\">\n            <span *ngIf=\"field.processing; then waitForProcessing; else finishProcessing\"></span>\n            <ng-template #finishProcessing>\n              <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">{{ field.closeLabel }}</button>\n            </ng-template>\n            <ng-template #waitForProcessing>\n              <button type=\"button\" class=\"btn btn-secondary disabled\" data-dismiss=\"modal\">{{ field.closeLabel }}\n              </button>\n            </ng-template>\n          </div>\n        </div>\n      </div>\n    </div>\n  "
        })
    ], LabarchivesLinkComponent);
    return LabarchivesLinkComponent;
}(field_simple_component_1.SimpleComponent));
exports.LabarchivesLinkComponent = LabarchivesLinkComponent;


/***/ }),

/***/ "./src/app/components/labarchives-list.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var labarchives_service_1 = __webpack_require__("./src/app/labarchives.service.ts");
var LabarchivesListField = /** @class */ (function (_super) {
    __extends(LabarchivesListField, _super);
    function LabarchivesListField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.accessDeniedObjects = [];
        _this.failedObjects = [];
        _this.labUser = {};
        _this.link = new core_1.EventEmitter();
        _this.checkLoggedIn = new core_1.EventEmitter();
        _this.create = new core_1.EventEmitter();
        _this.goToExporter = new core_1.EventEmitter();
        _this.labarchivesService = _this.getFromInjector(labarchives_service_1.LabarchivesService);
        _this.columns = [
            { 'label': 'Name', 'property': 'name' },
            { 'label': 'Default', 'property': 'isDefault' }
        ];
        _this.rdmpLinkLabel = 'Plan';
        _this.syncLabel = 'Sync';
        _this.linkedLabel = options['linkedLabel'] || 'Linked';
        _this.linkedAnotherLabel = options['linkedAnotherLabel'] || 'Linked to another workspace';
        _this.linkLabel = options['linkLabel'] || 'Link Workspace';
        _this.linkProblem = options['linkProblem'] || 'There was a problem checking the link';
        _this.defaultNotebookLabel = options['defaultNotebookLabel'] || 'Default Notebook';
        _this.createNotebookLabel = options['createNotebookLabel'] || 'Create Notebook';
        return _this;
    }
    LabarchivesListField.prototype.registerEvents = function () {
        this.fieldMap['Login'].field['userLogin'].subscribe(this.listWorkspaces.bind(this));
        this.fieldMap['Link'].field['list'].subscribe(this.listWorkspaces.bind(this));
        this.fieldMap['Export'].field['list'].subscribe(this.listWorkspaces.bind(this));
    };
    LabarchivesListField.prototype.init = function () {
        this.rdmp = this.fieldMap._rootComp.rdmp;
    };
    LabarchivesListField.prototype.listWorkspaces = function () {
        var _this = this;
        this.loading = true;
        this.labarchivesService.rdmpInfo(this.rdmp).then(function (response) {
            _this.fieldMap._rootComp.rdmpMetadata = response['recordMetadata'];
            _this.rdmpTitle = _this.fieldMap._rootComp.rdmpMetadata['title'];
            return _this.labarchivesService.list();
        }).then(function (response) {
            if (response.status) {
                var notebooks = response['notebooks']['notebook'];
                _this.loggedIn = _this.fieldMap._rootComp.loggedIn = true;
                _this.checkLoggedIn.emit(true);
                _this.workspaces = notebooks.map(function (nb) {
                    console.log(nb['is-default']['_']);
                    return {
                        id: nb['id'],
                        name: nb['name'],
                        isDefault: nb['is-default']['_'] == 'true' ? _this.defaultNotebookLabel : '',
                        rdmp: { info: '' }
                    };
                });
                _this.loading = false;
                _this.checkLinks();
            }
            else {
                _this.checkLoggedIn.emit(false);
                _this.loading = false;
                throw new Error('cannot list');
            }
        }).catch(function (error) {
            _this.loading = false;
            _this.workspaces = null;
            _this.checkLoggedIn.emit(false);
        });
    };
    LabarchivesListField.prototype.linkWorkspace = function (item) {
        this.link.emit(item);
    };
    LabarchivesListField.prototype.createWorkspace = function () {
        this.create.emit();
    };
    LabarchivesListField.prototype.checkLinks = function () {
        var _this = this;
        this.loadingChecks = true;
        var links = this.workspaces.reduce(function (promise, w, index) {
            return promise.then(function () {
                return _this.labarchivesService.checkLink(_this.rdmp, w['id'])
                    .then(function (response) {
                    if (!response.status) {
                        throw new Error('Error checking workspace');
                    }
                    else {
                        var check = response['check'];
                        if (check['link'] === 'linked') {
                            _this.workspaces[index]['linkedState'] = 'linked';
                        }
                        else {
                            _this.workspaces[index]['linkedState'] = 'link';
                        }
                    }
                })
                    .catch(function (error) {
                    _this.workspaces[index]['linkedState'] = 'problem';
                });
            });
        }, Promise.resolve());
        links.then(function (e) {
            console.log(e);
            _this.loadingChecks = false;
        });
    };
    LabarchivesListField.prototype.exporter = function (item) {
        this.workspaces = null;
        this.goToExporter.emit(item);
    };
    LabarchivesListField.prototype.logOut = function () {
        alert('not implemented');
    };
    __decorate([
        core_1.Input(),
        __metadata("design:type", Object)
    ], LabarchivesListField.prototype, "user", void 0);
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], LabarchivesListField.prototype, "link", void 0);
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], LabarchivesListField.prototype, "checkLoggedIn", void 0);
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], LabarchivesListField.prototype, "create", void 0);
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], LabarchivesListField.prototype, "goToExporter", void 0);
    return LabarchivesListField;
}(field_base_1.FieldBase));
exports.LabarchivesListField = LabarchivesListField;
var LabarchivesListComponent = /** @class */ (function (_super) {
    __extends(LabarchivesListComponent, _super);
    function LabarchivesListComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabarchivesListComponent.prototype.ngOnInit = function () {
        this.field.registerEvents();
        //this.field.init();
    };
    LabarchivesListComponent.prototype.ngAfterContentInit = function () {
        this.field.init();
    };
    LabarchivesListComponent = __decorate([
        core_1.Component({
            selector: 'ws-labarchiveslist',
            template: "\n    <div class=\"row\">\n      <h4>Current Data Plan Selected: {{ field.rdmpTitle }}</h4>\n    </div>\n    <div class=\"row\">\n      <div *ngIf=\"field.workspaces\" class=\"col-lg-12\">\n        <div class=\"\">\n          <table class=\"table\">\n            <thead>\n            <tr>\n              <ng-container *ngFor=\"let header of field.columns\">\n                <th>{{ header.label }}</th>\n              </ng-container>\n              <th>{{ field.rdmpLinkLabel }}</th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr *ngFor=\"let item of field.workspaces\">\n              <ng-container *ngFor=\"let column of field.columns\">\n                <td *ngIf=\"column.show != false\">\n                  <span *ngIf=\"column.link; else noProcessing \">\n                    <a target=\"_blank\" rel=\"noopener noreferrer\"\n                       href=\"{{ item[column.property] }}\">{{ item[column.property]}}</a>\n                  </span>\n                  <ng-template #multivalue></ng-template>\n                  <ng-template #noProcessing><span>{{ item[column.property] }}</span></ng-template>\n                </td>\n              </ng-container>\n              <td>\n                <span *ngIf=\"!item['linkedState']\">\n                  <button type=\"button\" disabled class=\"btn btn-info btn-block\" [name]=\"item['@id']\">\n                    <span><i class=\"fa fa-spinner fa-spin\"></i></span></button>\n                </span>\n                <span *ngIf=\"item['linkedState'] === 'linked'\">\n                  <button type=\"button\" disabled class=\"btn btn-success btn-block\"\n                          [name]=\"item['@id']\">{{ field.linkedLabel }}</button>\n                </span>\n                <span *ngIf=\"item['linkedState'] === 'another'\">\n                  <button type=\"button\" disabled class=\"btn btn-info btn-block\"\n                          [name]=\"item['@id']\">{{ field.linkedAnotherLabel }}</button>\n                </span>\n                <span *ngIf=\"item['linkedState'] === 'link'\">\n                  <button type=\"button\" class=\"btn btn-info btn-block\" [name]=\"item['@id']\"\n                          (click)=\"field.linkWorkspace(item)\">{{ field.linkLabel }}</button>\n                </span>\n                <span *ngIf=\"item['linkedState'] === 'problem'\">\n                  <button type=\"button\" disabled class=\"btn btn-warning btn-block\"\n                          [name]=\"item['@id']\">{{ field.linkProblem }}</button>\n                </span>\n              </td>\n              <td>\n                <button class=\"btn btn-primary btn-block\" [disabled]=\"field.loadingChecks ? 'disabled': null\"\n                        (click)=\"field.exporter(item)\">Export\n                </button>\n              </td>\n            </tr>\n            </tbody>\n          </table>\n          <div *ngIf=\"field.loading\" class=\"\">\n            <img class=\"center-block\" src=\"/images/loading.svg\">\n          </div>\n          <div>\n            <p *ngIf=\"field.failedObjects.length > 0\">There were {{ field.failedObjects.length }} records that failed to\n              load</p>\n            <p *ngIf=\"field.accessDeniedObjects.length > 0\">There were {{ field.accessDeniedObjects.length }} records\n              that\n              you do not have access to</p>\n          </div>\n        </div>\n        <div class=\"row\">\n          <button class=\"btn btn-primary\" type=\"button\"\n                  (click)=\"field.createWorkspace()\">{{field.createNotebookLabel}}</button>\n        </div>\n        <p>&nbsp;</p>\n<!--        <div class=\"row\">-->\n<!--          <button class=\"btn btn-secondary\" type=\"button\"-->\n<!--                  (click)=\"field.logOut()\">Revoke Login Consent-->\n<!--          </button>-->\n<!--        </div>-->\n        <div class=\"row\">&nbsp;</div>\n      </div>\n    </div>\n  "
        })
    ], LabarchivesListComponent);
    return LabarchivesListComponent;
}(field_simple_component_1.SimpleComponent));
exports.LabarchivesListComponent = LabarchivesListComponent;


/***/ }),

/***/ "./src/app/components/labarchives-login.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var field_simple_component_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-simple.component.ts");
var field_base_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-base.ts");
var labarchives_service_1 = __webpack_require__("./src/app/labarchives.service.ts");
var LabarchivesLoginField = /** @class */ (function (_super) {
    __extends(LabarchivesLoginField, _super);
    function LabarchivesLoginField(options, injector) {
        var _this = _super.call(this, options, injector) || this;
        _this.valid = true;
        _this.submitted = false;
        _this.errorMessage = undefined;
        _this.userLogin = new core_1.EventEmitter();
        _this.listWorkspaces = new core_1.EventEmitter();
        _this.loading = true;
        _this.columns = options['columns'] || [];
        _this.usernameLabel = options['usernameLabel'] || 'Username';
        _this.passwordLabel = options['passwordLabel'] || 'Password';
        _this.userLoginError = options['userLoginError'] || 'Please include username';
        _this.userPasswordError = options['userPasswordError'] || 'Please include password';
        _this.loginLabel = options['loginLabel'] || 'Login';
        _this.helpLoginLabel = options['helpLoginLabel'] || '';
        _this.helpLoginLabelList = options['helpLoginLabelList'] || [];
        _this.loginHelpImageAlt = options['loginHelpImageAlt'] || 'labarchives help login';
        _this.loginHelpImage = options['loginHelpImage'] || _this.loginHelpImageAlt;
        _this.closeLabel = options['closeLabel'] || 'Close';
        _this.labarchivesService = _this.getFromInjector(labarchives_service_1.LabarchivesService);
        return _this;
    }
    LabarchivesLoginField.prototype.registerEvents = function () {
        this.fieldMap['List'].field['checkLoggedIn'].subscribe(this.checkLogin.bind(this));
        this.setUserEmail();
    };
    LabarchivesLoginField.prototype.checkLogin = function (status) {
        this.loggedIn = this.fieldMap._rootComp.loggedIn = status;
        this.loading = false;
    };
    LabarchivesLoginField.prototype.setUserEmail = function () {
        return __awaiter(this, void 0, void 0, function () {
            var userInfo, user, info;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.labarchivesService.getUserInfo()];
                    case 1:
                        userInfo = _a.sent();
                        user = userInfo['user'];
                        this.userEmail = user['email'];
                        return [4 /*yield*/, this.labarchivesService.info()];
                    case 2:
                        info = _a.sent();
                        this.location = info['location'];
                        return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesLoginField.prototype.login = function (form) {
        return __awaiter(this, void 0, void 0, function () {
            var formValid, login;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        formValid = this.loginValid(form);
                        if (!(formValid === '')) return [3 /*break*/, 2];
                        // TODO: Investigate this. Using this method to remove the trailing Base64 equals ==
                        form.password = form.password.trim();
                        form.password = form.password.replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
                        this.user = { username: this.userEmail, password: form.password };
                        return [4 /*yield*/, this.labarchivesService.login(this.user.username, this.user.password)];
                    case 1:
                        login = _a.sent();
                        if (login.status) {
                            this.loggedIn = true;
                            this.userLogin.emit(login.labUser);
                            this.submitted = true;
                            this.errorMessage = null;
                        }
                        else {
                            this.errorMessage = login.message;
                        }
                        return [3 /*break*/, 3];
                    case 2:
                        this.errorMessage = formValid;
                        _a.label = 3;
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesLoginField.prototype.loginValid = function (form) {
        if (!form.userEmail) {
            return this.userLoginError;
        }
        if (!form.password) {
            return this.userPasswordError;
        }
        return '';
    };
    LabarchivesLoginField.prototype.loginViaInstitution = function () {
        jQuery('#institutionModal').modal('show');
    };
    __decorate([
        core_1.Output(),
        __metadata("design:type", Object)
    ], LabarchivesLoginField.prototype, "userLogin", void 0);
    __decorate([
        core_1.Output(),
        __metadata("design:type", core_1.EventEmitter)
    ], LabarchivesLoginField.prototype, "listWorkspaces", void 0);
    return LabarchivesLoginField;
}(field_base_1.FieldBase));
exports.LabarchivesLoginField = LabarchivesLoginField;
var LabarchivesLoginComponent = /** @class */ (function (_super) {
    __extends(LabarchivesLoginComponent, _super);
    function LabarchivesLoginComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    LabarchivesLoginComponent.prototype.ngOnInit = function () {
        this.field.registerEvents();
    };
    LabarchivesLoginComponent = __decorate([
        core_1.Component({
            selector: 'ws-labarchiveslogin',
            template: "\n    <div class=\"row\" *ngIf=\"!field.loading\">\n      <div *ngIf=\"!field.loggedIn\" class=\"col-md-6\">\n        <form #form=\"ngForm\">\n          <div class=\"form-group\">\n            <label>{{ field.usernameLabel }}</label>\n            <input type=\"text\" class=\"form-control\" [(ngModel)]=\"field.userEmail\" name=\"userEmail\" ngModel\n                   attr.aria-label=\"{{ field.usernameLabel }}\">\n          </div>\n          <div class=\"form-group\">\n            <label>{{ field.passwordLabel }}</label>\n            <input type=\"password\" class=\"form-control\" ngModel name=\"password\"\n                   attr.aria-label=\"{{ field.passwordLabel }}\">\n          </div>\n          <div class=\"form-row\">\n            <p>\n              <button (click)=\"field.login(form.value)\" type=\"submit\" [disabled]=\"!field.valid\" class=\"btn btn-primary\">\n                {{ field.loginLabel }}\n              </button>\n              <!--or-->\n              <!--<button (click)=\"field.loginViaInstitution()\" type=\"submit\" [disabled]=\"!field.valid\"-->\n              <!--class=\"btn btn-info\">-->\n              <!--Login trough UTS-->\n              <!--</button>-->\n            </p>\n          </div>\n          <div class=\"form-row\">\n            <div class=\"alert alert-danger\" *ngIf=\"field.errorMessage\">{{ field.errorMessage }}</div>\n          </div>\n          <div>\n            <p>&nbsp;</p>\n          </div>\n        </form>\n      </div>\n      <div *ngIf=\"!field.loggedIn\" class=\"col-md-6\">\n        <div class=\"form-row\">\n          <p>{{ field.helpLoginLabel }}</p>\n          <p><a href=\"{{ field.location }}\" target=\"_blank\" rel=\"noopener noreferrer\">{{ field.location }}</a></p>\n          <ul>\n            <li *ngFor=\"let help of field.helpLoginLabelList\">{{ help }}</li>\n          </ul>\n          <div class=\"form-row col-md-6\">\n            <img alt=\"{{ field.loginHelpImageAlt }}\" [src]=\"field.loginHelpImage\"\n                 style=\"padding: 4px; border: dotted 1px #ccc;\"/>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"row\">\n      <p>&nbsp;</p>\n    </div>\n    <div id=\"institutionModal\" class=\"modal fade\">\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header\">\n            <h4 class=\"modal-title\">Login via UTS</h4>\n          </div>\n          <div class=\"modal-body\">\n            <p>Login not available please use Key method</p>\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">{{ field.closeLabel }}</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  "
        })
    ], LabarchivesLoginComponent);
    return LabarchivesLoginComponent;
}(field_simple_component_1.SimpleComponent));
exports.LabarchivesLoginComponent = LabarchivesLoginComponent;


/***/ }),

/***/ "./src/app/labarchives-form.component.css":
/***/ (function(module, exports) {

module.exports = ""

/***/ }),

/***/ "./src/app/labarchives-form.component.html":
/***/ (function(module, exports) {

module.exports = "<div *ngIf=\"!criticalError\" class=\"row\">\n  <div class=\"col-xs-2\"></div>\n  <div class=\"col-xs-8\">\n    <ws-field *ngFor=\"let field of fields\" [field]=\"field\"\n              [form]=\"form\" class=\"form-row\" [fieldMap]=\"fieldMap\">\n    </ws-field>\n  </div>\n</div>\n<div *ngIf=\"criticalError\" class=\"row\">\n  <div class=\"col-xs-2\"></div>\n  <div class=\"col-xs-8\">\n    <div class=\"panel panel-danger\">\n      <div class=\"panel-heading\">\n        <h3 class=\"panel-title\">Error</h3>\n      </div>\n      <div class=\"panel-body\">\n        <code>\n          {{criticalError}}\n        </code>\n      </div>\n    </div>\n  </div>\n  <div class=\"col-xs-2\"></div>\n</div>\n"

/***/ }),

/***/ "./src/app/labarchives-form.component.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var http_1 = __webpack_require__("./node_modules/@angular/common/esm5/http.js");
var common_1 = __webpack_require__("./node_modules/@angular/common/esm5/common.js");
var records_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/records.service.ts");
var loadable_component_1 = __webpack_require__("./redbox-portal/angular/shared/loadable.component.ts");
var field_control_service_1 = __webpack_require__("./redbox-portal/angular/shared/form/field-control.service.ts");
var translation_service_1 = __webpack_require__("./redbox-portal/angular/shared/translation-service.ts");
var labarchives_login_component_1 = __webpack_require__("./src/app/components/labarchives-login.component.ts");
var labarchives_list_component_1 = __webpack_require__("./src/app/components/labarchives-list.component.ts");
var labarchives_link_component_1 = __webpack_require__("./src/app/components/labarchives-link.component.ts");
var labarchives_create_component_1 = __webpack_require__("./src/app/components/labarchives-create.component.ts");
var labarchives_export_component_1 = __webpack_require__("./src/app/components/labarchives-export.component.ts");
/**
 * Main LabArchives Edit component
 *
 * @author <a target='_' href='https://github.com/moisbo'>moisbo</a>
 *
 */
var LabarchivesFormComponent = /** @class */ (function (_super) {
    __extends(LabarchivesFormComponent, _super);
    function LabarchivesFormComponent(elm, RecordsService, fcs, LocationService, translationService) {
        var _this = _super.call(this) || this;
        _this.RecordsService = RecordsService;
        _this.fcs = fcs;
        _this.LocationService = LocationService;
        _this.translationService = translationService;
        /**
         * Fields for the form
         */
        _this.fields = [];
        _this.loading = false;
        _this.oid = elm.nativeElement.getAttribute('oid');
        _this.editMode = elm.nativeElement.getAttribute('editMode') == "true";
        _this.recordType = elm.nativeElement.getAttribute('recordType');
        _this.rdmp = elm.nativeElement.getAttribute('rdmp');
        _this.action = _this.getParamValueQueryString('action');
        _this.workspaceId = _this.getParamValueQueryString('workspaceId');
        // TODO: Find out what is this next line!
        _this.fieldMap = { _rootComp: _this };
        _this.user = {};
        _this.initSubs = RecordsService.waitForInit(function (initStat) {
            _this.initSubs.unsubscribe();
            _this.loadForm();
        });
        return _this;
    }
    LabarchivesFormComponent.prototype.loginUser = function (user) {
        this.user = user;
    };
    LabarchivesFormComponent.prototype.registerEvents = function () {
        //this.fieldMap['ListWorkspaces'].field['setWorkspaceUser'].subscribe(this.setWorkspaceUser.bind(this));
    };
    LabarchivesFormComponent.prototype.loadForm = function () {
        var _this = this;
        this.fcs.addComponentClasses({
            'LabarchivesLoginField': { 'meta': labarchives_login_component_1.LabarchivesLoginField, 'comp': labarchives_login_component_1.LabarchivesLoginComponent },
            'LabarchivesListField': { 'meta': labarchives_list_component_1.LabarchivesListField, 'comp': labarchives_list_component_1.LabarchivesListComponent },
            'LabarchivesLinkField': { 'meta': labarchives_link_component_1.LabarchivesLinkField, 'comp': labarchives_link_component_1.LabarchivesLinkComponent },
            'LabarchivesCreateField': { 'meta': labarchives_create_component_1.LabarchivesCreateField, 'comp': labarchives_create_component_1.LabarchivesCreateComponent },
            'LabarchivesExportField': { 'meta': labarchives_export_component_1.LabarchivesExportField, 'comp': labarchives_export_component_1.LabarchivesExportComponent },
        });
        this.RecordsService.getForm(this.oid, this.recordType, this.editMode).then(function (obs) {
            obs.subscribe(function (form) {
                _this.formDef = form;
                if (_this.editMode) {
                    _this.cssClasses = _this.formDef.editCssClasses;
                }
                else {
                    _this.cssClasses = _this.formDef.viewCssClasses;
                }
                _this.loggedIn = false;
                if (form.fieldsMeta) {
                    _this.fields = form.fieldsMeta;
                    _this.rebuildForm();
                    _this.watchForChanges();
                    _this.registerEvents();
                    var focusTab = '?focusTabId=workspaces';
                    _this.fieldMap['BackToPlan'].field.value = _this.fieldMap['BackToPlan'].field.value + _this.rdmp + focusTab;
                }
            });
        }).catch(function (err) {
            console.log("Error loading form...");
            console.log(err);
            if (err.status == false) {
                _this.criticalError = err.message;
            }
            _this.setLoading(false);
        });
    };
    /**
     * Rebuild the form message.
     *
     * @return {[type]}
     */
    LabarchivesFormComponent.prototype.rebuildForm = function () {
        this.form = this.fcs.toFormGroup(this.fields, this.fieldMap);
    };
    /**
     * Enable form change monitor.
     *
     * @return {[type]}
     */
    LabarchivesFormComponent.prototype.watchForChanges = function () {
        this.setLoading(false);
        if (this.editMode) {
            this.form.valueChanges.subscribe(function (data) {
                //this.needsSave = true;
            });
        }
    };
    // setWorkspaceUser(workspaceUser: WorkspaceUser) {
    //   this.workspaceUser = workspaceUser;
    // }
    LabarchivesFormComponent.prototype.getParamValueQueryString = function (paramName) {
        var url = window.location.href;
        var paramValue;
        if (url.includes('?')) {
            var httpParams = new http_1.HttpParams({ fromString: url.split('?')[1] });
            paramValue = httpParams.get(paramName);
        }
        return paramValue;
    };
    __decorate([
        core_1.Input(),
        __metadata("design:type", String)
    ], LabarchivesFormComponent.prototype, "oid", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", Boolean)
    ], LabarchivesFormComponent.prototype, "editMode", void 0);
    __decorate([
        core_1.Input(),
        __metadata("design:type", String)
    ], LabarchivesFormComponent.prototype, "recordType", void 0);
    LabarchivesFormComponent = __decorate([
        core_1.Component({
            moduleId: module.i,
            selector: 'labarchives-form',
            template: __webpack_require__("./src/app/labarchives-form.component.html"),
            styles: [__webpack_require__("./src/app/labarchives-form.component.css")],
            providers: [common_1.Location, { provide: common_1.LocationStrategy, useClass: common_1.PathLocationStrategy }]
        }),
        __param(1, core_1.Inject(records_service_1.RecordsService)),
        __param(2, core_1.Inject(field_control_service_1.FieldControlService)),
        __param(3, core_1.Inject(common_1.Location)),
        __metadata("design:paramtypes", [core_1.ElementRef,
            records_service_1.RecordsService,
            field_control_service_1.FieldControlService,
            common_1.Location,
            translation_service_1.TranslationService])
    ], LabarchivesFormComponent);
    return LabarchivesFormComponent;
}(loadable_component_1.LoadableComponent));
exports.LabarchivesFormComponent = LabarchivesFormComponent;


/***/ }),

/***/ "./src/app/labarchives.module.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
var platform_browser_1 = __webpack_require__("./node_modules/@angular/platform-browser/esm5/platform-browser.js");
var forms_1 = __webpack_require__("./node_modules/@angular/forms/esm5/forms.js");
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var shared_module_1 = __webpack_require__("./redbox-portal/angular/shared/shared.module.ts");
var labarchives_service_1 = __webpack_require__("./src/app/labarchives.service.ts");
var labarchives_form_component_1 = __webpack_require__("./src/app/labarchives-form.component.ts");
var labarchives_login_component_1 = __webpack_require__("./src/app/components/labarchives-login.component.ts");
var labarchives_list_component_1 = __webpack_require__("./src/app/components/labarchives-list.component.ts");
var labarchives_link_component_1 = __webpack_require__("./src/app/components/labarchives-link.component.ts");
var labarchives_create_component_1 = __webpack_require__("./src/app/components/labarchives-create.component.ts");
var labarchives_export_component_1 = __webpack_require__("./src/app/components/labarchives-export.component.ts");
var LabarchivesModule = /** @class */ (function () {
    function LabarchivesModule() {
    }
    LabarchivesModule = __decorate([
        core_1.NgModule({
            imports: [
                platform_browser_1.BrowserModule, forms_1.ReactiveFormsModule, forms_1.FormsModule, shared_module_1.SharedModule
            ],
            declarations: [
                labarchives_form_component_1.LabarchivesFormComponent, labarchives_login_component_1.LabarchivesLoginComponent, labarchives_list_component_1.LabarchivesListComponent, labarchives_link_component_1.LabarchivesLinkComponent, labarchives_create_component_1.LabarchivesCreateComponent, labarchives_export_component_1.LabarchivesExportComponent
            ],
            exports: [],
            providers: [
                labarchives_service_1.LabarchivesService
            ],
            bootstrap: [
                labarchives_form_component_1.LabarchivesFormComponent
            ],
            entryComponents: [
                labarchives_form_component_1.LabarchivesFormComponent, labarchives_list_component_1.LabarchivesListComponent, labarchives_login_component_1.LabarchivesLoginComponent, labarchives_link_component_1.LabarchivesLinkComponent, labarchives_create_component_1.LabarchivesCreateComponent, labarchives_export_component_1.LabarchivesExportComponent
            ]
        })
    ], LabarchivesModule);
    return LabarchivesModule;
}());
exports.LabarchivesModule = LabarchivesModule;


/***/ }),

/***/ "./src/app/labarchives.service.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = y[op[0] & 2 ? "return" : op[0] ? "throw" : "next"]) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [0, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var Subject_1 = __webpack_require__("./node_modules/rxjs/_esm5/Subject.js");
var http_1 = __webpack_require__("./node_modules/@angular/http/esm5/http.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/toPromise.js");
__webpack_require__("./node_modules/rxjs/_esm5/add/operator/delay.js");
var base_service_1 = __webpack_require__("./redbox-portal/angular/shared/base-service.ts");
var config_service_1 = __webpack_require__("./redbox-portal/angular/shared/config-service.ts");
var LabarchivesService = /** @class */ (function (_super) {
    __extends(LabarchivesService, _super);
    function LabarchivesService(http, configService) {
        var _this = _super.call(this, http, configService) || this;
        _this.configService = configService;
        _this.recordURL = _this.brandingAndPortalUrl + '/record/view';
        _this.initSubject = new Subject_1.Subject();
        _this.emitInit();
        return _this;
    }
    LabarchivesService.prototype.waitForInit = function (handler) {
        var subs = this.initSubject.subscribe(handler);
        this.emitInit();
        return subs;
    };
    LabarchivesService.prototype.emitInit = function () {
        if (this.brandingAndPortalUrl) {
            this.initSubject.next('');
        }
    };
    LabarchivesService.prototype.info = function () {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_1;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/ws/labarchives/info';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.http.get(wsUrl, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve(this.extractData(result))];
                    case 3:
                        e_1 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_1))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesService.prototype.login = function (username, password) {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_2;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/ws/labarchives/login';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.http.post(wsUrl, { username: username, password: password }, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve(this.extractData(result))];
                    case 3:
                        e_2 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_2))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesService.prototype.list = function () {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_3;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/ws/labarchives/list';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.http.get(wsUrl, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve(this.extractData(result))];
                    case 3:
                        e_3 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_3))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesService.prototype.link = function (workspace, rdmpId) {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_4;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/ws/labarchives/link';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.http.post(wsUrl, { rdmp: rdmpId, workspace: workspace }, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve(this.extractData(result))];
                    case 3:
                        e_4 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_4))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesService.prototype.checkLink = function (rdmpId, nbId) {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_5;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/ws/labarchives/checkLink';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.http.post(wsUrl, { rdmp: rdmpId, nbId: nbId }, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve(this.extractData(result))];
                    case 3:
                        e_5 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_5))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesService.prototype.getUserInfo = function () {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_6;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/user/info';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.http.get(wsUrl, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve((this.extractData(result)))];
                    case 3:
                        e_6 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_6))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesService.prototype.createNotebook = function (rdmp, nbName, supervisorEmail, userEmail) {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_7;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/ws/labarchives/create';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.http.post(wsUrl, { name: nbName, supervisor: supervisorEmail, rdmp: rdmp, userEmail: userEmail }, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve((this.extractData(result)))];
                    case 3:
                        e_7 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_7))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesService.prototype.rdmpInfo = function (rdmp) {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_8;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/ws/labarchives/rdmp';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.http.post(wsUrl, { rdmp: rdmp }, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve((this.extractData(result)))];
                    case 3:
                        e_8 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_8))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesService.prototype.findNotebook = function (rdmp, workspace) {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_9;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/ws/labarchives/findNotebook';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        console.log('requesting this: ' + workspace);
                        return [4 /*yield*/, this.http.post(wsUrl, { rdmp: rdmp, workspace: workspace }, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve((this.extractData(result)))];
                    case 3:
                        e_9 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_9))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesService.prototype.notebookInfo = function (rdmp, notebook) {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_10;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/ws/labarchives/notebook';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        console.log('requesting this: ' + notebook);
                        return [4 /*yield*/, this.http.post(wsUrl, { rdmp: rdmp, notebook: notebook }, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve((this.extractData(result)))];
                    case 3:
                        e_10 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_10))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesService.prototype.exportNotebook = function (rdmp, notebook) {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_11;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/ws/labarchives/export';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.http.post(wsUrl, { rdmp: rdmp, notebook: notebook }, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve((this.extractData(result)))];
                    case 3:
                        e_11 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_11))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesService.prototype.zipNotebook = function (notebook) {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_12;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/ws/labarchives/zipExport';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.http.post(wsUrl, { notebook: notebook }, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve((this.extractData(result)))];
                    case 3:
                        e_12 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_12))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesService.prototype.checkExport = function (workspace) {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_13;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/ws/labarchives/checkExport';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.http.post(wsUrl, { workspace: workspace }, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve((this.extractData(result)))];
                    case 3:
                        e_13 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_13))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesService.prototype.returnNotebook = function (notebook) {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_14;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/ws/labarchives/returnExport';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.http.post(wsUrl, { notebook: notebook }, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve((this.extractData(result)))];
                    case 3:
                        e_14 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_14))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesService.prototype.createDataRecord = function (rdmp, rdmpTitle, isHdr, notebookFile, notebookTitle, retention, disposal, isc, contributor_ci, contributor_data_manager, keywords) {
        return __awaiter(this, void 0, void 0, function () {
            var wsUrl, result, e_15;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        wsUrl = this.brandingAndPortalUrl + '/ws/labarchives/createDataRecord';
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.http.post(wsUrl, {
                                rdmp: rdmp, rdmpTitle: rdmpTitle, isHdr: isHdr, notebookFile: notebookFile, notebookTitle: notebookTitle,
                                retention: retention, disposal: disposal, isc: isc,
                                contributor_ci: contributor_ci, contributor_data_manager: contributor_data_manager, keywords: keywords
                            }, this.options).toPromise()];
                    case 2:
                        result = _a.sent();
                        return [2 /*return*/, Promise.resolve((this.extractData(result)))];
                    case 3:
                        e_15 = _a.sent();
                        return [2 /*return*/, Promise.reject(new Error(e_15))];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    LabarchivesService = __decorate([
        core_1.Injectable(),
        __param(0, core_1.Inject(http_1.Http)),
        __param(1, core_1.Inject(config_service_1.ConfigService)),
        __metadata("design:paramtypes", [http_1.Http,
            config_service_1.ConfigService])
    ], LabarchivesService);
    return LabarchivesService;
}(base_service_1.BaseService));
exports.LabarchivesService = LabarchivesService;


/***/ }),

/***/ "./src/environments/environment.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// The file contents for the current environment will overwrite these during build.
// The build system defaults to the dev environment which uses `environment.ts`, but if you do
// `ng build --env=prod` then `environment.prod.ts` will be used instead.
// The list of which env maps to which file can be found in `.angular-cli.json`.
Object.defineProperty(exports, "__esModule", { value: true });
exports.environment = {
    production: false
};


/***/ }),

/***/ "./src/main.ts":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = __webpack_require__("./node_modules/@angular/core/esm5/core.js");
var platform_browser_dynamic_1 = __webpack_require__("./node_modules/@angular/platform-browser-dynamic/esm5/platform-browser-dynamic.js");
var labarchives_module_1 = __webpack_require__("./src/app/labarchives.module.ts");
var environment_1 = __webpack_require__("./src/environments/environment.ts");
if (environment_1.environment.production) {
    core_1.enableProdMode();
}
platform_browser_dynamic_1.platformBrowserDynamic().bootstrapModule(labarchives_module_1.LabarchivesModule)
    .catch(function (err) { return console.log(err); });


/***/ }),

/***/ 0:
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__("./src/main.ts");


/***/ }),

/***/ 1:
/***/ (function(module, exports) {

/* (ignored) */

/***/ })

},[0]);
//# sourceMappingURL=main.bundle.js.map